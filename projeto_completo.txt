==================================================
ARQUIVO: 404.html
==================================================
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Page Not Found</title>

    <style media="screen">
      body { background: #ECEFF1; color: rgba(0,0,0,0.87); font-family: Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; }
      #message { background: white; max-width: 360px; margin: 100px auto 16px; padding: 32px 24px 16px; border-radius: 3px; }
      #message h3 { color: #888; font-weight: normal; font-size: 16px; margin: 16px 0 12px; }
      #message h2 { color: #ffa100; font-weight: bold; font-size: 16px; margin: 0 0 8px; }
      #message h1 { font-size: 22px; font-weight: 300; color: rgba(0,0,0,0.6); margin: 0 0 16px;}
      #message p { line-height: 140%; margin: 16px 0 24px; font-size: 14px; }
      #message a { display: block; text-align: center; background: #039be5; text-transform: uppercase; text-decoration: none; color: white; padding: 16px; border-radius: 4px; }
      #message, #message a { box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); }
      #load { color: rgba(0,0,0,0.4); text-align: center; font-size: 13px; }
      @media (max-width: 600px) {
        body, #message { margin-top: 0; background: white; box-shadow: none; }
        body { border-top: 16px solid #ffa100; }
      }
    </style>
  </head>
  <body>
    <div id="message">
      <h2>404</h2>
      <h1>Page Not Found</h1>
      <p>The specified file was not found on this website. Please check the URL for mistakes and try again.</p>
      <h3>Why am I seeing this?</h3>
      <p>This page was generated by the Firebase Command-Line Interface. To modify it, edit the <code>404.html</code> file in your project's configured <code>public</code> directory.</p>
    </div>
  </body>
</html>


==================================================
ARQUIVO: firebase.json
==================================================
{
  "functions": [
    {
      "source": "functions",
      "codebase": "default",
      "ignore": [
        "node_modules",
        ".git",
        "firebase-debug.log",
        "firebase-debug.*.log",
        "*.local"
      ]
    }
  ],
  "hosting": {
    "public": "dist",
    "ignore": [
      "firebase.json",
      "**/.*",
      "**/node_modules/**"
    ],
    "rewrites": [
      {
        "source": "**",
        "destination": "/index.html"
      }
    ]
  },
  "emulators": {
    "auth": {
      "port": 9099
    },
    "functions": {
      "port": 5001
    },
    "firestore": {
      "port": 8081
    },
    "ui": {
      "enabled": true
    },
    "singleProjectMode": true
  }
}


==================================================
ARQUIVO: index.html
==================================================
<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Novva R&S</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>

==================================================
ARQUIVO: package.json
==================================================
{
  "name": "novva-rs-saas",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint . --ext js,jsx --report-unused-disable-directives --max-warnings 0",
    "preview": "vite preview"
  },
  "dependencies": {
    "@emotion/react": "^11.11.1",
    "@emotion/styled": "^11.11.0",
    "@mui/icons-material": "^5.14.13",
    "@mui/material": "^5.14.13",
    "@mui/x-date-pickers": "^8.12.0",
    "@supabase/supabase-js": "^2.39.0",
    "date-fns": "^2.30.0",
    "formidable": "^3.5.4",
    "lucide-react": "^0.294.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-imask": "^7.6.1",
    "react-router-dom": "^6.20.0",
    "recharts": "^2.10.0"
  },
  "devDependencies": {
    "@types/react": "^18.2.15",
    "@types/react-dom": "^18.2.7",
    "@vitejs/plugin-react": "^4.0.3",
    "autoprefixer": "^10.4.16",
    "eslint": "^8.45.0",
    "eslint-plugin-react": "^7.32.2",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-plugin-react-refresh": "^0.4.3",
    "postcss": "^8.4.31",
    "tailwindcss": "^3.4.1",
    "vite": "^4.4.5"
  }
}

==================================================
ARQUIVO: postcss.config.js
==================================================
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}

==================================================
ARQUIVO: tailwind.config.js
==================================================
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}

==================================================
ARQUIVO: vercel.json
==================================================
{
  "rewrites": [
    { "source": "/(.*)", "destination": "/index.html" }
  ]
}

==================================================
ARQUIVO: vite.config.js
==================================================
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
})

==================================================
ARQUIVO: .vercel\project.json
==================================================
{"projectId":"prj_HtLcAivMTvf4K2mSOR496vnc8rR7","orgId":"team_L2VfPt8LwRczWEzT69FA8EoY","projectName":"novva-rs-saas"}

==================================================
ARQUIVO: api\admin.js
==================================================
// api/admin.js (VERSÃƒO FINAL E CORRIGIDA)
import { createClient } from '@supabase/supabase-js';

async function validateAdmin(request) {
  const supabaseAdmin = createClient(
    process.env.SUPABASE_URL,
    process.env.SUPABASE_SERVICE_KEY
  );

  const authHeader = request.headers['authorization'];
  if (!authHeader) throw new Error('NÃ£o autorizado.');
  
  const token = authHeader.replace('Bearer ', '');
  const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
  if (userError) throw new Error('Token invÃ¡lido.');

  const { data: userData, error: userCheckError } = await supabaseAdmin
    .from('users')
    .select('isAdmin')
    .eq('id', user.id)
    .single();

  if (userCheckError) throw userCheckError;
  if (!userData || !userData.isAdmin) {
    throw new Error('Acesso negado. VocÃª nÃ£o Ã© um administrador.');
  }
  
  return { supabaseAdmin };
}

export default async function handler(request, response) {
  try {
    const { supabaseAdmin } = await validateAdmin(request);
    
    const action = request.method === 'GET' ? request.query.action : request.body.action;

    switch (action) {
      case 'getTenantsAndPlans': {
        const { data: tenants, error: tenantsError } = await supabaseAdmin
          .from('tenants')
          .select(`id, companyName, planId, cnpj, plans ( name )`);
        if (tenantsError) throw tenantsError;

        const { data: plans, error: plansError } = await supabaseAdmin
          .from('plans')
          .select('*');
        if (plansError) throw plansError;

        return response.status(200).json({ tenants, plans });
      }
        
      case 'updateTenantPlan': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { tenantId, newPlanId } = request.body;
        const { data, error } = await supabaseAdmin.from('tenants').update({ planId: newPlanId }).eq('id', tenantId).select('id, companyName, planId, plans ( name )').single();
        if (error) throw error;
        return response.status(200).json({ message: 'Plano atualizado!', updatedTenant: data });
      }
      
      case 'getTenantDetails': {
        if (request.method !== 'GET') { return response.status(405).json({ error: 'Use GET.' }); }
        const { tenantId } = request.query;
        if (!tenantId) { return response.status(400).json({ error: 'tenantId Ã© obrigatÃ³rio.' }); }
        
        const { data: tenant, error: tenantError } = await supabaseAdmin.from('tenants').select('id, companyName').eq('id', tenantId).single();
        if (tenantError || !tenant) { return response.status(404).json({ error: 'Empresa nÃ£o encontrada.' }); }

        // AQUI ESTAVA O ERRO DE SINTAXE. ESTA Ã‰ A VERSÃƒO CORRETA.
        const { data: users, error: usersError } = await supabaseAdmin
          .from('users')
          .select('id, name, role, isAdmin') 
          .eq('tenantId', Number(tenantId));
        if (usersError) throw usersError;
        
        return response.status(200).json({ tenant, users });
      }

      case 'createTenant': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { companyName, planId, cnpj } = request.body;
        if (!companyName || !planId) { return response.status(400).json({ error: 'Nome da empresa e Plano sÃ£o obrigatÃ³rios.' }); }

        const { data: newTenant, error } = await supabaseAdmin
          .from('tenants')
          .insert({ companyName, planId, cnpj: cnpj || null })
          .select('id, companyName, planId, cnpj, plans ( name )')
          .single();
        if (error) throw error;
        return response.status(201).json({ message: 'Empresa criada com sucesso!', newTenant });
      }
      
      case 'updateTenant': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { id, companyName, planId, cnpj } = request.body;
        if (!id || !companyName || !planId) { return response.status(400).json({ error: 'ID, Nome e Plano sÃ£o obrigatÃ³rios.' }); }

        const { data: updatedTenant, error } = await supabaseAdmin
          .from('tenants')
          .update({ companyName, planId, cnpj: cnpj || null })
          .eq('id', id)
          .select('id, companyName, planId, cnpj, plans ( name )')
          .single();
        if (error) throw error;
        return response.status(200).json({ message: 'Empresa atualizada!', updatedTenant });
      }

      case 'deleteTenant': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { tenantId } = request.body;
        if (!tenantId) { return response.status(400).json({ error: 'tenantId Ã© obrigatÃ³rio.' }); }
        
        const { error } = await supabaseAdmin.from('tenants').delete().eq('id', tenantId);
        if (error) throw error;
        return response.status(200).json({ message: 'Empresa excluÃ­da com sucesso!' });
      }
      
      case 'createPlan': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { planData } = request.body;
        if (!planData) { return response.status(400).json({ error: 'Dados do plano sÃ£o obrigatÃ³rios.' }); }
        const { data: newPlan, error } = await supabaseAdmin.from('plans').insert(planData).select().single();
        if (error) throw error;
        return response.status(201).json({ message: 'Plano criado com sucesso!', newPlan });
      }

      case 'updatePlan': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { planId, planData } = request.body;
        if (!planId || !planData) { return response.status(400).json({ error: 'planId e planData sÃ£o obrigatÃ³rios.' }); }
        const { data: updatedPlan, error } = await supabaseAdmin.from('plans').update(planData).eq('id', planId).select().single();
        if (error) throw error;
        return response.status(200).json({ message: 'Plano atualizado!', updatedPlan });
      }

      case 'deletePlan': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { planId } = request.body;
        if (!planId) { return response.status(400).json({ error: 'planId Ã© obrigatÃ³rio.' }); }
        const { count, error: checkError } = await supabaseAdmin.from('tenants').select('*', { count: 'exact', head: true }).eq('planId', planId);
        if (checkError) throw checkError;
        if (count > 0) { return response.status(400).json({ error: `NÃ£o Ã© possÃ­vel excluir este plano. Ele estÃ¡ sendo usado por ${count} empresa(s).` }); }
        const { error } = await supabaseAdmin.from('plans').delete().eq('id', planId);
        if (error) throw error;
        return response.status(200).json({ message: 'Plano excluÃ­do com sucesso!' });
      }

      case 'createUser': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { email, password, name, role, isAdmin, tenantId } = request.body;
        if (!email || !password || !name || !role || !tenantId) {
          return response.status(400).json({ error: 'Campos obrigatÃ³rios faltando.' });
        }

        const { data: authUser, error: authError } = await supabaseAdmin.auth.admin.createUser({
          email: email,
          password: password,
          email_confirm: true,
        });
        if (authError) throw authError;

        const { data: newUser, error: userError } = await supabaseAdmin
          .from('users')
          .insert({
            id: authUser.user.id,
            name: name,
            role: role,
            isAdmin: isAdmin || false,
            tenantId: tenantId
          })
          .select()
          .single();
        
        if (userError) {
          await supabaseAdmin.auth.admin.deleteUser(authUser.user.id);
          throw userError;
        }
        
        return response.status(201).json({ message: 'UsuÃ¡rio criado com sucesso!', newUser });
      }

      case 'updateUser': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { userId, name, role, isAdmin } = request.body;
        if (!userId || !name || !role) {
          return response.status(400).json({ error: 'Campos obrigatÃ³rios faltando.' });
        }
        
        const { data: updatedUser, error } = await supabaseAdmin
          .from('users')
          .update({ name, role, isAdmin })
          .eq('id', userId)
          .select()
          .single();
        
        if (error) throw error;
        return response.status(200).json({ message: 'UsuÃ¡rio atualizado!', updatedUser });
      }

      case 'deleteUser': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { userId } = request.body;
        if (!userId) { return response.status(400).json({ error: 'userId Ã© obrigatÃ³rio.' }); }

        const { error: userError } = await supabaseAdmin
          .from('users')
          .delete()
          .eq('id', userId);
        if (userError) throw userError;
        
        const { error: authError } = await supabaseAdmin.auth.admin.deleteUser(userId);
        if (authError) throw authError;
        
        return response.status(200).json({ message: 'UsuÃ¡rio excluÃ­do com sucesso!' });
      }
      
      default:
        return response.status(400).json({ error: 'AÃ§Ã£o de admin desconhecida.' });
    }

  } catch (error) {
    console.error("Erro na API de Admin:", error.message);
    if (error.message.includes('NÃ£o autorizado') || error.message.includes('Token invÃ¡lido')) {
      return response.status(401).json({ error: error.message });
    }
    if (error.message.includes('Acesso negado')) {
      return response.status(403).json({ error: error.message });
    }
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: api\apply.js
==================================================
// api/apply.js (VERSÃƒO FINAL, COMPLETA E CORRIGIDA)
import { createClient } from '@supabase/supabase-js';
import { formidable } from 'formidable';
import fs from 'fs';
import path from 'path';

export const config = {
  api: {
    bodyParser: false,
  },
};

export default async function handler(request, response) {
  if (request.method !== 'POST') {
    return response.status(405).json({ error: `MÃ©todo ${request.method} nÃ£o permitido.` });
  }

  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    const form = formidable({});
    const [fields, files] = await form.parse(request);
    
    const jobId = fields.jobId ? fields.jobId[0] : null;
    if (!jobId) { return response.status(400).json({ error: 'ID da vaga Ã© obrigatÃ³rio.' }); }

    // --- LÃ“GICA DE LIMITE ROBUSTA ---
    const { data: job, error: jobError } = await supabaseAdmin
      .from('jobs')
      .select('tenantId')
      .eq('id', jobId)
      .single();
    
    if (jobError || !job) { return response.status(404).json({ error: 'Vaga nÃ£o encontrada.' }); }

    const { data: tenant, error: tenantError } = await supabaseAdmin
      .from('tenants')
      .select('planId')
      .eq('id', job.tenantId)
      .single();

    if (tenantError || !tenant) { throw new Error('Empresa (tenant) nÃ£o encontrada para esta vaga.'); }

    const { data: plan, error: planError } = await supabaseAdmin
      .from('plans')
      .select('candidate_limit')
      .eq('id', tenant.planId)
      .single();
    
    if (planError || !plan) {
      throw new Error(`ConfiguraÃ§Ã£o de plano invÃ¡lida. O plano com ID "${tenant.planId}" nÃ£o foi encontrado na tabela 'plans'.`);
    }
    
    if (plan.candidate_limit !== -1) {
      const { count, error: countError } = await supabaseAdmin
        .from('applications')
        .select('*', { count: 'exact', head: true })
        .eq('jobId', jobId);
      if (countError) throw countError;
      if (count >= plan.candidate_limit) {
        return response.status(403).json({ error: `Limite de ${plan.candidate_limit} candidaturas para esta vaga foi atingido.` });
      }
    }
    // --- FIM DA LÃ“GICA DE LIMITE ---

    const { name, email } = fields;
    const resumeFile = files.resume;
    if (!name || !email || !resumeFile) { return response.status(400).json({ error: 'Nome, e-mail e currÃ­culo sÃ£o obrigatÃ³rios.' }); }
    const fileContent = fs.readFileSync(resumeFile[0].filepath);
    const fileExtension = path.extname(resumeFile[0].originalFilename);
    const fileName = `${email[0].replace(/[^a-zA-Z0-9]/g, '_')}_${Date.now()}${fileExtension}`;
    const { data: uploadData, error: uploadError } = await supabaseAdmin.storage.from('resumes').upload(fileName, fileContent, { contentType: resumeFile[0].mimetype, upsert: false });
    if (uploadError) throw new Error(`Erro no upload: ${uploadError.message}`);
    let { data: candidate } = await supabaseAdmin.from('candidates').select('id').eq('email', email[0]).single();
    if (!candidate) {
      const { data: newCandidate, error: newCandidateError } = await supabaseAdmin.from('candidates').insert({ name: name[0], email: email[0] }).select('id').single();
      if (newCandidateError) throw newCandidateError;
      candidate = newCandidate;
    }
    const applicationFields = {};
    for (const key in fields) { applicationFields[key] = fields[key][0]; }
    const { error: applicationError } = await supabaseAdmin.from('applications').insert({ jobId: jobId, candidateId: candidate.id, resumeUrl: uploadData.path, formData: applicationFields });
    if (applicationError) throw applicationError;
    
    return response.status(201).json({ message: 'Candidatura enviada com sucesso!' });

  } catch (error) {
    console.error("Erro na candidatura:", error.message);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: api\createJob.js
==================================================
// api/createJob.js (VersÃ£o Final "Area-Aware")
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  if (request.method !== 'POST') {
    response.setHeader('Allow', ['POST']);
    return response.status(405).json({ error: `MÃ©todo ${request.method} nÃ£o permitido.` });
  }
  try {
    const supabaseAdmin = createClient(process.env.SUPABASE_URL, process.env.SUPABASE_SERVICE_KEY);

    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });
    
    const { data: userData } = await supabaseAdmin.from('users').select('tenantId').eq('id', user.id).single();
    if (!userData) return response.status(404).json({ error: 'Perfil de usuÃ¡rio nÃ£o encontrado.' });
    const tenantId = userData.tenantId;

    const { data: tenant, error: tenantError } = await supabaseAdmin
      .from('tenants')
      .select('plan:plans(job_limit)')
      .eq('id', tenantId)
      .single();
    if (tenantError) throw tenantError;

    const job_limit = tenant.plan.job_limit;

    // LÃ³gica de limite dinÃ¢mica (job_limit === -1 Ã© ilimitado)
    if (job_limit !== -1) {
      const { count, error: countError } = await supabaseAdmin
        .from('jobs')
        .select('*', { count: 'exact', head: true })
        .eq('tenantId', tenantId);
      if (countError) throw countError;
      if (count >= job_limit) {
        return response.status(403).json({ error: `Limite de ${job_limit} vagas atingido para o seu plano.` });
      }
    }

    // --- MUDANÃ‡A AQUI: Recebendo tambÃ©m o ID do departamento ---
    const { title, company_department_id } = request.body; 
    
    if (!title) { return response.status(400).json({ error: 'O tÃ­tulo da vaga Ã© obrigatÃ³rio.' }); }
    
    const { data: newJob, error: insertError } = await supabaseAdmin
      .from('jobs')
      .insert({ 
          title: title, 
          tenantId: tenantId, 
          status: 'active',
          company_department_id: company_department_id || null // Salva o ID ou null se nÃ£o vier
      })
      .select()
      .single();
      
    if (insertError) throw insertError;
    
    return response.status(201).json({ newJob });
  } catch (error) {
    console.error("Erro na funÃ§Ã£o createJob:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: api\getApplicantsForJob.js
==================================================
// api/getApplicantsForJob.js (VERSÃƒO FINAL E CORRIGIDA)
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    // ValidaÃ§Ã£o do usuÃ¡rio (sem alteraÃ§Ãµes)
    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });
    const { data: userData } = await supabaseAdmin.from('users').select('tenantId').eq('id', user.id).single();
    if (!userData) return response.status(404).json({ error: 'Perfil de usuÃ¡rio nÃ£o encontrado.' });
    const tenantId = userData.tenantId;
    const { jobId } = request.query;
    if (!jobId) return response.status(400).json({ error: 'O ID da vaga Ã© obrigatÃ³rio.' });

    // Busca a vaga e suas candidaturas de uma sÃ³ vez
    const { data: job, error: jobError } = await supabaseAdmin
      .from('jobs')
      .select(`
        id,
        tenantId,
        parameters,
        applications (
          id,
          created_at,
          evaluation,
          isHired,
          candidate:candidates ( id, name, email )
        )
      `)
      .eq('id', Number(jobId))
      .eq('tenantId', tenantId)
      .single();

    if (jobError || !job) {
      return response.status(404).json({ error: 'Vaga nÃ£o encontrada ou nÃ£o pertence Ã  sua empresa.' });
    }

    // Prepara os mapas para cÃ¡lculo (sem alteraÃ§Ãµes)
    const parameters = job.parameters || {};
    const notesMap = new Map((parameters.notas || []).map(note => [note.id, note.valor]));
    const weightsMap = {
      triagem: new Map((parameters.triagem || []).map(c => [c.name, c.weight])),
      cultura: new Map((parameters.cultura || []).map(c => [c.name, c.weight])),
      tÃ©cnico: new Map((parameters.tÃ©cnico || []).map(c => [c.name, c.weight])),
    };

    // Calcula as notas para cada candidatura
    const classifiedApplicants = job.applications.map(app => {
      const scores = { notaTriagem: 0, notaCultura: 0, notaTecnico: 0, notaGeral: 0 };
      if (app.evaluation) {
        ['triagem', 'cultura', 'tÃ©cnico'].forEach(section => {
          let sectionScore = 0;
          const sectionEvaluation = app.evaluation[section];
          if (sectionEvaluation) {
            for (const criterionName in sectionEvaluation) {
              if (criterionName !== 'anotacoes') {
                const noteId = sectionEvaluation[criterionName];
                const noteValue = notesMap.get(noteId) ?? 0;
                const weight = weightsMap[section]?.get(criterionName) ?? 0;
                sectionScore += (noteValue * weight) / 100;
              }
            }
          }
          if (section === 'triagem') scores.notaTriagem = sectionScore;
          if (section === 'cultura') scores.notaCultura = sectionScore;
          if (section === 'tÃ©cnico') scores.notaTecnico = sectionScore;
        });
        scores.notaGeral = scores.notaTriagem + scores.notaCultura + scores.notaTecnico;
      }

      // A CORREÃ‡ÃƒO ESTÃ AQUI: O campo 'isHired' foi restaurado
      return {
        applicationId: app.id,
        submissionDate: app.created_at,
        isHired: app.isHired,
        candidateName: app.candidate.name,
        candidateEmail: app.candidate.email,
        ...scores
      };
    });
    
    return response.status(200).json({ applicants: classifiedApplicants });

  } catch (error) {
    console.error("Erro na funÃ§Ã£o getApplicantsForJob:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: api\getApplicationDetails.js
==================================================
// api/getApplicationDetails.js (VersÃ£o Definitivamente Corrigida)
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });

    const { data: userData } = await supabaseAdmin.from('users').select('tenantId').eq('id', user.id).single();
    if (!userData) return response.status(404).json({ error: 'Perfil de usuÃ¡rio nÃ£o encontrado.' });
    const tenantId = userData.tenantId;

    const { applicationId } = request.query;
    if (!applicationId) {
      return response.status(400).json({ error: 'O ID da candidatura Ã© obrigatÃ³rio.' });
    }

    const { data: application, error: applicationError } = await supabaseAdmin
      .from('applications')
      .select(`
        id,
        created_at,
        formData,
        resumeUrl,
        evaluation, 
        candidate:candidates ( * ),
        job:jobs ( title, parameters, tenantId )
      `)
      .eq('id', Number(applicationId))
      .single();

    if (applicationError) {
      if (applicationError.code === 'PGRST116') {
         return response.status(404).json({ error: 'Candidatura nÃ£o encontrada.' });
      }
      throw applicationError;
    }

    if (application.job.tenantId !== tenantId) {
      return response.status(403).json({ error: 'VocÃª nÃ£o tem permissÃ£o para ver esta candidatura.' });
    }

    return response.status(200).json({ application });

  } catch (error) {
    console.error("Erro na funÃ§Ã£o getApplicationDetails:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: api\getHiredApplicants.js
==================================================
// api/getHiredApplicants.js
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    // ValidaÃ§Ã£o do usuÃ¡rio de RH
    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });
    
    const { data: userData } = await supabaseAdmin.from('users').select('tenantId').eq('id', user.id).single();
    if (!userData) return response.status(404).json({ error: 'Perfil de usuÃ¡rio nÃ£o encontrado.' });
    const tenantId = userData.tenantId;

    // Busca todas as candidaturas marcadas como 'isHired = true'
    const { data: hiredApplications, error: fetchError } = await supabaseAdmin
      .from('applications')
      .select(`
        id,
        hiredAt,
        formData,
        candidate:candidates ( name, email ),
        job:jobs ( id, title, tenantId )
      `)
      .eq('isHired', true);

    if (fetchError) throw fetchError;

    // Filtra no servidor para garantir que o usuÃ¡rio sÃ³ veja os aprovados do seu prÃ³prio tenant
    const tenantHired = hiredApplications.filter(app => app.job.tenantId === tenantId);

    return response.status(200).json({ hired: tenantHired });

  } catch (error) {
    console.error("Erro ao buscar candidatos contratados:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: api\getPublicJobData.js
==================================================
// api/getPublicJobData.js (VERSÃƒO FINAL E CORRIGIDA)
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    const { id: jobId } = request.query;
    if (!jobId) {
      return response.status(400).json({ error: 'O ID da vaga Ã© obrigatÃ³rio.' });
    }

    // A CORREÃ‡ÃƒO ESTÃ AQUI: Convertemos o jobId para Number()
    const { data: job, error: jobError } = await supabaseAdmin
      .from('jobs')
      .select(`
        title,
        tenantId,
        applications ( count )
      `)
      .eq('id', Number(jobId)) // Comparando nÃºmero com nÃºmero
      .single();

    if (jobError) throw jobError;

    const { data: tenant, error: tenantError } = await supabaseAdmin
      .from('tenants')
      .select('planId')
      .eq('id', job.tenantId)
      .single();
    
    if (tenantError) throw tenantError;
    
    const formattedJob = {
      title: job.title,
      candidateCount: job.applications[0] ? job.applications[0].count : 0,
      planId: tenant.planId
    };

    return response.status(200).json({ job: formattedJob });
  } catch (error) {
    console.error("Erro ao buscar dados pÃºblicos da vaga:", error);
    return response.status(500).json({ error: 'NÃ£o foi possÃ­vel buscar os dados da vaga.' });
  }
}

==================================================
ARQUIVO: api\getResumeSignedUrl.js
==================================================
// api/getResumeSignedUrl.js
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    // ValidaÃ§Ã£o de seguranÃ§a (sÃ³ usuÃ¡rios logados podem pedir links)
    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });

    // Pega o caminho do arquivo que o frontend quer acessar
    const { filePath } = request.query;
    if (!filePath) {
      return response.status(400).json({ error: 'O caminho do arquivo Ã© obrigatÃ³rio.' });
    }

    // Gera uma URL assinada e segura, com validade de 60 segundos
    const { data, error: urlError } = await supabaseAdmin
      .storage
      .from('resumes')
      .createSignedUrl(filePath, 60); // 60 segundos de validade

    if (urlError) throw urlError;

    return response.status(200).json({ signedUrl: data.signedUrl });

  } catch (error) {
    console.error("Erro ao gerar URL assinada:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.' });
  }
}

==================================================
ARQUIVO: api\jobs.js
==================================================
// api/jobs.js (VERSÃƒO FINAL com Join de Ãreas)
import { createClient } from '@supabase/supabase-js';

// FunÃ§Ã£o de middleware de seguranÃ§a (reutilizada)
async function validateUser(request) {
  const supabaseAdmin = createClient(
    process.env.SUPABASE_URL,
    process.env.SUPABASE_SERVICE_KEY
  );

  const authHeader = request.headers['authorization'];
  if (!authHeader) throw new Error('NÃ£o autorizado.');
  
  const token = authHeader.replace('Bearer ', '');
  const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
  if (userError) throw new Error('Token invÃ¡lido.');

  const { data: userData } = await supabaseAdmin.from('users').select('tenantId, isAdmin').eq('id', user.id).single();
  if (!userData) throw new Error('Perfil de usuÃ¡rio nÃ£o encontrado.');
  
  return { supabaseAdmin, user, userData };
}

// Handler principal
export default async function handler(request, response) {
  try {
    const { supabaseAdmin, userData } = await validateUser(request);
    const tenantId = userData.tenantId;

    // --- LÃ“GICA DE REQUISIÃ‡ÃƒO GET (LEITURA) ---
    if (request.method === 'GET') {
      const { id } = request.query;

      if (id) {
        // Busca UMA vaga (Detalhes)
        // Incluindo o nome do departamento aqui tambÃ©m
        const { data: job, error: jobError } = await supabaseAdmin
            .from('jobs')
            .select(`
                *,
                company_departments ( name )
            `)
            .eq('id', Number(id))
            .eq('tenantId', tenantId)
            .single();

        if (jobError || !job) return response.status(404).json({ error: 'Vaga nÃ£o encontrada.' });
        return response.status(200).json({ job });
      } 
      else {
        // Busca TODAS as vagas (Dashboard)
        const { data: tenant, error: tenantError } = await supabaseAdmin.from('tenants').select('planId').eq('id', tenantId).single();
        if (tenantError) throw tenantError;

        // --- MUDANÃ‡A AQUI: Trazendo o nome do departamento ---
        const { data: jobs, error: jobsError } = await supabaseAdmin
            .from('jobs')
            .select(`
                id, title, status, tenantId, created_at,
                applications ( count ),
                company_departments ( name )
            `)
            .eq('tenantId', tenantId);

        if (jobsError) throw jobsError;
        
        const formattedJobs = jobs.map(job => ({ 
            ...job, 
            candidateCount: job.applications[0] ? job.applications[0].count : 0 
        }));
        
        return response.status(200).json({ 
          jobs: formattedJobs,
          planId: tenant.planId,
          isAdmin: userData.isAdmin
        });
      }
    }

    // --- LÃ“GICA DE REQUISIÃ‡ÃƒO POST (ATUALIZAR/DELETAR) ---
    if (request.method === 'POST') {
      const { action, jobId, newStatus } = request.body;

      switch (action) {
        case 'updateJobStatus':
          if (!jobId || !newStatus) { return response.status(400).json({ error: 'jobId e newStatus sÃ£o obrigatÃ³rios.' }); }
          
          const { data: updatedJob, error: updateError } = await supabaseAdmin
            .from('jobs')
            .update({ status: newStatus })
            .eq('id', jobId)
            .eq('tenantId', tenantId) // SeguranÃ§a
            .select()
            .single();
          
          if (updateError) throw updateError;
          return response.status(200).json({ message: 'Status atualizado!', updatedJob });

        case 'deleteJob':
          if (!jobId) { return response.status(400).json({ error: 'jobId Ã© obrigatÃ³rio.' }); }

          // 1. (SeguranÃ§a) Deleta as candidaturas
          await supabaseAdmin.from('applications').delete().eq('jobId', jobId);

          // 2. Deleta a vaga
          const { error: deleteError } = await supabaseAdmin
            .from('jobs')
            .delete()
            .eq('id', jobId)
            .eq('tenantId', tenantId); // SeguranÃ§a
            
          if (deleteError) throw deleteError;
          return response.status(200).json({ message: 'Vaga excluÃ­da com sucesso!' });

        default:
          return response.status(400).json({ error: 'AÃ§Ã£o POST desconhecida.' });
      }
    }

    response.setHeader('Allow', ['GET', 'POST']);
    return response.status(405).json({ error: `MÃ©todo ${request.method} nÃ£o permitido.` });

  } catch (error) {
    console.error("Erro na API de Vagas:", error.message);
    if (error.message.includes('NÃ£o autorizado') || error.message.includes('Token invÃ¡lido')) {
      return response.status(401).json({ error: error.message });
    }
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: api\saveEvaluation.js
==================================================
// api/saveEvaluation.js
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  if (request.method !== 'POST') {
    return response.status(405).json({ error: 'MÃ©todo nÃ£o permitido.' });
  }

  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    // 1. Valida o token do usuÃ¡rio de RH
    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });

    // 2. Pega o ID da candidatura e os dados da avaliaÃ§Ã£o do corpo da requisiÃ§Ã£o
    const { applicationId, evaluation } = request.body;
    if (!applicationId || !evaluation) {
      return response.status(400).json({ error: 'applicationId e evaluation sÃ£o obrigatÃ³rios.' });
    }

    // 3. ATUALIZA a candidatura no banco, preenchendo a coluna 'evaluation'
    // Por seguranÃ§a, poderÃ­amos re-validar se o usuÃ¡rio tem acesso a esta vaga,
    // mas vamos manter simples por agora, pois o risco Ã© baixo.
    const { data, error: updateError } = await supabaseAdmin
      .from('applications')
      .update({ evaluation: evaluation }) // Atualiza apenas a coluna 'evaluation'
      .eq('id', applicationId)
      .select()
      .single();

    if (updateError) throw updateError;

    return response.status(200).json({ message: 'AvaliaÃ§Ã£o salva com sucesso!', updatedApplication: data });

  } catch (error) {
    console.error("Erro na funÃ§Ã£o saveEvaluation:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: api\updateHiredStatus.js
==================================================
// api/updateHiredStatus.js (VersÃ£o com data de contrataÃ§Ã£o)
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  if (request.method !== 'POST') {
    return response.status(405).json({ error: 'MÃ©todo nÃ£o permitido.' });
  }

  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    // ValidaÃ§Ã£o do usuÃ¡rio (sem alteraÃ§Ãµes)
    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });
    
    const { applicationId, isHired } = request.body;
    if (!applicationId || typeof isHired !== 'boolean') {
      return response.status(400).json({ error: 'applicationId e isHired (booleano) sÃ£o obrigatÃ³rios.' });
    }

    // AQUI ESTÃ A LÃ“GICA ADITIVA:
    // Se estÃ¡ contratando, define a data atual. Se estÃ¡ "descontratando", define como nulo.
    const updateData = {
      isHired: isHired,
      hiredAt: isHired ? new Date().toISOString() : null
    };

    const { data, error: updateError } = await supabaseAdmin
      .from('applications')
      .update(updateData) // Usa o novo objeto de dados
      .eq('id', applicationId)
      .select()
      .single();

    if (updateError) throw updateError;

    return response.status(200).json({ message: 'Status do candidato atualizado com sucesso!', updatedApplication: data });

  } catch (error) {
    console.error("Erro ao atualizar status de contrataÃ§Ã£o:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: api\updateJobParameters.js
==================================================
// api/updateJobParameters.js
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  if (request.method !== 'POST') {
    response.setHeader('Allow', ['POST']);
    return response.status(405).json({ error: `MÃ©todo ${request.method} nÃ£o permitido.` });
  }

  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    // 1. Valida o token do usuÃ¡rio para garantir que ele estÃ¡ logado
    const authHeader = request.headers['authorization'];
    if (!authHeader) {
      return response.status(401).json({ error: 'NÃ£o autorizado.' });
    }
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) {
      return response.status(401).json({ error: 'Token invÃ¡lido.' });
    }

    // 2. Busca o tenantId do usuÃ¡rio para garantir que ele sÃ³ edite suas prÃ³prias vagas
    const { data: userData } = await supabaseAdmin.from('users').select('tenantId').eq('id', user.id).single();
    if (!userData) {
      return response.status(404).json({ error: 'Perfil de usuÃ¡rio nÃ£o encontrado.' });
    }
    const tenantId = userData.tenantId;

    // 3. Pega o ID da vaga e os novos parÃ¢metros do corpo da requisiÃ§Ã£o
    const { jobId, parameters } = request.body;
    if (!jobId || !parameters) {
      return response.status(400).json({ error: 'jobId e parameters sÃ£o obrigatÃ³rios.' });
    }

    // 4. Atualiza a vaga no banco de dados
    const { data, error: updateError } = await supabaseAdmin
      .from('jobs')
      .update({ parameters: parameters }) // Atualiza apenas a coluna 'parameters'
      .eq('id', jobId)                   // Onde o ID da vaga bate
      .eq('tenantId', tenantId)          // E ONDE a vaga pertence ao tenant do usuÃ¡rio (SEGURANÃ‡A)
      .select()
      .single();

    if (updateError) {
      // Se o erro for 'PGRST116', significa que a vaga nÃ£o foi encontrada (ou nÃ£o pertence ao tenant)
      if (updateError.code === 'PGRST116') {
        return response.status(404).json({ error: 'Vaga nÃ£o encontrada ou vocÃª nÃ£o tem permissÃ£o para editÃ¡-la.' });
      }
      throw updateError;
    }

    // 5. Retorna sucesso
    return response.status(200).json({ message: 'ParÃ¢metros salvos com sucesso!', updatedJob: data });

  } catch (error) {
    console.error("Erro na funÃ§Ã£o updateJobParameters:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: functions\.eslintrc.js
==================================================
module.exports = {
  root: true,
  env: {
    es6: true,
    node: true,
  },
  extends: [
    "eslint:recommended",
    "google",
  ],
  rules: {
    quotes: ["error", "double"],
  },
};

==================================================
ARQUIVO: functions\index.js
==================================================
const functions = require("firebase-functions");
const admin = require("firebase-admin");

admin.initializeApp();

exports.getJobsByTenant = functions.https.onCall(async (data, context) => {
  if (!context.auth) {
    throw new functions.https.HttpsError(
      "unauthenticated",
      "VocÃª precisa estar autenticado."
    );
  }

  const uid = context.auth.uid;
  const db = admin.firestore();

  try {
    const userDoc = await db.collection("users").doc(uid).get();
    if (!userDoc.exists) {
      throw new functions.https.HttpsError(
        "not-found",
        "UsuÃ¡rio nÃ£o encontrado."
      );
    }
    const tenantId = userDoc.data().tenantId;
    if (!tenantId) {
      throw new functions.https.HttpsError(
        "permission-denied",
        "UsuÃ¡rio sem tenantId."
      );
    }

    const jobsSnapshot = await db.collection("jobs").where("tenantId", "==", tenantId).get();
    const jobs = [];
    jobsSnapshot.forEach((doc) => {
      jobs.push({ id: doc.id, ...doc.data() });
    });

    return { jobs };

  } catch (error) {
    console.error("Erro ao buscar vagas:", error);
    throw new functions.https.HttpsError(
      "internal",
      "Ocorreu um erro ao buscar as vagas."
    );
  }
});

==================================================
ARQUIVO: functions\package.json
==================================================
{
  "name": "functions",
  "description": "Cloud Functions for Firebase",
  "scripts": {
    "lint": "eslint .",
    "serve": "firebase emulators:start --only functions",
    "shell": "firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "20"
  },
  "main": "index.js",
  "dependencies": {
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^3.24.1"
  },
  "devDependencies": {
    "eslint": "^8.15.0",
    "eslint-plugin-promise": "^6.0.0",
    "firebase-functions-test": "^0.2.0"
  },
  "private": true
}

==================================================
ARQUIVO: functions\functions\package.json
==================================================
{
  "dependencies": {
    "functions": "file:.."
  }
}


==================================================
ARQUIVO: src\App.jsx
==================================================
import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';
import { AuthProvider } from './context/AuthContext';
import PrivateRoute from './components/PrivateRoute';

// PÃ¡ginas existentes (Confirmadas na sua lista)
import Login from './pages/Login';
import Dashboard from './pages/Dashboard';
import JobDetails from './pages/JobDetails';
import ApplyPage from './pages/ApplyPage';

// PÃ¡ginas NOVAS (Que acabamos de criar no Passo 1)
import Register from './pages/Register';
import Jobs from './pages/Jobs';
import Candidates from './pages/Candidates';
import CompanySettings from './pages/CompanySettings';
import Evaluation from './pages/Evaluation';

function App() {
  return (
    <Router>
      <AuthProvider>
        <Routes>
          {/* Rotas PÃºblicas */}
          <Route path="/login" element={<Login />} />
          <Route path="/register" element={<Register />} />
          
          {/* Rota PÃºblica de Candidatura */}
          <Route path="/vagas/:id/candidatar" element={<ApplyPage />} />

          {/* Rotas Privadas */}
          <Route element={<PrivateRoute />}>
            <Route path="/" element={<Navigate to="/dashboard" replace />} />
            <Route path="/dashboard" element={<Dashboard />} />
            
            <Route path="/jobs" element={<Jobs />} />
            <Route path="/jobs/:id" element={<JobDetails />} />
            
            <Route path="/candidates" element={<Candidates />} />
            <Route path="/settings" element={<CompanySettings />} />
            <Route path="/evaluations/:applicationId" element={<Evaluation />} />
          </Route>

          <Route path="*" element={<Navigate to="/login" replace />} />
        </Routes>
      </AuthProvider>
    </Router>
  );
}

export default App;

==================================================
ARQUIVO: src\index.css
==================================================
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Seus estilos globais extras aqui, se houver */
body {
  @apply bg-gray-50;
}

==================================================
ARQUIVO: src\main.jsx
==================================================
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.jsx'
import './index.css'

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)

==================================================
ARQUIVO: src\components\AreaSelect.jsx
==================================================
import React, { useState, useEffect } from 'react';
import { 
  FormControl, 
  InputLabel, 
  Select, 
  MenuItem, 
  TextField, 
  Button, 
  Box, 
  CircularProgress,
  FormHelperText
} from '@mui/material';
import { supabase } from '../supabase/client'; // Ajustei para o caminho que vi na sua Ã¡rvore

export default function AreaSelect({ currentTenantId, selectedAreaId, onSelectArea, error }) {
  const [departments, setDepartments] = useState([]);
  const [isCreatingNew, setIsCreatingNew] = useState(false);
  const [newDeptName, setNewDeptName] = useState('');
  const [loading, setLoading] = useState(false);

  // Busca Ã¡reas da empresa atual
  useEffect(() => {
    if (!currentTenantId) return;

    async function fetchDepartments() {
      setLoading(true);
      try {
        const { data, error } = await supabase
          .from('company_departments')
          .select('id, name')
          .eq('tenantId', currentTenantId)
          .order('name', { ascending: true });

        if (error) throw error;
        setDepartments(data || []);
      } catch (error) {
        console.error('Erro ao buscar Ã¡reas:', error.message);
      } finally {
        setLoading(false);
      }
    }

    fetchDepartments();
  }, [currentTenantId]);

  // Salva nova Ã¡rea
  const handleSaveNew = async () => {
    if (!newDeptName.trim()) return;

    try {
      setLoading(true);
      const { data, error } = await supabase
        .from('company_departments')
        .insert([{ 
          name: newDeptName.trim(), 
          tenantId: currentTenantId 
        }])
        .select()
        .single();

      if (error) throw error;

      setDepartments([...departments, data]);
      onSelectArea(data.id);
      setIsCreatingNew(false);
      setNewDeptName('');
    } catch (error) {
      alert('Erro ao criar Ã¡rea: ' + error.message);
    } finally {
      setLoading(false);
    }
  };

  if (loading && departments.length === 0) return <Box sx={{p: 2}}><CircularProgress size={20} /></Box>;

  // Modo de CriaÃ§Ã£o (Input de Texto)
  if (isCreatingNew) {
    return (
      <Box sx={{ mb: 2, mt: 2, p: 2, border: '1px dashed #ccc', borderRadius: 1 }}>
        <TextField
          label="Nome da Nova Ãrea"
          value={newDeptName}
          onChange={(e) => setNewDeptName(e.target.value)}
          size="small"
          fullWidth
          autoFocus
          sx={{ mb: 1 }}
        />
        <Box sx={{ display: 'flex', gap: 1, justifyContent: 'flex-end' }}>
            <Button 
            variant="text" 
            color="inherit" 
            onClick={() => setIsCreatingNew(false)}
            size="small"
            >
            Cancelar
            </Button>
            <Button 
            variant="contained" 
            onClick={handleSaveNew}
            disabled={!newDeptName.trim()}
            size="small"
            >
            Salvar Ãrea
            </Button>
        </Box>
      </Box>
    );
  }

  // Modo de SeleÃ§Ã£o (Dropdown)
  return (
    <FormControl fullWidth margin="normal" error={!!error}>
      <InputLabel id="area-select-label">Ãrea / Departamento</InputLabel>
      <Select
        labelId="area-select-label"
        value={selectedAreaId || ''}
        label="Ãrea / Departamento"
        onChange={(e) => {
          if (e.target.value === 'NEW') setIsCreatingNew(true);
          else onSelectArea(e.target.value);
        }}
      >
        <MenuItem value="">
          <em>Sem Ã¡rea definida</em>
        </MenuItem>
        {departments.map((dept) => (
          <MenuItem key={dept.id} value={dept.id}>
            {dept.name}
          </MenuItem>
        ))}
        <MenuItem value="NEW" sx={{ color: 'primary.main', fontWeight: 'bold', borderTop: '1px solid #eee' }}>
          + Cadastrar Nova Ãrea
        </MenuItem>
      </Select>
      {error && <FormHelperText>{error}</FormHelperText>}
    </FormControl>
  );
}

==================================================
ARQUIVO: src\components\PrivateRoute.jsx
==================================================
import { Navigate, Outlet } from 'react-router-dom';
import { useAuth } from '../context/AuthContext';

export default function PrivateRoute() {
  const { user, loading } = useAuth();

  // 1. Enquanto verifica o login, mostra um spinner para nÃ£o "piscar" a tela de login
  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen bg-gray-50">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  // 2. Regra de NegÃ³cio: Se tem user, libera o acesso (Outlet). Se nÃ£o, chuta pro Login.
  return user ? <Outlet /> : <Navigate to="/login" replace />;
}

==================================================
ARQUIVO: src\components\charts\ClassificationChart.jsx
==================================================
// src/components/charts/ClassificationChart.jsx
import React from 'react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, LabelList } from 'recharts';
import { Box } from '@mui/material';

const ClassificationChart = ({ data }) => {
  // O Recharts espera os dados com os candidatos no eixo Y, entÃ£o nÃ£o precisamos de transformaÃ§Ãµes
  return (
    <Box sx={{ width: '100%', height: 300, mt: 4 }}>
      <ResponsiveContainer>
        <BarChart
          layout="vertical"
          data={data}
          margin={{
            top: 5,
            right: 30,
            left: 100, // Aumenta o espaÃ§o para nomes longos
            bottom: 5,
          }}
        >
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis type="number" />
          <YAxis dataKey="candidateName" type="category" width={150} />
          <Tooltip />
          <Legend />
          <Bar dataKey="notaTriagem" stackId="a" fill="#3f51b5" name="Nota Triagem">
            <LabelList dataKey="notaTriagem" position="center" fill="#fff" formatter={(value) => value.toFixed(1)} />
          </Bar>
          <Bar dataKey="notaCultura" stackId="a" fill="#8884d8" name="Nota Cultura">
             <LabelList dataKey="notaCultura" position="center" fill="#fff" formatter={(value) => value.toFixed(1)} />
          </Bar>
          <Bar dataKey="notaTecnico" stackId="a" fill="#82ca9d" name="Nota TÃ©cnico">
             <LabelList dataKey="notaTecnico" position="center" fill="#fff" formatter={(value) => value.toFixed(1)} />
          </Bar>
        </BarChart>
      </ResponsiveContainer>
    </Box>
  );
};

export default ClassificationChart;

==================================================
ARQUIVO: src\components\common\LoadingSpinner.jsx
==================================================
import React from 'react';
import { Box, CircularProgress } from '@mui/material';

const LoadingSpinner = () => {
    return (
        <Box
            sx={{
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'center',
                height: '100vh',
                width: '100vw',
            }}
        >
            <CircularProgress />
        </Box>
    );
};

export default LoadingSpinner;

==================================================
ARQUIVO: src\components\evaluation_v2\EvaluationDashboardV2.jsx
==================================================
import React, { useEffect, useState } from 'react';
import { prepareEvaluationV2, getEvaluationSummaryV2 } from '../../services/evaluationService';
import { supabase } from '../../supabase/client';

export default function EvaluationDashboardV2({ applicationId, jobId, currentUser }) {
  const [loading, setLoading] = useState(true);
  const [summary, setSummary] = useState(null);
  const [viewMode, setViewMode] = useState('summary'); // 'summary' ou 'evaluate'

  useEffect(() => {
    const init = async () => {
      try {
        setLoading(true);
        // Garante que o banco estÃ¡ pronto
        await prepareEvaluationV2(jobId);
        // Carrega dados
        const data = await getEvaluationSummaryV2(applicationId);
        setSummary(data);
      } catch (error) {
        console.error("Erro ao carregar V2:", error);
      } finally {
        setLoading(false);
      }
    };
    if (jobId && applicationId) init();
  }, [applicationId, jobId]);

  if (loading) return <div className="p-4 text-center">Carregando AvaliaÃ§Ã£o 360Âº...</div>;

  return (
    <div className="bg-white rounded-lg shadow p-6 mt-6">
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-2xl font-bold text-gray-800">AvaliaÃ§Ã£o 360Âº</h2>
        <button 
          onClick={() => setViewMode(viewMode === 'summary' ? 'evaluate' : 'summary')}
          className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition"
        >
          {viewMode === 'summary' ? 'Minha AvaliaÃ§Ã£o' : 'Voltar ao Resumo'}
        </button>
      </div>

      {viewMode === 'summary' ? (
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          {/* Card da Nota Final */}
          <div className="bg-gray-50 p-6 rounded-xl border border-gray-200 text-center">
            <span className="block text-gray-500 text-sm uppercase tracking-wide">MÃ©dia Geral</span>
            <span className="block text-5xl font-extrabold text-blue-600 mt-2">
              {summary?.final_score || '-'}
            </span>
          </div>
          
          {/* Lista de Avaliadores */}
          <div className="col-span-2">
            <h3 className="font-semibold text-gray-700 mb-3">Avaliadores Participantes</h3>
            <div className="flex gap-2">
              {summary?.evaluators?.map(ev => (
                <span key={ev.id} className="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">
                  {ev.name}
                </span>
              ))}
              {(!summary?.evaluators || summary.evaluators.length === 0) && (
                <span className="text-gray-400 italic">Nenhuma avaliaÃ§Ã£o concluÃ­da ainda.</span>
              )}
            </div>
          </div>
        </div>
      ) : (
        <div className="p-4 bg-yellow-50 border border-yellow-200 rounded text-yellow-800">
          {/* AQUI ENTRARÃ O FORMULÃRIO DE NOTAS NO PRÃ“XIMO PASSO */}
          <p>O formulÃ¡rio de avaliaÃ§Ã£o individual serÃ¡ carregado aqui.</p>
        </div>
      )}
    </div>
  );
}

==================================================
ARQUIVO: src\components\inputs\StateSelect.jsx
==================================================
import React from 'react';
import PropTypes from 'prop-types';
import { FormControl, InputLabel, Select, MenuItem, FormHelperText } from '@mui/material';
// Importando seus dados diretamente no componente que precisa deles
import { estados } from '../../data/brazil-locations'; 

const StateSelect = ({ 
  value, 
  onChange, 
  name = "state", 
  label = "Em que estado vocÃª mora?", 
  required = true,
  error = false,
  helperText = "",
  disabled = false
}) => {
  return (
    <FormControl 
      fullWidth 
      margin="normal" 
      required={required} 
      error={!!error} // Garante booleano
      disabled={disabled}
    >
      <InputLabel id={`${name}-label`}>{label}</InputLabel>
      <Select
        labelId={`${name}-label`}
        id={name}
        name={name}
        value={value || ''} // Evita warning de componente nÃ£o controlado
        label={label}
        onChange={onChange}
        MenuProps={{
          PaperProps: {
            style: {
              maxHeight: 300, // UX: Scroll suave para listas longas
            },
          },
        }}
      >
        <MenuItem value="" disabled>
          <em>Selecione uma opÃ§Ã£o</em>
        </MenuItem>
        {estados.map((estado) => (
          <MenuItem key={estado.sigla} value={estado.sigla}>
            {estado.nome}
          </MenuItem>
        ))}
      </Select>
      {/* Exibe mensagem de erro ou texto de ajuda se houver */}
      {(error || helperText) && (
        <FormHelperText>{error || helperText}</FormHelperText>
      )}
    </FormControl>
  );
};

StateSelect.propTypes = {
  value: PropTypes.string,
  onChange: PropTypes.func.isRequired,
  name: PropTypes.string,
  label: PropTypes.string,
  required: PropTypes.bool,
  error: PropTypes.string, // Pode receber a string de mensagem de erro
  helperText: PropTypes.string,
  disabled: PropTypes.bool
};

export default StateSelect;

==================================================
ARQUIVO: src\components\jobs\CreateJobModal.jsx
==================================================
import React, { useState, useEffect } from 'react';
import { supabase } from '../../supabase/client'; // Verifique se o caminho estÃ¡ correto
import { Modal, Box, Typography, TextField, Button, CircularProgress, Alert } from '@mui/material';
import AreaSelect from '../AreaSelect'; // Verifique se o caminho estÃ¡ correto

const style = {
  position: 'absolute',
  top: '50%',
  left: '50%',
  transform: 'translate(-50%, -50%)',
  width: 450,
  bgcolor: 'background.paper',
  boxShadow: 24,
  p: 4,
  borderRadius: 2,
};

const CreateJobModal = ({ open, handleClose, onJobCreated }) => {
  const [jobTitle, setJobTitle] = useState('');
  const [departmentId, setDepartmentId] = useState(null);
  const [tenantId, setTenantId] = useState(null); // O ID da Empresa
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');

  // --- CORREÃ‡ÃƒO AQUI: Busca robusta do Tenant ID ---
  useEffect(() => {
    if (open) {
      const fetchTenantId = async () => {
        try {
          // 1. Pega o usuÃ¡rio logado
          const { data: { user } } = await supabase.auth.getUser();
          if (!user) return;

          // 2. Busca o tenantId na tabela 'users' (Fonte da verdade)
          const { data: userData, error } = await supabase
            .from('users')
            .select('tenantId')
            .eq('id', user.id)
            .single();

          if (error) {
            console.error('Erro ao buscar perfil:', error);
            return;
          }

          if (userData?.tenantId) {
            setTenantId(userData.tenantId);
          }
        } catch (err) {
          console.error('Erro fatal ao buscar tenant:', err);
        }
      };
      
      fetchTenantId();
    }
  }, [open]);

  const handleSubmit = async (event) => {
    event.preventDefault();
    setLoading(true);
    setError('');

    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) throw new Error("VocÃª nÃ£o estÃ¡ autenticado.");

      // Envia para a API (que jÃ¡ corrigimos no passo anterior)
      const response = await fetch('/api/createJob', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${session.access_token}`,
        },
        body: JSON.stringify({ 
            title: jobTitle, 
            company_department_id: departmentId // Pode ser null se nÃ£o selecionado
        }),
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || "NÃ£o foi possÃ­vel criar a vaga.");
      }

      // Sucesso
      setJobTitle('');
      setDepartmentId(null);
      onJobCreated(); 
      handleClose();

    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <Modal
      open={open}
      onClose={handleClose}
      aria-labelledby="create-job-modal-title"
    >
      <Box sx={style} component="form" onSubmit={handleSubmit}>
        <Typography id="create-job-modal-title" variant="h6" component="h2" gutterBottom>
          Criar Nova Vaga
        </Typography>
        
        <TextField
          margin="normal"
          required
          fullWidth
          id="jobTitle"
          label="Nome da Vaga"
          name="jobTitle"
          autoFocus
          value={jobTitle}
          onChange={(e) => setJobTitle(e.target.value)}
          disabled={loading}
        />

        {/* Passamos o tenantId recuperado do banco.
            Se tenantId for null (ainda carregando), o AreaSelect saberÃ¡ lidar/esperar 
        */}
        {tenantId ? (
            <AreaSelect 
                currentTenantId={tenantId}
                selectedAreaId={departmentId}
                onSelectArea={setDepartmentId}
            />
        ) : (
            <Typography variant="caption" color="text.secondary">
                Carregando Ã¡reas...
            </Typography>
        )}

        {error && <Alert severity="error" sx={{mt: 2}}>{error}</Alert>}
        
        <Box sx={{ mt: 3, display: 'flex', justifyContent: 'flex-end', gap: 1 }}>
          <Button onClick={handleClose} disabled={loading}>Cancelar</Button>
          <Button type="submit" variant="contained" disabled={loading || !jobTitle}>
            {loading ? <CircularProgress size={24} /> : 'Criar Vaga'}
          </Button>
        </Box>
      </Box>
    </Modal>
  );
};

export default CreateJobModal;

==================================================
ARQUIVO: src\context\AuthContext.jsx
==================================================
import { createContext, useContext, useEffect, useState } from 'react';
import { supabase } from '../supabase/client';

const AuthContext = createContext({});

// --- A LINHA QUE ESTAVA FALTANDO Ã‰ ESTA ABAIXO: ---
export const useAuth = () => useContext(AuthContext);
// --------------------------------------------------

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // 1. Verifica a sessÃ£o inicial
    const checkSession = async () => {
      try {
        const { data: { session } } = await supabase.auth.getSession();
        setUser(session?.user ?? null);
      } catch (error) {
        console.error("Erro ao verificar sessÃ£o:", error);
      } finally {
        setLoading(false);
      }
    };

    checkSession();

    // 2. Escuta mudanÃ§as na autenticaÃ§Ã£o
    const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
      setUser(session?.user ?? null);
      setLoading(false);
    });

    return () => subscription.unsubscribe();
  }, []);

  // O valor que serÃ¡ compartilhado com toda a aplicaÃ§Ã£o
  const value = {
    signUp: (data) => supabase.auth.signUp(data),
    signIn: (data) => supabase.auth.signInWithPassword(data),
    signOut: () => supabase.auth.signOut(),
    user,
    loading
  };

  // BLOQUEIO DE SEGURANÃ‡A (Resolve o Loop):
  // Enquanto o Supabase nÃ£o responde se tem usuÃ¡rio ou nÃ£o, mostramos "Carregando".
  // Assim, o PrivateRoute nunca roda com dados incompletos.
  if (loading) {
    return (
      <div className="flex h-screen w-screen items-center justify-center bg-gray-50">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <p className="text-gray-600">Carregando sistema...</p>
        </div>
      </div>
    );
  }

  return (
    <AuthContext.Provider value={value}>
      {children}
    </AuthContext.Provider>
  );
};

==================================================
ARQUIVO: src\context\gerar_contexto.py
==================================================
import os

# ConfiguraÃ§Ãµes - Adicione ou remova extensÃµes/pastas conforme necessÃ¡rio
EXTENSOES_PERMITIDAS = {
    '.js', '.jsx', '.ts', '.tsx',  # Web / React / Node
    '.html', '.css', '.scss',      # Front-end
    '.py', '.java', '.cs', '.php', # Back-end
    '.sql', '.prisma',             # Banco de Dados
    '.json', '.xml', '.yml',       # ConfiguraÃ§Ãµes
    '.dart', '.swift', '.kt'       # Mobile
}

PASTAS_IGNORADAS = {
    'node_modules', '.git', '.idea', '.vscode', 
    'dist', 'build', 'coverage', 'venv', '__pycache__',
    'bin', 'obj', 'android', 'ios' # Ignorando pastas nativas pesadas se for React Native/Flutter (pode remover se precisar de configs nativas)
}

ARQUIVOS_IGNORADOS = {
    'package-lock.json', 'yarn.lock', 'gerar_contexto.py'
}

def deve_processar(caminho_arquivo):
    _, ext = os.path.splitext(caminho_arquivo)
    nome_arquivo = os.path.basename(caminho_arquivo)
    
    if nome_arquivo in ARQUIVOS_IGNORADOS:
        return False
    return ext in EXTENSOES_PERMITIDAS

def gerar_txt_projeto():
    saida = "projeto_completo.txt"
    
    with open(saida, 'w', encoding='utf-8') as f_out:
        # Adiciona a estrutura de pastas primeiro (TREE)
        f_out.write("--- ESTRUTURA DE DIRETÃ“RIOS ---\n")
        for root, dirs, files in os.walk('.'):
            # Filtra pastas ignoradas para nÃ£o descer nelas
            dirs[:] = [d for d in dirs if d not in PASTAS_IGNORADAS]
            level = root.replace('.', '', 1).count(os.sep)
            indent = ' ' * 4 * (level)
            f_out.write(f"{indent}{os.path.basename(root)}/\n")
            subindent = ' ' * 4 * (level + 1)
            for f in files:
                f_out.write(f"{subindent}{f}\n")
        
        f_out.write("\n\n--- CONTEÃšDO DOS ARQUIVOS ---\n\n")

        # Adiciona o conteÃºdo dos arquivos
        for root, dirs, files in os.walk('.'):
            dirs[:] = [d for d in dirs if d not in PASTAS_IGNORADAS]
            
            for file in files:
                caminho_completo = os.path.join(root, file)
                
                if deve_processar(caminho_completo):
                    f_out.write(f"\n{'='*50}\n")
                    f_out.write(f"CAMINHO: {caminho_completo}\n")
                    f_out.write(f"{'='*50}\n")
                    
                    try:
                        with open(caminho_completo, 'r', encoding='utf-8') as f_in:
                            f_out.write(f_in.read())
                    except Exception as e:
                        f_out.write(f"[Erro ao ler arquivo: {e}]\n")

    print(f"Sucesso! Arquivo '{saida}' gerado. Basta enviÃ¡-lo para a IA.")

if __name__ == "__main__":
    gerar_txt_projeto()

==================================================
ARQUIVO: src\data\brazil-locations.js
==================================================
// src/data/brazil-locations.js
export const estados = [
  { sigla: 'AC', nome: 'Acre' },
  { sigla: 'AL', nome: 'Alagoas' },
  { sigla: 'AP', nome: 'AmapÃ¡' },
  { sigla: 'AM', nome: 'Amazonas' },
  { sigla: 'BA', nome: 'Bahia' },
  { sigla: 'CE', nome: 'CearÃ¡' },
  { sigla: 'DF', nome: 'Distrito Federal' },
  { sigla: 'ES', nome: 'EspÃ­rito Santo' },
  { sigla: 'GO', nome: 'GoiÃ¡s' },
  { sigla: 'MA', nome: 'MaranhÃ£o' },
  { sigla: 'MT', nome: 'Mato Grosso' },
  { sigla: 'MS', nome: 'Mato Grosso do Sul' },
  { sigla: 'MG', nome: 'Minas Gerais' },
  { sigla: 'PA', nome: 'ParÃ¡' },
  { sigla: 'PB', nome: 'ParaÃ­ba' },
  { sigla: 'PR', nome: 'ParanÃ¡' },
  { sigla: 'PE', nome: 'Pernambuco' },
  { sigla: 'PI', nome: 'PiauÃ­' },
  { sigla: 'RJ', nome: 'Rio de Janeiro' },
  { sigla: 'RN', nome: 'Rio Grande do Norte' },
  { sigla: 'RS', nome: 'Rio Grande do Sul' },
  { sigla: 'RO', nome: 'RondÃ´nia' },
  { sigla: 'RR', nome: 'Roraima' },
  { sigla: 'SC', nome: 'Santa Catarina' },
  { sigla: 'SP', nome: 'SÃ£o Paulo' },
  { sigla: 'SE', nome: 'Sergipe' },
  { sigla: 'TO', nome: 'Tocantins' }
];

// No futuro, podemos substituir o campo de cidade por uma busca via API de CEP
// Por enquanto, usaremos um campo de texto simples para a cidade.

==================================================
ARQUIVO: src\pages\AdminPage.jsx
==================================================
// src/pages/AdminPage.jsx (VersÃ£o com Link para /admin/tenant/:tenantId)
import React, { useState, useEffect, forwardRef } from 'react';
import { Link as RouterLink } from 'react-router-dom';
import { supabase } from '../supabase/client';
import { 
    Container, Typography, Box, AppBar, Toolbar, Button, CircularProgress, 
    Alert, Paper, Table, TableHead, TableRow, TableCell, TableBody, Tabs, Tab,
    Modal, FormControl, InputLabel, Select, MenuItem, Snackbar, TextField,
    Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, IconButton, Grid
} from '@mui/material';
import { IMaskInput } from 'react-imask';
import AddIcon from '@mui/icons-material/Add';
import EditIcon from '@mui/icons-material/Edit';
import DeleteIcon from '@mui/icons-material/Delete';

// MÃ¡scara CNPJ (sem alteraÃ§Ãµes)
const CnpjMask = forwardRef(function CnpjMask(props, ref) {
  const { onChange, ...other } = props;
  return (
    <IMaskInput
      {...other}
      mask="00.000.000/0000-00"
      definitions={{
        '#': /[1-9]/,
      }}
      inputRef={ref}
      onAccept={(value) => onChange({ target: { name: props.name, value } })}
      overwrite
    />
  );
});

// Estilo Modal (sem alteraÃ§Ãµes)
const modalStyle = {
  position: 'absolute',
  top: '50%',
  left: '50%',
  transform: 'translate(-50%, -50%)',
  width: 500,
  bgcolor: 'background.paper',
  boxShadow: 24,
  p: 4,
};

// Componente do FormulÃ¡rio de Plano (sem alteraÃ§Ãµes)
const PlanFormModal = ({ open, onClose, plan, onSave }) => {
  const [formData, setFormData] = useState({ id: '', name: '', user_limit: 1, job_limit: 1, candidate_limit: 1, price: 0 });
  const [isSaving, setIsSaving] = useState(false);
  const [error, setError] = useState('');
  const isEditMode = Boolean(plan);
  useEffect(() => { if (plan) { setFormData(plan); } else { setFormData({ id: '', name: '', user_limit: 1, job_limit: 1, candidate_limit: 1, price: 0 }); } }, [plan, open]);
  const handleChange = (e) => { const { name, value } = e.target; setFormData(prev => ({ ...prev, [name]: value })); };
  const handleNumericChange = (e) => { const { name, value } = e.target; const numValue = value === '-1' ? -1 : parseInt(value, 10) || 0; setFormData(prev => ({ ...prev, [name]: numValue })); };
  const handleSubmit = async () => {
    setIsSaving(true);
    setError('');
    try {
      const action = isEditMode ? 'updatePlan' : 'createPlan';
      const body = isEditMode ? { planId: plan.id, planData: formData } : { planData: formData };
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
      const response = await fetch('/api/admin', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
          body: JSON.stringify({ action, ...body })
      });
      if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error || "Ocorreu um erro."); }
      const data = await response.json();
      onSave(isEditMode ? data.updatedPlan : data.newPlan);
      onClose();
    } catch (err) { setError(err.message); } 
    finally { setIsSaving(false); }
  };
  return (
    <Modal open={open} onClose={onClose}>
      <Box sx={modalStyle}>
        <Typography variant="h6" gutterBottom>{isEditMode ? 'Editar Plano' : 'Criar Novo Plano'}</Typography>
        <Grid container spacing={2}>
          <Grid item xs={12}><TextField name="id" label="ID do Plano (ex: 'basico')" value={formData.id} onChange={handleChange} fullWidth margin="normal" required disabled={isEditMode} /></Grid>
          <Grid item xs={12}><TextField name="name" label="Nome do Plano (ex: 'Plano BÃ¡sico')" value={formData.name} onChange={handleChange} fullWidth margin="normal" required /></Grid>
          <Grid item xs={12}><TextField name="price" label="PreÃ§o (ex: 99.00)" type="number" value={formData.price} onChange={handleChange} fullWidth margin="normal" required /></Grid>
          <Grid item xs={12} sm={4}><TextField name="user_limit" label="Limite de UsuÃ¡rios" type="number" value={formData.user_limit} onChange={handleNumericChange} fullWidth margin="normal" helperText="-1 para ilimitado" /></Grid>
          <Grid item xs={12} sm={4}><TextField name="job_limit" label="Limite de Vagas" type="number" value={formData.job_limit} onChange={handleNumericChange} fullWidth margin="normal" helperText="-1 para ilimitado" /></Grid>
          <Grid item xs={12} sm={4}><TextField name="candidate_limit" label="Limite de Candidatos/Vaga" type="number" value={formData.candidate_limit} onChange={handleNumericChange} fullWidth margin="normal" helperText="-1 para ilimitado" /></Grid>
        </Grid>
        {error && <Alert severity="error" sx={{ mt: 2 }}>{error}</Alert>}
        <Box sx={{ mt: 3, display: 'flex', justifyContent: 'flex-end', gap: 1 }}>
          <Button onClick={onClose} disabled={isSaving}>Cancelar</Button>
          <Button variant="contained" onClick={handleSubmit} disabled={isSaving}>
            {isSaving ? <CircularProgress size={24} /> : 'Salvar'}
          </Button>
        </Box>
      </Box>
    </Modal>
  );
};

// Tabela de Planos (sem alteraÃ§Ãµes)
const PlansTable = ({ plans, onAdd, onEdit, onDelete }) => (
  <>
    <Box sx={{ display: 'flex', justifyContent: 'flex-end', my: 2 }}>
        <Button variant="contained" startIcon={<AddIcon />} onClick={onAdd}>
            Criar Novo Plano
        </Button>
    </Box>
    <Paper>
      <Table>
        <TableHead>
          <TableRow>
            <TableCell sx={{ fontWeight: 'bold' }}>ID do Plano</TableCell>
            <TableCell sx={{ fontWeight: 'bold' }}>Nome</TableCell>
            <TableCell align="center" sx={{ fontWeight: 'bold' }}>UsuÃ¡rios</TableCell>
            <TableCell align="center" sx={{ fontWeight: 'bold' }}>Vagas</TableCell>
            <TableCell align="center" sx={{ fontWeight: 'bold' }}>Candidatos/Vaga</TableCell>
            <TableCell align="right" sx={{ fontWeight: 'bold' }}>PreÃ§o</TableCell>
            <TableCell align="center" sx={{ fontWeight: 'bold' }}>AÃ§Ãµes</TableCell>
          </TableRow>
        </TableHead>
        <TableBody>
          {plans.map((plan) => (
            <TableRow hover key={plan.id}>
              <TableCell>{plan.id}</TableCell>
              <TableCell>{plan.name}</TableCell>
              <TableCell align="center">{plan.user_limit === -1 ? 'Ilimitado' : plan.user_limit}</TableCell>
              <TableCell align="center">{plan.job_limit === -1 ? 'Ilimitado' : plan.job_limit}</TableCell>
              <TableCell align="center">{plan.candidate_limit === -1 ? 'Ilimitado' : plan.candidate_limit}</TableCell>
              <TableCell align="right">R$ {plan.price.toFixed(2)}</TableCell>
              <TableCell align="center">
                <IconButton size="small" onClick={() => onEdit(plan)}><EditIcon /></IconButton>
                <IconButton size="small" onClick={() => onDelete(plan)}><DeleteIcon color="error" /></IconButton>
              </TableCell>
            </TableRow>
          ))}
        </TableBody>
      </Table>
    </Paper>
  </>
);

// Tabela de Tenants (AQUI ESTÃ A MUDANÃ‡A)
const TenantsTable = ({ tenants, plans, onTenantUpdated, onTenantCreated, onTenantDeleted }) => {
  const [modalOpen, setModalOpen] = useState(false);
  const [dialogOpen, setDialogOpen] = useState(false);
  const [isSaving, setIsSaving] = useState(false);
  const [selectedTenant, setSelectedTenant] = useState(null);
  const [formData, setFormData] = useState({ companyName: '', planId: '', cnpj: '' });
  
  const handleOpenModal = (tenant = null) => {
    setSelectedTenant(tenant);
    if (tenant) { setFormData({ companyName: tenant.companyName, planId: tenant.planId, cnpj: tenant.cnpj || '' }); }
    else { setFormData({ companyName: '', planId: '', cnpj: '' }); }
    setModalOpen(true);
  };
  const handleOpenDialog = (tenant) => { setSelectedTenant(tenant); setDialogOpen(true); };
  const handleClose = () => { setModalOpen(false); setDialogOpen(false); setSelectedTenant(null); };
  const handleChange = (e) => { const { name, value } = e.target; setFormData(prev => ({ ...prev, [name]: value })); };
  const callApi = async (action, body) => {
    const { data: { session } } = await supabase.auth.getSession();
    if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
    const response = await fetch('/api/admin', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
        body: JSON.stringify({ action, ...body })
    });
    if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error || "Ocorreu um erro."); }
    return await response.json();
  };
  const handleSubmit = async () => {
    setIsSaving(true);
    try {
      if (selectedTenant) { const data = await callApi('updateTenant', { id: selectedTenant.id, ...formData }); onTenantUpdated(data.updatedTenant); }
      else { const data = await callApi('createTenant', formData); onTenantCreated(data.newTenant); }
      handleClose();
    } catch (err) { console.error("Erro ao salvar empresa:", err); } 
    finally { setIsSaving(false); }
  };
  const handleDelete = async () => {
    setIsSaving(true);
    try {
      await callApi('deleteTenant', { tenantId: selectedTenant.id });
      onTenantDeleted(selectedTenant.id);
      handleClose();
    } catch (err) { console.error("Erro ao excluir empresa:", err); } 
    finally { setIsSaving(false); }
  };

  return (
    <>
      <Box sx={{ display: 'flex', justifyContent: 'flex-end', my: 2 }}>
        <Button variant="contained" startIcon={<AddIcon />} onClick={() => handleOpenModal()}>
            Criar Nova Empresa
        </Button>
      </Box>
      <Paper>
        <Table>
          <TableHead>
            <TableRow>
              <TableCell sx={{ fontWeight: 'bold' }}>Nome da Empresa</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>CNPJ</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Plano Atual</TableCell>
              <TableCell align="right" sx={{ fontWeight: 'bold' }}>AÃ§Ãµes</TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {tenants.map((tenant) => (
              <TableRow hover key={tenant.id}>
                <TableCell>{tenant.companyName}</TableCell>
                <TableCell>{tenant.cnpj}</TableCell>
                <TableCell>{tenant.plans ? tenant.plans.name : tenant.planId}</TableCell>
                <TableCell align="right">
                    {/* AQUI ESTÃ A MUDANÃ‡A: O botÃ£o agora Ã© um Link */}
                    <Button size="small" component={RouterLink} to={`/admin/tenant/${tenant.id}`}>
                      Gerenciar UsuÃ¡rios
                    </Button>
                    <IconButton size="small" onClick={() => handleOpenModal(tenant)}><EditIcon /></IconButton>
                    <IconButton size="small" onClick={() => handleOpenDialog(tenant)}><DeleteIcon color="error" /></IconButton>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </Paper>
      <Modal open={modalOpen} onClose={handleClose}>
        <Box sx={modalStyle}>
          <Typography variant="h6" gutterBottom>{selectedTenant ? 'Editar Empresa' : 'Criar Nova Empresa'}</Typography>
          <TextField name="companyName" label="Nome da Empresa" value={formData.companyName} onChange={handleChange} fullWidth margin="normal" required />
          <TextField name="cnpj" label="CNPJ" value={formData.cnpj} onChange={handleChange} fullWidth margin="normal" InputProps={{ inputComponent: CnpjMask }} />
          <FormControl fullWidth margin="normal" required>
            <InputLabel id="plan-select-label">Plano</InputLabel>
            <Select name="planId" labelId="plan-select-label" value={formData.planId} label="Plano" onChange={handleChange}>
              {plans.map(plan => (
                <MenuItem key={plan.id} value={plan.id}>{plan.name}</MenuItem>
              ))}
            </Select>
          </FormControl>
          <Box sx={{ mt: 3, display: 'flex', justifyContent: 'flex-end', gap: 1 }}>
            <Button onClick={handleClose} disabled={isSaving}>Cancelar</Button>
            <Button variant="contained" onClick={handleSubmit} disabled={isSaving}>
              {isSaving ? <CircularProgress size={24} /> : 'Salvar'}
            </Button>
          </Box>
        </Box>
      </Modal>
      <Dialog open={dialogOpen} onClose={handleClose}>
        <DialogTitle>Confirmar ExclusÃ£o</DialogTitle>
        <DialogContent><DialogContentText>VocÃª tem certeza que deseja excluir a empresa <strong>{selectedTenant?.companyName}</strong>? Esta aÃ§Ã£o Ã© irreversÃ­vel.</DialogContentText></DialogContent>
        <DialogActions>
          <Button onClick={handleClose} disabled={isSaving}>Cancelar</Button>
          <Button onClick={handleDelete} color="error" disabled={isSaving}>
            {isSaving ? <CircularProgress size={24} /> : 'Excluir'}
          </Button>
        </DialogActions>
      </Dialog>
    </>
  );
};

// Componente Principal da PÃ¡gina
const AdminPage = () => {
    const [tenants, setTenants] = useState([]);
    const [plans, setPlans] = useState([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState('');
    const [tabValue, setTabValue] = useState(0);
    const [feedback, setFeedback] = useState({ open: false, message: '', severity: 'success' });
    const [planModalOpen, setPlanModalOpen] = useState(false);
    const [selectedPlan, setSelectedPlan] = useState(null);
    const [planDialogOpen, setPlanDialogOpen] = useState(false);

    const fetchData = async () => {
        setLoading(true);
        try {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
            const response = await fetch('/api/admin?action=getTenantsAndPlans', {
                headers: { 'Authorization': `Bearer ${session.access_token}` },
            });
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || "NÃ£o foi possÃ­vel buscar os dados.");
            }
            const data = await response.json();
            setTenants(data.tenants || []);
            setPlans(data.plans || []);
        } catch (err) {
            console.error("Erro ao buscar dados de admin:", err);
            setError(err.message);
        } finally {
            setLoading(false);
        }
    };

    useEffect(() => {
        fetchData();
    }, []);

    const handleTabChange = (event, newValue) => { setTabValue(newValue); };

    const handleTenantUpdated = (updatedTenant) => {
      setTenants(prevTenants => prevTenants.map(t => 
        t.id === updatedTenant.id ? { ...t, ...updatedTenant, plans: plans.find(p => p.id === updatedTenant.planId) } : t
      ));
      setFeedback({ open: true, message: 'Empresa atualizada!', severity: 'success' });
    };
    const handleTenantCreated = (newTenant) => {
      setTenants(prevTenants => [
        ...prevTenants, 
        { ...newTenant, plans: plans.find(p => p.id === newTenant.planId) }
      ]);
      setFeedback({ open: true, message: 'Empresa criada!', severity: 'success' });
    };
    const handleTenantDeleted = (deletedTenantId) => {
      setTenants(prevTenants => prevTenants.filter(t => t.id !== deletedTenantId));
      setFeedback({ open: true, message: 'Empresa excluÃ­da!', severity: 'success' });
    };
    const handleOpenPlanModal = (plan = null) => {
      setSelectedPlan(plan);
      setPlanModalOpen(true);
    };
    const handleClosePlanModal = () => {
      setSelectedPlan(null);
      setPlanModalOpen(false);
    };
    const handleSavePlan = (savedPlan) => {
      if (selectedPlan) {
        setPlans(prev => prev.map(p => p.id === savedPlan.id ? savedPlan : p));
      } else {
        setPlans(prev => [...prev, savedPlan]);
      }
      setFeedback({ open: true, message: 'Plano salvo!', severity: 'success' });
    };
    const handleOpenPlanDialog = (plan) => {
      setSelectedPlan(plan);
      setPlanDialogOpen(true);
    };
    const handleClosePlanDialog = () => {
      setSelectedPlan(null);
      setPlanDialogOpen(false);
    };
    const handleDeletePlan = async () => {
      if (!selectedPlan) return;
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
        const response = await fetch('/api/admin', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
            body: JSON.stringify({ action: 'deletePlan', planId: selectedPlan.id })
        });
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || "Erro ao excluir.");
        }
        setPlans(prev => prev.filter(p => p.id !== selectedPlan.id));
        setFeedback({ open: true, message: 'Plano excluÃ­do!', severity: 'success' });
        handleClosePlanDialog();
      } catch (err) {
        console.error("Erro ao excluir plano:", err);
        setFeedback({ open: true, message: err.message, severity: 'error' });
      }
    };
    
    const renderContent = () => {
        if (loading) {
            return <Box sx={{ display: 'flex', justifyContent: 'center', my: 5 }}><CircularProgress /></Box>;
        }
        if (error) {
            return <Alert severity="error">{error}</Alert>;
        }
        return (
            <Box>
                <Box sx={{ borderBottom: 1, borderColor: 'divider' }}>
                    <Tabs value={tabValue} onChange={handleTabChange}>
                        <Tab label="Empresas (Tenants)" />
                        <Tab label="Planos" />
                    </Tabs>
                </Box>
                <Box hidden={tabValue !== 0}>
                    <TenantsTable 
                      tenants={tenants} 
                      plans={plans} 
                      onTenantUpdated={handleTenantUpdated}
                      onTenantCreated={handleTenantCreated}
                      onTenantDeleted={handleTenantDeleted}
                    />
                </Box>
                <Box hidden={tabValue !== 1}>
                    <PlansTable 
                      plans={plans} 
                      onAdd={() => handleOpenPlanModal()}
                      onEdit={(plan) => handleOpenPlanModal(plan)}
                      onDelete={(plan) => handleOpenPlanDialog(plan)}
                    />
                </Box>
            </Box>
        );
    };

    return (
        <Box>
            <AppBar position="static">
                <Toolbar>
                    <Typography variant="h6" component="div" sx={{ flexGrow: 1 }}>
                        Painel de AdministraÃ§Ã£o
                    </Typography>
                    <Button color="inherit" component={RouterLink} to="/">
                        Voltar para o App
                    </Button>
                </Toolbar>
            </AppBar>
            <Container sx={{ mt: 4 }}>
                <Typography variant="h4" component="h1" gutterBottom>
                    Gerenciamento do Sistema
                </Typography>
                {renderContent()}
            </Container>
            <PlanFormModal
              open={planModalOpen}
              onClose={handleClosePlanModal}
              plan={selectedPlan}
              onSave={handleSavePlan}
            />
            <Dialog open={planDialogOpen} onClose={handleClosePlanDialog}>
              <DialogTitle>Confirmar ExclusÃ£o</DialogTitle>
              <DialogContent>
                <DialogContentText>
                  VocÃª tem certeza que deseja excluir o plano <strong>{selectedPlan?.name}</strong>? Esta aÃ§Ã£o nÃ£o pode ser desfeita.
                </DialogContentText>
              </DialogContent>
              <DialogActions>
                <Button onClick={handleClosePlanDialog}>Cancelar</Button>
                <Button onClick={handleDeletePlan} color="error">Excluir</Button>
              </DialogActions>
            </Dialog>
            <Snackbar open={feedback.open} autoHideDuration={4000} onClose={() => setFeedback({open: false, message: ''})}>
                <Alert onClose={() => setFeedback({open: false, message: ''})} severity={feedback.severity || 'success'} sx={{ width: '100%' }}>
                  {feedback.message}
                </Alert>
            </Snackbar>
        </Box>
    );
};

export default AdminPage;

==================================================
ARQUIVO: src\pages\AdminTenantPage.jsx
==================================================
// src/pages/AdminTenantPage.jsx (VERSÃƒO FINAL E CORRIGIDA)
import React, { useState, useEffect } from 'react';
import { useParams, Link as RouterLink } from 'react-router-dom';
import { supabase } from '../supabase/client';
import { 
    Container, Typography, Box, AppBar, Toolbar, Button, CircularProgress, 
    Alert, Paper, Table, TableHead, TableRow, TableCell, TableBody,
    Modal, TextField, Checkbox, FormControlLabel, Snackbar,
    Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, IconButton
} from '@mui/material';
import AddIcon from '@mui/icons-material/Add';
import EditIcon from '@mui/icons-material/Edit';
import DeleteIcon from '@mui/icons-material/Delete';

// Estilo para o Modal
const modalStyle = {
  position: 'absolute',
  top: '50%',
  left: '50%',
  transform: 'translate(-50%, -50%)',
  width: 500,
  bgcolor: 'background.paper',
  boxShadow: 24,
  p: 4,
};

// Componente do FormulÃ¡rio de UsuÃ¡rio
const UserFormModal = ({ open, onClose, user, tenantId, onSave }) => {
  const [formData, setFormData] = useState({ email: '', password: '', name: '', role: 'rh', isAdmin: false });
  const [isSaving, setIsSaving] = useState(false);
  const [error, setError] = useState('');
  const isEditMode = Boolean(user);

  useEffect(() => {
    if (user) {
      setFormData({ 
        name: user.name, 
        role: user.role, 
        isAdmin: user.isAdmin,
        email: user.email || '', // O email nÃ£o pode ser editado
      });
    } else {
      setFormData({ email: '', password: '', name: '', role: 'rh', isAdmin: false });
    }
  }, [user, open]);

  const handleChange = (e) => {
    const { name, value, type, checked } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: type === 'checkbox' ? checked : value
    }));
  };

  const handleSubmit = async () => {
    setIsSaving(true);
    setError('');
    try {
      const action = isEditMode ? 'updateUser' : 'createUser';
      // No modo de ediÃ§Ã£o, nÃ£o enviamos email/senha/tenantId
      const body = isEditMode 
        ? { action, userId: user.id, name: formData.name, role: formData.role, isAdmin: formData.isAdmin }
        : { action, ...formData, tenantId: tenantId };
      
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
      
      const response = await fetch('/api/admin', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
          body: JSON.stringify(body)
      });
      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || "Ocorreu um erro.");
      }
      const data = await response.json();
      onSave(isEditMode ? data.updatedUser : data.newUser);
      onClose();
    } catch (err) {
      setError(err.message);
    } finally {
      setIsSaving(false);
    }
  };

  return (
    <Modal open={open} onClose={onClose}>
      <Box sx={modalStyle}>
        <Typography variant="h6" gutterBottom>{isEditMode ? 'Editar UsuÃ¡rio' : 'Criar Novo UsuÃ¡rio'}</Typography>
        <TextField name="email" label="Email do UsuÃ¡rio" value={formData.email} onChange={handleChange} fullWidth margin="normal" required disabled={isEditMode} />
        {!isEditMode && (
          <TextField name="password" label="Senha ProvisÃ³ria" type="password" value={formData.password} onChange={handleChange} fullWidth margin="normal" required />
        )}
        <TextField name="name" label="Nome Completo" value={formData.name} onChange={handleChange} fullWidth margin="normal" required />
        <TextField name="role" label="FunÃ§Ã£o (ex: rh, gestor)" value={formData.role} onChange={handleChange} fullWidth margin="normal" required />
        <FormControlLabel
          control={<Checkbox name="isAdmin" checked={formData.isAdmin} onChange={handleChange} />}
          label="Este usuÃ¡rio Ã© Administrador?"
        />
        {error && <Alert severity="error" sx={{ mt: 2 }}>{error}</Alert>}
        <Box sx={{ mt: 3, display: 'flex', justifyContent: 'flex-end', gap: 1 }}>
          <Button onClick={onClose} disabled={isSaving}>Cancelar</Button>
          <Button variant="contained" onClick={handleSubmit} disabled={isSaving}>
            {isSaving ? <CircularProgress size={24} /> : 'Salvar'}
          </Button>
        </Box>
      </Box>
    </Modal>
  );
};


const AdminTenantPage = () => {
    const { tenantId } = useParams();
    const [tenant, setTenant] = useState(null);
    const [users, setUsers] = useState([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState('');
    const [modalOpen, setModalOpen] = useState(false);
    const [dialogOpen, setDialogOpen] = useState(false);
    const [selectedUser, setSelectedUser] = useState(null);
    const [feedback, setFeedback] = useState({ open: false, message: '', severity: 'success' });

    const fetchTenantDetails = async () => {
        setLoading(true);
        try {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
            const response = await fetch(`/api/admin?action=getTenantDetails&tenantId=${tenantId}`, {
                headers: { 'Authorization': `Bearer ${session.access_token}` },
            });
            if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error || "NÃ£o foi possÃ­vel buscar os dados."); }
            const data = await response.json();
            setTenant(data.tenant || null);
            setUsers(data.users || []);
        } catch (err) {
            console.error("Erro ao buscar detalhes do tenant:", err);
            setError(err.message);
        } finally {
            setLoading(false);
        }
    };

    useEffect(() => {
        fetchTenantDetails();
    }, [tenantId]);

    const handleOpenModal = (user = null) => {
      setSelectedUser(user);
      setModalOpen(true);
    };
    const handleCloseModal = () => {
      setSelectedUser(null);
      setModalOpen(false);
    };
    const handleOpenDialog = (user) => {
      setSelectedUser(user);
      setDialogOpen(true);
    };
    const handleCloseDialog = () => {
      setSelectedUser(null);
      setDialogOpen(false);
    };

    const handleSaveUser = (savedUser) => {
      if (selectedUser) {
        setUsers(prev => prev.map(u => u.id === savedUser.id ? savedUser : u));
      } else {
        setUsers(prev => [...prev, savedUser]);
      }
      setFeedback({ open: true, message: 'UsuÃ¡rio salvo!', severity: 'success' });
    };

    const handleDeleteUser = async () => {
      if (!selectedUser) return;
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
        
        const response = await fetch('/api/admin', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
            body: JSON.stringify({ action: 'deleteUser', userId: selectedUser.id })
        });
        if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error || "Erro ao excluir."); }
        
        setUsers(prev => prev.filter(u => u.id !== selectedUser.id));
        setFeedback({ open: true, message: 'UsuÃ¡rio excluÃ­do!', severity: 'success' });
        handleCloseDialog();
      } catch (err) {
        console.error("Erro ao excluir usuÃ¡rio:", err);
        setFeedback({ open: true, message: err.message, severity: 'error' });
      }
    };

    const renderContent = () => {
        if (loading) {
            return <Box sx={{ display: 'flex', justifyContent: 'center', my: 5 }}><CircularProgress /></Box>;
        }
        if (error) {
            return <Alert severity="error">{error}</Alert>;
        }
        if (!tenant) {
             return <Alert severity="warning">Empresa nÃ£o encontrada.</Alert>;
        }
        return (
            <Paper sx={{ mt: 3 }}>
                <Table>
                    <TableHead>
                        <TableRow>
                            <TableCell sx={{ fontWeight: 'bold' }}>Nome do UsuÃ¡rio</TableCell>
                            <TableCell sx={{ fontWeight: 'bold' }}>FunÃ§Ã£o</TableCell>
                            <TableCell align="center" sx={{ fontWeight: 'bold' }}>Ã‰ Admin?</TableCell>
                            <TableCell align="right" sx={{ fontWeight: 'bold' }}>AÃ§Ãµes</TableCell>
                        </TableRow>
                    </TableHead>
                    <TableBody>
                        {users.map((user) => (
                            <TableRow hover key={user.id}>
                                <TableCell>{user.name}</TableCell>
                                <TableCell>{user.role}</TableCell>
                                <TableCell align="center">{user.isAdmin ? 'Sim' : 'NÃ£o'}</TableCell>
                                <TableCell align="right">
                                    <IconButton size="small" onClick={() => handleOpenModal(user)}><EditIcon /></IconButton>
                                    <IconButton size="small" onClick={() => handleOpenDialog(user)}><DeleteIcon color="error" /></IconButton>
                                </TableCell>
                            </TableRow>
                        ))}
                    </TableBody>
                </Table>
            </Paper>
        );
    };

    return (
        <Box>
            <AppBar position="static">
                <Toolbar>
                    <Typography variant="h6" component="div" sx={{ flexGrow: 1 }}>
                        {tenant ? `Gerenciar: ${tenant.companyName}` : 'Carregando Empresa...'}
                    </Typography>
                    <Button color="inherit" component={RouterLink} to="/admin">
                        Voltar para Admin
                    </Button>
                </Toolbar>
            </AppBar>
            <Container sx={{ mt: 4 }}>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>
                    <Typography variant="h4" component="h1" gutterBottom>
                        Gerenciamento de UsuÃ¡rios
                    </Typography>
                    <Button variant="contained" startIcon={<AddIcon />} onClick={() => handleOpenModal()}>
                        Criar UsuÃ¡rio
                    </Button>
                </Box>
                {renderContent()}
            </Container>
            <UserFormModal
                open={modalOpen}
                onClose={handleCloseModal}
                user={selectedUser}
                tenantId={tenantId}
                onSave={handleSaveUser}
            />
            <Dialog open={dialogOpen} onClose={handleCloseDialog}>
                <DialogTitle>Confirmar ExclusÃ£o</DialogTitle>
                <DialogContent>
                    <DialogContentText>
                        VocÃª tem certeza que deseja excluir o usuÃ¡rio <strong>{selectedUser?.name}</strong>? Esta aÃ§Ã£o Ã© irreversÃ­vel.
                    </DialogContentText>
                </DialogContent>
                <DialogActions>
                    <Button onClick={handleCloseDialog}>Cancelar</Button>
                    <Button onClick={handleDeleteUser} color="error">Excluir</Button>
                </DialogActions>
            </Dialog>
            <Snackbar open={feedback.open} autoHideDuration={4000} onClose={() => setFeedback({open: false, message: ''})}>
                <Alert onClose={() => setFeedback({open: false, message: ''})} severity={feedback.severity || 'success'} sx={{ width: '100%' }}>
                  {feedback.message}
                </Alert>
            </Snackbar>
        </Box>
    );
};

export default AdminTenantPage;

==================================================
ARQUIVO: src\pages\ApplicationDetails.jsx
==================================================
// src/pages/ApplicationDetails.jsx (VERSÃƒO FINAL, COMPLETA E CORRIGIDA)
import EvaluationDashboardV2 from '../components/evaluation_v2/EvaluationDashboardV2';
import { useAuth } from '../context/AuthContext'; // Para pegar o usuÃ¡rio logado
import React, { useState, useEffect } from 'react';
import { useParams, Link as RouterLink } from 'react-router-dom';
import { supabase } from '../supabase/client';
// Importa as funÃ§Ãµes centralizadas
import { formatUrl, formatPhone, formatDate } from '../utils/formatters';
import { 
    Container, Typography, Box, AppBar, Toolbar, Button, CircularProgress, 
    Alert, Paper, Grid, Link, Divider, List, ListItem, ListItemText,
    FormControl, InputLabel, Select, MenuItem, TextField, Snackbar
} from '@mui/material';
import AddCircleOutlineIcon from '@mui/icons-material/AddCircleOutline';
import DeleteIcon from '@mui/icons-material/Delete';
import ContentCopyIcon from '@mui/icons-material/ContentCopy';

// O componente de seÃ§Ã£o de parÃ¢metros, que jÃ¡ estÃ¡ estÃ¡vel.
// NOTE: Este componente nÃ£o existe neste arquivo, ele estÃ¡ no JobDetails.jsx
// Removendo-o daqui para evitar confusÃ£o, jÃ¡ que ele nÃ£o Ã© usado aqui.

// O componente de seÃ§Ã£o de avaliaÃ§Ã£o, com a lÃ³gica de ID Ãºnico que vocÃª sugeriu.
const EvaluationSection = ({ title, criteria = [], notes = [], evaluationData = {}, onEvaluationChange, onNotesChange }) => {
  return (
    <Paper variant="outlined" sx={{ p: 2, mt: 2 }}>
      <Typography variant="h6" sx={{textTransform: 'capitalize'}}>{title}</Typography>
      {criteria.map((criterion) => (
        <Box key={`${title}-${criterion.name}`} sx={{ mt: 2 }}>
          <FormControl fullWidth>
            <InputLabel>{criterion.name} (Peso: {criterion.weight}%)</InputLabel>
            <Select
              value={evaluationData[criterion.name] || ''}
              label={`${criterion.name} (Peso: ${criterion.weight}%)`}
              onChange={(e) => onEvaluationChange(title.toLowerCase(), criterion.name, e.target.value)}
              variant="standard"
            >
              {notes.map((note) => (
                <MenuItem key={note.id} value={note.id}>{note.nome} ({note.valor})</MenuItem>
              ))}
            </Select>
          </FormControl>
        </Box>
      ))}
      <TextField
        label="AnotaÃ§Ãµes"
        multiline
        rows={3}
        fullWidth
        variant="standard"
        sx={{ mt: 2 }}
        value={evaluationData.anotacoes || ''}
        onChange={(e) => onNotesChange(title.toLowerCase(), e.target.value)}
      />
    </Paper>
  );
};

// O componente principal, com a lÃ³gica de estado e carregamento CORRIGIDA.
const ApplicationDetails = () => {
  const { jobId, applicationId } = useParams();
  const [application, setApplication] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState('');
  const [resumeUrl, setResumeUrl] = useState('');
  const [evaluation, setEvaluation] = useState(null); // Corrigido: Inicia como nulo
  const [isSaving, setIsSaving] = useState(false);
  const [feedback, setFeedback] = useState({ open: false, message: '', severity: 'success' });
  
  useEffect(() => {
    const fetchDetails = async () => {
      if (!applicationId) { setError("ID da candidatura nÃ£o encontrado."); setLoading(false); return; }
      setLoading(true);
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
        const appResponse = await fetch(`/api/getApplicationDetails?applicationId=${applicationId}`, { headers: { 'Authorization': `Bearer ${session.access_token}` } });
        if (!appResponse.ok) { const errorData = await appResponse.json(); throw new Error(errorData.error || "NÃ£o foi possÃ­vel buscar os detalhes."); }
        const appData = await appResponse.json();
        
        if (appData.application) {
          setApplication(appData.application);

          // CORREÃ‡ÃƒO: LÃ³gica robusta para carregar a avaliaÃ§Ã£o salva ou criar uma estrutura vazia.
          const savedEvaluation = appData.application.evaluation;
          setEvaluation({
            triagem: savedEvaluation?.triagem || {},
            cultura: savedEvaluation?.cultura || {},
            tÃ©cnico: savedEvaluation?.tÃ©cnico || {},
          });

          const filePath = appData.application.resumeUrl;
          if (filePath) {
            const urlResponse = await fetch(`/api/getResumeSignedUrl?filePath=${filePath}`, { headers: { 'Authorization': `Bearer ${session.access_token}` } });
            if (!urlResponse.ok) { throw new Error("NÃ£o foi possÃ­vel gerar o link do currÃ­culo."); }
            const urlData = await urlResponse.json();
            setResumeUrl(urlData.signedUrl);
          }
        } else { throw new Error("Dados da candidatura recebidos sÃ£o invÃ¡lidos."); }
      } catch (err) { console.error("Erro ao carregar detalhes:", err); setError(err.message); } 
      finally { setLoading(false); }
    };
    fetchDetails();
  }, [applicationId]);
  
  const handleEvaluationChange = (section, criterionName, noteId) => {
    setEvaluation(prevEval => ({ ...prevEval, [section]: { ...prevEval[section], [criterionName]: noteId } }));
  };
  const handleNotesChange = (section, text) => {
    setEvaluation(prevEval => ({ ...prevEval, [section]: { ...prevEval[section], anotacoes: text } }));
  };
  const handleCloseFeedback = (event, reason) => {
    if (reason === 'clickaway') {
      return;
    }
    setFeedback({ open: false, message: '' });
  };

  const handleSaveEvaluation = async () => {
    setIsSaving(true);
    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) throw new Error("VocÃª nÃ£o estÃ¡ autenticado.");
      const response = await fetch('/api/saveEvaluation', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
        body: JSON.stringify({ applicationId: applicationId, evaluation: evaluation }),
      });
      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || "NÃ£o foi possÃ­vel salvar a avaliaÃ§Ã£o.");
      }
      setFeedback({ open: true, message: 'AvaliaÃ§Ã£o salva com sucesso!', severity: 'success' });
    } catch (err) {
      console.error("Erro ao salvar avaliaÃ§Ã£o:", err);
      setFeedback({ open: true, message: err.message, severity: 'error' });
    } finally {
      setIsSaving(false);
    }
  };
  
  const renderContent = () => {
    if (loading) { return <Box sx={{ display: 'flex', justifyContent: 'center', my: 5 }}><CircularProgress /></Box>; }
    if (error) { return <Alert severity="error">{error}</Alert>; }
    if (application && evaluation) {
      const { candidate, job, formData } = application;
      const displayFields = [
        { key: 'preferredName', label: 'Como prefere ser chamado(a)?' }, { key: 'birthDate', label: 'Data de Nascimento', format: formatDate },
        { key: 'state', label: 'Estado' }, { key: 'city', label: 'Cidade' },
        { key: 'hasGraduated', label: 'Concluiu curso superior?', format: (val) => val === 'sim' ? 'Sim, jÃ¡ concluÃ­' : 'NÃ£o, estou cursando' },
        { key: 'studyPeriod', label: 'PerÃ­odo que estuda' }, { key: 'course', label: 'Curso' },
        { key: 'institution', label: 'InstituiÃ§Ã£o' }, { key: 'completionYear', label: 'Ano de ConclusÃ£o' },
        { key: 'englishLevel', label: 'NÃ­vel de InglÃªs' }, { key: 'spanishLevel', label: 'NÃ­vel de Espanhol' },
        { key: 'source', label: 'Como soube da vaga?' }, { key: 'motivation', label: 'MotivaÃ§Ã£o' },
      ];

      return (
        <Grid container spacing={3}>
          <Grid item xs={12} md={4}>
            <Paper sx={{ p: 2, height: '100%' }}>
              <Typography variant="h5" gutterBottom>{candidate.name}</Typography>
              <Typography variant="body1" sx={{ wordBreak: 'break-all' }}><strong>E-mail:</strong> {candidate.email}</Typography>
              <Typography variant="body1"><strong>Telefone:</strong> {formatPhone(formData.phone)}</Typography>
              <Divider sx={{ my: 2 }} />
              {formData.linkedinProfile && <Link href={formatUrl(formData.linkedinProfile)} target="_blank" rel="noopener" display="block">Perfil no LinkedIn</Link>}
              {formData.githubProfile && <Link href={formatUrl(formData.githubProfile)} target="_blank" rel="noopener" display="block">Perfil no GitHub</Link>}
              <Box mt={2}><Button variant="contained" href={resumeUrl} target="_blank" disabled={!resumeUrl}> Ver CurrÃ­culo </Button></Box>
            </Paper>
          </Grid>
          <Grid item xs={12} md={8}>
            <Paper sx={{ p: 2, height: '100%' }}>
              <Typography variant="h6" gutterBottom>Respostas do FormulÃ¡rio</Typography>
              <Grid container spacing={2}>
                {displayFields.map((field) => {
                  const value = formData[field.key];
                  if (value) {
                    return (
                      <Grid item xs={12} sm={6} key={field.key}>
                        <Typography variant="caption" color="text.secondary" sx={{ display: 'block' }}>{field.label}</Typography>
                        <Typography variant="body1">{field.format ? field.format(value) : (value || 'NÃ£o informado')}</Typography>
                      </Grid>
                    );
                  }
                  return null;
                })}
              </Grid>
            </Paper>
          </Grid>
          <Grid item xs={12}>
             <Paper sx={{ p: 2, mt: 2 }}>
                <Typography variant="h5" gutterBottom>AvaliaÃ§Ã£o</Typography>
                <EvaluationSection title="Triagem" criteria={job.parameters.triagem} notes={job.parameters.notas} evaluationData={evaluation.triagem} onEvaluationChange={handleEvaluationChange} onNotesChange={handleNotesChange} />
                <EvaluationSection title="Cultura" criteria={job.parameters.cultura} notes={job.parameters.notas} evaluationData={evaluation.cultura} onEvaluationChange={handleEvaluationChange} onNotesChange={handleNotesChange} />
                <EvaluationSection title="TÃ©cnico" criteria={job.parameters.tÃ©cnico} notes={job.parameters.notas} evaluationData={evaluation.tÃ©cnico} onEvaluationChange={handleEvaluationChange} onNotesChange={handleNotesChange} />
                <Box sx={{ mt: 3, display: 'flex', justifyContent: 'flex-end' }}>
                  <Button variant="contained" size="large" onClick={handleSaveEvaluation} disabled={isSaving}>
                    {isSaving ? <CircularProgress size={24} color="inherit"/> : 'Salvar AvaliaÃ§Ã£o'}
                  </Button>
                </Box>
              </Paper>
           </Grid>
        </Grid>
      );
    }
    return null;
  };
  
  return (
    <Box>
      <AppBar position="static">
        <Toolbar>
          <Typography variant="h6" component="div" sx={{ flexGrow: 1 }}>
            {application ? `Candidato: ${application.candidate.name}` : 'Carregando Candidatura...'}
          </Typography>
          <Button color="inherit" component={RouterLink} to={`/vaga/${jobId}`}> Voltar para a Vaga </Button>
        </Toolbar>
      </AppBar>
      <Container sx={{ mt: 4 }}>
        {renderContent()}
      </Container>
      <Snackbar open={feedback.open} autoHideDuration={4000} onClose={handleCloseFeedback}>
        <Alert onClose={handleCloseFeedback} severity={feedback.severity} sx={{ width: '100%' }}>
          {feedback.message}
        </Alert>
      </Snackbar>
    </Box>
  );
};

export default ApplicationDetails;

==================================================
ARQUIVO: src\pages\ApplyPage.jsx
==================================================
// src/pages/ApplyPage.jsx (VERSÃƒO FINAL: Refatorada com StateSelect)
import React, { useState, useEffect } from 'react';
import { useParams } from 'react-router-dom';
import { 
    Container, Box, Typography, TextField, Button, CircularProgress, Alert,
    Select, MenuItem, InputLabel, FormControl, RadioGroup, FormControlLabel, Radio, FormLabel
} from '@mui/material';
import { DatePicker } from '@mui/x-date-pickers/DatePicker';

// ImportaÃ§Ã£o do novo componente refatorado
import StateSelect from '../components/inputs/StateSelect';

const ApplyPage = () => {
  const { jobId } = useParams();
  const [jobTitle, setJobTitle] = useState('');
  
  // Estados de controle da pÃ¡gina
  const [isVagaClosed, setIsVagaClosed] = useState(false);
  const [loadingPage, setLoadingPage] = useState(true);
  const [errorPage, setErrorPage] = useState('');

  // Estado do formulÃ¡rio
  const [formState, setFormState] = useState({
    name: '', preferredName: '', email: '', phone: '', birthDate: null,
    state: '', city: '', hasGraduated: '', studyPeriod: '', course: '',
    institution: '', completionYear: '', englishLevel: '', spanishLevel: '',
    source: '', motivation: '', linkedinProfile: '', githubProfile: ''
  });
  
  const [resumeFile, setResumeFile] = useState(null);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [feedback, setFeedback] = useState({ type: '', message: '' });

  // Busca dados da vaga e verifica status/plano
  useEffect(() => {
    const fetchJobData = async () => {
      if (!jobId) {
        setErrorPage('ID da vaga nÃ£o especificado na URL.');
        setLoadingPage(false);
        return;
      }
      try {
        const response = await fetch(`/api/getPublicJobData?id=${jobId}`);
        if (!response.ok) throw new Error('Vaga nÃ£o encontrada ou ocorreu um erro no servidor.');
        const data = await response.json();
        
        if (data.job) {
          // LÃ³gica Freemium: Bloqueia se atingiu limite de 3 candidatos
          if (data.job.planId === 'freemium' && data.job.candidateCount >= 3) {
            setIsVagaClosed(true);
          }
          setJobTitle(data.job.title);
        } else {
            throw new Error('Dados da vaga nÃ£o encontrados.');
        }
      } catch (error) {
        setErrorPage(error.message);
        console.error(error);
      } finally {
        setLoadingPage(false);
      }
    };
    fetchJobData();
  }, [jobId]);

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormState(prevState => ({ ...prevState, [name]: value }));
  };
  
  const handleDateChange = (newDate) => { 
      setFormState(prevState => ({ ...prevState, birthDate: newDate })); 
  };
  
  const handleFileChange = (e) => {
    if (e.target.files && e.target.files.length > 0) {
      setResumeFile(e.target.files[0]);
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setIsSubmitting(true);
    setFeedback({ type: '', message: '' });

    if (!resumeFile) {
      setFeedback({ type: 'error', message: 'Por favor, anexe seu currÃ­culo.' });
      setIsSubmitting(false);
      return;
    }

    const formData = new FormData();
    formData.append('jobId', jobId);
    
    // Anexa campos do formulÃ¡rio ao FormData
    for (const key in formState) {
      if (formState[key]) {
        if (key === 'birthDate') { 
            formData.append(key, formState[key].toISOString()); 
        } else { 
            formData.append(key, formState[key]); 
        }
      }
    }
    formData.append('resume', resumeFile);

    try {
      const response = await fetch('/api/apply', { method: 'POST', body: formData });
      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || 'Ocorreu um erro ao enviar sua candidatura.');
      }
      setFeedback({ type: 'success', message: 'Candidatura enviada com sucesso! Agradecemos o seu interesse.' });
    } catch (error) {
      console.error("Erro na submissÃ£o:", error);
      setFeedback({ type: 'error', message: error.message });
    } finally {
      setIsSubmitting(false);
    }
  };

  // RenderizaÃ§Ã£o Condicional de Estados de Carregamento/Erro
  if (loadingPage) {
    return <Box sx={{ display: 'flex', justifyContent: 'center', my: 8 }}><CircularProgress /></Box>;
  }
  
  if (errorPage) {
    return <Container maxWidth="sm" sx={{mt: 8}}><Alert severity="error">{errorPage}</Alert></Container>;
  }
  
  if (feedback.type === 'success') {
    return (
        <Container maxWidth="sm" sx={{ textAlign: 'center', mt: 8 }}>
            <Typography variant="h4" gutterBottom>Obrigado!</Typography>
            <Alert severity="success">{feedback.message}</Alert>
        </Container>
    );
  }
  
  if (isVagaClosed) {
    return (
        <Container maxWidth="sm" sx={{ textAlign: 'center', mt: 8 }}>
            <Typography variant="h4" gutterBottom>Vaga Encerrada</Typography>
            <Alert severity="warning">
              Agradecemos o seu interesse, mas esta vaga jÃ¡ atingiu o nÃºmero mÃ¡ximo de candidaturas.
            </Alert>
        </Container>
    );
  }

  return (
    <Container maxWidth="md">
      <Box sx={{ my: 4 }}>
        <Typography variant="h4" component="h1" gutterBottom>Candidatura Ã  Vaga</Typography>
        <Typography variant="h6" color="text.secondary">{jobTitle}</Typography>
        
        <Box component="form" onSubmit={handleSubmit} noValidate sx={{ mt: 3, borderTop: '1px solid #ddd', pt: 3 }}>
          
          <TextField name="name" label="Nome Completo" required fullWidth margin="normal" onChange={handleInputChange} />
          <TextField name="preferredName" label="Como prefere ser chamado(a)?" fullWidth margin="normal" onChange={handleInputChange} />
          
          <TextField name="email" label="Seu melhor e-mail" type="email" required fullWidth margin="normal" onChange={handleInputChange} />
          <TextField name="phone" label="NÃºmero de telefone (celular)" type="tel" required fullWidth margin="normal" onChange={handleInputChange} />
          
          <DatePicker label="Data de Nascimento" sx={{ width: '100%', mt: 2, mb: 1 }} value={formState.birthDate} onChange={handleDateChange} />
          
          {/* AQUI ESTÃ A MUDANÃ‡A: Uso do Componente StateSelect */}
          <StateSelect 
            value={formState.state}
            onChange={handleInputChange}
          />

          <TextField 
            name="city" 
            label="Em que cidade vocÃª mora?" 
            required 
            fullWidth 
            margin="normal" 
            onChange={handleInputChange} 
          />
          
          <FormControl component="fieldset" margin="normal" required>
              <FormLabel component="legend">VocÃª jÃ¡ concluiu algum curso de nÃ­vel superior?</FormLabel>
              <RadioGroup row name="hasGraduated" value={formState.hasGraduated} onChange={handleInputChange}>
                  <FormControlLabel value="sim" control={<Radio />} label="Sim, jÃ¡ concluÃ­" />
                  <FormControlLabel value="nao" control={<Radio />} label="NÃ£o, estou cursando" />
              </RadioGroup>
          </FormControl>
          
          {formState.hasGraduated === 'nao' && (
              <TextField name="studyPeriod" label="Em que perÃ­odo/ano vocÃª estÃ¡?" fullWidth margin="normal" onChange={handleInputChange} />
          )}
          
          {formState.hasGraduated && (
            <>
                <TextField name="course" label="Qual o curso?" required={!!formState.hasGraduated} fullWidth margin="normal" onChange={handleInputChange} />
                <TextField name="institution" label="Em qual faculdade/instituiÃ§Ã£o?" required={!!formState.hasGraduated} fullWidth margin="normal" onChange={handleInputChange} />
                {formState.hasGraduated === 'sim' && ( 
                    <TextField name="completionYear" label="Ano de ConclusÃ£o" type="number" fullWidth margin="normal" onChange={handleInputChange} />
                )}
            </>
          )}
          
          {['englishLevel', 'spanishLevel'].map(lang => (
              <FormControl fullWidth margin="normal" key={lang}>
                  <InputLabel>{lang === 'englishLevel' ? 'NÃ­vel de InglÃªs' : 'NÃ­vel de Espanhol'}</InputLabel>
                  <Select name={lang} value={formState[lang] || ''} label={lang === 'englishLevel' ? 'NÃ­vel de InglÃªs' : 'NÃ­vel de Espanhol'} onChange={handleInputChange}>
                      <MenuItem value="basico">BÃ¡sico</MenuItem>
                      <MenuItem value="intermediario">IntermediÃ¡rio</MenuItem>
                      <MenuItem value="avancado">AvanÃ§ado</MenuItem>
                      <MenuItem value="fluente">Fluente/Nativo</MenuItem>
                  </Select>
              </FormControl>
          ))}
          
          <TextField name="source" label="Como ficou sabendo da vaga?" fullWidth margin="normal" onChange={handleInputChange} />
          
          <TextField name="motivation" label="Por que vocÃª deseja fazer parte do nosso time?" required multiline rows={4} fullWidth margin="normal" onChange={handleInputChange} />
          
          <TextField name="linkedinProfile" label="Link do seu perfil no LinkedIn" fullWidth margin="normal" onChange={handleInputChange} />
          <TextField name="githubProfile" label="Link do seu perfil no GitHub" fullWidth margin="normal" onChange={handleInputChange} />
          
          <Button variant="outlined" component="label" sx={{ mt: 2, mb: 1, width: '100%' }}>
              Anexe o seu currÃ­culo (PDF, DOC, DOCX)
              <input type="file" hidden required accept=".pdf,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" onChange={handleFileChange} />
          </Button>
          
          {resumeFile && <Typography variant="body2" textAlign="center" color="text.secondary">{resumeFile.name}</Typography>}
          
          {feedback.type && <Alert severity={feedback.type} sx={{ mt: 2 }}>{feedback.message}</Alert>}
          
          <Button type="submit" fullWidth variant="contained" size="large" sx={{ mt: 3, mb: 2 }} disabled={isSubmitting}>
              {isSubmitting ? <CircularProgress size={24} /> : 'Enviar Candidatura'}
          </Button>
        </Box>
      </Box>
    </Container>
  );
};

export default ApplyPage;

==================================================
ARQUIVO: src\pages\Candidates.jsx
==================================================
export default function Candidates() {
  return (
    <div className="p-8">
      <h1 className="text-2xl font-bold mb-4">Banco de Talentos</h1>
      <p>PÃ¡gina em construÃ§Ã£o. Aqui aparecerÃ£o todos os candidatos.</p>
    </div>
  );
}

==================================================
ARQUIVO: src\pages\CompanySettings.jsx
==================================================
export default function CompanySettings() {
  return (
    <div className="p-8">
      <h1 className="text-2xl font-bold mb-4">ConfiguraÃ§Ãµes da Empresa</h1>
      <p>PÃ¡gina em construÃ§Ã£o.</p>
    </div>
  );
}

==================================================
ARQUIVO: src\pages\Dashboard.jsx
==================================================
// src/pages/Dashboard.jsx (VERSÃƒO FINAL: UX Aprimorada e Chips de Status)
import React, { useState, useEffect, useMemo } from 'react';
import { useNavigate, Link as RouterLink } from 'react-router-dom';
import { supabase } from '../supabase/client';
import { useAuth } from '../context/AuthContext';
import CreateJobModal from '../components/jobs/CreateJobModal';
import { 
    Box, Button, Typography, Container, AppBar, Toolbar, CircularProgress, 
    Table, TableBody, TableCell, TableHead, TableRow, Paper, Alert,
    FormControl, InputLabel, Select, MenuItem, Chip, Stack
} from '@mui/material';
import { formatStatus } from '../utils/formatters';
import AddIcon from '@mui/icons-material/Add';
import CheckCircleIcon from '@mui/icons-material/CheckCircle';

// FunÃ§Ã£o auxiliar para definir cores dos status (Design System)
const getStatusColor = (status) => {
    switch (status) {
        case 'active': return 'success';   // Verde
        case 'filled': return 'info';      // Azul
        case 'inactive': return 'default'; // Cinza
        default: return 'default';
    }
};

// Prioridade de ordenaÃ§Ã£o (Constante para nÃ£o recriar a cada render)
const STATUS_PRIORITY = {
    'active': 1,
    'filled': 2,
    'inactive': 3
};

const Dashboard = () => {
    const navigate = useNavigate();
    const { currentUser } = useAuth();
    
    // Estados de Dados
    const [jobs, setJobs] = useState([]);
    const [planId, setPlanId] = useState(null);
    const [isAdmin, setIsAdmin] = useState(false);
    
    // Estados de UI
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState('');
    const [openCreateModal, setOpenCreateModal] = useState(false);
    const [statusFilter, setStatusFilter] = useState('active'); // UX: PadrÃ£o 'active' foca no que importa

    const fetchJobs = async () => {
        if (!currentUser) return;
        setLoading(true);
        try {
            // Nota: O arquivo client.js jÃ¡ garante que as chaves existem
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) throw new Error("SessÃ£o do usuÃ¡rio nÃ£o encontrada.");
            
            const response = await fetch('/api/jobs', { 
                headers: { 'Authorization': `Bearer ${session.access_token}` } 
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'Falha ao buscar vagas.');
            }
            
            const data = await response.json();
            setJobs(data.jobs || []);
            setPlanId(data.planId);
            setIsAdmin(data.isAdmin);
        } catch (err) {
            console.error("Erro ao buscar vagas:", err);
            setError(err.message);
        } finally {
            setLoading(false);
        }
    };

    useEffect(() => {
        fetchJobs();
    }, [currentUser]);

    // LÃ³gica de Filtro e OrdenaÃ§Ã£o Otimizada (Memoized)
    const processedJobs = useMemo(() => {
      return jobs
        .filter(job => {
          if (statusFilter === 'all') return true;
          return job.status === statusFilter;
        })
        .sort((a, b) => {
          // 1. Ordena pela prioridade do status
          const priorityA = STATUS_PRIORITY[a.status] || 99;
          const priorityB = STATUS_PRIORITY[b.status] || 99;
          
          if (priorityA !== priorityB) return priorityA - priorityB;
          
          // 2. Desempate: Ordem alfabÃ©tica
          return a.title.localeCompare(b.title);
        });
    }, [jobs, statusFilter]);

    const handleLogout = async () => { await supabase.auth.signOut(); };
    const handleRowClick = (jobId) => { navigate(`/vaga/${jobId}`); };
    
    const isFreemium = planId === 'freemium';
    const isJobLimitReached = isFreemium && jobs.length >= 2;

    return (
        <>
            <Box sx={{ flexGrow: 1, minHeight: '100vh', bgcolor: '#f5f5f5' }}>
                <AppBar position="static" color="default" elevation={1}>
                    <Toolbar>
                        <Typography variant="h6" component="div" sx={{ flexGrow: 1, fontWeight: 'bold', color: 'primary.main' }}>
                            Novva R&S
                        </Typography>
                        {isAdmin && (
                            <Button color="inherit" component={RouterLink} to="/admin" sx={{ mr: 1 }}>
                                Admin System
                            </Button>
                        )}
                        <Button color="inherit" onClick={handleLogout}>Sair</Button>
                    </Toolbar>
                </AppBar>

                <Container sx={{ mt: 4, pb: 4 }}>
                    {/* CabeÃ§alho da PÃ¡gina */}
                    <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 4, flexWrap: 'wrap', gap: 2 }}>
                        <Typography variant="h4" component="h1" fontWeight="500">
                            Painel de Vagas
                        </Typography>
                        <Stack direction="row" spacing={2}>
                            <Button 
                                variant="outlined" 
                                startIcon={<CheckCircleIcon />}
                                component={RouterLink} 
                                to="/aprovados"
                            >
                                Ver Aprovados
                            </Button>
                            <Button 
                                variant="contained" 
                                startIcon={<AddIcon />}
                                onClick={() => setOpenCreateModal(true)}
                                disabled={isJobLimitReached}
                            >
                                Nova Vaga
                            </Button>
                        </Stack>
                    </Box>

                    {isJobLimitReached && (
                        <Alert severity="info" sx={{ mb: 3 }}>
                            Seu plano <strong>Freemium</strong> permite atÃ© 2 vagas. FaÃ§a um upgrade para criar mais.
                        </Alert>
                    )}

                    {/* Barra de Ferramentas da Tabela */}
                    <Paper sx={{ mb: 3, p: 2, display: 'flex', alignItems: 'center', justifyContent: 'space-between', flexWrap: 'wrap', gap: 2 }}>
                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                            <FormControl size="small" sx={{ minWidth: 200 }}>
                                <InputLabel id="status-filter-label">Status da Vaga</InputLabel>
                                <Select
                                    labelId="status-filter-label"
                                    value={statusFilter}
                                    label="Status da Vaga"
                                    onChange={(e) => setStatusFilter(e.target.value)}
                                >
                                    <MenuItem value="active">Apenas Ativas</MenuItem>
                                    <MenuItem value="filled">Preenchidas</MenuItem>
                                    <MenuItem value="inactive">Inativas</MenuItem>
                                    <Divider />
                                    <MenuItem value="all">Todas as Vagas</MenuItem>
                                </Select>
                            </FormControl>
                            <Typography variant="body2" color="text.secondary">
                                Exibindo <strong>{processedJobs.length}</strong> de {jobs.length} vagas
                            </Typography>
                        </Box>
                    </Paper>

                    {/* Ãrea de ConteÃºdo */}
                    {loading ? (
                        <Box sx={{ display: 'flex', justifyContent: 'center', my: 8 }}><CircularProgress /></Box>
                    ) : error ? (
                        <Alert severity="error">Erro ao carregar dados: {error}</Alert>
                    ) : (
                        <Paper sx={{ width: '100%', overflow: 'hidden', boxShadow: 2 }}>
                            <Table>
                                <TableHead sx={{ bgcolor: '#f9fafb' }}>
                                    <TableRow>
                                        <TableCell sx={{ fontWeight: 'bold' }}>TÃ­tulo da Vaga</TableCell>
                                        <TableCell sx={{ fontWeight: 'bold', width: '150px' }}>Status</TableCell>
                                        <TableCell align="center" sx={{ fontWeight: 'bold', width: '150px' }}>Candidatos</TableCell>
                                    </TableRow>
                                </TableHead>
                                <TableBody>
                                    {processedJobs.length > 0 ? processedJobs.map((job) => (
                                        <TableRow 
                                            hover 
                                            key={job.id} 
                                            onClick={() => handleRowClick(job.id)}
                                            sx={{ cursor: 'pointer', transition: '0.2s' }}
                                        >
                                            <TableCell>
                                                <Typography variant="body1" fontWeight="500">{job.title}</Typography>
                                            </TableCell>
                                            <TableCell>
                                                <Chip 
                                                    label={formatStatus(job.status)} 
                                                    color={getStatusColor(job.status)}
                                                    size="small"
                                                    variant={job.status === 'active' ? 'filled' : 'outlined'}
                                                />
                                            </TableCell>
                                            <TableCell align="center">
                                                <Chip 
                                                    label={job.candidateCount || 0} 
                                                    size="small" 
                                                    variant="outlined" 
                                                    sx={{ minWidth: 40 }}
                                                />
                                            </TableCell>
                                        </TableRow>
                                    )) : (
                                        <TableRow>
                                            <TableCell colSpan={3} align="center" sx={{ py: 6 }}>
                                                <Typography color="text.secondary">
                                                    Nenhuma vaga encontrada com o filtro atual.
                                                </Typography>
                                                {statusFilter !== 'all' && (
                                                    <Button onClick={() => setStatusFilter('all')} sx={{ mt: 1 }}>
                                                        Limpar Filtros
                                                    </Button>
                                                )}
                                            </TableCell>
                                        </TableRow>
                                    )}
                                </TableBody>
                            </Table>
                        </Paper>
                    )}
                </Container>
            </Box>
            
            <CreateJobModal 
                open={openCreateModal}
                handleClose={() => setOpenCreateModal(false)}
                onJobCreated={fetchJobs}
            />
        </>
    );
};

// Pequeno ajuste para importar Divider que esqueci no topo
import { Divider } from '@mui/material';

export default Dashboard;

==================================================
ARQUIVO: src\pages\Evaluation.jsx
==================================================
import { useParams } from 'react-router-dom';

export default function Evaluation() {
  const { applicationId } = useParams();
  return (
    <div className="p-8">
      <h1 className="text-2xl font-bold mb-4">AvaliaÃ§Ã£o do Candidato</h1>
      <p>Avaliando candidatura ID: {applicationId}</p>
    </div>
  );
}

==================================================
ARQUIVO: src\pages\HiredPage.jsx
==================================================
// src/pages/HiredPage.jsx (VersÃ£o Corrigida)
import React, { useState, useEffect } from 'react';
import { Link as RouterLink } from 'react-router-dom';
import { supabase } from '../supabase/client';
import { format, parseISO } from 'date-fns';
import {
    Container,
    Typography,
    Box,
    AppBar,
    Toolbar,
    Button,
    CircularProgress,
    Alert,
    Paper,
    List,
    ListItem,
    ListItemText,
    Divider,
} from '@mui/material';

const HiredPage = () => {
    const [hiredData, setHiredData] = useState({});
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState('');

    useEffect(() => {
        const fetchHired = async () => {
            setLoading(true);
            try {
                const { data: { session } } = await supabase.auth.getSession();
                if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
                const response = await fetch('/api/getHiredApplicants', {
                    headers: { 'Authorization': `Bearer ${session.access_token}` },
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || "NÃ£o foi possÃ­vel buscar os candidatos aprovados.");
                }
                const data = await response.json();
                const groupedByJob = (data.hired || []).reduce((acc, application) => {
                    const jobTitle = application.job.title;
                    if (!acc[jobTitle]) {
                        acc[jobTitle] = [];
                    }
                    acc[jobTitle].push(application);
                    return acc;
                }, {});
                setHiredData(groupedByJob);
            } catch (err) {
                console.error("Erro ao buscar aprovados:", err);
                setError(err.message);
            } finally {
                setLoading(false);
            }
        };
        fetchHired();
    }, []);

    const formatPhone = (phone) => {
        if (!phone) return 'NÃ£o informado';
        const cleaned = phone.replace(/\D/g, '');
        if (cleaned.length === 11) { return `(${cleaned.substring(0, 2)}) ${cleaned.substring(2, 7)}-${cleaned.substring(7)}`; }
        if (cleaned.length === 10) { return `(${cleaned.substring(0, 2)}) ${cleaned.substring(2, 6)}-${cleaned.substring(6)}`; }
        return phone;
    };

    const renderContent = () => {
        if (loading) {
            return <Box sx={{ display: 'flex', justifyContent: 'center', my: 5 }}><CircularProgress /></Box>;
        }
        if (error) {
            return <Alert severity="error">{error}</Alert>;
        }
        if (Object.keys(hiredData).length === 0) {
            return <Typography sx={{ mt: 3, textAlign: 'center' }}>Nenhum candidato foi marcado como contratado ainda.</Typography>;
        }
        return (
            <Box>
                {Object.entries(hiredData).map(([jobTitle, applications]) => (
                    <Paper key={jobTitle} sx={{ my: 3, p: 2 }}>
                        <Typography variant="h5" gutterBottom>{jobTitle}</Typography>
                        <List>
                            {applications.map((app, index) => (
                                <React.Fragment key={app.id}>
                                    <ListItem>
                                        <ListItemText
                                            primary={app.candidate.name}
                                            secondary={
                                                <>
                                                    <Typography component="span" variant="body2" color="text.primary">
                                                        Email: {app.candidate.email}
                                                    </Typography>
                                                    <br />
                                                    <Typography component="span" variant="body2" color="text.primary">
                                                        Telefone: {formatPhone(app.formData.phone)}
                                                    </Typography>
                                                    <br />
                                                    <Typography component="span" variant="body2" color="text.secondary">
                                                        {/* AQUI ESTÃ A CORREÃ‡ÃƒO DA REGRESSÃƒO */}
                                                        Aprovado em: {app.hiredAt ? format(parseISO(app.hiredAt), 'dd/MM/yyyy') : 'Data nÃ£o registrada'}
                                                    </Typography>
                                                </>
                                            }
                                        />
                                    </ListItem>
                                    {index < applications.length - 1 && <Divider />}
                                </React.Fragment>
                            ))}
                        </List>
                    </Paper>
                ))}
            </Box>
        );
    };

    return (
        <Box>
            <AppBar position="static">
                <Toolbar>
                    <Typography variant="h6" component="div" sx={{ flexGrow: 1 }}>
                        Candidatos Aprovados
                    </Typography>
                    <Button color="inherit" component={RouterLink} to="/">
                        Voltar para o Painel
                    </Button>
                </Toolbar>
            </AppBar>
            <Container sx={{ mt: 4 }}>
                {renderContent()}
            </Container>
        </Box>
    );
};

export default HiredPage;

==================================================
ARQUIVO: src\pages\JobDetails.jsx
==================================================
import { useState, useEffect } from 'react';
import { useParams, Link } from 'react-router-dom';
import { supabase } from '../supabase/client';
import { 
  ArrowLeft, 
  User, 
  Calendar, 
  MapPin, 
  Briefcase, 
  CheckCircle, 
  XCircle, 
  Clock, 
  Share2,
  Download,
  Settings,
  Plus,
  Trash2,
  Save
} from 'lucide-react';

export default function JobDetails() {
  const { id } = useParams();
  
  // Estados de Dados
  const [job, setJob] = useState(null);
  const [candidates, setCandidates] = useState([]);
  
  // Estados de Controle
  const [loading, setLoading] = useState(true);
  const [activeTab, setActiveTab] = useState('details'); // 'details', 'candidates', 'evaluation'
  const [shareUrl, setShareUrl] = useState('');
  const [savingParams, setSavingParams] = useState(false);

  // Estado Local para EdiÃ§Ã£o dos ParÃ¢metros de AvaliaÃ§Ã£o (V2)
  const [evalParams, setEvalParams] = useState({
    triagem: [], // Perguntas de Yes/No
    tecnico: [], // CritÃ©rios de 1 a 5
    cultura: []  // CritÃ©rios de Fit Cultural
  });

  useEffect(() => {
    fetchJobDetails();
  }, [id]);

  useEffect(() => {
    const url = `${window.location.origin}/vagas/${id}/candidatar`;
    setShareUrl(url);
  }, [id]);

  const fetchJobDetails = async () => {
    try {
      setLoading(true);

      // 1. Busca Vaga e ParÃ¢metros
      const { data: jobData, error: jobError } = await supabase
        .from('jobs')
        .select('*')
        .eq('id', id)
        .single();

      if (jobError) throw jobError;
      
      setJob(jobData);
      
      // Carrega os parÃ¢metros existentes ou inicia vazios
      if (jobData.parameters) {
        setEvalParams({
          triagem: jobData.parameters.triagem || [],
          tecnico: jobData.parameters.tecnico || [],
          cultura: jobData.parameters.cultura || []
        });
      }

      // 2. Busca Candidatos (com Join V2)
      const { data: appsData, error: appsError } = await supabase
        .from('applications')
        .select(`
          *,
          candidate:candidates (
            name, email, phone, city, state, resume_url
          )
        `)
        .eq('jobId', id)
        .order('created_at', { ascending: false });

      if (appsError) throw appsError;
      setCandidates(appsData || []);

    } catch (error) {
      console.error('Erro ao carregar dados:', error);
    } finally {
      setLoading(false);
    }
  };

  // --- LÃ“GICA DE AVALIAÃ‡ÃƒO (V2) ---

  const handleAddCriteria = (type) => {
    const newCriteria = prompt(`Digite o novo critÃ©rio para ${type}:`);
    if (!newCriteria) return;

    setEvalParams(prev => ({
      ...prev,
      [type]: [...prev[type], { id: crypto.randomUUID(), text: newCriteria, weight: 1 }]
    }));
  };

  const handleRemoveCriteria = (type, criteriaId) => {
    setEvalParams(prev => ({
      ...prev,
      [type]: prev[type].filter(item => item.id !== criteriaId)
    }));
  };

  const handleWeightChange = (type, criteriaId, newWeight) => {
    setEvalParams(prev => ({
      ...prev,
      [type]: prev[type].map(item => 
        item.id === criteriaId ? { ...item, weight: parseInt(newWeight) } : item
      )
    }));
  };

  const handleSaveParameters = async () => {
    try {
      setSavingParams(true);
      const { error } = await supabase
        .from('jobs')
        .update({ parameters: evalParams })
        .eq('id', id);

      if (error) throw error;
      alert('ParÃ¢metros de avaliaÃ§Ã£o atualizados com sucesso!');
    } catch (err) {
      console.error('Erro ao salvar parÃ¢metros:', err);
      alert('Erro ao salvar. Tente novamente.');
    } finally {
      setSavingParams(false);
    }
  };

  // --- LÃ“GICA DE UTILIDADES ---

  const handleCopyLink = () => {
    navigator.clipboard.writeText(shareUrl);
    alert('Link copiado!');
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  if (!job) {
    return (
      <div className="max-w-7xl mx-auto px-4 py-10 text-center">
        <h2 className="text-2xl font-bold text-gray-900">Vaga nÃ£o encontrada</h2>
        <Link to="/jobs" className="mt-4 inline-flex items-center text-blue-600">
          <ArrowLeft className="h-4 w-4 mr-2" /> Voltar
        </Link>
      </div>
    );
  }

  return (
    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      {/* HEADER DA PÃGINA */}
      <div className="mb-8">
        <Link to="/jobs" className="inline-flex items-center text-gray-500 hover:text-gray-700 mb-4">
          <ArrowLeft className="h-4 w-4 mr-2" />
          Voltar para Painel
        </Link>
        
        <div className="flex flex-col md:flex-row md:justify-between md:items-start gap-4">
          <div>
            <h1 className="text-3xl font-bold text-gray-900">{job.title}</h1>
            <div className="mt-2 flex flex-wrap items-center gap-4 text-sm text-gray-500">
              <span className="flex items-center"><MapPin className="h-4 w-4 mr-1"/> {job.location || 'Remoto'}</span>
              <span className="flex items-center"><Briefcase className="h-4 w-4 mr-1"/> {job.type || 'CLT'}</span>
              <span className="flex items-center"><Calendar className="h-4 w-4 mr-1"/> {new Date(job.created_at).toLocaleDateString()}</span>
            </div>
          </div>
          
          <button
            onClick={handleCopyLink}
            className="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"
          >
            <Share2 className="h-4 w-4 mr-2" /> Compartilhar Link
          </button>
        </div>
      </div>

      {/* NAVEGAÃ‡ÃƒO DE ABAS */}
      <div className="border-b border-gray-200 mb-6">
        <nav className="-mb-px flex space-x-8">
          <button
            onClick={() => setActiveTab('details')}
            className={`${activeTab === 'details' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`}
          >
            Detalhes da Vaga
          </button>
          <button
            onClick={() => setActiveTab('candidates')}
            className={`${activeTab === 'candidates' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center`}
          >
            Candidatos
            <span className="ml-2 bg-gray-100 text-gray-600 py-0.5 px-2.5 rounded-full text-xs">{candidates.length}</span>
          </button>
          <button
            onClick={() => setActiveTab('evaluation')}
            className={`${activeTab === 'evaluation' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center`}
          >
            <Settings className="w-4 h-4 mr-2" />
            ConfiguraÃ§Ã£o de AvaliaÃ§Ã£o
          </button>
        </nav>
      </div>

      {/* CONTEÃšDO DAS ABAS */}
      
      {/* 1. ABA DETALHES */}
      {activeTab === 'details' && (
        <div className="bg-white shadow overflow-hidden sm:rounded-lg">
          <div className="px-4 py-5 sm:px-6">
            <h3 className="text-lg leading-6 font-medium text-gray-900">DescriÃ§Ã£o do Cargo</h3>
            <div className="mt-2 text-sm text-gray-500 whitespace-pre-wrap">{job.description || 'N/A'}</div>
          </div>
          <div className="border-t border-gray-200 px-4 py-5 sm:px-6">
            <h3 className="text-lg leading-6 font-medium text-gray-900">Requisitos</h3>
            <div className="mt-2 text-sm text-gray-500 whitespace-pre-wrap">{job.requirements || 'N/A'}</div>
          </div>
        </div>
      )}

      {/* 2. ABA CANDIDATOS (Com CorreÃ§Ã£o Visual) */}
      {activeTab === 'candidates' && (
        <div className="space-y-4">
          {candidates.length === 0 ? (
            <div className="text-center py-12 bg-white rounded-lg border border-dashed border-gray-300">
              <User className="mx-auto h-12 w-12 text-gray-400" />
              <h3 className="mt-2 text-sm font-medium text-gray-900">Nenhum candidato inscrito ainda</h3>
              <p className="mt-1 text-sm text-gray-500">Divulgue o link para comeÃ§ar a receber currÃ­culos.</p>
            </div>
          ) : (
            <div className="bg-white shadow overflow-hidden sm:rounded-md">
              <ul className="divide-y divide-gray-200">
                {candidates.map((app) => (
                  <li key={app.id}>
                    <div className="px-4 py-4 sm:px-6 hover:bg-gray-50">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center min-w-0">
                          <div className="flex-shrink-0">
                            <span className="h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold">
                              {app.candidate?.name?.charAt(0).toUpperCase() || '?'}
                            </span>
                          </div>
                          <div className="ml-4 truncate">
                            <p className="text-sm font-medium text-blue-600 truncate">{app.candidate?.name || 'Sem Nome'}</p>
                            <div className="flex text-sm text-gray-500 mt-1 gap-4">
                              <span className="flex items-center"><User className="w-4 h-4 mr-1"/> {app.candidate?.email}</span>
                              <span className="flex items-center"><MapPin className="w-4 h-4 mr-1"/> {app.candidate?.city || 'N/A'}</span>
                            </div>
                          </div>
                        </div>
                        <div className="flex items-center gap-2">
                          {(app.resumeUrl || app.candidate?.resume_url) && (
                            <a href={app.resumeUrl || app.candidate?.resume_url} target="_blank" rel="noreferrer" className="p-2 text-gray-400 hover:text-gray-600 border rounded-full">
                              <Download className="w-5 h-5" />
                            </a>
                          )}
                          <Link to={`/evaluations/${app.id}`} className="px-3 py-1 text-xs font-medium bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200">
                            Avaliar
                          </Link>
                        </div>
                      </div>
                    </div>
                  </li>
                ))}
              </ul>
            </div>
          )}
        </div>
      )}

      {/* 3. ABA AVALIAÃ‡ÃƒO (Funcionalidade Restaurada) */}
      {activeTab === 'evaluation' && (
        <div className="bg-white shadow sm:rounded-lg p-6 space-y-8">
          
          <div className="border-b border-gray-200 pb-4">
            <h2 className="text-xl font-bold text-gray-900">DefiniÃ§Ã£o de Notas e CritÃ©rios</h2>
            <p className="text-sm text-gray-500">Configure aqui o que serÃ¡ avaliado nos candidatos desta vaga.</p>
          </div>

          {/* SeÃ§Ã£o 1: CritÃ©rios TÃ©cnicos (Hard Skills) */}
          <div>
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-lg font-medium text-gray-900 flex items-center">
                <Briefcase className="w-5 h-5 mr-2 text-blue-500"/> CritÃ©rios TÃ©cnicos (1 a 5)
              </h3>
              <button onClick={() => handleAddCriteria('tecnico')} className="text-sm text-blue-600 hover:text-blue-800 flex items-center">
                <Plus className="w-4 h-4 mr-1"/> Adicionar CritÃ©rio
              </button>
            </div>
            
            {evalParams.tecnico.length === 0 ? (
              <p className="text-sm text-gray-400 italic">Nenhum critÃ©rio tÃ©cnico definido.</p>
            ) : (
              <div className="space-y-3">
                {evalParams.tecnico.map((item) => (
                  <div key={item.id} className="flex items-center gap-3 bg-gray-50 p-3 rounded-md">
                    <span className="flex-1 font-medium text-gray-700">{item.text}</span>
                    <div className="flex items-center gap-2">
                      <span className="text-xs text-gray-500">Peso:</span>
                      <select 
                        className="text-sm border-gray-300 rounded-md"
                        value={item.weight}
                        onChange={(e) => handleWeightChange('tecnico', item.id, e.target.value)}
                      >
                        <option value="1">1x</option>
                        <option value="2">2x</option>
                        <option value="3">3x</option>
                      </select>
                    </div>
                    <button onClick={() => handleRemoveCriteria('tecnico', item.id)} className="text-red-500 hover:text-red-700">
                      <Trash2 className="w-4 h-4"/>
                    </button>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* SeÃ§Ã£o 2: Fit Cultural (Soft Skills) */}
          <div className="pt-6 border-t border-gray-100">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-lg font-medium text-gray-900 flex items-center">
                <User className="w-5 h-5 mr-2 text-purple-500"/> Fit Cultural (Comportamental)
              </h3>
              <button onClick={() => handleAddCriteria('cultura')} className="text-sm text-blue-600 hover:text-blue-800 flex items-center">
                <Plus className="w-4 h-4 mr-1"/> Adicionar CritÃ©rio
              </button>
            </div>
            
            {evalParams.cultura.length === 0 ? (
              <p className="text-sm text-gray-400 italic">Nenhum critÃ©rio cultural definido.</p>
            ) : (
              <div className="space-y-3">
                {evalParams.cultura.map((item) => (
                  <div key={item.id} className="flex items-center gap-3 bg-gray-50 p-3 rounded-md">
                    <span className="flex-1 font-medium text-gray-700">{item.text}</span>
                    <div className="flex items-center gap-2">
                      <span className="text-xs text-gray-500">Peso:</span>
                      <select 
                        className="text-sm border-gray-300 rounded-md"
                        value={item.weight}
                        onChange={(e) => handleWeightChange('cultura', item.id, e.target.value)}
                      >
                        <option value="1">1x</option>
                        <option value="2">2x</option>
                        <option value="3">3x</option>
                      </select>
                    </div>
                    <button onClick={() => handleRemoveCriteria('cultura', item.id)} className="text-red-500 hover:text-red-700">
                      <Trash2 className="w-4 h-4"/>
                    </button>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* BotÃ£o de Salvar Global */}
          <div className="pt-8 border-t border-gray-200 flex justify-end">
            <button
              onClick={handleSaveParameters}
              disabled={savingParams}
              className="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none disabled:opacity-50"
            >
              <Save className="w-5 h-5 mr-2" />
              {savingParams ? 'Salvando...' : 'Salvar ConfiguraÃ§Ãµes de AvaliaÃ§Ã£o'}
            </button>
          </div>

        </div>
      )}
    </div>
  );
}

==================================================
ARQUIVO: src\pages\Jobs.jsx
==================================================
import { useState, useEffect } from 'react';
import { Link } from 'react-router-dom';
import { supabase } from '../supabase/client';
import { Plus } from 'lucide-react';
import CreateJobModal from '../components/jobs/CreateJobModal';

export default function Jobs() {
  const [jobs, setJobs] = useState([]);
  const [isModalOpen, setIsModalOpen] = useState(false);

  useEffect(() => {
    fetchJobs();
  }, []);

  const fetchJobs = async () => {
    const { data } = await supabase.from('jobs').select('*').order('created_at', { ascending: false });
    setJobs(data || []);
  };

  return (
    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-2xl font-bold text-gray-900">Vagas</h1>
        <button
          onClick={() => setIsModalOpen(true)}
          className="flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
        >
          <Plus className="w-5 h-5 mr-2" /> Nova Vaga
        </button>
      </div>

      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        {jobs.map((job) => (
          <Link key={job.id} to={`/jobs/${job.id}`} className="block p-6 bg-white rounded-lg border hover:shadow-md transition">
            <h3 className="text-lg font-medium text-gray-900">{job.title}</h3>
            <p className="mt-2 text-sm text-gray-500">{job.location || 'Remoto'}</p>
            <span className={`mt-4 inline-block px-2 py-1 text-xs font-semibold rounded-full ${job.status === 'open' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}`}>
              {job.status === 'open' ? 'Aberta' : 'Fechada'}
            </span>
          </Link>
        ))}
      </div>

      <CreateJobModal 
        isOpen={isModalOpen} 
        onClose={() => setIsModalOpen(false)} 
        onSuccess={fetchJobs} 
      />
    </div>
  );
}

==================================================
ARQUIVO: src\pages\Login.jsx
==================================================
import { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { supabase } from '../supabase/client';
// Note: NÃƒO estamos importando useAuth nem useEffect para redirecionamento

export default function Login() {
  const navigate = useNavigate();
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [loading, setLoading] = useState(false);

  // --- SE TIVER ALGUM useEffect AQUI, APAGUE! ---

  const handleLogin = async (e) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { error } = await supabase.auth.signInWithPassword({
        email,
        password,
      });

      if (error) throw error;

      // SÃ³ redireciona AQUI, apÃ³s o sucesso do clique
      navigate('/dashboard');
      
    } catch (error) {
      alert(error.message);
    } finally {
      setLoading(false);
    }
  };

  // ... (Restante do HTML do formulÃ¡rio igual ao anterior) ...
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-100">
      <div className="max-w-md w-full bg-white p-8 rounded shadow space-y-6">
        <h2 className="text-center text-3xl font-extrabold text-gray-900">Acesso Recrutador</h2>
        <form className="mt-8 space-y-6" onSubmit={handleLogin}>
           {/* Seus inputs de email/senha */}
           <div className="rounded-md shadow-sm -space-y-px">
            <div>
              <input type="email" required className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="Email" value={email} onChange={(e) => setEmail(e.target.value)} />
            </div>
            <div>
              <input type="password" required className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 rounded-b-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="Senha" value={password} onChange={(e) => setPassword(e.target.value)} />
            </div>
          </div>
           <div>
            <button type="submit" disabled={loading} className="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none disabled:opacity-50">
              {loading ? 'Entrando...' : 'Entrar'}
            </button>
          </div>
        </form>
        <div className="text-center">
          <Link to="/register" className="font-medium text-blue-600 hover:text-blue-500">Criar conta</Link>
        </div>
      </div>
    </div>
  );
}

==================================================
ARQUIVO: src\pages\Register.jsx
==================================================
import { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { useAuth } from '../context/AuthContext';

export default function Register() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const { signUp } = useAuth();
  const navigate = useNavigate();
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      setLoading(true);
      const { error } = await signUp({ email, password });
      if (error) throw error;
      alert('Verifique seu e-mail para confirmar o cadastro!');
      navigate('/login');
    } catch (error) {
      alert(error.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50">
      <div className="max-w-md w-full space-y-8 p-8 bg-white rounded shadow">
        <h2 className="text-center text-3xl font-extrabold text-gray-900">Criar conta</h2>
        <form className="mt-8 space-y-6" onSubmit={handleSubmit}>
          <input
            type="email"
            required
            className="w-full px-3 py-2 border rounded"
            placeholder="Email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
          />
          <input
            type="password"
            required
            className="w-full px-3 py-2 border rounded"
            placeholder="Senha"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
          />
          <button
            type="submit"
            disabled={loading}
            className="w-full py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"
          >
            {loading ? 'Carregando...' : 'Registrar'}
          </button>
        </form>
        <div className="text-center">
          <Link to="/login" className="text-blue-600 hover:text-blue-500">JÃ¡ tem conta? Login</Link>
        </div>
      </div>
    </div>
  );
}

==================================================
ARQUIVO: src\services\evaluationService.js
==================================================
// src/services/evaluationService.js
import { supabase } from '../supabase/client';

// 1. Prepara o banco (Cria critÃ©rios se nÃ£o existirem)
export const prepareEvaluationV2 = async (jobId) => {
  const { data, error } = await supabase
    .rpc('initialize_job_criteria_v2', { target_job_id: jobId });
  if (error) throw error;
  return data;
};

// 2. Busca o resumo consolidado (MÃ©dias)
export const getEvaluationSummaryV2 = async (applicationId) => {
  const { data, error } = await supabase
    .rpc('get_candidate_summary_v2', { target_app_id: applicationId });
  if (error) throw error;
  return data;
};

// 3. Busca/Cria a sessÃ£o do usuÃ¡rio atual
export const getMyEvaluationSession = async (applicationId, userId) => {
  // Tenta buscar existente
  let { data: session, error } = await supabase
    .from('evaluation_assignments_v2')
    .select('id, status')
    .eq('application_id', applicationId)
    .eq('evaluator_id', userId)
    .maybeSingle();

  // Se nÃ£o existir, cria
  if (!session) {
    const { data: newSession, error: createError } = await supabase
      .from('evaluation_assignments_v2')
      .insert({ application_id: applicationId, evaluator_id: userId })
      .select()
      .single();
    
    if (createError) throw createError;
    session = newSession;
  }
  
  return session;
};

==================================================
ARQUIVO: src\supabase\client.js
==================================================
// src/supabase/client.js (VersÃ£o Limpa e Segura)
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

// ValidaÃ§Ã£o de SeguranÃ§a:
// Impede que a aplicaÃ§Ã£o inicie "pela metade" se as chaves nÃ£o existirem.
if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error(
    'ERRO CRÃTICO: As chaves de configuraÃ§Ã£o do Supabase nÃ£o foram encontradas. ' +
    'Verifique se o arquivo .env existe na raiz do projeto e contÃ©m as variÃ¡veis VITE_SUPABASE_URL e VITE_SUPABASE_ANON_KEY.'
  );
}

export const supabase = createClient(supabaseUrl, supabaseAnonKey);

==================================================
ARQUIVO: src\utils\formatters.js
==================================================
// src/utils/formatters.js
import { format, parseISO } from 'date-fns';

// Nossa nova funÃ§Ã£o de traduÃ§Ã£o
export const formatStatus = (status) => {
  const statusMap = {
    active: 'Ativa',
    inactive: 'Inativa',
    filled: 'Preenchida',
  };
  return statusMap[status] || status;
};

// Movi as outras funÃ§Ãµes de formataÃ§Ã£o para cÃ¡ para centralizar
export const formatPhone = (phone) => {
  if (!phone) return 'NÃ£o informado';
  const cleaned = phone.replace(/\D/g, '');
  if (cleaned.length === 11) {
    return `(${cleaned.substring(0, 2)}) ${cleaned.substring(2, 7)}-${cleaned.substring(7)}`;
  }
  if (cleaned.length === 10) {
    return `(${cleaned.substring(0, 2)}) ${cleaned.substring(2, 6)}-${cleaned.substring(6)}`;
  }
  return phone;
};

export const formatUrl = (url) => {
  if (!url) return '#';
  if (url.startsWith('http://') || url.startsWith('https://')) { return url; }
  return `//${url}`;
};

export const formatDate = (dateStr) => {
    if (!dateStr) return 'NÃ£o informado';
    try {
        return format(parseISO(dateStr), 'dd/MM/yyyy');
    } catch (error) {
        console.error("Erro ao formatar data:", dateStr, error);
        return 'Data invÃ¡lida';
    }
};

