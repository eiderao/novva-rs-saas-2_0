==================================================
ARQUIVO: 404.html
==================================================
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Page Not Found</title>

    <style media="screen">
      body { background: #ECEFF1; color: rgba(0,0,0,0.87); font-family: Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; }
      #message { background: white; max-width: 360px; margin: 100px auto 16px; padding: 32px 24px 16px; border-radius: 3px; }
      #message h3 { color: #888; font-weight: normal; font-size: 16px; margin: 16px 0 12px; }
      #message h2 { color: #ffa100; font-weight: bold; font-size: 16px; margin: 0 0 8px; }
      #message h1 { font-size: 22px; font-weight: 300; color: rgba(0,0,0,0.6); margin: 0 0 16px;}
      #message p { line-height: 140%; margin: 16px 0 24px; font-size: 14px; }
      #message a { display: block; text-align: center; background: #039be5; text-transform: uppercase; text-decoration: none; color: white; padding: 16px; border-radius: 4px; }
      #message, #message a { box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); }
      #load { color: rgba(0,0,0,0.4); text-align: center; font-size: 13px; }
      @media (max-width: 600px) {
        body, #message { margin-top: 0; background: white; box-shadow: none; }
        body { border-top: 16px solid #ffa100; }
      }
    </style>
  </head>
  <body>
    <div id="message">
      <h2>404</h2>
      <h1>Page Not Found</h1>
      <p>The specified file was not found on this website. Please check the URL for mistakes and try again.</p>
      <h3>Why am I seeing this?</h3>
      <p>This page was generated by the Firebase Command-Line Interface. To modify it, edit the <code>404.html</code> file in your project's configured <code>public</code> directory.</p>
    </div>
  </body>
</html>


==================================================
ARQUIVO: firebase.json
==================================================
{
  "functions": [
    {
      "source": "functions",
      "codebase": "default",
      "ignore": [
        "node_modules",
        ".git",
        "firebase-debug.log",
        "firebase-debug.*.log",
        "*.local"
      ]
    }
  ],
  "hosting": {
    "public": "dist",
    "ignore": [
      "firebase.json",
      "**/.*",
      "**/node_modules/**"
    ],
    "rewrites": [
      {
        "source": "**",
        "destination": "/index.html"
      }
    ]
  },
  "emulators": {
    "auth": {
      "port": 9099
    },
    "functions": {
      "port": 5001
    },
    "firestore": {
      "port": 8081
    },
    "ui": {
      "enabled": true
    },
    "singleProjectMode": true
  }
}


==================================================
ARQUIVO: index.html
==================================================
<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Novva R&S</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>

==================================================
ARQUIVO: package.json
==================================================
{
  "name": "novva-rs-saas",
  "private": true,
  "version": "2.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint . --ext js,jsx --report-unused-disable-directives --max-warnings 0",
    "preview": "vite preview",
    "test": "vitest"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.39.0",
    "class-variance-authority": "^0.7.0",
    "clsx": "^2.0.0",
    "date-fns": "^2.30.0",
    "formidable": "^3.5.4",
    "lucide-react": "^0.294.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-imask": "^7.6.1",
    "react-router-dom": "^6.20.0",
    "recharts": "^2.10.0",
    "tailwind-merge": "^2.0.0"
  },
  "devDependencies": {
    "@testing-library/jest-dom": "^6.1.4",
    "@testing-library/react": "^14.1.2",
    "@types/react": "^18.2.15",
    "@types/react-dom": "^18.2.7",
    "@vitejs/plugin-react": "^4.0.3",
    "autoprefixer": "^10.4.16",
    "eslint": "^8.45.0",
    "eslint-plugin-react": "^7.32.2",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-plugin-react-refresh": "^0.4.3",
    "jsdom": "^22.1.0",
    "postcss": "^8.4.31",
    "tailwindcss": "^3.4.1",
    "vite": "^4.4.5",
    "vitest": "^0.34.6"
  }
}

==================================================
ARQUIVO: postcss.config.js
==================================================
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}

==================================================
ARQUIVO: tailwind.config.js
==================================================
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}

==================================================
ARQUIVO: vercel.json
==================================================
{
  "rewrites": [
    { "source": "/(.*)", "destination": "/index.html" }
  ]
}

==================================================
ARQUIVO: vite.config.js
==================================================
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: './src/test/setup.js',
    css: true,
  },
})

==================================================
ARQUIVO: .vercel\project.json
==================================================
{"projectId":"prj_HtLcAivMTvf4K2mSOR496vnc8rR7","orgId":"team_L2VfPt8LwRczWEzT69FA8EoY","projectName":"novva-rs-saas"}

==================================================
ARQUIVO: api\admin.js
==================================================
// api/admin.js (VERSÃƒO FINAL E CORRIGIDA)
import { createClient } from '@supabase/supabase-js';

async function validateAdmin(request) {
  const supabaseAdmin = createClient(
    process.env.SUPABASE_URL,
    process.env.SUPABASE_SERVICE_KEY
  );

  const authHeader = request.headers['authorization'];
  if (!authHeader) throw new Error('NÃ£o autorizado.');
  
  const token = authHeader.replace('Bearer ', '');
  const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
  if (userError) throw new Error('Token invÃ¡lido.');

  const { data: userData, error: userCheckError } = await supabaseAdmin
    .from('users')
    .select('isAdmin')
    .eq('id', user.id)
    .single();

  if (userCheckError) throw userCheckError;
  if (!userData || !userData.isAdmin) {
    throw new Error('Acesso negado. VocÃª nÃ£o Ã© um administrador.');
  }
  
  return { supabaseAdmin };
}

export default async function handler(request, response) {
  try {
    const { supabaseAdmin } = await validateAdmin(request);
    
    const action = request.method === 'GET' ? request.query.action : request.body.action;

    switch (action) {
      case 'getTenantsAndPlans': {
        const { data: tenants, error: tenantsError } = await supabaseAdmin
          .from('tenants')
          .select(`id, companyName, planId, cnpj, plans ( name )`);
        if (tenantsError) throw tenantsError;

        const { data: plans, error: plansError } = await supabaseAdmin
          .from('plans')
          .select('*');
        if (plansError) throw plansError;

        return response.status(200).json({ tenants, plans });
      }
        
      case 'updateTenantPlan': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { tenantId, newPlanId } = request.body;
        const { data, error } = await supabaseAdmin.from('tenants').update({ planId: newPlanId }).eq('id', tenantId).select('id, companyName, planId, plans ( name )').single();
        if (error) throw error;
        return response.status(200).json({ message: 'Plano atualizado!', updatedTenant: data });
      }
      
      case 'getTenantDetails': {
        if (request.method !== 'GET') { return response.status(405).json({ error: 'Use GET.' }); }
        const { tenantId } = request.query;
        if (!tenantId) { return response.status(400).json({ error: 'tenantId Ã© obrigatÃ³rio.' }); }
        
        const { data: tenant, error: tenantError } = await supabaseAdmin.from('tenants').select('id, companyName').eq('id', tenantId).single();
        if (tenantError || !tenant) { return response.status(404).json({ error: 'Empresa nÃ£o encontrada.' }); }

        // AQUI ESTAVA O ERRO DE SINTAXE. ESTA Ã‰ A VERSÃƒO CORRETA.
        const { data: users, error: usersError } = await supabaseAdmin
          .from('users')
          .select('id, name, role, isAdmin') 
          .eq('tenantId', Number(tenantId));
        if (usersError) throw usersError;
        
        return response.status(200).json({ tenant, users });
      }

      case 'createTenant': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { companyName, planId, cnpj } = request.body;
        if (!companyName || !planId) { return response.status(400).json({ error: 'Nome da empresa e Plano sÃ£o obrigatÃ³rios.' }); }

        const { data: newTenant, error } = await supabaseAdmin
          .from('tenants')
          .insert({ companyName, planId, cnpj: cnpj || null })
          .select('id, companyName, planId, cnpj, plans ( name )')
          .single();
        if (error) throw error;
        return response.status(201).json({ message: 'Empresa criada com sucesso!', newTenant });
      }
      
      case 'updateTenant': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { id, companyName, planId, cnpj } = request.body;
        if (!id || !companyName || !planId) { return response.status(400).json({ error: 'ID, Nome e Plano sÃ£o obrigatÃ³rios.' }); }

        const { data: updatedTenant, error } = await supabaseAdmin
          .from('tenants')
          .update({ companyName, planId, cnpj: cnpj || null })
          .eq('id', id)
          .select('id, companyName, planId, cnpj, plans ( name )')
          .single();
        if (error) throw error;
        return response.status(200).json({ message: 'Empresa atualizada!', updatedTenant });
      }

      case 'deleteTenant': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { tenantId } = request.body;
        if (!tenantId) { return response.status(400).json({ error: 'tenantId Ã© obrigatÃ³rio.' }); }
        
        const { error } = await supabaseAdmin.from('tenants').delete().eq('id', tenantId);
        if (error) throw error;
        return response.status(200).json({ message: 'Empresa excluÃ­da com sucesso!' });
      }
      
      case 'createPlan': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { planData } = request.body;
        if (!planData) { return response.status(400).json({ error: 'Dados do plano sÃ£o obrigatÃ³rios.' }); }
        const { data: newPlan, error } = await supabaseAdmin.from('plans').insert(planData).select().single();
        if (error) throw error;
        return response.status(201).json({ message: 'Plano criado com sucesso!', newPlan });
      }

      case 'updatePlan': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { planId, planData } = request.body;
        if (!planId || !planData) { return response.status(400).json({ error: 'planId e planData sÃ£o obrigatÃ³rios.' }); }
        const { data: updatedPlan, error } = await supabaseAdmin.from('plans').update(planData).eq('id', planId).select().single();
        if (error) throw error;
        return response.status(200).json({ message: 'Plano atualizado!', updatedPlan });
      }

      case 'deletePlan': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { planId } = request.body;
        if (!planId) { return response.status(400).json({ error: 'planId Ã© obrigatÃ³rio.' }); }
        const { count, error: checkError } = await supabaseAdmin.from('tenants').select('*', { count: 'exact', head: true }).eq('planId', planId);
        if (checkError) throw checkError;
        if (count > 0) { return response.status(400).json({ error: `NÃ£o Ã© possÃ­vel excluir este plano. Ele estÃ¡ sendo usado por ${count} empresa(s).` }); }
        const { error } = await supabaseAdmin.from('plans').delete().eq('id', planId);
        if (error) throw error;
        return response.status(200).json({ message: 'Plano excluÃ­do com sucesso!' });
      }

      case 'createUser': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { email, password, name, role, isAdmin, tenantId } = request.body;
        if (!email || !password || !name || !role || !tenantId) {
          return response.status(400).json({ error: 'Campos obrigatÃ³rios faltando.' });
        }

        const { data: authUser, error: authError } = await supabaseAdmin.auth.admin.createUser({
          email: email,
          password: password,
          email_confirm: true,
        });
        if (authError) throw authError;

        const { data: newUser, error: userError } = await supabaseAdmin
          .from('users')
          .insert({
            id: authUser.user.id,
            name: name,
            role: role,
            isAdmin: isAdmin || false,
            tenantId: tenantId
          })
          .select()
          .single();
        
        if (userError) {
          await supabaseAdmin.auth.admin.deleteUser(authUser.user.id);
          throw userError;
        }
        
        return response.status(201).json({ message: 'UsuÃ¡rio criado com sucesso!', newUser });
      }

      case 'updateUser': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { userId, name, role, isAdmin } = request.body;
        if (!userId || !name || !role) {
          return response.status(400).json({ error: 'Campos obrigatÃ³rios faltando.' });
        }
        
        const { data: updatedUser, error } = await supabaseAdmin
          .from('users')
          .update({ name, role, isAdmin })
          .eq('id', userId)
          .select()
          .single();
        
        if (error) throw error;
        return response.status(200).json({ message: 'UsuÃ¡rio atualizado!', updatedUser });
      }

      case 'deleteUser': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { userId } = request.body;
        if (!userId) { return response.status(400).json({ error: 'userId Ã© obrigatÃ³rio.' }); }

        const { error: userError } = await supabaseAdmin
          .from('users')
          .delete()
          .eq('id', userId);
        if (userError) throw userError;
        
        const { error: authError } = await supabaseAdmin.auth.admin.deleteUser(userId);
        if (authError) throw authError;
        
        return response.status(200).json({ message: 'UsuÃ¡rio excluÃ­do com sucesso!' });
      }
      
      default:
        return response.status(400).json({ error: 'AÃ§Ã£o de admin desconhecida.' });
    }

  } catch (error) {
    console.error("Erro na API de Admin:", error.message);
    if (error.message.includes('NÃ£o autorizado') || error.message.includes('Token invÃ¡lido')) {
      return response.status(401).json({ error: error.message });
    }
    if (error.message.includes('Acesso negado')) {
      return response.status(403).json({ error: error.message });
    }
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: api\apply.js
==================================================
// api/apply.js (VERSÃƒO FINAL, COMPLETA E CORRIGIDA)
import { createClient } from '@supabase/supabase-js';
import { formidable } from 'formidable';
import fs from 'fs';
import path from 'path';

export const config = {
  api: {
    bodyParser: false,
  },
};

export default async function handler(request, response) {
  if (request.method !== 'POST') {
    return response.status(405).json({ error: `MÃ©todo ${request.method} nÃ£o permitido.` });
  }

  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    const form = formidable({});
    const [fields, files] = await form.parse(request);
    
    const jobId = fields.jobId ? fields.jobId[0] : null;
    if (!jobId) { return response.status(400).json({ error: 'ID da vaga Ã© obrigatÃ³rio.' }); }

    // --- LÃ“GICA DE LIMITE ROBUSTA ---
    const { data: job, error: jobError } = await supabaseAdmin
      .from('jobs')
      .select('tenantId')
      .eq('id', jobId)
      .single();
    
    if (jobError || !job) { return response.status(404).json({ error: 'Vaga nÃ£o encontrada.' }); }

    const { data: tenant, error: tenantError } = await supabaseAdmin
      .from('tenants')
      .select('planId')
      .eq('id', job.tenantId)
      .single();

    if (tenantError || !tenant) { throw new Error('Empresa (tenant) nÃ£o encontrada para esta vaga.'); }

    const { data: plan, error: planError } = await supabaseAdmin
      .from('plans')
      .select('candidate_limit')
      .eq('id', tenant.planId)
      .single();
    
    if (planError || !plan) {
      throw new Error(`ConfiguraÃ§Ã£o de plano invÃ¡lida. O plano com ID "${tenant.planId}" nÃ£o foi encontrado na tabela 'plans'.`);
    }
    
    if (plan.candidate_limit !== -1) {
      const { count, error: countError } = await supabaseAdmin
        .from('applications')
        .select('*', { count: 'exact', head: true })
        .eq('jobId', jobId);
      if (countError) throw countError;
      if (count >= plan.candidate_limit) {
        return response.status(403).json({ error: `Limite de ${plan.candidate_limit} candidaturas para esta vaga foi atingido.` });
      }
    }
    // --- FIM DA LÃ“GICA DE LIMITE ---

    const { name, email } = fields;
    const resumeFile = files.resume;
    if (!name || !email || !resumeFile) { return response.status(400).json({ error: 'Nome, e-mail e currÃ­culo sÃ£o obrigatÃ³rios.' }); }
    const fileContent = fs.readFileSync(resumeFile[0].filepath);
    const fileExtension = path.extname(resumeFile[0].originalFilename);
    const fileName = `${email[0].replace(/[^a-zA-Z0-9]/g, '_')}_${Date.now()}${fileExtension}`;
    const { data: uploadData, error: uploadError } = await supabaseAdmin.storage.from('resumes').upload(fileName, fileContent, { contentType: resumeFile[0].mimetype, upsert: false });
    if (uploadError) throw new Error(`Erro no upload: ${uploadError.message}`);
    let { data: candidate } = await supabaseAdmin.from('candidates').select('id').eq('email', email[0]).single();
    if (!candidate) {
      const { data: newCandidate, error: newCandidateError } = await supabaseAdmin.from('candidates').insert({ name: name[0], email: email[0] }).select('id').single();
      if (newCandidateError) throw newCandidateError;
      candidate = newCandidate;
    }
    const applicationFields = {};
    for (const key in fields) { applicationFields[key] = fields[key][0]; }
    const { error: applicationError } = await supabaseAdmin.from('applications').insert({ jobId: jobId, candidateId: candidate.id, resumeUrl: uploadData.path, formData: applicationFields });
    if (applicationError) throw applicationError;
    
    return response.status(201).json({ message: 'Candidatura enviada com sucesso!' });

  } catch (error) {
    console.error("Erro na candidatura:", error.message);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: api\createJob.js
==================================================
// api/createJob.js (VersÃ£o V2.0 - Freemium Limit & Full Fields)
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  if (request.method !== 'POST') {
    response.setHeader('Allow', ['POST']);
    return response.status(405).json({ error: `MÃ©todo ${request.method} nÃ£o permitido.` });
  }
  try {
    const supabaseAdmin = createClient(process.env.SUPABASE_URL, process.env.SUPABASE_SERVICE_KEY);
    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });
    
    const { data: userData } = await supabaseAdmin.from('users').select('tenantId').eq('id', user.id).single();
    if (!userData) return response.status(404).json({ error: 'Perfil nÃ£o encontrado.' });
    const tenantId = userData.tenantId;

    // Busca dados do plano e contagem atual
    const { data: tenant, error: tenantError } = await supabaseAdmin
      .from('tenants')
      .select('plan:plans(id, job_limit)')
      .eq('id', tenantId)
      .single();
    
    if (tenantError) throw tenantError;

    // REGRA 6: Limite de Vagas Ativas apenas (especialmente Freemium)
    const job_limit = tenant.plan.job_limit;
    
    // Se o limite for diferente de -1 (ilimitado), verificamos
    if (job_limit !== -1) {
      const { count, error: countError } = await supabaseAdmin
        .from('jobs')
        .select('*', { count: 'exact', head: true })
        .eq('tenantId', tenantId)
        .eq('status', 'active'); // Conta apenas ativas!

      if (countError) throw countError;
      
      if (count >= job_limit) {
        return response.status(403).json({ 
            error: `Limite de ${job_limit} vagas ativas atingido para o plano ${tenant.plan.id}. Arquive ou exclua uma vaga para criar outra.` 
        });
      }
    }

    // Recebe todos os campos novos
    const { 
        title, 
        description, 
        requirements, 
        type, 
        location_type, 
        company_department_id 
    } = request.body;

    if (!title) return response.status(400).json({ error: 'O tÃ­tulo da vaga Ã© obrigatÃ³rio.' });
    
    // Prepara objeto de inserÃ§Ã£o com campos seguros
    const insertData = {
        title,
        tenantId,
        status: 'active',
        description: description || '',
        requirements: requirements || '',
        type: type || 'CLT',
        location_type: location_type || 'HÃ­brido',
        // Inicia com parÃ¢metros padrÃ£o se nÃ£o existirem
        parameters: { 
            triagem: [], 
            cultura: [], 
            tecnico: [], 
            notas: [
                {id: '1', nome: 'Abaixo', valor: 0},
                {id: '2', nome: 'Atende', valor: 50},
                {id: '3', nome: 'Supera', valor: 100}
            ] 
        }
    };

    // SÃ³ adiciona o departamento se ele vier preenchido
    if (company_department_id) {
        insertData.company_department_id = company_department_id;
    }
    
    const { data: newJob, error: insertError } = await supabaseAdmin
      .from('jobs')
      .insert(insertData)
      .select()
      .single();
      
    if (insertError) throw insertError;
    
    return response.status(201).json({ newJob });

  } catch (error) {
    console.error("Erro createJob:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: api\getApplicantsForJob.js
==================================================
// api/getApplicantsForJob.js (VERSÃƒO FINAL E CORRIGIDA)
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    // ValidaÃ§Ã£o do usuÃ¡rio (sem alteraÃ§Ãµes)
    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });
    const { data: userData } = await supabaseAdmin.from('users').select('tenantId').eq('id', user.id).single();
    if (!userData) return response.status(404).json({ error: 'Perfil de usuÃ¡rio nÃ£o encontrado.' });
    const tenantId = userData.tenantId;
    const { jobId } = request.query;
    if (!jobId) return response.status(400).json({ error: 'O ID da vaga Ã© obrigatÃ³rio.' });

    // Busca a vaga e suas candidaturas de uma sÃ³ vez
    const { data: job, error: jobError } = await supabaseAdmin
      .from('jobs')
      .select(`
        id,
        tenantId,
        parameters,
        applications (
          id,
          created_at,
          evaluation,
          isHired,
          candidate:candidates ( id, name, email )
        )
      `)
      .eq('id', Number(jobId))
      .eq('tenantId', tenantId)
      .single();

    if (jobError || !job) {
      return response.status(404).json({ error: 'Vaga nÃ£o encontrada ou nÃ£o pertence Ã  sua empresa.' });
    }

    // Prepara os mapas para cÃ¡lculo (sem alteraÃ§Ãµes)
    const parameters = job.parameters || {};
    const notesMap = new Map((parameters.notas || []).map(note => [note.id, note.valor]));
    const weightsMap = {
      triagem: new Map((parameters.triagem || []).map(c => [c.name, c.weight])),
      cultura: new Map((parameters.cultura || []).map(c => [c.name, c.weight])),
      tÃ©cnico: new Map((parameters.tÃ©cnico || []).map(c => [c.name, c.weight])),
    };

    // Calcula as notas para cada candidatura
    const classifiedApplicants = job.applications.map(app => {
      const scores = { notaTriagem: 0, notaCultura: 0, notaTecnico: 0, notaGeral: 0 };
      if (app.evaluation) {
        ['triagem', 'cultura', 'tÃ©cnico'].forEach(section => {
          let sectionScore = 0;
          const sectionEvaluation = app.evaluation[section];
          if (sectionEvaluation) {
            for (const criterionName in sectionEvaluation) {
              if (criterionName !== 'anotacoes') {
                const noteId = sectionEvaluation[criterionName];
                const noteValue = notesMap.get(noteId) ?? 0;
                const weight = weightsMap[section]?.get(criterionName) ?? 0;
                sectionScore += (noteValue * weight) / 100;
              }
            }
          }
          if (section === 'triagem') scores.notaTriagem = sectionScore;
          if (section === 'cultura') scores.notaCultura = sectionScore;
          if (section === 'tÃ©cnico') scores.notaTecnico = sectionScore;
        });
        scores.notaGeral = scores.notaTriagem + scores.notaCultura + scores.notaTecnico;
      }

      // A CORREÃ‡ÃƒO ESTÃ AQUI: O campo 'isHired' foi restaurado
      return {
        applicationId: app.id,
        submissionDate: app.created_at,
        isHired: app.isHired,
        candidateName: app.candidate.name,
        candidateEmail: app.candidate.email,
        ...scores
      };
    });
    
    return response.status(200).json({ applicants: classifiedApplicants });

  } catch (error) {
    console.error("Erro na funÃ§Ã£o getApplicantsForJob:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: api\getApplicationDetails.js
==================================================
// api/getApplicationDetails.js (VersÃ£o Definitivamente Corrigida)
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });

    const { data: userData } = await supabaseAdmin.from('users').select('tenantId').eq('id', user.id).single();
    if (!userData) return response.status(404).json({ error: 'Perfil de usuÃ¡rio nÃ£o encontrado.' });
    const tenantId = userData.tenantId;

    const { applicationId } = request.query;
    if (!applicationId) {
      return response.status(400).json({ error: 'O ID da candidatura Ã© obrigatÃ³rio.' });
    }

    const { data: application, error: applicationError } = await supabaseAdmin
      .from('applications')
      .select(`
        id,
        created_at,
        formData,
        resumeUrl,
        evaluation, 
        candidate:candidates ( * ),
        job:jobs ( title, parameters, tenantId )
      `)
      .eq('id', Number(applicationId))
      .single();

    if (applicationError) {
      if (applicationError.code === 'PGRST116') {
         return response.status(404).json({ error: 'Candidatura nÃ£o encontrada.' });
      }
      throw applicationError;
    }

    if (application.job.tenantId !== tenantId) {
      return response.status(403).json({ error: 'VocÃª nÃ£o tem permissÃ£o para ver esta candidatura.' });
    }

    return response.status(200).json({ application });

  } catch (error) {
    console.error("Erro na funÃ§Ã£o getApplicationDetails:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: api\getHiredApplicants.js
==================================================
// api/getHiredApplicants.js
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    // ValidaÃ§Ã£o do usuÃ¡rio de RH
    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });
    
    const { data: userData } = await supabaseAdmin.from('users').select('tenantId').eq('id', user.id).single();
    if (!userData) return response.status(404).json({ error: 'Perfil de usuÃ¡rio nÃ£o encontrado.' });
    const tenantId = userData.tenantId;

    // Busca todas as candidaturas marcadas como 'isHired = true'
    const { data: hiredApplications, error: fetchError } = await supabaseAdmin
      .from('applications')
      .select(`
        id,
        hiredAt,
        formData,
        candidate:candidates ( name, email ),
        job:jobs ( id, title, tenantId )
      `)
      .eq('isHired', true);

    if (fetchError) throw fetchError;

    // Filtra no servidor para garantir que o usuÃ¡rio sÃ³ veja os aprovados do seu prÃ³prio tenant
    const tenantHired = hiredApplications.filter(app => app.job.tenantId === tenantId);

    return response.status(200).json({ hired: tenantHired });

  } catch (error) {
    console.error("Erro ao buscar candidatos contratados:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: api\getPublicJobData.js
==================================================
// api/getPublicJobData.js (VERSÃƒO FINAL E CORRIGIDA)
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    const { id: jobId } = request.query;
    if (!jobId) {
      return response.status(400).json({ error: 'O ID da vaga Ã© obrigatÃ³rio.' });
    }

    // A CORREÃ‡ÃƒO ESTÃ AQUI: Convertemos o jobId para Number()
    const { data: job, error: jobError } = await supabaseAdmin
      .from('jobs')
      .select(`
        title,
        tenantId,
        applications ( count )
      `)
      .eq('id', Number(jobId)) // Comparando nÃºmero com nÃºmero
      .single();

    if (jobError) throw jobError;

    const { data: tenant, error: tenantError } = await supabaseAdmin
      .from('tenants')
      .select('planId')
      .eq('id', job.tenantId)
      .single();
    
    if (tenantError) throw tenantError;
    
    const formattedJob = {
      title: job.title,
      candidateCount: job.applications[0] ? job.applications[0].count : 0,
      planId: tenant.planId
    };

    return response.status(200).json({ job: formattedJob });
  } catch (error) {
    console.error("Erro ao buscar dados pÃºblicos da vaga:", error);
    return response.status(500).json({ error: 'NÃ£o foi possÃ­vel buscar os dados da vaga.' });
  }
}

==================================================
ARQUIVO: api\getResumeSignedUrl.js
==================================================
// api/getResumeSignedUrl.js
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    // ValidaÃ§Ã£o de seguranÃ§a (sÃ³ usuÃ¡rios logados podem pedir links)
    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });

    // Pega o caminho do arquivo que o frontend quer acessar
    const { filePath } = request.query;
    if (!filePath) {
      return response.status(400).json({ error: 'O caminho do arquivo Ã© obrigatÃ³rio.' });
    }

    // Gera uma URL assinada e segura, com validade de 60 segundos
    const { data, error: urlError } = await supabaseAdmin
      .storage
      .from('resumes')
      .createSignedUrl(filePath, 60); // 60 segundos de validade

    if (urlError) throw urlError;

    return response.status(200).json({ signedUrl: data.signedUrl });

  } catch (error) {
    console.error("Erro ao gerar URL assinada:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.' });
  }
}

==================================================
ARQUIVO: api\jobs.js
==================================================
// api/jobs.js
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  const supabaseAdmin = createClient(
    process.env.SUPABASE_URL,
    process.env.SUPABASE_SERVICE_KEY
  );

  try {
    // 1. AutenticaÃ§Ã£o Admin (Bypassa RLS)
    const authHeader = request.headers['authorization'];
    if (!authHeader) throw new Error('Token ausente.');
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError || !user) throw new Error('Token invÃ¡lido.');

    // 2. Busca Tenant do UsuÃ¡rio
    const { data: userData } = await supabaseAdmin
      .from('users')
      .select('tenantId, name, isAdmin')
      .eq('id', user.id)
      .single();
      
    if (!userData?.tenantId) throw new Error('UsuÃ¡rio sem empresa vinculada.');
    const tenantId = userData.tenantId;

    if (request.method === 'GET') {
        const { id } = request.query;

        // Detalhes da Vaga
        if (id) {
            const { data: job, error } = await supabaseAdmin
                .from('jobs')
                .select(`*, company_departments ( id, name )`) // Join com Dept
                .eq('id', Number(id))
                .eq('tenantId', tenantId)
                .single();
            
            if (error) throw error;
            return response.status(200).json({ job });
        }

        // Dashboard (Lista)
        const { data: tenant } = await supabaseAdmin
            .from('tenants')
            .select('companyName, planId')
            .eq('id', tenantId)
            .single();

        const { data: jobs, error: jobsError } = await supabaseAdmin
            .from('jobs')
            .select(`
                id, title, status, created_at,
                description, requirements, type, location_type,
                applications ( count ),
                company_departments ( name )
            `)
            .eq('tenantId', tenantId);

        if (jobsError) throw jobsError;

        // Processamento (Flattening)
        const formattedJobs = jobs.map(job => ({
            ...job,
            candidateCount: job.applications?.[0]?.count || 0,
            // Garante que deptName exista mesmo que seja null
            deptName: job.company_departments?.name || 'Geral' 
        })).sort((a, b) => {
            // Regra 5: Ordem AlfabÃ©tica de Ãrea -> Data de CriaÃ§Ã£o
            const deptCompare = a.deptName.localeCompare(b.deptName);
            if (deptCompare !== 0) return deptCompare;
            return new Date(b.created_at) - new Date(a.created_at);
        });

        return response.status(200).json({
            jobs: formattedJobs,
            meta: {
                companyName: tenant.companyName,
                userName: userData.name || user.email,
                planId: tenant.planId,
                isAdmin: userData.isAdmin
            }
        });
    }

    // POST (Criar/Atualizar/Deletar) - Mantido simplificado para brevidade
    // ... (Seu cÃ³digo de POST anterior estava correto, mantenha-o ou me peÃ§a se precisar)
    
    return response.status(405).json({ error: 'Method not allowed' });

  } catch (error) {
    console.error('API Error:', error);
    return response.status(500).json({ error: error.message });
  }
}

==================================================
ARQUIVO: api\saveEvaluation.js
==================================================
// api/saveEvaluation.js
import { createClient } from '@supabase/supabase-js';
import { calculateWeightedScore } from './_utils/calculator.js';

export default async function handler(request, response) {
  if (request.method !== 'POST') return response.status(405).json({ error: 'Method not allowed' });

  const supabaseAdmin = createClient(process.env.SUPABASE_URL, process.env.SUPABASE_SERVICE_KEY);

  try {
    // Auth
    const token = request.headers['authorization']?.replace('Bearer ', '');
    if (!token) throw new Error('NÃ£o autorizado.');
    const { data: { user }, error: authError } = await supabaseAdmin.auth.getUser(token);
    if (authError || !user) throw new Error('Token invÃ¡lido.');

    const { applicationId, scores, notes } = request.body;

    // 1. Busca ParÃ¢metros da Vaga (para calcular a nota corretamente)
    const { data: appData, error: appError } = await supabaseAdmin
        .from('applications')
        .select('job:jobs(parameters)')
        .eq('id', applicationId)
        .single();

    if (appError) throw new Error('Candidatura nÃ£o encontrada.');

    // 2. Calcula Nota no Backend (SeguranÃ§a + Regra de NegÃ³cio)
    const finalScore = calculateWeightedScore(scores, appData.job.parameters);

    // 3. Salva na tabela EVALUATIONS (Upsert: Atualiza se jÃ¡ existir para este usuÃ¡rio)
    const { error: saveError } = await supabaseAdmin
        .from('evaluations')
        .upsert({
            application_id: applicationId,
            evaluator_id: user.id,
            scores: scores,     // JSON bruto das escolhas
            notes: notes,       // Texto
            final_score: finalScore,
            updated_at: new Date()
        }, { onConflict: 'application_id, evaluator_id' });

    if (saveError) throw saveError;

    return response.status(200).json({ message: 'Salvo!', score: finalScore });

  } catch (error) {
    console.error('Save Error:', error);
    return response.status(500).json({ error: error.message });
  }
}

==================================================
ARQUIVO: api\updateHiredStatus.js
==================================================
// api/updateHiredStatus.js (VersÃ£o com data de contrataÃ§Ã£o)
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  if (request.method !== 'POST') {
    return response.status(405).json({ error: 'MÃ©todo nÃ£o permitido.' });
  }

  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    // ValidaÃ§Ã£o do usuÃ¡rio (sem alteraÃ§Ãµes)
    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });
    
    const { applicationId, isHired } = request.body;
    if (!applicationId || typeof isHired !== 'boolean') {
      return response.status(400).json({ error: 'applicationId e isHired (booleano) sÃ£o obrigatÃ³rios.' });
    }

    // AQUI ESTÃ A LÃ“GICA ADITIVA:
    // Se estÃ¡ contratando, define a data atual. Se estÃ¡ "descontratando", define como nulo.
    const updateData = {
      isHired: isHired,
      hiredAt: isHired ? new Date().toISOString() : null
    };

    const { data, error: updateError } = await supabaseAdmin
      .from('applications')
      .update(updateData) // Usa o novo objeto de dados
      .eq('id', applicationId)
      .select()
      .single();

    if (updateError) throw updateError;

    return response.status(200).json({ message: 'Status do candidato atualizado com sucesso!', updatedApplication: data });

  } catch (error) {
    console.error("Erro ao atualizar status de contrataÃ§Ã£o:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: api\updateJobParameters.js
==================================================
// api/updateJobParameters.js
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  if (request.method !== 'POST') {
    response.setHeader('Allow', ['POST']);
    return response.status(405).json({ error: `MÃ©todo ${request.method} nÃ£o permitido.` });
  }

  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    // 1. Valida o token do usuÃ¡rio para garantir que ele estÃ¡ logado
    const authHeader = request.headers['authorization'];
    if (!authHeader) {
      return response.status(401).json({ error: 'NÃ£o autorizado.' });
    }
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) {
      return response.status(401).json({ error: 'Token invÃ¡lido.' });
    }

    // 2. Busca o tenantId do usuÃ¡rio para garantir que ele sÃ³ edite suas prÃ³prias vagas
    const { data: userData } = await supabaseAdmin.from('users').select('tenantId').eq('id', user.id).single();
    if (!userData) {
      return response.status(404).json({ error: 'Perfil de usuÃ¡rio nÃ£o encontrado.' });
    }
    const tenantId = userData.tenantId;

    // 3. Pega o ID da vaga e os novos parÃ¢metros do corpo da requisiÃ§Ã£o
    const { jobId, parameters } = request.body;
    if (!jobId || !parameters) {
      return response.status(400).json({ error: 'jobId e parameters sÃ£o obrigatÃ³rios.' });
    }

    // 4. Atualiza a vaga no banco de dados
    const { data, error: updateError } = await supabaseAdmin
      .from('jobs')
      .update({ parameters: parameters }) // Atualiza apenas a coluna 'parameters'
      .eq('id', jobId)                   // Onde o ID da vaga bate
      .eq('tenantId', tenantId)          // E ONDE a vaga pertence ao tenant do usuÃ¡rio (SEGURANÃ‡A)
      .select()
      .single();

    if (updateError) {
      // Se o erro for 'PGRST116', significa que a vaga nÃ£o foi encontrada (ou nÃ£o pertence ao tenant)
      if (updateError.code === 'PGRST116') {
        return response.status(404).json({ error: 'Vaga nÃ£o encontrada ou vocÃª nÃ£o tem permissÃ£o para editÃ¡-la.' });
      }
      throw updateError;
    }

    // 5. Retorna sucesso
    return response.status(200).json({ message: 'ParÃ¢metros salvos com sucesso!', updatedJob: data });

  } catch (error) {
    console.error("Erro na funÃ§Ã£o updateJobParameters:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: api\_utils\calculator.js
==================================================
// api/_utils/calculator.js
export function calculateWeightedScore(userScores, jobParameters) {
    if (!userScores || !jobParameters) return 0;

    // Converte lista de notas do banco em Mapa para acesso rÃ¡pido
    // Ex: { "uuid-nota-1": 0, "uuid-nota-2": 50, "uuid-nota-3": 100 }
    const notesMap = new Map((jobParameters.notas || []).map(n => [n.id, Number(n.valor)]));

    const sections = ['triagem', 'cultura', 'tecnico']; // SeÃ§Ãµes padrÃ£o
    let totalScore = 0;
    let totalMaxPossible = 0;

    sections.forEach(section => {
        const criteriaList = jobParameters[section] || []; // Ex: [{name: 'React', weight: 2}]
        const userSectionScores = userScores[section] || {}; // Ex: { 'React': 'uuid-nota-3' }

        criteriaList.forEach(criterion => {
            const noteId = userSectionScores[criterion.name];
            
            // LÃ“GICA DE N/A: Se a notaId for 'NA' ou nÃ£o existir, ignoramos este critÃ©rio
            if (!noteId || noteId === 'NA') return;

            const noteValue = notesMap.get(noteId); // Valor (0, 50, 100)
            const weight = Number(criterion.weight) || 1; // Peso (1x, 2x...)

            if (noteValue !== undefined) {
                totalScore += (noteValue * weight);
                totalMaxPossible += (100 * weight); // O mÃ¡ximo seria tirar 100 nesse critÃ©rio
            }
        });
    });

    // Evita divisÃ£o por zero se tudo for N/A
    if (totalMaxPossible === 0) return 0;

    // Normaliza para 0-100 com 1 casa decimal
    return Number(((totalScore / totalMaxPossible) * 100).toFixed(1));
}

==================================================
ARQUIVO: functions\.eslintrc.js
==================================================
module.exports = {
  root: true,
  env: {
    es6: true,
    node: true,
  },
  extends: [
    "eslint:recommended",
    "google",
  ],
  rules: {
    quotes: ["error", "double"],
  },
};

==================================================
ARQUIVO: functions\index.js
==================================================
const functions = require("firebase-functions");
const admin = require("firebase-admin");

admin.initializeApp();

exports.getJobsByTenant = functions.https.onCall(async (data, context) => {
  if (!context.auth) {
    throw new functions.https.HttpsError(
      "unauthenticated",
      "VocÃª precisa estar autenticado."
    );
  }

  const uid = context.auth.uid;
  const db = admin.firestore();

  try {
    const userDoc = await db.collection("users").doc(uid).get();
    if (!userDoc.exists) {
      throw new functions.https.HttpsError(
        "not-found",
        "UsuÃ¡rio nÃ£o encontrado."
      );
    }
    const tenantId = userDoc.data().tenantId;
    if (!tenantId) {
      throw new functions.https.HttpsError(
        "permission-denied",
        "UsuÃ¡rio sem tenantId."
      );
    }

    const jobsSnapshot = await db.collection("jobs").where("tenantId", "==", tenantId).get();
    const jobs = [];
    jobsSnapshot.forEach((doc) => {
      jobs.push({ id: doc.id, ...doc.data() });
    });

    return { jobs };

  } catch (error) {
    console.error("Erro ao buscar vagas:", error);
    throw new functions.https.HttpsError(
      "internal",
      "Ocorreu um erro ao buscar as vagas."
    );
  }
});

==================================================
ARQUIVO: functions\package.json
==================================================
{
  "name": "functions",
  "description": "Cloud Functions for Firebase",
  "scripts": {
    "lint": "eslint .",
    "serve": "firebase emulators:start --only functions",
    "shell": "firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "20"
  },
  "main": "index.js",
  "dependencies": {
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^3.24.1"
  },
  "devDependencies": {
    "eslint": "^8.15.0",
    "eslint-plugin-promise": "^6.0.0",
    "firebase-functions-test": "^0.2.0"
  },
  "private": true
}

==================================================
ARQUIVO: functions\functions\package.json
==================================================
{
  "dependencies": {
    "functions": "file:.."
  }
}


==================================================
ARQUIVO: src\App.jsx
==================================================
import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';
import { AuthProvider } from './context/AuthContext';
import PrivateRoute from './components/PrivateRoute';
import Layout from './components/Layout';

import Login from './pages/Login';
import Register from './pages/Register';
import Dashboard from './pages/Dashboard';
import JobDetails from './pages/JobDetails';
import ApplyPage from './pages/ApplyPage';
import Jobs from './pages/Jobs';
import Candidates from './pages/Candidates';
import CompanySettings from './pages/CompanySettings';
import Evaluation from './pages/Evaluation';

function App() {
  return (
    <Router>
      <AuthProvider>
        <Routes>
          {/* Rotas PÃºblicas */}
          <Route path="/login" element={<Login />} />
          <Route path="/register" element={<Register />} />
          <Route path="/vagas/:id/candidatar" element={<ApplyPage />} />

          {/* Rotas Privadas (Protegidas) */}
          <Route element={<PrivateRoute />}>
            {/* O Layout envolve todas as pÃ¡ginas internas */}
            <Route element={<Layout />}>
              <Route path="/" element={<Navigate to="/dashboard" replace />} />
              <Route path="/dashboard" element={<Dashboard />} />
              
              <Route path="/jobs" element={<Jobs />} />
              <Route path="/jobs/:id" element={<JobDetails />} />
              
              <Route path="/candidates" element={<Candidates />} />
              <Route path="/settings" element={<CompanySettings />} />
              <Route path="/evaluations/:applicationId" element={<Evaluation />} />
            </Route>
          </Route>

          <Route path="*" element={<Navigate to="/login" replace />} />
        </Routes>
      </AuthProvider>
    </Router>
  );
}

export default App;

==================================================
ARQUIVO: src\index.css
==================================================
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Seus estilos globais extras aqui, se houver */
body {
  @apply bg-gray-50;
}

==================================================
ARQUIVO: src\main.jsx
==================================================
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.jsx'
import './index.css'

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)

==================================================
ARQUIVO: src\components\AreaSelect.jsx
==================================================
import React, { useState, useEffect } from 'react';
import { supabase } from '../supabase/client';
import { Input } from './ui/input';
import { Button } from './ui/button';
import { Label } from './ui/label';
import { Loader2, Plus, X } from 'lucide-react';

export default function AreaSelect({ currentTenantId, selectedAreaId, onSelectArea, error }) {
  const [departments, setDepartments] = useState([]);
  const [isCreatingNew, setIsCreatingNew] = useState(false);
  const [newDeptName, setNewDeptName] = useState('');
  const [loading, setLoading] = useState(false);

  // Busca Ã¡reas da empresa atual
  useEffect(() => {
    if (!currentTenantId) return;

    async function fetchDepartments() {
      setLoading(true);
      try {
        const { data, error } = await supabase
          .from('company_departments')
          .select('id, name')
          .eq('tenantId', currentTenantId)
          .order('name', { ascending: true });

        if (error) throw error;
        setDepartments(data || []);
      } catch (error) {
        console.error('Erro ao buscar Ã¡reas:', error.message);
      } finally {
        setLoading(false);
      }
    }

    fetchDepartments();
  }, [currentTenantId]);

  // Salva nova Ã¡rea
  const handleSaveNew = async () => {
    if (!newDeptName.trim()) return;
    try {
      setLoading(true);
      const { data, error } = await supabase
        .from('company_departments')
        .insert([{ 
          name: newDeptName.trim(), 
          tenantId: currentTenantId 
        }])
        .select()
        .single();

      if (error) throw error;

      setDepartments([...departments, data]);
      onSelectArea(data.id);
      setIsCreatingNew(false);
      setNewDeptName('');
    } catch (error) {
      alert('Erro ao criar Ã¡rea: ' + error.message);
    } finally {
      setLoading(false);
    }
  };

  if (loading && departments.length === 0) {
    return <div className="text-sm text-gray-500 flex items-center"><Loader2 className="w-3 h-3 animate-spin mr-2"/> Carregando Ã¡reas...</div>;
  }

  // Modo de CriaÃ§Ã£o (Input de Texto)
  if (isCreatingNew) {
    return (
      <div className="mb-4 p-4 border border-blue-100 bg-blue-50 rounded-md">
        <Label>Nome da Nova Ãrea</Label>
        <div className="flex gap-2">
          <Input
            value={newDeptName}
            onChange={(e) => setNewDeptName(e.target.value)}
            placeholder="Ex: Marketing, TI..."
            autoFocus
          />
        </div>
        <div className="flex justify-end gap-2 mt-3">
            <Button 
                type="button"
                variant="ghost" 
                size="sm"
                onClick={() => setIsCreatingNew(false)}
            >
                Cancelar
            </Button>
            <Button 
                type="button"
                size="sm"
                onClick={handleSaveNew}
                disabled={!newDeptName.trim() || loading}
            >
                {loading ? <Loader2 className="w-4 h-4 animate-spin"/> : 'Salvar'}
            </Button>
        </div>
      </div>
    );
  }

  // Modo de SeleÃ§Ã£o (Dropdown Nativo Estilizado)
  return (
    <div className="mb-4">
      <Label>Ãrea / Departamento</Label>
      <select
        className="flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
        value={selectedAreaId || ''}
        onChange={(e) => {
          if (e.target.value === 'NEW') setIsCreatingNew(true);
          else onSelectArea(e.target.value);
        }}
      >
        <option value="">Selecione uma Ã¡rea...</option>
        {departments.map((dept) => (
          <option key={dept.id} value={dept.id}>
            {dept.name}
          </option>
        ))}
        <option value="NEW" className="font-bold text-blue-600 bg-blue-50">
          + Cadastrar Nova Ãrea
        </option>
      </select>
      {error && <p className="text-sm text-red-500 mt-1">{error}</p>}
    </div>
  );
}

==================================================
ARQUIVO: src\components\Layout.jsx
==================================================
import { useState } from 'react';
import { Outlet, Link, useLocation, useNavigate } from 'react-router-dom';
import { supabase } from '../supabase/client';
import { 
  LayoutDashboard, 
  Briefcase, 
  Users, 
  Settings, 
  LogOut, 
  Menu, 
  X 
} from 'lucide-react';
import { Button } from './ui/button';

export default function Layout() {
  const location = useLocation();
  const navigate = useNavigate();
  const [isSidebarOpen, setIsSidebarOpen] = useState(false);

  const navigation = [
    { name: 'Dashboard', href: '/dashboard', icon: LayoutDashboard },
    { name: 'Vagas', href: '/jobs', icon: Briefcase },
    { name: 'Candidatos', href: '/candidates', icon: Users },
    { name: 'ConfiguraÃ§Ãµes', href: '/settings', icon: Settings },
  ];

  const handleLogout = async () => {
    await supabase.auth.signOut();
    navigate('/login');
  };

  const NavItem = ({ item }) => {
    const isActive = location.pathname.startsWith(item.href);
    return (
      <Link
        to={item.href}
        onClick={() => setIsSidebarOpen(false)}
        className={`flex items-center px-4 py-3 text-sm font-medium rounded-md transition-colors ${
          isActive 
            ? 'bg-blue-50 text-blue-700' 
            : 'text-gray-700 hover:bg-gray-50 hover:text-gray-900'
        }`}
      >
        <item.icon className={`mr-3 h-5 w-5 ${isActive ? 'text-blue-700' : 'text-gray-400'}`} />
        {item.name}
      </Link>
    );
  };

  return (
    <div className="min-h-screen bg-gray-50 flex">
      {/* Sidebar Mobile Overlay */}
      {isSidebarOpen && (
        <div 
          className="fixed inset-0 z-40 bg-gray-600 bg-opacity-75 lg:hidden"
          onClick={() => setIsSidebarOpen(false)}
        />
      )}

      {/* Sidebar Navigation */}
      <div className={`
        fixed inset-y-0 left-0 z-50 w-64 bg-white border-r border-gray-200 transform transition-transform duration-200 ease-in-out lg:translate-x-0 lg:static lg:inset-0
        ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'}
      `}>
        <div className="flex items-center justify-between h-16 px-6 border-b border-gray-200">
          <span className="text-xl font-bold text-blue-600 tracking-tight">Novva R&S</span>
          <button onClick={() => setIsSidebarOpen(false)} className="lg:hidden">
            <X className="h-6 w-6 text-gray-500" />
          </button>
        </div>
        
        <nav className="p-4 space-y-1">
          {navigation.map((item) => (
            <NavItem key={item.name} item={item} />
          ))}
        </nav>

        <div className="absolute bottom-0 w-full p-4 border-t border-gray-200">
          <Button 
            variant="ghost" 
            className="w-full justify-start text-red-600 hover:text-red-700 hover:bg-red-50"
            onClick={handleLogout}
          >
            <LogOut className="mr-3 h-5 w-5" />
            Sair
          </Button>
        </div>
      </div>

      {/* Main Content Area */}
      <div className="flex-1 flex flex-col min-w-0 overflow-hidden">
        {/* Mobile Header */}
        <div className="lg:hidden flex items-center justify-between bg-white border-b border-gray-200 px-4 py-2">
          <span className="font-semibold text-gray-700">Menu</span>
          <button 
            onClick={() => setIsSidebarOpen(true)}
            className="p-2 -mr-2 text-gray-500 hover:text-gray-700"
          >
            <Menu className="h-6 w-6" />
          </button>
        </div>

        {/* Page Content */}
        <main className="flex-1 overflow-y-auto p-4 sm:p-8">
          <Outlet />
        </main>
      </div>
    </div>
  );
}

==================================================
ARQUIVO: src\components\PrivateRoute.jsx
==================================================
import { Navigate, Outlet } from 'react-router-dom';
import { useAuth } from '../context/AuthContext';

export default function PrivateRoute() {
  const { user, loading } = useAuth();

  // 1. Enquanto verifica o login, mostra um spinner para nÃ£o "piscar" a tela de login
  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen bg-gray-50">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  // 2. Regra de NegÃ³cio: Se tem user, libera o acesso (Outlet). Se nÃ£o, chuta pro Login.
  return user ? <Outlet /> : <Navigate to="/login" replace />;
}

==================================================
ARQUIVO: src\components\charts\ClassificationChart.jsx
==================================================
// src/components/charts/ClassificationChart.jsx
import React from 'react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, LabelList } from 'recharts';
import { Box } from '@mui/material';

const ClassificationChart = ({ data }) => {
  // O Recharts espera os dados com os candidatos no eixo Y, entÃ£o nÃ£o precisamos de transformaÃ§Ãµes
  return (
    <Box sx={{ width: '100%', height: 300, mt: 4 }}>
      <ResponsiveContainer>
        <BarChart
          layout="vertical"
          data={data}
          margin={{
            top: 5,
            right: 30,
            left: 100, // Aumenta o espaÃ§o para nomes longos
            bottom: 5,
          }}
        >
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis type="number" />
          <YAxis dataKey="candidateName" type="category" width={150} />
          <Tooltip />
          <Legend />
          <Bar dataKey="notaTriagem" stackId="a" fill="#3f51b5" name="Nota Triagem">
            <LabelList dataKey="notaTriagem" position="center" fill="#fff" formatter={(value) => value.toFixed(1)} />
          </Bar>
          <Bar dataKey="notaCultura" stackId="a" fill="#8884d8" name="Nota Cultura">
             <LabelList dataKey="notaCultura" position="center" fill="#fff" formatter={(value) => value.toFixed(1)} />
          </Bar>
          <Bar dataKey="notaTecnico" stackId="a" fill="#82ca9d" name="Nota TÃ©cnico">
             <LabelList dataKey="notaTecnico" position="center" fill="#fff" formatter={(value) => value.toFixed(1)} />
          </Bar>
        </BarChart>
      </ResponsiveContainer>
    </Box>
  );
};

export default ClassificationChart;

==================================================
ARQUIVO: src\components\common\LoadingSpinner.jsx
==================================================
import React from 'react';
import { Box, CircularProgress } from '@mui/material';

const LoadingSpinner = () => {
    return (
        <Box
            sx={{
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'center',
                height: '100vh',
                width: '100vw',
            }}
        >
            <CircularProgress />
        </Box>
    );
};

export default LoadingSpinner;

==================================================
ARQUIVO: src\components\evaluation_v2\EvaluationDashboardV2.jsx
==================================================
import React, { useEffect, useState } from 'react';
import { prepareEvaluationV2, getEvaluationSummaryV2 } from '../../services/evaluationService';
import { supabase } from '../../supabase/client';

export default function EvaluationDashboardV2({ applicationId, jobId, currentUser }) {
  const [loading, setLoading] = useState(true);
  const [summary, setSummary] = useState(null);
  const [viewMode, setViewMode] = useState('summary'); // 'summary' ou 'evaluate'

  useEffect(() => {
    const init = async () => {
      try {
        setLoading(true);
        // Garante que o banco estÃ¡ pronto
        await prepareEvaluationV2(jobId);
        // Carrega dados
        const data = await getEvaluationSummaryV2(applicationId);
        setSummary(data);
      } catch (error) {
        console.error("Erro ao carregar V2:", error);
      } finally {
        setLoading(false);
      }
    };
    if (jobId && applicationId) init();
  }, [applicationId, jobId]);

  if (loading) return <div className="p-4 text-center">Carregando AvaliaÃ§Ã£o 360Âº...</div>;

  return (
    <div className="bg-white rounded-lg shadow p-6 mt-6">
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-2xl font-bold text-gray-800">AvaliaÃ§Ã£o 360Âº</h2>
        <button 
          onClick={() => setViewMode(viewMode === 'summary' ? 'evaluate' : 'summary')}
          className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition"
        >
          {viewMode === 'summary' ? 'Minha AvaliaÃ§Ã£o' : 'Voltar ao Resumo'}
        </button>
      </div>

      {viewMode === 'summary' ? (
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          {/* Card da Nota Final */}
          <div className="bg-gray-50 p-6 rounded-xl border border-gray-200 text-center">
            <span className="block text-gray-500 text-sm uppercase tracking-wide">MÃ©dia Geral</span>
            <span className="block text-5xl font-extrabold text-blue-600 mt-2">
              {summary?.final_score || '-'}
            </span>
          </div>
          
          {/* Lista de Avaliadores */}
          <div className="col-span-2">
            <h3 className="font-semibold text-gray-700 mb-3">Avaliadores Participantes</h3>
            <div className="flex gap-2">
              {summary?.evaluators?.map(ev => (
                <span key={ev.id} className="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">
                  {ev.name}
                </span>
              ))}
              {(!summary?.evaluators || summary.evaluators.length === 0) && (
                <span className="text-gray-400 italic">Nenhuma avaliaÃ§Ã£o concluÃ­da ainda.</span>
              )}
            </div>
          </div>
        </div>
      ) : (
        <div className="p-4 bg-yellow-50 border border-yellow-200 rounded text-yellow-800">
          {/* AQUI ENTRARÃ O FORMULÃRIO DE NOTAS NO PRÃ“XIMO PASSO */}
          <p>O formulÃ¡rio de avaliaÃ§Ã£o individual serÃ¡ carregado aqui.</p>
        </div>
      )}
    </div>
  );
}

==================================================
ARQUIVO: src\components\inputs\StateSelect.jsx
==================================================
import React from 'react';
import { Label } from '../ui/label';
import { estados } from '../../data/brazil-locations'; 

const StateSelect = ({ value, onChange, error, disabled }) => {
  return (
    <div className="mb-4">
      <Label htmlFor="state">Em que estado vocÃª mora?</Label>
      <select
        id="state"
        name="state"
        value={value || ''}
        onChange={onChange}
        disabled={disabled}
        className="flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
      >
        <option value="" disabled>Selecione uma opÃ§Ã£o</option>
        {estados.map((estado) => (
          <option key={estado.sigla} value={estado.sigla}>
            {estado.nome}
          </option>
        ))}
      </select>
      {error && <p className="text-sm text-red-500 mt-1">{error}</p>}
    </div>
  );
};

export default StateSelect;

==================================================
ARQUIVO: src\components\jobs\CreateJobModal.jsx
==================================================
import React, { useState, useEffect } from 'react';
import { supabase } from '../../supabase/client';
import { Modal } from '../ui/modal';
import { Button } from '../ui/button';
import { Input } from '../ui/input';
import { Label } from '../ui/label';
import AreaSelect from '../AreaSelect';
import { Loader2, AlertCircle } from 'lucide-react';

const CreateJobModal = ({ open, handleClose, onJobCreated }) => {
  const [jobTitle, setJobTitle] = useState('');
  const [departmentId, setDepartmentId] = useState(null);
  const [tenantId, setTenantId] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');

  // Busca o Tenant ID assim que o modal abre
  useEffect(() => {
    if (open) {
      const fetchTenantId = async () => {
        try {
          const { data: { user } } = await supabase.auth.getSession();
          if (!user) return;

          const { data: userData, error } = await supabase
            .from('users')
            .select('tenantId')
            .eq('id', user.id)
            .single();

          if (error) throw error;
          if (userData?.tenantId) setTenantId(userData.tenantId);
          
        } catch (err) {
          console.error('Erro ao buscar tenant:', err);
          setError("Erro ao carregar configuraÃ§Ãµes da empresa.");
        }
      };
      fetchTenantId();
    }
  }, [open]);

  const handleSubmit = async (event) => {
    event.preventDefault();
    setLoading(true);
    setError('');

    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) throw new Error("VocÃª nÃ£o estÃ¡ autenticado.");

      const response = await fetch('/api/createJob', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${session.access_token}`,
        },
        body: JSON.stringify({ 
            title: jobTitle, 
            company_department_id: departmentId 
        }),
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || "NÃ£o foi possÃ­vel criar a vaga.");
      }

      // Sucesso
      setJobTitle('');
      setDepartmentId(null);
      onJobCreated(); 
      handleClose();

    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <Modal
      isOpen={open}
      onClose={handleClose}
      title="Criar Nova Vaga"
    >
      <form onSubmit={handleSubmit} className="space-y-6">
        
        <div>
          <Label htmlFor="jobTitle">TÃ­tulo da Vaga</Label>
          <Input
            id="jobTitle"
            required
            autoFocus
            placeholder="Ex: Analista Financeiro"
            value={jobTitle}
            onChange={(e) => setJobTitle(e.target.value)}
            disabled={loading}
          />
        </div>

        {/* Ponto 4: Ãrea Select agora lida melhor com o estado de loading interno */}
        <div className="space-y-2">
            {tenantId ? (
                <AreaSelect 
                    currentTenantId={tenantId}
                    selectedAreaId={departmentId}
                    onSelectArea={setDepartmentId}
                />
            ) : (
                <div className="flex items-center text-sm text-gray-500 bg-gray-50 p-3 rounded-md">
                   <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                   Carregando departamentos...
                </div>
            )}
        </div>

        {error && (
            <div className="p-3 bg-red-50 border border-red-200 rounded-md flex items-center gap-2 text-sm text-red-700">
                <AlertCircle className="w-4 h-4" />
                {error}
            </div>
        )}
        
        <div className="flex justify-end gap-3 pt-2">
          <Button type="button" variant="outline" onClick={handleClose} disabled={loading}>
            Cancelar
          </Button>
          <Button type="submit" disabled={loading || !jobTitle}>
            {loading ? (
                <>
                    <Loader2 className="w-4 h-4 mr-2 animate-spin" /> 
                    Criando...
                </>
            ) : 'Criar Vaga'}
          </Button>
        </div>
      </form>
    </Modal>
  );
};

export default CreateJobModal;

==================================================
ARQUIVO: src\components\ui\badge.jsx
==================================================
import * as React from "react"
import { cva } from "class-variance-authority"
import { cn } from "../../lib/utils"

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default: "border-transparent bg-blue-600 text-white hover:bg-blue-700",
        secondary: "border-transparent bg-gray-100 text-gray-900 hover:bg-gray-200",
        destructive: "border-transparent bg-red-500 text-white hover:bg-red-600",
        outline: "text-gray-900 border-gray-200",
        success: "border-transparent bg-green-100 text-green-800 hover:bg-green-200",
        warning: "border-transparent bg-yellow-100 text-yellow-800 hover:bg-yellow-200",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function Badge({ className, variant, ...props }) {
  return (<div className={cn(badgeVariants({ variant }), className)} {...props} />)
}

export { Badge, badgeVariants }

==================================================
ARQUIVO: src\components\ui\button.jsx
==================================================
import * as React from "react"
import { cva } from "class-variance-authority"
import { cn } from "../../lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
  {
    variants: {
      variant: {
        default: "bg-blue-600 text-white hover:bg-blue-700 shadow-sm",
        destructive: "bg-red-500 text-white hover:bg-red-600 shadow-sm",
        outline: "border border-gray-200 bg-white hover:bg-gray-100 hover:text-gray-900",
        secondary: "bg-gray-100 text-gray-900 hover:bg-gray-200",
        ghost: "hover:bg-gray-100 hover:text-gray-900",
        link: "text-blue-600 underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const Button = React.forwardRef(({ className, variant, size, ...props }, ref) => {
  return (
    <button
      className={cn(buttonVariants({ variant, size, className }))}
      ref={ref}
      {...props}
    />
  )
})
Button.displayName = "Button"

export { Button, buttonVariants }

==================================================
ARQUIVO: src\components\ui\button.test.jsx
==================================================
import { render, screen } from '@testing-library/react';
import { Button } from './button';
import { describe, it, expect } from 'vitest';

describe('Componente Button', () => {
  it('deve renderizar o texto corretamente', () => {
    render(<Button>Clique aqui</Button>);
    expect(screen.getByText('Clique aqui')).toBeInTheDocument();
  });

  it('deve aplicar a classe de variante destructive', () => {
    render(<Button variant="destructive">Excluir</Button>);
    const button = screen.getByText('Excluir');
    // Verifica se a classe do tailwind para background vermelho estÃ¡ presente
    expect(button).toHaveClass('bg-red-500');
  });
});

==================================================
ARQUIVO: src\components\ui\card.jsx
==================================================
import * as React from "react"
import { cn } from "../../lib/utils"

const Card = React.forwardRef(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("rounded-lg border bg-white text-gray-950 shadow-sm", className)} {...props} />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("flex flex-col space-y-1.5 p-6", className)} {...props} />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef(({ className, ...props }, ref) => (
  <h3 ref={ref} className={cn("text-2xl font-semibold leading-none tracking-tight", className)} {...props} />
))
CardTitle.displayName = "CardTitle"

const CardContent = React.forwardRef(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

export { Card, CardHeader, CardTitle, CardContent }

==================================================
ARQUIVO: src\components\ui\input.jsx
==================================================
import * as React from "react"
import { cn } from "../../lib/utils"

const Input = React.forwardRef(({ className, type, ...props }, ref) => {
  return (
    <input
      type={type}
      className={cn(
        "flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      ref={ref}
      {...props}
    />
  )
})
Input.displayName = "Input"

export { Input }

==================================================
ARQUIVO: src\components\ui\label.jsx
==================================================
import * as React from "react"
import { cn } from "../../lib/utils"

const Label = React.forwardRef(({ className, ...props }, ref) => (
  <label
    ref={ref}
    className={cn(
      "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-gray-700 mb-2 block",
      className
    )}
    {...props}
  />
))
Label.displayName = "Label"

export { Label }

==================================================
ARQUIVO: src\components\ui\modal.jsx
==================================================
import React, { useEffect } from 'react';
import { X } from 'lucide-react';
import { createPortal } from 'react-dom';

export function Modal({ isOpen, onClose, title, children }) {
  // Fecha ao pressionar ESC
  useEffect(() => {
    const handleEsc = (e) => {
      if (e.key === 'Escape') onClose();
    };
    if (isOpen) window.addEventListener('keydown', handleEsc);
    return () => window.removeEventListener('keydown', handleEsc);
  }, [isOpen, onClose]);

  if (!isOpen) return null;

  return createPortal(
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in duration-200">
      <div className="relative w-full max-w-md bg-white rounded-lg shadow-xl animate-in zoom-in-95 duration-200" onClick={(e) => e.stopPropagation()}>
        {/* Header */}
        <div className="flex items-center justify-between px-6 py-4 border-b">
          <h3 className="text-lg font-semibold text-gray-900">{title}</h3>
          <button
            onClick={onClose}
            className="text-gray-400 hover:text-gray-500 transition-colors focus:outline-none"
          >
            <X className="w-5 h-5" />
          </button>
        </div>
        
        {/* Content */}
        <div className="p-6">
          {children}
        </div>
      </div>
    </div>,
    document.body
  );
}

==================================================
ARQUIVO: src\components\ui\textarea.jsx
==================================================
import * as React from "react"
import { cn } from "../../lib/utils"

const Textarea = React.forwardRef(({ className, ...props }, ref) => {
  return (
    <textarea
      className={cn(
        "flex min-h-[80px] w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      ref={ref}
      {...props}
    />
  )
})
Textarea.displayName = "Textarea"

export { Textarea }

==================================================
ARQUIVO: src\context\AuthContext.jsx
==================================================
import { createContext, useContext, useEffect, useState } from 'react';
import { supabase } from '../supabase/client';

const AuthContext = createContext({});

// --- A LINHA QUE ESTAVA FALTANDO Ã‰ ESTA ABAIXO: ---
export const useAuth = () => useContext(AuthContext);
// --------------------------------------------------

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // 1. Verifica a sessÃ£o inicial
    const checkSession = async () => {
      try {
        const { data: { session } } = await supabase.auth.getSession();
        setUser(session?.user ?? null);
      } catch (error) {
        console.error("Erro ao verificar sessÃ£o:", error);
      } finally {
        setLoading(false);
      }
    };

    checkSession();

    // 2. Escuta mudanÃ§as na autenticaÃ§Ã£o
    const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
      setUser(session?.user ?? null);
      setLoading(false);
    });

    return () => subscription.unsubscribe();
  }, []);

  // O valor que serÃ¡ compartilhado com toda a aplicaÃ§Ã£o
  const value = {
    signUp: (data) => supabase.auth.signUp(data),
    signIn: (data) => supabase.auth.signInWithPassword(data),
    signOut: () => supabase.auth.signOut(),
    user,
    loading
  };

  // BLOQUEIO DE SEGURANÃ‡A (Resolve o Loop):
  // Enquanto o Supabase nÃ£o responde se tem usuÃ¡rio ou nÃ£o, mostramos "Carregando".
  // Assim, o PrivateRoute nunca roda com dados incompletos.
  if (loading) {
    return (
      <div className="flex h-screen w-screen items-center justify-center bg-gray-50">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <p className="text-gray-600">Carregando sistema...</p>
        </div>
      </div>
    );
  }

  return (
    <AuthContext.Provider value={value}>
      {children}
    </AuthContext.Provider>
  );
};

==================================================
ARQUIVO: src\data\brazil-locations.js
==================================================
// src/data/brazil-locations.js
export const estados = [
  { sigla: 'AC', nome: 'Acre' },
  { sigla: 'AL', nome: 'Alagoas' },
  { sigla: 'AP', nome: 'AmapÃ¡' },
  { sigla: 'AM', nome: 'Amazonas' },
  { sigla: 'BA', nome: 'Bahia' },
  { sigla: 'CE', nome: 'CearÃ¡' },
  { sigla: 'DF', nome: 'Distrito Federal' },
  { sigla: 'ES', nome: 'EspÃ­rito Santo' },
  { sigla: 'GO', nome: 'GoiÃ¡s' },
  { sigla: 'MA', nome: 'MaranhÃ£o' },
  { sigla: 'MT', nome: 'Mato Grosso' },
  { sigla: 'MS', nome: 'Mato Grosso do Sul' },
  { sigla: 'MG', nome: 'Minas Gerais' },
  { sigla: 'PA', nome: 'ParÃ¡' },
  { sigla: 'PB', nome: 'ParaÃ­ba' },
  { sigla: 'PR', nome: 'ParanÃ¡' },
  { sigla: 'PE', nome: 'Pernambuco' },
  { sigla: 'PI', nome: 'PiauÃ­' },
  { sigla: 'RJ', nome: 'Rio de Janeiro' },
  { sigla: 'RN', nome: 'Rio Grande do Norte' },
  { sigla: 'RS', nome: 'Rio Grande do Sul' },
  { sigla: 'RO', nome: 'RondÃ´nia' },
  { sigla: 'RR', nome: 'Roraima' },
  { sigla: 'SC', nome: 'Santa Catarina' },
  { sigla: 'SP', nome: 'SÃ£o Paulo' },
  { sigla: 'SE', nome: 'Sergipe' },
  { sigla: 'TO', nome: 'Tocantins' }
];

// No futuro, podemos substituir o campo de cidade por uma busca via API de CEP
// Por enquanto, usaremos um campo de texto simples para a cidade.

==================================================
ARQUIVO: src\lib\utils.js
==================================================
import { clsx } from "clsx"
import { twMerge } from "tailwind-merge"
 
export function cn(...inputs) {
  return twMerge(clsx(inputs))
}

==================================================
ARQUIVO: src\pages\AdminPage.jsx
==================================================
// src/pages/AdminPage.jsx (VersÃ£o com Link para /admin/tenant/:tenantId)
import React, { useState, useEffect, forwardRef } from 'react';
import { Link as RouterLink } from 'react-router-dom';
import { supabase } from '../supabase/client';
import { 
    Container, Typography, Box, AppBar, Toolbar, Button, CircularProgress, 
    Alert, Paper, Table, TableHead, TableRow, TableCell, TableBody, Tabs, Tab,
    Modal, FormControl, InputLabel, Select, MenuItem, Snackbar, TextField,
    Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, IconButton, Grid
} from '@mui/material';
import { IMaskInput } from 'react-imask';
import AddIcon from '@mui/icons-material/Add';
import EditIcon from '@mui/icons-material/Edit';
import DeleteIcon from '@mui/icons-material/Delete';

// MÃ¡scara CNPJ (sem alteraÃ§Ãµes)
const CnpjMask = forwardRef(function CnpjMask(props, ref) {
  const { onChange, ...other } = props;
  return (
    <IMaskInput
      {...other}
      mask="00.000.000/0000-00"
      definitions={{
        '#': /[1-9]/,
      }}
      inputRef={ref}
      onAccept={(value) => onChange({ target: { name: props.name, value } })}
      overwrite
    />
  );
});

// Estilo Modal (sem alteraÃ§Ãµes)
const modalStyle = {
  position: 'absolute',
  top: '50%',
  left: '50%',
  transform: 'translate(-50%, -50%)',
  width: 500,
  bgcolor: 'background.paper',
  boxShadow: 24,
  p: 4,
};

// Componente do FormulÃ¡rio de Plano (sem alteraÃ§Ãµes)
const PlanFormModal = ({ open, onClose, plan, onSave }) => {
  const [formData, setFormData] = useState({ id: '', name: '', user_limit: 1, job_limit: 1, candidate_limit: 1, price: 0 });
  const [isSaving, setIsSaving] = useState(false);
  const [error, setError] = useState('');
  const isEditMode = Boolean(plan);
  useEffect(() => { if (plan) { setFormData(plan); } else { setFormData({ id: '', name: '', user_limit: 1, job_limit: 1, candidate_limit: 1, price: 0 }); } }, [plan, open]);
  const handleChange = (e) => { const { name, value } = e.target; setFormData(prev => ({ ...prev, [name]: value })); };
  const handleNumericChange = (e) => { const { name, value } = e.target; const numValue = value === '-1' ? -1 : parseInt(value, 10) || 0; setFormData(prev => ({ ...prev, [name]: numValue })); };
  const handleSubmit = async () => {
    setIsSaving(true);
    setError('');
    try {
      const action = isEditMode ? 'updatePlan' : 'createPlan';
      const body = isEditMode ? { planId: plan.id, planData: formData } : { planData: formData };
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
      const response = await fetch('/api/admin', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
          body: JSON.stringify({ action, ...body })
      });
      if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error || "Ocorreu um erro."); }
      const data = await response.json();
      onSave(isEditMode ? data.updatedPlan : data.newPlan);
      onClose();
    } catch (err) { setError(err.message); } 
    finally { setIsSaving(false); }
  };
  return (
    <Modal open={open} onClose={onClose}>
      <Box sx={modalStyle}>
        <Typography variant="h6" gutterBottom>{isEditMode ? 'Editar Plano' : 'Criar Novo Plano'}</Typography>
        <Grid container spacing={2}>
          <Grid item xs={12}><TextField name="id" label="ID do Plano (ex: 'basico')" value={formData.id} onChange={handleChange} fullWidth margin="normal" required disabled={isEditMode} /></Grid>
          <Grid item xs={12}><TextField name="name" label="Nome do Plano (ex: 'Plano BÃ¡sico')" value={formData.name} onChange={handleChange} fullWidth margin="normal" required /></Grid>
          <Grid item xs={12}><TextField name="price" label="PreÃ§o (ex: 99.00)" type="number" value={formData.price} onChange={handleChange} fullWidth margin="normal" required /></Grid>
          <Grid item xs={12} sm={4}><TextField name="user_limit" label="Limite de UsuÃ¡rios" type="number" value={formData.user_limit} onChange={handleNumericChange} fullWidth margin="normal" helperText="-1 para ilimitado" /></Grid>
          <Grid item xs={12} sm={4}><TextField name="job_limit" label="Limite de Vagas" type="number" value={formData.job_limit} onChange={handleNumericChange} fullWidth margin="normal" helperText="-1 para ilimitado" /></Grid>
          <Grid item xs={12} sm={4}><TextField name="candidate_limit" label="Limite de Candidatos/Vaga" type="number" value={formData.candidate_limit} onChange={handleNumericChange} fullWidth margin="normal" helperText="-1 para ilimitado" /></Grid>
        </Grid>
        {error && <Alert severity="error" sx={{ mt: 2 }}>{error}</Alert>}
        <Box sx={{ mt: 3, display: 'flex', justifyContent: 'flex-end', gap: 1 }}>
          <Button onClick={onClose} disabled={isSaving}>Cancelar</Button>
          <Button variant="contained" onClick={handleSubmit} disabled={isSaving}>
            {isSaving ? <CircularProgress size={24} /> : 'Salvar'}
          </Button>
        </Box>
      </Box>
    </Modal>
  );
};

// Tabela de Planos (sem alteraÃ§Ãµes)
const PlansTable = ({ plans, onAdd, onEdit, onDelete }) => (
  <>
    <Box sx={{ display: 'flex', justifyContent: 'flex-end', my: 2 }}>
        <Button variant="contained" startIcon={<AddIcon />} onClick={onAdd}>
            Criar Novo Plano
        </Button>
    </Box>
    <Paper>
      <Table>
        <TableHead>
          <TableRow>
            <TableCell sx={{ fontWeight: 'bold' }}>ID do Plano</TableCell>
            <TableCell sx={{ fontWeight: 'bold' }}>Nome</TableCell>
            <TableCell align="center" sx={{ fontWeight: 'bold' }}>UsuÃ¡rios</TableCell>
            <TableCell align="center" sx={{ fontWeight: 'bold' }}>Vagas</TableCell>
            <TableCell align="center" sx={{ fontWeight: 'bold' }}>Candidatos/Vaga</TableCell>
            <TableCell align="right" sx={{ fontWeight: 'bold' }}>PreÃ§o</TableCell>
            <TableCell align="center" sx={{ fontWeight: 'bold' }}>AÃ§Ãµes</TableCell>
          </TableRow>
        </TableHead>
        <TableBody>
          {plans.map((plan) => (
            <TableRow hover key={plan.id}>
              <TableCell>{plan.id}</TableCell>
              <TableCell>{plan.name}</TableCell>
              <TableCell align="center">{plan.user_limit === -1 ? 'Ilimitado' : plan.user_limit}</TableCell>
              <TableCell align="center">{plan.job_limit === -1 ? 'Ilimitado' : plan.job_limit}</TableCell>
              <TableCell align="center">{plan.candidate_limit === -1 ? 'Ilimitado' : plan.candidate_limit}</TableCell>
              <TableCell align="right">R$ {plan.price.toFixed(2)}</TableCell>
              <TableCell align="center">
                <IconButton size="small" onClick={() => onEdit(plan)}><EditIcon /></IconButton>
                <IconButton size="small" onClick={() => onDelete(plan)}><DeleteIcon color="error" /></IconButton>
              </TableCell>
            </TableRow>
          ))}
        </TableBody>
      </Table>
    </Paper>
  </>
);

// Tabela de Tenants (AQUI ESTÃ A MUDANÃ‡A)
const TenantsTable = ({ tenants, plans, onTenantUpdated, onTenantCreated, onTenantDeleted }) => {
  const [modalOpen, setModalOpen] = useState(false);
  const [dialogOpen, setDialogOpen] = useState(false);
  const [isSaving, setIsSaving] = useState(false);
  const [selectedTenant, setSelectedTenant] = useState(null);
  const [formData, setFormData] = useState({ companyName: '', planId: '', cnpj: '' });
  
  const handleOpenModal = (tenant = null) => {
    setSelectedTenant(tenant);
    if (tenant) { setFormData({ companyName: tenant.companyName, planId: tenant.planId, cnpj: tenant.cnpj || '' }); }
    else { setFormData({ companyName: '', planId: '', cnpj: '' }); }
    setModalOpen(true);
  };
  const handleOpenDialog = (tenant) => { setSelectedTenant(tenant); setDialogOpen(true); };
  const handleClose = () => { setModalOpen(false); setDialogOpen(false); setSelectedTenant(null); };
  const handleChange = (e) => { const { name, value } = e.target; setFormData(prev => ({ ...prev, [name]: value })); };
  const callApi = async (action, body) => {
    const { data: { session } } = await supabase.auth.getSession();
    if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
    const response = await fetch('/api/admin', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
        body: JSON.stringify({ action, ...body })
    });
    if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error || "Ocorreu um erro."); }
    return await response.json();
  };
  const handleSubmit = async () => {
    setIsSaving(true);
    try {
      if (selectedTenant) { const data = await callApi('updateTenant', { id: selectedTenant.id, ...formData }); onTenantUpdated(data.updatedTenant); }
      else { const data = await callApi('createTenant', formData); onTenantCreated(data.newTenant); }
      handleClose();
    } catch (err) { console.error("Erro ao salvar empresa:", err); } 
    finally { setIsSaving(false); }
  };
  const handleDelete = async () => {
    setIsSaving(true);
    try {
      await callApi('deleteTenant', { tenantId: selectedTenant.id });
      onTenantDeleted(selectedTenant.id);
      handleClose();
    } catch (err) { console.error("Erro ao excluir empresa:", err); } 
    finally { setIsSaving(false); }
  };

  return (
    <>
      <Box sx={{ display: 'flex', justifyContent: 'flex-end', my: 2 }}>
        <Button variant="contained" startIcon={<AddIcon />} onClick={() => handleOpenModal()}>
            Criar Nova Empresa
        </Button>
      </Box>
      <Paper>
        <Table>
          <TableHead>
            <TableRow>
              <TableCell sx={{ fontWeight: 'bold' }}>Nome da Empresa</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>CNPJ</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Plano Atual</TableCell>
              <TableCell align="right" sx={{ fontWeight: 'bold' }}>AÃ§Ãµes</TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {tenants.map((tenant) => (
              <TableRow hover key={tenant.id}>
                <TableCell>{tenant.companyName}</TableCell>
                <TableCell>{tenant.cnpj}</TableCell>
                <TableCell>{tenant.plans ? tenant.plans.name : tenant.planId}</TableCell>
                <TableCell align="right">
                    {/* AQUI ESTÃ A MUDANÃ‡A: O botÃ£o agora Ã© um Link */}
                    <Button size="small" component={RouterLink} to={`/admin/tenant/${tenant.id}`}>
                      Gerenciar UsuÃ¡rios
                    </Button>
                    <IconButton size="small" onClick={() => handleOpenModal(tenant)}><EditIcon /></IconButton>
                    <IconButton size="small" onClick={() => handleOpenDialog(tenant)}><DeleteIcon color="error" /></IconButton>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </Paper>
      <Modal open={modalOpen} onClose={handleClose}>
        <Box sx={modalStyle}>
          <Typography variant="h6" gutterBottom>{selectedTenant ? 'Editar Empresa' : 'Criar Nova Empresa'}</Typography>
          <TextField name="companyName" label="Nome da Empresa" value={formData.companyName} onChange={handleChange} fullWidth margin="normal" required />
          <TextField name="cnpj" label="CNPJ" value={formData.cnpj} onChange={handleChange} fullWidth margin="normal" InputProps={{ inputComponent: CnpjMask }} />
          <FormControl fullWidth margin="normal" required>
            <InputLabel id="plan-select-label">Plano</InputLabel>
            <Select name="planId" labelId="plan-select-label" value={formData.planId} label="Plano" onChange={handleChange}>
              {plans.map(plan => (
                <MenuItem key={plan.id} value={plan.id}>{plan.name}</MenuItem>
              ))}
            </Select>
          </FormControl>
          <Box sx={{ mt: 3, display: 'flex', justifyContent: 'flex-end', gap: 1 }}>
            <Button onClick={handleClose} disabled={isSaving}>Cancelar</Button>
            <Button variant="contained" onClick={handleSubmit} disabled={isSaving}>
              {isSaving ? <CircularProgress size={24} /> : 'Salvar'}
            </Button>
          </Box>
        </Box>
      </Modal>
      <Dialog open={dialogOpen} onClose={handleClose}>
        <DialogTitle>Confirmar ExclusÃ£o</DialogTitle>
        <DialogContent><DialogContentText>VocÃª tem certeza que deseja excluir a empresa <strong>{selectedTenant?.companyName}</strong>? Esta aÃ§Ã£o Ã© irreversÃ­vel.</DialogContentText></DialogContent>
        <DialogActions>
          <Button onClick={handleClose} disabled={isSaving}>Cancelar</Button>
          <Button onClick={handleDelete} color="error" disabled={isSaving}>
            {isSaving ? <CircularProgress size={24} /> : 'Excluir'}
          </Button>
        </DialogActions>
      </Dialog>
    </>
  );
};

// Componente Principal da PÃ¡gina
const AdminPage = () => {
    const [tenants, setTenants] = useState([]);
    const [plans, setPlans] = useState([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState('');
    const [tabValue, setTabValue] = useState(0);
    const [feedback, setFeedback] = useState({ open: false, message: '', severity: 'success' });
    const [planModalOpen, setPlanModalOpen] = useState(false);
    const [selectedPlan, setSelectedPlan] = useState(null);
    const [planDialogOpen, setPlanDialogOpen] = useState(false);

    const fetchData = async () => {
        setLoading(true);
        try {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
            const response = await fetch('/api/admin?action=getTenantsAndPlans', {
                headers: { 'Authorization': `Bearer ${session.access_token}` },
            });
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || "NÃ£o foi possÃ­vel buscar os dados.");
            }
            const data = await response.json();
            setTenants(data.tenants || []);
            setPlans(data.plans || []);
        } catch (err) {
            console.error("Erro ao buscar dados de admin:", err);
            setError(err.message);
        } finally {
            setLoading(false);
        }
    };

    useEffect(() => {
        fetchData();
    }, []);

    const handleTabChange = (event, newValue) => { setTabValue(newValue); };

    const handleTenantUpdated = (updatedTenant) => {
      setTenants(prevTenants => prevTenants.map(t => 
        t.id === updatedTenant.id ? { ...t, ...updatedTenant, plans: plans.find(p => p.id === updatedTenant.planId) } : t
      ));
      setFeedback({ open: true, message: 'Empresa atualizada!', severity: 'success' });
    };
    const handleTenantCreated = (newTenant) => {
      setTenants(prevTenants => [
        ...prevTenants, 
        { ...newTenant, plans: plans.find(p => p.id === newTenant.planId) }
      ]);
      setFeedback({ open: true, message: 'Empresa criada!', severity: 'success' });
    };
    const handleTenantDeleted = (deletedTenantId) => {
      setTenants(prevTenants => prevTenants.filter(t => t.id !== deletedTenantId));
      setFeedback({ open: true, message: 'Empresa excluÃ­da!', severity: 'success' });
    };
    const handleOpenPlanModal = (plan = null) => {
      setSelectedPlan(plan);
      setPlanModalOpen(true);
    };
    const handleClosePlanModal = () => {
      setSelectedPlan(null);
      setPlanModalOpen(false);
    };
    const handleSavePlan = (savedPlan) => {
      if (selectedPlan) {
        setPlans(prev => prev.map(p => p.id === savedPlan.id ? savedPlan : p));
      } else {
        setPlans(prev => [...prev, savedPlan]);
      }
      setFeedback({ open: true, message: 'Plano salvo!', severity: 'success' });
    };
    const handleOpenPlanDialog = (plan) => {
      setSelectedPlan(plan);
      setPlanDialogOpen(true);
    };
    const handleClosePlanDialog = () => {
      setSelectedPlan(null);
      setPlanDialogOpen(false);
    };
    const handleDeletePlan = async () => {
      if (!selectedPlan) return;
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
        const response = await fetch('/api/admin', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
            body: JSON.stringify({ action: 'deletePlan', planId: selectedPlan.id })
        });
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || "Erro ao excluir.");
        }
        setPlans(prev => prev.filter(p => p.id !== selectedPlan.id));
        setFeedback({ open: true, message: 'Plano excluÃ­do!', severity: 'success' });
        handleClosePlanDialog();
      } catch (err) {
        console.error("Erro ao excluir plano:", err);
        setFeedback({ open: true, message: err.message, severity: 'error' });
      }
    };
    
    const renderContent = () => {
        if (loading) {
            return <Box sx={{ display: 'flex', justifyContent: 'center', my: 5 }}><CircularProgress /></Box>;
        }
        if (error) {
            return <Alert severity="error">{error}</Alert>;
        }
        return (
            <Box>
                <Box sx={{ borderBottom: 1, borderColor: 'divider' }}>
                    <Tabs value={tabValue} onChange={handleTabChange}>
                        <Tab label="Empresas (Tenants)" />
                        <Tab label="Planos" />
                    </Tabs>
                </Box>
                <Box hidden={tabValue !== 0}>
                    <TenantsTable 
                      tenants={tenants} 
                      plans={plans} 
                      onTenantUpdated={handleTenantUpdated}
                      onTenantCreated={handleTenantCreated}
                      onTenantDeleted={handleTenantDeleted}
                    />
                </Box>
                <Box hidden={tabValue !== 1}>
                    <PlansTable 
                      plans={plans} 
                      onAdd={() => handleOpenPlanModal()}
                      onEdit={(plan) => handleOpenPlanModal(plan)}
                      onDelete={(plan) => handleOpenPlanDialog(plan)}
                    />
                </Box>
            </Box>
        );
    };

    return (
        <Box>
            <AppBar position="static">
                <Toolbar>
                    <Typography variant="h6" component="div" sx={{ flexGrow: 1 }}>
                        Painel de AdministraÃ§Ã£o
                    </Typography>
                    <Button color="inherit" component={RouterLink} to="/">
                        Voltar para o App
                    </Button>
                </Toolbar>
            </AppBar>
            <Container sx={{ mt: 4 }}>
                <Typography variant="h4" component="h1" gutterBottom>
                    Gerenciamento do Sistema
                </Typography>
                {renderContent()}
            </Container>
            <PlanFormModal
              open={planModalOpen}
              onClose={handleClosePlanModal}
              plan={selectedPlan}
              onSave={handleSavePlan}
            />
            <Dialog open={planDialogOpen} onClose={handleClosePlanDialog}>
              <DialogTitle>Confirmar ExclusÃ£o</DialogTitle>
              <DialogContent>
                <DialogContentText>
                  VocÃª tem certeza que deseja excluir o plano <strong>{selectedPlan?.name}</strong>? Esta aÃ§Ã£o nÃ£o pode ser desfeita.
                </DialogContentText>
              </DialogContent>
              <DialogActions>
                <Button onClick={handleClosePlanDialog}>Cancelar</Button>
                <Button onClick={handleDeletePlan} color="error">Excluir</Button>
              </DialogActions>
            </Dialog>
            <Snackbar open={feedback.open} autoHideDuration={4000} onClose={() => setFeedback({open: false, message: ''})}>
                <Alert onClose={() => setFeedback({open: false, message: ''})} severity={feedback.severity || 'success'} sx={{ width: '100%' }}>
                  {feedback.message}
                </Alert>
            </Snackbar>
        </Box>
    );
};

export default AdminPage;

==================================================
ARQUIVO: src\pages\AdminTenantPage.jsx
==================================================
// src/pages/AdminTenantPage.jsx (VERSÃƒO FINAL E CORRIGIDA)
import React, { useState, useEffect } from 'react';
import { useParams, Link as RouterLink } from 'react-router-dom';
import { supabase } from '../supabase/client';
import { 
    Container, Typography, Box, AppBar, Toolbar, Button, CircularProgress, 
    Alert, Paper, Table, TableHead, TableRow, TableCell, TableBody,
    Modal, TextField, Checkbox, FormControlLabel, Snackbar,
    Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, IconButton
} from '@mui/material';
import AddIcon from '@mui/icons-material/Add';
import EditIcon from '@mui/icons-material/Edit';
import DeleteIcon from '@mui/icons-material/Delete';

// Estilo para o Modal
const modalStyle = {
  position: 'absolute',
  top: '50%',
  left: '50%',
  transform: 'translate(-50%, -50%)',
  width: 500,
  bgcolor: 'background.paper',
  boxShadow: 24,
  p: 4,
};

// Componente do FormulÃ¡rio de UsuÃ¡rio
const UserFormModal = ({ open, onClose, user, tenantId, onSave }) => {
  const [formData, setFormData] = useState({ email: '', password: '', name: '', role: 'rh', isAdmin: false });
  const [isSaving, setIsSaving] = useState(false);
  const [error, setError] = useState('');
  const isEditMode = Boolean(user);

  useEffect(() => {
    if (user) {
      setFormData({ 
        name: user.name, 
        role: user.role, 
        isAdmin: user.isAdmin,
        email: user.email || '', // O email nÃ£o pode ser editado
      });
    } else {
      setFormData({ email: '', password: '', name: '', role: 'rh', isAdmin: false });
    }
  }, [user, open]);

  const handleChange = (e) => {
    const { name, value, type, checked } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: type === 'checkbox' ? checked : value
    }));
  };

  const handleSubmit = async () => {
    setIsSaving(true);
    setError('');
    try {
      const action = isEditMode ? 'updateUser' : 'createUser';
      // No modo de ediÃ§Ã£o, nÃ£o enviamos email/senha/tenantId
      const body = isEditMode 
        ? { action, userId: user.id, name: formData.name, role: formData.role, isAdmin: formData.isAdmin }
        : { action, ...formData, tenantId: tenantId };
      
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
      
      const response = await fetch('/api/admin', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
          body: JSON.stringify(body)
      });
      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || "Ocorreu um erro.");
      }
      const data = await response.json();
      onSave(isEditMode ? data.updatedUser : data.newUser);
      onClose();
    } catch (err) {
      setError(err.message);
    } finally {
      setIsSaving(false);
    }
  };

  return (
    <Modal open={open} onClose={onClose}>
      <Box sx={modalStyle}>
        <Typography variant="h6" gutterBottom>{isEditMode ? 'Editar UsuÃ¡rio' : 'Criar Novo UsuÃ¡rio'}</Typography>
        <TextField name="email" label="Email do UsuÃ¡rio" value={formData.email} onChange={handleChange} fullWidth margin="normal" required disabled={isEditMode} />
        {!isEditMode && (
          <TextField name="password" label="Senha ProvisÃ³ria" type="password" value={formData.password} onChange={handleChange} fullWidth margin="normal" required />
        )}
        <TextField name="name" label="Nome Completo" value={formData.name} onChange={handleChange} fullWidth margin="normal" required />
        <TextField name="role" label="FunÃ§Ã£o (ex: rh, gestor)" value={formData.role} onChange={handleChange} fullWidth margin="normal" required />
        <FormControlLabel
          control={<Checkbox name="isAdmin" checked={formData.isAdmin} onChange={handleChange} />}
          label="Este usuÃ¡rio Ã© Administrador?"
        />
        {error && <Alert severity="error" sx={{ mt: 2 }}>{error}</Alert>}
        <Box sx={{ mt: 3, display: 'flex', justifyContent: 'flex-end', gap: 1 }}>
          <Button onClick={onClose} disabled={isSaving}>Cancelar</Button>
          <Button variant="contained" onClick={handleSubmit} disabled={isSaving}>
            {isSaving ? <CircularProgress size={24} /> : 'Salvar'}
          </Button>
        </Box>
      </Box>
    </Modal>
  );
};


const AdminTenantPage = () => {
    const { tenantId } = useParams();
    const [tenant, setTenant] = useState(null);
    const [users, setUsers] = useState([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState('');
    const [modalOpen, setModalOpen] = useState(false);
    const [dialogOpen, setDialogOpen] = useState(false);
    const [selectedUser, setSelectedUser] = useState(null);
    const [feedback, setFeedback] = useState({ open: false, message: '', severity: 'success' });

    const fetchTenantDetails = async () => {
        setLoading(true);
        try {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
            const response = await fetch(`/api/admin?action=getTenantDetails&tenantId=${tenantId}`, {
                headers: { 'Authorization': `Bearer ${session.access_token}` },
            });
            if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error || "NÃ£o foi possÃ­vel buscar os dados."); }
            const data = await response.json();
            setTenant(data.tenant || null);
            setUsers(data.users || []);
        } catch (err) {
            console.error("Erro ao buscar detalhes do tenant:", err);
            setError(err.message);
        } finally {
            setLoading(false);
        }
    };

    useEffect(() => {
        fetchTenantDetails();
    }, [tenantId]);

    const handleOpenModal = (user = null) => {
      setSelectedUser(user);
      setModalOpen(true);
    };
    const handleCloseModal = () => {
      setSelectedUser(null);
      setModalOpen(false);
    };
    const handleOpenDialog = (user) => {
      setSelectedUser(user);
      setDialogOpen(true);
    };
    const handleCloseDialog = () => {
      setSelectedUser(null);
      setDialogOpen(false);
    };

    const handleSaveUser = (savedUser) => {
      if (selectedUser) {
        setUsers(prev => prev.map(u => u.id === savedUser.id ? savedUser : u));
      } else {
        setUsers(prev => [...prev, savedUser]);
      }
      setFeedback({ open: true, message: 'UsuÃ¡rio salvo!', severity: 'success' });
    };

    const handleDeleteUser = async () => {
      if (!selectedUser) return;
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
        
        const response = await fetch('/api/admin', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
            body: JSON.stringify({ action: 'deleteUser', userId: selectedUser.id })
        });
        if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error || "Erro ao excluir."); }
        
        setUsers(prev => prev.filter(u => u.id !== selectedUser.id));
        setFeedback({ open: true, message: 'UsuÃ¡rio excluÃ­do!', severity: 'success' });
        handleCloseDialog();
      } catch (err) {
        console.error("Erro ao excluir usuÃ¡rio:", err);
        setFeedback({ open: true, message: err.message, severity: 'error' });
      }
    };

    const renderContent = () => {
        if (loading) {
            return <Box sx={{ display: 'flex', justifyContent: 'center', my: 5 }}><CircularProgress /></Box>;
        }
        if (error) {
            return <Alert severity="error">{error}</Alert>;
        }
        if (!tenant) {
             return <Alert severity="warning">Empresa nÃ£o encontrada.</Alert>;
        }
        return (
            <Paper sx={{ mt: 3 }}>
                <Table>
                    <TableHead>
                        <TableRow>
                            <TableCell sx={{ fontWeight: 'bold' }}>Nome do UsuÃ¡rio</TableCell>
                            <TableCell sx={{ fontWeight: 'bold' }}>FunÃ§Ã£o</TableCell>
                            <TableCell align="center" sx={{ fontWeight: 'bold' }}>Ã‰ Admin?</TableCell>
                            <TableCell align="right" sx={{ fontWeight: 'bold' }}>AÃ§Ãµes</TableCell>
                        </TableRow>
                    </TableHead>
                    <TableBody>
                        {users.map((user) => (
                            <TableRow hover key={user.id}>
                                <TableCell>{user.name}</TableCell>
                                <TableCell>{user.role}</TableCell>
                                <TableCell align="center">{user.isAdmin ? 'Sim' : 'NÃ£o'}</TableCell>
                                <TableCell align="right">
                                    <IconButton size="small" onClick={() => handleOpenModal(user)}><EditIcon /></IconButton>
                                    <IconButton size="small" onClick={() => handleOpenDialog(user)}><DeleteIcon color="error" /></IconButton>
                                </TableCell>
                            </TableRow>
                        ))}
                    </TableBody>
                </Table>
            </Paper>
        );
    };

    return (
        <Box>
            <AppBar position="static">
                <Toolbar>
                    <Typography variant="h6" component="div" sx={{ flexGrow: 1 }}>
                        {tenant ? `Gerenciar: ${tenant.companyName}` : 'Carregando Empresa...'}
                    </Typography>
                    <Button color="inherit" component={RouterLink} to="/admin">
                        Voltar para Admin
                    </Button>
                </Toolbar>
            </AppBar>
            <Container sx={{ mt: 4 }}>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>
                    <Typography variant="h4" component="h1" gutterBottom>
                        Gerenciamento de UsuÃ¡rios
                    </Typography>
                    <Button variant="contained" startIcon={<AddIcon />} onClick={() => handleOpenModal()}>
                        Criar UsuÃ¡rio
                    </Button>
                </Box>
                {renderContent()}
            </Container>
            <UserFormModal
                open={modalOpen}
                onClose={handleCloseModal}
                user={selectedUser}
                tenantId={tenantId}
                onSave={handleSaveUser}
            />
            <Dialog open={dialogOpen} onClose={handleCloseDialog}>
                <DialogTitle>Confirmar ExclusÃ£o</DialogTitle>
                <DialogContent>
                    <DialogContentText>
                        VocÃª tem certeza que deseja excluir o usuÃ¡rio <strong>{selectedUser?.name}</strong>? Esta aÃ§Ã£o Ã© irreversÃ­vel.
                    </DialogContentText>
                </DialogContent>
                <DialogActions>
                    <Button onClick={handleCloseDialog}>Cancelar</Button>
                    <Button onClick={handleDeleteUser} color="error">Excluir</Button>
                </DialogActions>
            </Dialog>
            <Snackbar open={feedback.open} autoHideDuration={4000} onClose={() => setFeedback({open: false, message: ''})}>
                <Alert onClose={() => setFeedback({open: false, message: ''})} severity={feedback.severity || 'success'} sx={{ width: '100%' }}>
                  {feedback.message}
                </Alert>
            </Snackbar>
        </Box>
    );
};

export default AdminTenantPage;

==================================================
ARQUIVO: src\pages\ApplicationDetails.jsx
==================================================
// src/pages/ApplicationDetails.jsx (VERSÃƒO FINAL, COMPLETA E CORRIGIDA)
import EvaluationDashboardV2 from '../components/evaluation_v2/EvaluationDashboardV2';
import { useAuth } from '../context/AuthContext'; // Para pegar o usuÃ¡rio logado
import React, { useState, useEffect } from 'react';
import { useParams, Link as RouterLink } from 'react-router-dom';
import { supabase } from '../supabase/client';
// Importa as funÃ§Ãµes centralizadas
import { formatUrl, formatPhone, formatDate } from '../utils/formatters';
import { 
    Container, Typography, Box, AppBar, Toolbar, Button, CircularProgress, 
    Alert, Paper, Grid, Link, Divider, List, ListItem, ListItemText,
    FormControl, InputLabel, Select, MenuItem, TextField, Snackbar
} from '@mui/material';
import AddCircleOutlineIcon from '@mui/icons-material/AddCircleOutline';
import DeleteIcon from '@mui/icons-material/Delete';
import ContentCopyIcon from '@mui/icons-material/ContentCopy';

// O componente de seÃ§Ã£o de parÃ¢metros, que jÃ¡ estÃ¡ estÃ¡vel.
// NOTE: Este componente nÃ£o existe neste arquivo, ele estÃ¡ no JobDetails.jsx
// Removendo-o daqui para evitar confusÃ£o, jÃ¡ que ele nÃ£o Ã© usado aqui.

// O componente de seÃ§Ã£o de avaliaÃ§Ã£o, com a lÃ³gica de ID Ãºnico que vocÃª sugeriu.
const EvaluationSection = ({ title, criteria = [], notes = [], evaluationData = {}, onEvaluationChange, onNotesChange }) => {
  return (
    <Paper variant="outlined" sx={{ p: 2, mt: 2 }}>
      <Typography variant="h6" sx={{textTransform: 'capitalize'}}>{title}</Typography>
      {criteria.map((criterion) => (
        <Box key={`${title}-${criterion.name}`} sx={{ mt: 2 }}>
          <FormControl fullWidth>
            <InputLabel>{criterion.name} (Peso: {criterion.weight}%)</InputLabel>
            <Select
              value={evaluationData[criterion.name] || ''}
              label={`${criterion.name} (Peso: ${criterion.weight}%)`}
              onChange={(e) => onEvaluationChange(title.toLowerCase(), criterion.name, e.target.value)}
              variant="standard"
            >
              {notes.map((note) => (
                <MenuItem key={note.id} value={note.id}>{note.nome} ({note.valor})</MenuItem>
              ))}
            </Select>
          </FormControl>
        </Box>
      ))}
      <TextField
        label="AnotaÃ§Ãµes"
        multiline
        rows={3}
        fullWidth
        variant="standard"
        sx={{ mt: 2 }}
        value={evaluationData.anotacoes || ''}
        onChange={(e) => onNotesChange(title.toLowerCase(), e.target.value)}
      />
    </Paper>
  );
};

// O componente principal, com a lÃ³gica de estado e carregamento CORRIGIDA.
const ApplicationDetails = () => {
  const { jobId, applicationId } = useParams();
  const [application, setApplication] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState('');
  const [resumeUrl, setResumeUrl] = useState('');
  const [evaluation, setEvaluation] = useState(null); // Corrigido: Inicia como nulo
  const [isSaving, setIsSaving] = useState(false);
  const [feedback, setFeedback] = useState({ open: false, message: '', severity: 'success' });
  
  useEffect(() => {
    const fetchDetails = async () => {
      if (!applicationId) { setError("ID da candidatura nÃ£o encontrado."); setLoading(false); return; }
      setLoading(true);
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
        const appResponse = await fetch(`/api/getApplicationDetails?applicationId=${applicationId}`, { headers: { 'Authorization': `Bearer ${session.access_token}` } });
        if (!appResponse.ok) { const errorData = await appResponse.json(); throw new Error(errorData.error || "NÃ£o foi possÃ­vel buscar os detalhes."); }
        const appData = await appResponse.json();
        
        if (appData.application) {
          setApplication(appData.application);

          // CORREÃ‡ÃƒO: LÃ³gica robusta para carregar a avaliaÃ§Ã£o salva ou criar uma estrutura vazia.
          const savedEvaluation = appData.application.evaluation;
          setEvaluation({
            triagem: savedEvaluation?.triagem || {},
            cultura: savedEvaluation?.cultura || {},
            tÃ©cnico: savedEvaluation?.tÃ©cnico || {},
          });

          const filePath = appData.application.resumeUrl;
          if (filePath) {
            const urlResponse = await fetch(`/api/getResumeSignedUrl?filePath=${filePath}`, { headers: { 'Authorization': `Bearer ${session.access_token}` } });
            if (!urlResponse.ok) { throw new Error("NÃ£o foi possÃ­vel gerar o link do currÃ­culo."); }
            const urlData = await urlResponse.json();
            setResumeUrl(urlData.signedUrl);
          }
        } else { throw new Error("Dados da candidatura recebidos sÃ£o invÃ¡lidos."); }
      } catch (err) { console.error("Erro ao carregar detalhes:", err); setError(err.message); } 
      finally { setLoading(false); }
    };
    fetchDetails();
  }, [applicationId]);
  
  const handleEvaluationChange = (section, criterionName, noteId) => {
    setEvaluation(prevEval => ({ ...prevEval, [section]: { ...prevEval[section], [criterionName]: noteId } }));
  };
  const handleNotesChange = (section, text) => {
    setEvaluation(prevEval => ({ ...prevEval, [section]: { ...prevEval[section], anotacoes: text } }));
  };
  const handleCloseFeedback = (event, reason) => {
    if (reason === 'clickaway') {
      return;
    }
    setFeedback({ open: false, message: '' });
  };

  const handleSaveEvaluation = async () => {
    setIsSaving(true);
    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) throw new Error("VocÃª nÃ£o estÃ¡ autenticado.");
      const response = await fetch('/api/saveEvaluation', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
        body: JSON.stringify({ applicationId: applicationId, evaluation: evaluation }),
      });
      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || "NÃ£o foi possÃ­vel salvar a avaliaÃ§Ã£o.");
      }
      setFeedback({ open: true, message: 'AvaliaÃ§Ã£o salva com sucesso!', severity: 'success' });
    } catch (err) {
      console.error("Erro ao salvar avaliaÃ§Ã£o:", err);
      setFeedback({ open: true, message: err.message, severity: 'error' });
    } finally {
      setIsSaving(false);
    }
  };
  
  const renderContent = () => {
    if (loading) { return <Box sx={{ display: 'flex', justifyContent: 'center', my: 5 }}><CircularProgress /></Box>; }
    if (error) { return <Alert severity="error">{error}</Alert>; }
    if (application && evaluation) {
      const { candidate, job, formData } = application;
      const displayFields = [
        { key: 'preferredName', label: 'Como prefere ser chamado(a)?' }, { key: 'birthDate', label: 'Data de Nascimento', format: formatDate },
        { key: 'state', label: 'Estado' }, { key: 'city', label: 'Cidade' },
        { key: 'hasGraduated', label: 'Concluiu curso superior?', format: (val) => val === 'sim' ? 'Sim, jÃ¡ concluÃ­' : 'NÃ£o, estou cursando' },
        { key: 'studyPeriod', label: 'PerÃ­odo que estuda' }, { key: 'course', label: 'Curso' },
        { key: 'institution', label: 'InstituiÃ§Ã£o' }, { key: 'completionYear', label: 'Ano de ConclusÃ£o' },
        { key: 'englishLevel', label: 'NÃ­vel de InglÃªs' }, { key: 'spanishLevel', label: 'NÃ­vel de Espanhol' },
        { key: 'source', label: 'Como soube da vaga?' }, { key: 'motivation', label: 'MotivaÃ§Ã£o' },
      ];

      return (
        <Grid container spacing={3}>
          <Grid item xs={12} md={4}>
            <Paper sx={{ p: 2, height: '100%' }}>
              <Typography variant="h5" gutterBottom>{candidate.name}</Typography>
              <Typography variant="body1" sx={{ wordBreak: 'break-all' }}><strong>E-mail:</strong> {candidate.email}</Typography>
              <Typography variant="body1"><strong>Telefone:</strong> {formatPhone(formData.phone)}</Typography>
              <Divider sx={{ my: 2 }} />
              {formData.linkedinProfile && <Link href={formatUrl(formData.linkedinProfile)} target="_blank" rel="noopener" display="block">Perfil no LinkedIn</Link>}
              {formData.githubProfile && <Link href={formatUrl(formData.githubProfile)} target="_blank" rel="noopener" display="block">Perfil no GitHub</Link>}
              <Box mt={2}><Button variant="contained" href={resumeUrl} target="_blank" disabled={!resumeUrl}> Ver CurrÃ­culo </Button></Box>
            </Paper>
          </Grid>
          <Grid item xs={12} md={8}>
            <Paper sx={{ p: 2, height: '100%' }}>
              <Typography variant="h6" gutterBottom>Respostas do FormulÃ¡rio</Typography>
              <Grid container spacing={2}>
                {displayFields.map((field) => {
                  const value = formData[field.key];
                  if (value) {
                    return (
                      <Grid item xs={12} sm={6} key={field.key}>
                        <Typography variant="caption" color="text.secondary" sx={{ display: 'block' }}>{field.label}</Typography>
                        <Typography variant="body1">{field.format ? field.format(value) : (value || 'NÃ£o informado')}</Typography>
                      </Grid>
                    );
                  }
                  return null;
                })}
              </Grid>
            </Paper>
          </Grid>
          <Grid item xs={12}>
             <Paper sx={{ p: 2, mt: 2 }}>
                <Typography variant="h5" gutterBottom>AvaliaÃ§Ã£o</Typography>
                <EvaluationSection title="Triagem" criteria={job.parameters.triagem} notes={job.parameters.notas} evaluationData={evaluation.triagem} onEvaluationChange={handleEvaluationChange} onNotesChange={handleNotesChange} />
                <EvaluationSection title="Cultura" criteria={job.parameters.cultura} notes={job.parameters.notas} evaluationData={evaluation.cultura} onEvaluationChange={handleEvaluationChange} onNotesChange={handleNotesChange} />
                <EvaluationSection title="TÃ©cnico" criteria={job.parameters.tÃ©cnico} notes={job.parameters.notas} evaluationData={evaluation.tÃ©cnico} onEvaluationChange={handleEvaluationChange} onNotesChange={handleNotesChange} />
                <Box sx={{ mt: 3, display: 'flex', justifyContent: 'flex-end' }}>
                  <Button variant="contained" size="large" onClick={handleSaveEvaluation} disabled={isSaving}>
                    {isSaving ? <CircularProgress size={24} color="inherit"/> : 'Salvar AvaliaÃ§Ã£o'}
                  </Button>
                </Box>
              </Paper>
           </Grid>
        </Grid>
      );
    }
    return null;
  };
  
  return (
    <Box>
      <AppBar position="static">
        <Toolbar>
          <Typography variant="h6" component="div" sx={{ flexGrow: 1 }}>
            {application ? `Candidato: ${application.candidate.name}` : 'Carregando Candidatura...'}
          </Typography>
          <Button color="inherit" component={RouterLink} to={`/vaga/${jobId}`}> Voltar para a Vaga </Button>
        </Toolbar>
      </AppBar>
      <Container sx={{ mt: 4 }}>
        {renderContent()}
      </Container>
      <Snackbar open={feedback.open} autoHideDuration={4000} onClose={handleCloseFeedback}>
        <Alert onClose={handleCloseFeedback} severity={feedback.severity} sx={{ width: '100%' }}>
          {feedback.message}
        </Alert>
      </Snackbar>
    </Box>
  );
};

export default ApplicationDetails;

==================================================
ARQUIVO: src\pages\ApplyPage.jsx
==================================================
import React, { useState, useEffect } from 'react';
import { useParams } from 'react-router-dom';
import { Button } from '../components/ui/button';
import { Input } from '../components/ui/input';
import { Textarea } from '../components/ui/textarea';
import { Label } from '../components/ui/label';
import StateSelect from '../components/inputs/StateSelect';
import { Loader2, UploadCloud, CheckCircle, AlertCircle } from 'lucide-react';

const ApplyPage = () => {
  // CORREÃ‡ÃƒO AQUI: O Router passa 'id', nÃ£o 'jobId'
  const { id } = useParams(); 
  // Para facilitar, vamos renomear internamente para jobId
  const jobId = id;

  // Estados de controle
  const [jobTitle, setJobTitle] = useState('');
  const [isVagaClosed, setIsVagaClosed] = useState(false);
  const [loadingPage, setLoadingPage] = useState(true);
  const [errorPage, setErrorPage] = useState('');

  // FormulÃ¡rio
  const [formState, setFormState] = useState({
    name: '', preferredName: '', email: '', phone: '', birthDate: '',
    state: '', city: '', hasGraduated: '', studyPeriod: '', course: '',
    institution: '', completionYear: '', englishLevel: '', spanishLevel: '',
    source: '', motivation: '', linkedinProfile: '', githubProfile: ''
  });
  
  const [resumeFile, setResumeFile] = useState(null);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [feedback, setFeedback] = useState({ type: '', message: '' });

  useEffect(() => {
    const fetchJobData = async () => {
      if (!jobId) {
        setErrorPage('ID da vaga nÃ£o especificado.');
        setLoadingPage(false);
        return;
      }
      try {
        const response = await fetch(`/api/getPublicJobData?id=${jobId}`);
        if (!response.ok) throw new Error('Vaga nÃ£o encontrada.');
        const data = await response.json();
        
        if (data.job) {
          if (data.job.planId === 'freemium' && data.job.candidateCount >= 3) {
            setIsVagaClosed(true);
          }
          setJobTitle(data.job.title);
        } else {
            throw new Error('Dados da vaga nÃ£o encontrados.');
        }
      } catch (error) {
        setErrorPage(error.message);
      } finally {
        setLoadingPage(false);
      }
    };
    fetchJobData();
  }, [jobId]);

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormState(prev => ({ ...prev, [name]: value }));
  };

  const handleFileChange = (e) => {
    if (e.target.files && e.target.files.length > 0) {
      setResumeFile(e.target.files[0]);
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setIsSubmitting(true);
    setFeedback({ type: '', message: '' });

    if (!resumeFile) {
      setFeedback({ type: 'error', message: 'Por favor, anexe seu currÃ­culo.' });
      setIsSubmitting(false);
      return;
    }

    const formData = new FormData();
    formData.append('jobId', jobId);
    
    Object.keys(formState).forEach(key => {
        if (formState[key]) formData.append(key, formState[key]);
    });
    
    formData.append('resume', resumeFile);

    try {
      const response = await fetch('/api/apply', { method: 'POST', body: formData });
      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || 'Erro ao enviar candidatura.');
      }
      setFeedback({ type: 'success', message: 'Candidatura enviada com sucesso!' });
    } catch (error) {
      setFeedback({ type: 'error', message: error.message });
    } finally {
      setIsSubmitting(false);
    }
  };

  if (loadingPage) return <div className="flex justify-center my-20"><Loader2 className="w-8 h-8 animate-spin text-blue-600"/></div>;
  
  if (errorPage) return <div className="max-w-md mx-auto mt-10 p-4 bg-red-50 text-red-700 rounded border border-red-200">{errorPage}</div>;
  
  if (feedback.type === 'success') {
    return (
        <div className="max-w-md mx-auto mt-20 text-center p-8 bg-green-50 rounded-lg border border-green-100">
            <CheckCircle className="w-16 h-16 text-green-500 mx-auto mb-4" />
            <h1 className="text-2xl font-bold text-green-800 mb-2">Sucesso!</h1>
            <p className="text-green-700">{feedback.message}</p>
        </div>
    );
  }
  
  if (isVagaClosed) {
    return (
        <div className="max-w-md mx-auto mt-20 text-center p-8 bg-yellow-50 rounded-lg border border-yellow-100">
            <AlertCircle className="w-16 h-16 text-yellow-500 mx-auto mb-4" />
            <h1 className="text-2xl font-bold text-yellow-800 mb-2">Vaga Encerrada</h1>
            <p className="text-yellow-700">Esta vaga jÃ¡ atingiu o limite de candidaturas.</p>
        </div>
    );
  }

  return (
    <div className="max-w-3xl mx-auto px-4 py-10">
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-gray-900">Candidatura Ã  Vaga</h1>
        <p className="text-lg text-blue-600 font-medium mt-1">{jobTitle}</p>
      </div>
      
      <form onSubmit={handleSubmit} className="space-y-6 bg-white p-6 md:p-8 rounded-xl shadow-sm border border-gray-100">
        
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <Label htmlFor="name">Nome Completo</Label>
                <Input name="name" id="name" required onChange={handleInputChange} />
            </div>
            <div>
                <Label htmlFor="preferredName">Nome Social / Como prefere ser chamado</Label>
                <Input name="preferredName" id="preferredName" onChange={handleInputChange} />
            </div>
            
            <div>
                <Label htmlFor="email">E-mail</Label>
                <Input name="email" id="email" type="email" required onChange={handleInputChange} />
            </div>
            <div>
                <Label htmlFor="phone">Telefone (Celular)</Label>
                <Input name="phone" id="phone" type="tel" required onChange={handleInputChange} />
            </div>
            
            <div>
                <Label htmlFor="birthDate">Data de Nascimento</Label>
                <Input name="birthDate" id="birthDate" type="date" required value={formState.birthDate} onChange={handleInputChange} />
            </div>
        </div>

        <StateSelect value={formState.state} onChange={handleInputChange} />
        
        <div>
            <Label htmlFor="city">Cidade</Label>
            <Input name="city" id="city" required onChange={handleInputChange} />
        </div>

        <div className="p-4 bg-gray-50 rounded-lg border border-gray-200">
            <Label className="mb-3">VocÃª jÃ¡ concluiu curso superior?</Label>
            <div className="flex gap-6">
                <label className="flex items-center gap-2 cursor-pointer">
                    <input type="radio" name="hasGraduated" value="sim" onChange={handleInputChange} className="w-4 h-4 text-blue-600" />
                    <span className="text-sm text-gray-700">Sim, jÃ¡ concluÃ­</span>
                </label>
                <label className="flex items-center gap-2 cursor-pointer">
                    <input type="radio" name="hasGraduated" value="nao" onChange={handleInputChange} className="w-4 h-4 text-blue-600" />
                    <span className="text-sm text-gray-700">NÃ£o, estou cursando</span>
                </label>
            </div>
        </div>

        {formState.hasGraduated === 'nao' && (
             <div><Label>PerÃ­odo/Ano</Label><Input name="studyPeriod" onChange={handleInputChange} /></div>
        )}
        
        {formState.hasGraduated && (
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div><Label>Curso</Label><Input name="course" required onChange={handleInputChange} /></div>
                <div><Label>InstituiÃ§Ã£o</Label><Input name="institution" required onChange={handleInputChange} /></div>
                {formState.hasGraduated === 'sim' && ( 
                     <div><Label>Ano de ConclusÃ£o</Label><Input name="completionYear" type="number" onChange={handleInputChange} /></div>
                )}
            </div>
        )}

        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            {['englishLevel', 'spanishLevel'].map(lang => (
                <div key={lang}>
                    <Label>{lang === 'englishLevel' ? 'InglÃªs' : 'Espanhol'}</Label>
                    <select name={lang} onChange={handleInputChange} className="flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm">
                        <option value="">Selecione...</option>
                        <option value="basico">BÃ¡sico</option>
                        <option value="intermediario">IntermediÃ¡rio</option>
                        <option value="avancado">AvanÃ§ado</option>
                        <option value="fluente">Fluente/Nativo</option>
                    </select>
                </div>
            ))}
        </div>

        <div>
            <Label htmlFor="motivation">Por que vocÃª deseja esta vaga?</Label>
            <Textarea name="motivation" id="motivation" required rows={4} onChange={handleInputChange} />
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div><Label>LinkedIn (Opcional)</Label><Input name="linkedinProfile" onChange={handleInputChange} /></div>
            <div><Label>GitHub (Opcional)</Label><Input name="githubProfile" onChange={handleInputChange} /></div>
        </div>

        <div className="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:bg-gray-50 transition-colors">
            <Label htmlFor="resume" className="cursor-pointer">
                <div className="flex flex-col items-center gap-2">
                    <UploadCloud className="w-8 h-8 text-gray-400" />
                    <span className="text-sm font-medium text-blue-600">Clique para enviar seu currÃ­culo (PDF/DOC)</span>
                    {resumeFile && <span className="text-xs text-green-600 font-bold">Arquivo selecionado: {resumeFile.name}</span>}
                </div>
                <input id="resume" type="file" hidden required accept=".pdf,.doc,.docx" onChange={handleFileChange} />
            </Label>
        </div>

        {feedback.type === 'error' && <div className="text-red-600 text-sm bg-red-50 p-3 rounded">{feedback.message}</div>}

        <Button type="submit" className="w-full" size="lg" disabled={isSubmitting}>
            {isSubmitting ? <><Loader2 className="w-4 h-4 mr-2 animate-spin"/> Enviando...</> : 'Enviar Candidatura'}
        </Button>
      </form>
    </div>
  );
};

export default ApplyPage;

==================================================
ARQUIVO: src\pages\Candidates.jsx
==================================================
export default function Candidates() {
  return (
    <div className="p-8">
      <h1 className="text-2xl font-bold mb-4">Banco de Talentos</h1>
      <p>PÃ¡gina em construÃ§Ã£o. Aqui aparecerÃ£o todos os candidatos.</p>
    </div>
  );
}

==================================================
ARQUIVO: src\pages\CompanySettings.jsx
==================================================
export default function CompanySettings() {
  return (
    <div className="p-8">
      <h1 className="text-2xl font-bold mb-4">ConfiguraÃ§Ãµes da Empresa</h1>
      <p>PÃ¡gina em construÃ§Ã£o.</p>
    </div>
  );
}

==================================================
ARQUIVO: src\pages\Dashboard.jsx
==================================================
import React, { useState, useEffect, useMemo } from 'react';
import { useNavigate } from 'react-router-dom';
import { supabase } from '../supabase/client';
import { useAuth } from '../context/AuthContext';
import { formatStatus } from '../utils/formatters';
import { Button } from '../components/ui/button';
import { Card, CardHeader, CardTitle, CardContent } from '../components/ui/card';
import { Badge } from '../components/ui/badge';
import { Plus, Loader2, Users, Briefcase, Building2, Crown, User, Filter } from 'lucide-react';
import CreateJobModal from '../components/jobs/CreateJobModal';

const Dashboard = () => {
    const navigate = useNavigate();
    const { currentUser } = useAuth();
    
    const [jobs, setJobs] = useState([]);
    const [meta, setMeta] = useState({ companyName: '', userName: '', planId: '' });
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState('');
    const [openCreateModal, setOpenCreateModal] = useState(false);
    
    // Filtros
    const [statusFilter, setStatusFilter] = useState('active');
    const [deptFilter, setDeptFilter] = useState('all');

    const fetchData = async () => {
        setLoading(true);
        try {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) return; // AuthContext redireciona

            const response = await fetch('/api/jobs', { 
                headers: { 'Authorization': `Bearer ${session.access_token}` } 
            });

            if (!response.ok) throw new Error('Falha ao carregar dados.');
            
            const data = await response.json();
            setJobs(data.jobs || []);
            setMeta(data.meta || {});
        } catch (err) {
            console.error(err);
            setError(err.message);
        } finally {
            setLoading(false);
        }
    };

    useEffect(() => { if (currentUser) fetchData(); }, [currentUser]);

    // Extrai departamentos Ãºnicos das vagas carregadas
    const uniqueDepartments = useMemo(() => {
        return [...new Set(jobs.map(j => j.deptName))].sort();
    }, [jobs]);

    const processedJobs = useMemo(() => {
        return jobs.filter(job => {
            const matchStatus = statusFilter === 'all' || job.status === statusFilter;
            const matchDept = deptFilter === 'all' || job.deptName === deptFilter;
            return matchStatus && matchDept;
        });
    }, [jobs, statusFilter, deptFilter]);

    // KPIs
    const activeJobs = jobs.filter(j => j.status === 'active');
    const totalCandidates = jobs.reduce((acc, j) => acc + (j.candidateCount || 0), 0);
    const avgCandidates = activeJobs.length ? (totalCandidates / activeJobs.length).toFixed(1) : 0;

    return (
        <div className="space-y-6">
            {/* Header */}
            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 bg-white p-6 rounded-lg border shadow-sm">
                <div>
                    <div className="flex items-center gap-2 mb-1">
                        <Building2 className="w-5 h-5 text-gray-400" />
                        <h1 className="text-2xl font-bold text-gray-900">
                            {loading ? 'Carregando...' : meta.companyName}
                        </h1>
                        <span className="text-gray-300 mx-2">|</span>
                        <div className="flex items-center gap-2 text-gray-600">
                            <User className="w-4 h-4" /> {meta.userName}
                        </div>
                    </div>
                    <div className="flex items-center gap-2 text-sm text-gray-500 mt-2">
                        <span className="font-semibold text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full capitalize flex items-center">
                            <Crown className="w-3 h-3 mr-1" /> Plano {meta.planId}
                        </span>
                    </div>
                </div>
                <Button onClick={() => setOpenCreateModal(true)}>
                    <Plus className="mr-2 h-4 w-4" /> Nova Vaga
                </Button>
            </div>

            {/* KPIs */}
            <div className="grid gap-4 md:grid-cols-3">
                <Card>
                    <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                        <CardTitle className="text-sm font-medium">Vagas Ativas</CardTitle>
                        <Briefcase className="h-4 w-4 text-gray-500" />
                    </CardHeader>
                    <CardContent><div className="text-2xl font-bold">{activeJobs.length}</div></CardContent>
                </Card>
                <Card>
                    <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                        <CardTitle className="text-sm font-medium">Candidatos / Vaga</CardTitle>
                        <Users className="h-4 w-4 text-gray-500" />
                    </CardHeader>
                    <CardContent>
                        <div className="text-2xl font-bold">{avgCandidates}</div>
                        <p className="text-xs text-gray-500 mt-1">MÃ©dia</p>
                    </CardContent>
                </Card>
                <Card>
                    <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                        <CardTitle className="text-sm font-medium">Total Candidatos</CardTitle>
                        <div className="h-4 w-4 text-gray-500">ðŸ“„</div>
                    </CardHeader>
                    <CardContent><div className="text-2xl font-bold">{totalCandidates}</div></CardContent>
                </Card>
            </div>

            {/* Lista de Vagas */}
            <Card>
                <CardHeader>
                    <div className="flex flex-col sm:flex-row justify-between gap-4">
                        <CardTitle>Painel de Vagas</CardTitle>
                        <div className="flex gap-2">
                            <select 
                                className="h-9 rounded-md border border-gray-300 text-sm px-3 bg-white"
                                value={deptFilter}
                                onChange={(e) => setDeptFilter(e.target.value)}
                            >
                                <option value="all">Todos Departamentos</option>
                                {uniqueDepartments.map(d => <option key={d} value={d}>{d}</option>)}
                            </select>
                            <select 
                                className="h-9 rounded-md border border-gray-300 text-sm px-3 bg-white"
                                value={statusFilter}
                                onChange={(e) => setStatusFilter(e.target.value)}
                            >
                                <option value="active">Ativas</option>
                                <option value="filled">Preenchidas</option>
                                <option value="inactive">Inativas</option>
                                <option value="all">Todas</option>
                            </select>
                        </div>
                    </div>
                </CardHeader>
                <CardContent>
                    {loading ? (
                        <div className="flex justify-center py-10"><Loader2 className="h-8 w-8 animate-spin text-blue-600" /></div>
                    ) : error ? (
                        <div className="text-red-500 text-center py-10">{error}</div>
                    ) : processedJobs.length === 0 ? (
                        <div className="text-center py-10 text-gray-500">Nenhuma vaga encontrada.</div>
                    ) : (
                        <div className="relative w-full overflow-auto">
                            <table className="w-full caption-bottom text-sm text-left">
                                <thead className="bg-gray-50/50 [&_tr]:border-b">
                                    <tr>
                                        <th className="h-10 px-4 font-medium text-gray-500">Empresa / Ãrea</th>
                                        <th className="h-10 px-4 font-medium text-gray-500">TÃ­tulo da Vaga</th>
                                        <th className="h-10 px-4 font-medium text-gray-500">Status</th>
                                        <th className="h-10 px-4 font-medium text-gray-500 text-center">Candidatos</th>
                                    </tr>
                                </thead>
                                <tbody className="[&_tr:last-child]:border-0">
                                    {processedJobs.map((job) => (
                                        <tr 
                                            key={job.id} 
                                            className="border-b transition-colors hover:bg-gray-50 cursor-pointer"
                                            onClick={() => navigate(`/jobs/${job.id}`)}
                                        >
                                            <td className="p-4 align-middle font-medium text-gray-600">
                                                {meta.companyName} <span className="text-gray-300 mx-1">/</span> {job.deptName}
                                            </td>
                                            <td className="p-4 align-middle font-medium text-blue-600 hover:underline">
                                                {job.title}
                                            </td>
                                            <td className="p-4 align-middle">
                                                <Badge variant={job.status === 'active' ? 'success' : 'secondary'}>
                                                    {formatStatus(job.status)}
                                                </Badge>
                                            </td>
                                            <td className="p-4 align-middle text-center">
                                                <Badge variant="outline" className="bg-gray-50">
                                                    {job.candidateCount}
                                                </Badge>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}
                </CardContent>
            </Card>

            <CreateJobModal 
                open={openCreateModal}
                handleClose={() => setOpenCreateModal(false)}
                onJobCreated={fetchData} 
            />
        </div>
    );
};

export default Dashboard;

==================================================
ARQUIVO: src\pages\Evaluation.jsx
==================================================
import { useParams } from 'react-router-dom';

export default function Evaluation() {
  const { applicationId } = useParams();
  return (
    <div className="p-8">
      <h1 className="text-2xl font-bold mb-4">AvaliaÃ§Ã£o do Candidato</h1>
      <p>Avaliando candidatura ID: {applicationId}</p>
    </div>
  );
}

==================================================
ARQUIVO: src\pages\HiredPage.jsx
==================================================
// src/pages/HiredPage.jsx (VersÃ£o Corrigida)
import React, { useState, useEffect } from 'react';
import { Link as RouterLink } from 'react-router-dom';
import { supabase } from '../supabase/client';
import { format, parseISO } from 'date-fns';
import {
    Container,
    Typography,
    Box,
    AppBar,
    Toolbar,
    Button,
    CircularProgress,
    Alert,
    Paper,
    List,
    ListItem,
    ListItemText,
    Divider,
} from '@mui/material';

const HiredPage = () => {
    const [hiredData, setHiredData] = useState({});
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState('');

    useEffect(() => {
        const fetchHired = async () => {
            setLoading(true);
            try {
                const { data: { session } } = await supabase.auth.getSession();
                if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
                const response = await fetch('/api/getHiredApplicants', {
                    headers: { 'Authorization': `Bearer ${session.access_token}` },
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || "NÃ£o foi possÃ­vel buscar os candidatos aprovados.");
                }
                const data = await response.json();
                const groupedByJob = (data.hired || []).reduce((acc, application) => {
                    const jobTitle = application.job.title;
                    if (!acc[jobTitle]) {
                        acc[jobTitle] = [];
                    }
                    acc[jobTitle].push(application);
                    return acc;
                }, {});
                setHiredData(groupedByJob);
            } catch (err) {
                console.error("Erro ao buscar aprovados:", err);
                setError(err.message);
            } finally {
                setLoading(false);
            }
        };
        fetchHired();
    }, []);

    const formatPhone = (phone) => {
        if (!phone) return 'NÃ£o informado';
        const cleaned = phone.replace(/\D/g, '');
        if (cleaned.length === 11) { return `(${cleaned.substring(0, 2)}) ${cleaned.substring(2, 7)}-${cleaned.substring(7)}`; }
        if (cleaned.length === 10) { return `(${cleaned.substring(0, 2)}) ${cleaned.substring(2, 6)}-${cleaned.substring(6)}`; }
        return phone;
    };

    const renderContent = () => {
        if (loading) {
            return <Box sx={{ display: 'flex', justifyContent: 'center', my: 5 }}><CircularProgress /></Box>;
        }
        if (error) {
            return <Alert severity="error">{error}</Alert>;
        }
        if (Object.keys(hiredData).length === 0) {
            return <Typography sx={{ mt: 3, textAlign: 'center' }}>Nenhum candidato foi marcado como contratado ainda.</Typography>;
        }
        return (
            <Box>
                {Object.entries(hiredData).map(([jobTitle, applications]) => (
                    <Paper key={jobTitle} sx={{ my: 3, p: 2 }}>
                        <Typography variant="h5" gutterBottom>{jobTitle}</Typography>
                        <List>
                            {applications.map((app, index) => (
                                <React.Fragment key={app.id}>
                                    <ListItem>
                                        <ListItemText
                                            primary={app.candidate.name}
                                            secondary={
                                                <>
                                                    <Typography component="span" variant="body2" color="text.primary">
                                                        Email: {app.candidate.email}
                                                    </Typography>
                                                    <br />
                                                    <Typography component="span" variant="body2" color="text.primary">
                                                        Telefone: {formatPhone(app.formData.phone)}
                                                    </Typography>
                                                    <br />
                                                    <Typography component="span" variant="body2" color="text.secondary">
                                                        {/* AQUI ESTÃ A CORREÃ‡ÃƒO DA REGRESSÃƒO */}
                                                        Aprovado em: {app.hiredAt ? format(parseISO(app.hiredAt), 'dd/MM/yyyy') : 'Data nÃ£o registrada'}
                                                    </Typography>
                                                </>
                                            }
                                        />
                                    </ListItem>
                                    {index < applications.length - 1 && <Divider />}
                                </React.Fragment>
                            ))}
                        </List>
                    </Paper>
                ))}
            </Box>
        );
    };

    return (
        <Box>
            <AppBar position="static">
                <Toolbar>
                    <Typography variant="h6" component="div" sx={{ flexGrow: 1 }}>
                        Candidatos Aprovados
                    </Typography>
                    <Button color="inherit" component={RouterLink} to="/">
                        Voltar para o Painel
                    </Button>
                </Toolbar>
            </AppBar>
            <Container sx={{ mt: 4 }}>
                {renderContent()}
            </Container>
        </Box>
    );
};

export default HiredPage;

==================================================
ARQUIVO: src\pages\JobDetails.jsx
==================================================
import React, { useState, useEffect } from 'react';
import { useParams, Link } from 'react-router-dom';
import { supabase } from '../supabase/client';
import { Button } from '../components/ui/button';
import { Badge } from '../components/ui/badge';
import { Loader2, ArrowLeft, MapPin, Briefcase, Calendar, Share2, User, Download, Settings, Plus, Trash2, Save } from 'lucide-react';

export default function JobDetails() {
  const { id } = useParams();
  const [job, setJob] = useState(null);
  const [candidates, setCandidates] = useState([]);
  const [loading, setLoading] = useState(true);
  const [activeTab, setActiveTab] = useState('details');
  const [savingParams, setSavingParams] = useState(false);
  const [evalParams, setEvalParams] = useState({ triagem: [], tecnico: [], cultura: [] });

  useEffect(() => {
    const fetchJobDetails = async () => {
      try {
        setLoading(true);
        const { data: jobData, error: jobError } = await supabase.from('jobs').select('*').eq('id', id).single();
        if (jobError) throw jobError;
        setJob(jobData);
        
        if (jobData.parameters) {
          setEvalParams({
            triagem: jobData.parameters.triagem || [],
            tecnico: jobData.parameters.tecnico || [],
            cultura: jobData.parameters.cultura || []
          });
        }

        const { data: appsData, error: appsError } = await supabase
          .from('applications')
          .select(`*, candidate:candidates(name, email, city, resume_url)`)
          .eq('jobId', id)
          .order('created_at', { ascending: false });
        if (appsError) throw appsError;
        setCandidates(appsData || []);
      } catch (error) {
        console.error('Erro:', error);
      } finally {
        setLoading(false);
      }
    };
    fetchJobDetails();
  }, [id]);

  const handleCopyLink = () => {
    navigator.clipboard.writeText(`${window.location.origin}/vagas/${id}/candidatar`);
    alert('Link copiado!');
  };

  const handleSaveParameters = async () => {
    setSavingParams(true);
    try {
        await supabase.from('jobs').update({ parameters: evalParams }).eq('id', id);
        alert('Salvo com sucesso!');
    } catch(e) { console.error(e); }
    finally { setSavingParams(false); }
  };

  const addCriteria = (type) => {
    const text = prompt("Novo critÃ©rio:");
    if(text) setEvalParams(p => ({...p, [type]: [...p[type], {id: crypto.randomUUID(), text, weight: 1}]}));
  };
  const removeCriteria = (type, id) => setEvalParams(p => ({...p, [type]: p[type].filter(x => x.id !== id)}));

  if (loading) return <div className="flex justify-center p-10"><Loader2 className="animate-spin w-8 h-8 text-blue-600"/></div>;
  if (!job) return <div className="text-center p-10">Vaga nÃ£o encontrada</div>;

  return (
    <div className="max-w-7xl mx-auto px-4 py-8">
      <div className="mb-8">
        <Link to="/jobs" className="inline-flex items-center text-gray-500 hover:text-gray-900 mb-4"><ArrowLeft className="w-4 h-4 mr-2"/> Voltar</Link>
        <div className="flex justify-between items-start">
            <div>
                <h1 className="text-3xl font-bold text-gray-900">{job.title}</h1>
                <div className="flex gap-4 mt-2 text-sm text-gray-500">
                    <span className="flex items-center"><MapPin className="w-4 h-4 mr-1"/> {job.location || 'Remoto'}</span>
                    <span className="flex items-center"><Briefcase className="w-4 h-4 mr-1"/> {job.type || 'CLT'}</span>
                    <span className="flex items-center"><Calendar className="w-4 h-4 mr-1"/> {new Date(job.created_at).toLocaleDateString()}</span>
                </div>
            </div>
            <Button variant="outline" onClick={handleCopyLink}>
                <Share2 className="w-4 h-4 mr-2"/> Compartilhar FormulÃ¡rio de Candidatura
            </Button>
        </div>
      </div>

      <div className="border-b border-gray-200 mb-6 flex gap-8">
        {['details', 'candidates', 'evaluation'].map(tab => (
            <button 
                key={tab}
                onClick={() => setActiveTab(tab)}
                className={`py-4 px-1 border-b-2 font-medium text-sm capitalize ${activeTab === tab ? 'border-blue-600 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}`}
            >
                {tab === 'details' ? 'Detalhes' : tab === 'candidates' ? `Candidatos (${candidates.length})` : 'AvaliaÃ§Ã£o'}
            </button>
        ))}
      </div>

      {activeTab === 'details' && (
        <div className="bg-white p-6 rounded-lg shadow-sm border space-y-6">
            <div><h3 className="font-medium text-gray-900">DescriÃ§Ã£o</h3><p className="mt-2 text-gray-600 whitespace-pre-wrap">{job.description}</p></div>
            <div><h3 className="font-medium text-gray-900">Requisitos</h3><p className="mt-2 text-gray-600 whitespace-pre-wrap">{job.requirements}</p></div>
        </div>
      )}

      {activeTab === 'candidates' && (
        <div className="space-y-4">
            {candidates.map(app => (
                <div key={app.id} className="bg-white p-4 rounded-lg border shadow-sm flex justify-between items-center">
                    <div className="flex items-center gap-4">
                        <div className="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold">{app.candidate?.name?.[0]}</div>
                        <div>
                            <p className="font-medium text-gray-900">{app.candidate?.name}</p>
                            <p className="text-sm text-gray-500">{app.candidate?.email}</p>
                        </div>
                    </div>
                    <div className="flex gap-2">
                        {app.resumeUrl && <a href={app.resumeUrl} target="_blank" className="p-2 text-gray-500 border rounded-full hover:bg-gray-50"><Download className="w-4 h-4"/></a>}
                        <Link to={`/evaluations/${app.id}`}><Button size="sm" variant="outline">Avaliar</Button></Link>
                    </div>
                </div>
            ))}
            {candidates.length === 0 && <div className="text-center py-10 text-gray-500">Nenhum candidato ainda.</div>}
        </div>
      )}

      {activeTab === 'evaluation' && (
        <div className="bg-white p-6 rounded-lg border shadow-sm space-y-8">
            <div className="border-b pb-4">
                <h2 className="text-lg font-semibold">ConfiguraÃ§Ã£o da AvaliaÃ§Ã£o</h2>
                <p className="text-sm text-gray-500">Defina os critÃ©rios que serÃ£o usados para avaliar os candidatos desta vaga.</p>
            </div>

            {/* CRITÃ‰RIOS DE TRIAGEM */}
            <div>
                <div className="flex justify-between items-center mb-3">
                    <h3 className="font-medium flex items-center"><User className="w-4 h-4 mr-2 text-purple-600"/> Triagem (Ex: Tem disponibilidade?)</h3>
                    <Button size="sm" variant="ghost" onClick={() => addCriteria('triagem')}><Plus className="w-4 h-4 mr-2"/> Adicionar</Button>
                </div>
                {evalParams.triagem.length === 0 && <p className="text-sm text-gray-400 italic">Nenhum critÃ©rio definido.</p>}
                {evalParams.triagem.map(item => (
                    <div key={item.id} className="flex justify-between items-center bg-gray-50 p-2 rounded mb-2">
                        <span>{item.text}</span>
                        <button onClick={() => removeCriteria('triagem', item.id)} className="text-red-500"><Trash2 className="w-4 h-4"/></button>
                    </div>
                ))}
            </div>

            {/* CRITÃ‰RIOS TÃ‰CNICOS */}
            <div>
                <div className="flex justify-between items-center mb-3">
                    <h3 className="font-medium flex items-center"><Briefcase className="w-4 h-4 mr-2 text-blue-600"/> CritÃ©rios TÃ©cnicos (1 a 5)</h3>
                    <Button size="sm" variant="ghost" onClick={() => addCriteria('tecnico')}><Plus className="w-4 h-4 mr-2"/> Adicionar</Button>
                </div>
                {evalParams.tecnico.length === 0 && <p className="text-sm text-gray-400 italic">Nenhum critÃ©rio definido.</p>}
                {evalParams.tecnico.map(item => (
                    <div key={item.id} className="flex justify-between items-center bg-gray-50 p-2 rounded mb-2">
                        <span>{item.text}</span>
                        <button onClick={() => removeCriteria('tecnico', item.id)} className="text-red-500"><Trash2 className="w-4 h-4"/></button>
                    </div>
                ))}
            </div>

            {/* CRITÃ‰RIOS DE CULTURA */}
            <div>
                <div className="flex justify-between items-center mb-3">
                    <h3 className="font-medium flex items-center"><User className="w-4 h-4 mr-2 text-green-600"/> Fit Cultural</h3>
                    <Button size="sm" variant="ghost" onClick={() => addCriteria('cultura')}><Plus className="w-4 h-4 mr-2"/> Adicionar</Button>
                </div>
                {evalParams.cultura.length === 0 && <p className="text-sm text-gray-400 italic">Nenhum critÃ©rio definido.</p>}
                {evalParams.cultura.map(item => (
                    <div key={item.id} className="flex justify-between items-center bg-gray-50 p-2 rounded mb-2">
                        <span>{item.text}</span>
                        <button onClick={() => removeCriteria('cultura', item.id)} className="text-red-500"><Trash2 className="w-4 h-4"/></button>
                    </div>
                ))}
            </div>

            <div className="pt-4 border-t flex justify-end">
                <Button onClick={handleSaveParameters} disabled={savingParams}>
                    {savingParams ? <Loader2 className="animate-spin w-4 h-4"/> : <><Save className="w-4 h-4 mr-2"/> Salvar ConfiguraÃ§Ãµes</>}
                </Button>
            </div>
        </div>
      )}
    </div>
  );
}

==================================================
ARQUIVO: src\pages\Jobs.jsx
==================================================
import { useState, useEffect } from 'react';
import { Link } from 'react-router-dom';
import { supabase } from '../supabase/client';
import { Plus, MapPin } from 'lucide-react';
import CreateJobModal from '../components/jobs/CreateJobModal';
import { Badge } from '../components/ui/badge';
import { Button } from '../components/ui/button';

export default function Jobs() {
  const [jobs, setJobs] = useState([]);
  const [isModalOpen, setIsModalOpen] = useState(false);

  useEffect(() => {
    fetchJobs();
  }, []);

  const fetchJobs = async () => {
    const { data } = await supabase.from('jobs').select('*').order('created_at', { ascending: false });
    setJobs(data || []);
  };

  return (
    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-2xl font-bold text-gray-900">Vagas</h1>
        <Button onClick={() => setIsModalOpen(true)}>
          <Plus className="w-4 h-4 mr-2" /> Nova Vaga
        </Button>
      </div>

      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        {jobs.map((job) => (
          <Link key={job.id} to={`/jobs/${job.id}`} className="block p-6 bg-white rounded-lg border hover:shadow-md transition">
            <h3 className="text-lg font-medium text-gray-900">{job.title}</h3>
            <div className="flex items-center mt-2 text-sm text-gray-500">
                <MapPin className="w-4 h-4 mr-1"/>
                {job.location || 'Remoto'}
            </div>
            
            {/* CORREÃ‡ÃƒO AQUI: Verificando se Ã© 'active' */}
            <div className="mt-4">
                <Badge variant={job.status === 'active' ? 'success' : 'secondary'}>
                    {job.status === 'active' ? 'Ativa' : 'Fechada'}
                </Badge>
            </div>
          </Link>
        ))}
      </div>

      <CreateJobModal 
        open={isModalOpen} 
        handleClose={() => setIsModalOpen(false)} 
        onJobCreated={fetchJobs} 
      />
    </div>
  );
}

==================================================
ARQUIVO: src\pages\Login.jsx
==================================================
import { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { supabase } from '../supabase/client';
import { Button } from '../components/ui/button';
import { Input } from '../components/ui/input';
import { Loader2, LayoutDashboard } from 'lucide-react';

export default function Login() {
  const navigate = useNavigate();
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');

  const handleLogin = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError('');

    try {
      const { error } = await supabase.auth.signInWithPassword({
        email,
        password,
      });
      if (error) throw error;
      navigate('/dashboard');
    } catch (error) {
      setError(error.message === 'Invalid login credentials' 
        ? 'E-mail ou senha incorretos.' 
        : 'Ocorreu um erro ao entrar. Tente novamente.');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 px-4 sm:px-6 lg:px-8">
      <div className="max-w-md w-full space-y-8">
        <div className="text-center">
          <div className="mx-auto h-12 w-12 bg-blue-600 rounded-lg flex items-center justify-center text-white">
            <LayoutDashboard size={24} />
          </div>
          <h2 className="mt-6 text-3xl font-extrabold text-gray-900 tracking-tight">
            Bem-vindo de volta
          </h2>
          <p className="mt-2 text-sm text-gray-600">
            Acesse o painel de recrutamento da <span className="font-semibold text-blue-600">Novva R&S</span>
          </p>
        </div>
        
        <form className="mt-8 space-y-6" onSubmit={handleLogin}>
          <div className="rounded-md shadow-sm space-y-4">
            <div>
              <label htmlFor="email" className="sr-only">Email</label>
              <Input
                id="email"
                type="email"
                required
                placeholder="seu@email.com"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                autoComplete="email"
              />
            </div>
            <div>
              <label htmlFor="password" className="sr-only">Senha</label>
              <Input
                id="password"
                type="password"
                required
                placeholder="Sua senha secreta"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                autoComplete="current-password"
              />
            </div>
          </div>

          {error && (
            <div className="p-3 rounded-md bg-red-50 text-red-700 text-sm text-center border border-red-200 animate-pulse">
              {error}
            </div>
          )}

          <div>
            <Button type="submit" disabled={loading} className="w-full" size="lg">
              {loading ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                  Entrando...
                </>
              ) : (
                'Entrar na Plataforma'
              )}
            </Button>
          </div>

          <div className="text-center">
            <Link 
              to="/register" 
              className="font-medium text-sm text-blue-600 hover:text-blue-500 transition-colors"
            >
              NÃ£o tem uma conta? Cadastre-se gratuitamente
            </Link>
          </div>
        </form>
      </div>
    </div>
  );
}

==================================================
ARQUIVO: src\pages\Register.jsx
==================================================
import { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { useAuth } from '../context/AuthContext';

export default function Register() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const { signUp } = useAuth();
  const navigate = useNavigate();
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      setLoading(true);
      const { error } = await signUp({ email, password });
      if (error) throw error;
      alert('Verifique seu e-mail para confirmar o cadastro!');
      navigate('/login');
    } catch (error) {
      alert(error.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50">
      <div className="max-w-md w-full space-y-8 p-8 bg-white rounded shadow">
        <h2 className="text-center text-3xl font-extrabold text-gray-900">Criar conta</h2>
        <form className="mt-8 space-y-6" onSubmit={handleSubmit}>
          <input
            type="email"
            required
            className="w-full px-3 py-2 border rounded"
            placeholder="Email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
          />
          <input
            type="password"
            required
            className="w-full px-3 py-2 border rounded"
            placeholder="Senha"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
          />
          <button
            type="submit"
            disabled={loading}
            className="w-full py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"
          >
            {loading ? 'Carregando...' : 'Registrar'}
          </button>
        </form>
        <div className="text-center">
          <Link to="/login" className="text-blue-600 hover:text-blue-500">JÃ¡ tem conta? Login</Link>
        </div>
      </div>
    </div>
  );
}

==================================================
ARQUIVO: src\services\evaluationService.js
==================================================
// src/services/evaluationService.js
import { supabase } from '../supabase/client';

// 1. Prepara o banco (Cria critÃ©rios se nÃ£o existirem)
export const prepareEvaluationV2 = async (jobId) => {
  const { data, error } = await supabase
    .rpc('initialize_job_criteria_v2', { target_job_id: jobId });
  if (error) throw error;
  return data;
};

// 2. Busca o resumo consolidado (MÃ©dias)
export const getEvaluationSummaryV2 = async (applicationId) => {
  const { data, error } = await supabase
    .rpc('get_candidate_summary_v2', { target_app_id: applicationId });
  if (error) throw error;
  return data;
};

// 3. Busca/Cria a sessÃ£o do usuÃ¡rio atual
export const getMyEvaluationSession = async (applicationId, userId) => {
  // Tenta buscar existente
  let { data: session, error } = await supabase
    .from('evaluation_assignments_v2')
    .select('id, status')
    .eq('application_id', applicationId)
    .eq('evaluator_id', userId)
    .maybeSingle();

  // Se nÃ£o existir, cria
  if (!session) {
    const { data: newSession, error: createError } = await supabase
      .from('evaluation_assignments_v2')
      .insert({ application_id: applicationId, evaluator_id: userId })
      .select()
      .single();
    
    if (createError) throw createError;
    session = newSession;
  }
  
  return session;
};

==================================================
ARQUIVO: src\supabase\client.js
==================================================
// src/supabase/client.js (VersÃ£o Limpa e Segura)
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

// ValidaÃ§Ã£o de SeguranÃ§a:
// Impede que a aplicaÃ§Ã£o inicie "pela metade" se as chaves nÃ£o existirem.
if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error(
    'ERRO CRÃTICO: As chaves de configuraÃ§Ã£o do Supabase nÃ£o foram encontradas. ' +
    'Verifique se o arquivo .env existe na raiz do projeto e contÃ©m as variÃ¡veis VITE_SUPABASE_URL e VITE_SUPABASE_ANON_KEY.'
  );
}

export const supabase = createClient(supabaseUrl, supabaseAnonKey);

==================================================
ARQUIVO: src\utils\formatters.js
==================================================
// src/utils/formatters.js
import { format, parseISO } from 'date-fns';

// Nossa nova funÃ§Ã£o de traduÃ§Ã£o
export const formatStatus = (status) => {
  const statusMap = {
    active: 'Ativa',
    inactive: 'Inativa',
    filled: 'Preenchida',
  };
  return statusMap[status] || status;
};

// Movi as outras funÃ§Ãµes de formataÃ§Ã£o para cÃ¡ para centralizar
export const formatPhone = (phone) => {
  if (!phone) return 'NÃ£o informado';
  const cleaned = phone.replace(/\D/g, '');
  if (cleaned.length === 11) {
    return `(${cleaned.substring(0, 2)}) ${cleaned.substring(2, 7)}-${cleaned.substring(7)}`;
  }
  if (cleaned.length === 10) {
    return `(${cleaned.substring(0, 2)}) ${cleaned.substring(2, 6)}-${cleaned.substring(6)}`;
  }
  return phone;
};

export const formatUrl = (url) => {
  if (!url) return '#';
  if (url.startsWith('http://') || url.startsWith('https://')) { return url; }
  return `//${url}`;
};

export const formatDate = (dateStr) => {
    if (!dateStr) return 'NÃ£o informado';
    try {
        return format(parseISO(dateStr), 'dd/MM/yyyy');
    } catch (error) {
        console.error("Erro ao formatar data:", dateStr, error);
        return 'Data invÃ¡lida';
    }
};

