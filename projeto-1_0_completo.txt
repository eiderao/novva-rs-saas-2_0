==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\404.html
==================================================
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Page Not Found</title>

    <style media="screen">
      body { background: #ECEFF1; color: rgba(0,0,0,0.87); font-family: Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; }
      #message { background: white; max-width: 360px; margin: 100px auto 16px; padding: 32px 24px 16px; border-radius: 3px; }
      #message h3 { color: #888; font-weight: normal; font-size: 16px; margin: 16px 0 12px; }
      #message h2 { color: #ffa100; font-weight: bold; font-size: 16px; margin: 0 0 8px; }
      #message h1 { font-size: 22px; font-weight: 300; color: rgba(0,0,0,0.6); margin: 0 0 16px;}
      #message p { line-height: 140%; margin: 16px 0 24px; font-size: 14px; }
      #message a { display: block; text-align: center; background: #039be5; text-transform: uppercase; text-decoration: none; color: white; padding: 16px; border-radius: 4px; }
      #message, #message a { box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); }
      #load { color: rgba(0,0,0,0.4); text-align: center; font-size: 13px; }
      @media (max-width: 600px) {
        body, #message { margin-top: 0; background: white; box-shadow: none; }
        body { border-top: 16px solid #ffa100; }
      }
    </style>
  </head>
  <body>
    <div id="message">
      <h2>404</h2>
      <h1>Page Not Found</h1>
      <p>The specified file was not found on this website. Please check the URL for mistakes and try again.</p>
      <h3>Why am I seeing this?</h3>
      <p>This page was generated by the Firebase Command-Line Interface. To modify it, edit the <code>404.html</code> file in your project's configured <code>public</code> directory.</p>
    </div>
  </body>
</html>


==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\firebase.json
==================================================
{
  "functions": [
    {
      "source": "functions",
      "codebase": "default",
      "ignore": [
        "node_modules",
        ".git",
        "firebase-debug.log",
        "firebase-debug.*.log",
        "*.local"
      ]
    }
  ],
  "hosting": {
    "public": "dist",
    "ignore": [
      "firebase.json",
      "**/.*",
      "**/node_modules/**"
    ],
    "rewrites": [
      {
        "source": "**",
        "destination": "/index.html"
      }
    ]
  },
  "emulators": {
    "auth": {
      "port": 9099
    },
    "functions": {
      "port": 5001
    },
    "firestore": {
      "port": 8081
    },
    "ui": {
      "enabled": true
    },
    "singleProjectMode": true
  }
}


==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\index.html
==================================================
<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Novva R&S</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\package.json
==================================================
{
  "name": "novva-rs-saas",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint . --ext js,jsx --report-unused-disable-directives --max-warnings 0",
    "preview": "vite preview"
  },
  "dependencies": {
    "@emotion/react": "^11.11.1",
    "@emotion/styled": "^11.11.0",
    "@mui/icons-material": "^5.14.13",
    "@mui/material": "^5.14.13",
    "@mui/x-date-pickers": "^8.12.0",
    "@supabase/supabase-js": "^2.58.0",
    "date-fns": "^4.1.0",
    "formidable": "^3.5.4",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-imask": "^7.6.1",
    "react-router-dom": "^7.9.3",
    "recharts": "^3.2.1"
  },
  "devDependencies": {
    "@types/react": "^18.2.15",
    "@types/react-dom": "^18.2.7",
    "@vitejs/plugin-react": "^4.0.3",
    "eslint": "^8.45.0",
    "eslint-plugin-react": "^7.32.2",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-plugin-react-refresh": "^0.4.3",
    "vite": "^4.4.5"
  }
}


==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\vercel.json
==================================================
{
  "rewrites": [
    { "source": "/(.*)", "destination": "/index.html" }
  ]
}

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\vite.config.js
==================================================
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
})

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\.vercel\project.json
==================================================
{"projectId":"prj_HtLcAivMTvf4K2mSOR496vnc8rR7","orgId":"team_L2VfPt8LwRczWEzT69FA8EoY","projectName":"novva-rs-saas"}

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\api\admin.js
==================================================
// api/admin.js (VERSÃƒO FINAL E CORRIGIDA)
import { createClient } from '@supabase/supabase-js';

async function validateAdmin(request) {
  const supabaseAdmin = createClient(
    process.env.SUPABASE_URL,
    process.env.SUPABASE_SERVICE_KEY
  );

  const authHeader = request.headers['authorization'];
  if (!authHeader) throw new Error('NÃ£o autorizado.');
  
  const token = authHeader.replace('Bearer ', '');
  const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
  if (userError) throw new Error('Token invÃ¡lido.');

  const { data: userData, error: userCheckError } = await supabaseAdmin
    .from('users')
    .select('isAdmin')
    .eq('id', user.id)
    .single();

  if (userCheckError) throw userCheckError;
  if (!userData || !userData.isAdmin) {
    throw new Error('Acesso negado. VocÃª nÃ£o Ã© um administrador.');
  }
  
  return { supabaseAdmin };
}

export default async function handler(request, response) {
  try {
    const { supabaseAdmin } = await validateAdmin(request);
    
    const action = request.method === 'GET' ? request.query.action : request.body.action;

    switch (action) {
      case 'getTenantsAndPlans': {
        const { data: tenants, error: tenantsError } = await supabaseAdmin
          .from('tenants')
          .select(`id, companyName, planId, cnpj, plans ( name )`);
        if (tenantsError) throw tenantsError;

        const { data: plans, error: plansError } = await supabaseAdmin
          .from('plans')
          .select('*');
        if (plansError) throw plansError;

        return response.status(200).json({ tenants, plans });
      }
        
      case 'updateTenantPlan': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { tenantId, newPlanId } = request.body;
        const { data, error } = await supabaseAdmin.from('tenants').update({ planId: newPlanId }).eq('id', tenantId).select('id, companyName, planId, plans ( name )').single();
        if (error) throw error;
        return response.status(200).json({ message: 'Plano atualizado!', updatedTenant: data });
      }
      
      case 'getTenantDetails': {
        if (request.method !== 'GET') { return response.status(405).json({ error: 'Use GET.' }); }
        const { tenantId } = request.query;
        if (!tenantId) { return response.status(400).json({ error: 'tenantId Ã© obrigatÃ³rio.' }); }
        
        const { data: tenant, error: tenantError } = await supabaseAdmin.from('tenants').select('id, companyName').eq('id', tenantId).single();
        if (tenantError || !tenant) { return response.status(404).json({ error: 'Empresa nÃ£o encontrada.' }); }

        // AQUI ESTAVA O ERRO DE SINTAXE. ESTA Ã‰ A VERSÃƒO CORRETA.
        const { data: users, error: usersError } = await supabaseAdmin
          .from('users')
          .select('id, name, role, isAdmin') 
          .eq('tenantId', Number(tenantId));
        if (usersError) throw usersError;
        
        return response.status(200).json({ tenant, users });
      }

      case 'createTenant': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { companyName, planId, cnpj } = request.body;
        if (!companyName || !planId) { return response.status(400).json({ error: 'Nome da empresa e Plano sÃ£o obrigatÃ³rios.' }); }

        const { data: newTenant, error } = await supabaseAdmin
          .from('tenants')
          .insert({ companyName, planId, cnpj: cnpj || null })
          .select('id, companyName, planId, cnpj, plans ( name )')
          .single();
        if (error) throw error;
        return response.status(201).json({ message: 'Empresa criada com sucesso!', newTenant });
      }
      
      case 'updateTenant': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { id, companyName, planId, cnpj } = request.body;
        if (!id || !companyName || !planId) { return response.status(400).json({ error: 'ID, Nome e Plano sÃ£o obrigatÃ³rios.' }); }

        const { data: updatedTenant, error } = await supabaseAdmin
          .from('tenants')
          .update({ companyName, planId, cnpj: cnpj || null })
          .eq('id', id)
          .select('id, companyName, planId, cnpj, plans ( name )')
          .single();
        if (error) throw error;
        return response.status(200).json({ message: 'Empresa atualizada!', updatedTenant });
      }

      case 'deleteTenant': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { tenantId } = request.body;
        if (!tenantId) { return response.status(400).json({ error: 'tenantId Ã© obrigatÃ³rio.' }); }
        
        const { error } = await supabaseAdmin.from('tenants').delete().eq('id', tenantId);
        if (error) throw error;
        return response.status(200).json({ message: 'Empresa excluÃ­da com sucesso!' });
      }
      
      case 'createPlan': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { planData } = request.body;
        if (!planData) { return response.status(400).json({ error: 'Dados do plano sÃ£o obrigatÃ³rios.' }); }
        const { data: newPlan, error } = await supabaseAdmin.from('plans').insert(planData).select().single();
        if (error) throw error;
        return response.status(201).json({ message: 'Plano criado com sucesso!', newPlan });
      }

      case 'updatePlan': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { planId, planData } = request.body;
        if (!planId || !planData) { return response.status(400).json({ error: 'planId e planData sÃ£o obrigatÃ³rios.' }); }
        const { data: updatedPlan, error } = await supabaseAdmin.from('plans').update(planData).eq('id', planId).select().single();
        if (error) throw error;
        return response.status(200).json({ message: 'Plano atualizado!', updatedPlan });
      }

      case 'deletePlan': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { planId } = request.body;
        if (!planId) { return response.status(400).json({ error: 'planId Ã© obrigatÃ³rio.' }); }
        const { count, error: checkError } = await supabaseAdmin.from('tenants').select('*', { count: 'exact', head: true }).eq('planId', planId);
        if (checkError) throw checkError;
        if (count > 0) { return response.status(400).json({ error: `NÃ£o Ã© possÃ­vel excluir este plano. Ele estÃ¡ sendo usado por ${count} empresa(s).` }); }
        const { error } = await supabaseAdmin.from('plans').delete().eq('id', planId);
        if (error) throw error;
        return response.status(200).json({ message: 'Plano excluÃ­do com sucesso!' });
      }

      case 'createUser': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { email, password, name, role, isAdmin, tenantId } = request.body;
        if (!email || !password || !name || !role || !tenantId) {
          return response.status(400).json({ error: 'Campos obrigatÃ³rios faltando.' });
        }

        const { data: authUser, error: authError } = await supabaseAdmin.auth.admin.createUser({
          email: email,
          password: password,
          email_confirm: true,
        });
        if (authError) throw authError;

        const { data: newUser, error: userError } = await supabaseAdmin
          .from('users')
          .insert({
            id: authUser.user.id,
            name: name,
            role: role,
            isAdmin: isAdmin || false,
            tenantId: tenantId
          })
          .select()
          .single();
        
        if (userError) {
          await supabaseAdmin.auth.admin.deleteUser(authUser.user.id);
          throw userError;
        }
        
        return response.status(201).json({ message: 'UsuÃ¡rio criado com sucesso!', newUser });
      }

      case 'updateUser': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { userId, name, role, isAdmin } = request.body;
        if (!userId || !name || !role) {
          return response.status(400).json({ error: 'Campos obrigatÃ³rios faltando.' });
        }
        
        const { data: updatedUser, error } = await supabaseAdmin
          .from('users')
          .update({ name, role, isAdmin })
          .eq('id', userId)
          .select()
          .single();
        
        if (error) throw error;
        return response.status(200).json({ message: 'UsuÃ¡rio atualizado!', updatedUser });
      }

      case 'deleteUser': {
        if (request.method !== 'POST') { return response.status(405).json({ error: 'Use POST.' }); }
        const { userId } = request.body;
        if (!userId) { return response.status(400).json({ error: 'userId Ã© obrigatÃ³rio.' }); }

        const { error: userError } = await supabaseAdmin
          .from('users')
          .delete()
          .eq('id', userId);
        if (userError) throw userError;
        
        const { error: authError } = await supabaseAdmin.auth.admin.deleteUser(userId);
        if (authError) throw authError;
        
        return response.status(200).json({ message: 'UsuÃ¡rio excluÃ­do com sucesso!' });
      }
      
      default:
        return response.status(400).json({ error: 'AÃ§Ã£o de admin desconhecida.' });
    }

  } catch (error) {
    console.error("Erro na API de Admin:", error.message);
    if (error.message.includes('NÃ£o autorizado') || error.message.includes('Token invÃ¡lido')) {
      return response.status(401).json({ error: error.message });
    }
    if (error.message.includes('Acesso negado')) {
      return response.status(403).json({ error: error.message });
    }
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\api\apply.js
==================================================
// api/apply.js (VERSÃƒO FINAL, COMPLETA E CORRIGIDA)
import { createClient } from '@supabase/supabase-js';
import { formidable } from 'formidable';
import fs from 'fs';
import path from 'path';

export const config = {
  api: {
    bodyParser: false,
  },
};

export default async function handler(request, response) {
  if (request.method !== 'POST') {
    return response.status(405).json({ error: `MÃ©todo ${request.method} nÃ£o permitido.` });
  }

  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    const form = formidable({});
    const [fields, files] = await form.parse(request);
    
    const jobId = fields.jobId ? fields.jobId[0] : null;
    if (!jobId) { return response.status(400).json({ error: 'ID da vaga Ã© obrigatÃ³rio.' }); }

    // --- LÃ“GICA DE LIMITE ROBUSTA ---
    const { data: job, error: jobError } = await supabaseAdmin
      .from('jobs')
      .select('tenantId')
      .eq('id', jobId)
      .single();
    
    if (jobError || !job) { return response.status(404).json({ error: 'Vaga nÃ£o encontrada.' }); }

    const { data: tenant, error: tenantError } = await supabaseAdmin
      .from('tenants')
      .select('planId')
      .eq('id', job.tenantId)
      .single();

    if (tenantError || !tenant) { throw new Error('Empresa (tenant) nÃ£o encontrada para esta vaga.'); }

    const { data: plan, error: planError } = await supabaseAdmin
      .from('plans')
      .select('candidate_limit')
      .eq('id', tenant.planId)
      .single();
    
    if (planError || !plan) {
      throw new Error(`ConfiguraÃ§Ã£o de plano invÃ¡lida. O plano com ID "${tenant.planId}" nÃ£o foi encontrado na tabela 'plans'.`);
    }
    
    if (plan.candidate_limit !== -1) {
      const { count, error: countError } = await supabaseAdmin
        .from('applications')
        .select('*', { count: 'exact', head: true })
        .eq('jobId', jobId);
      if (countError) throw countError;
      if (count >= plan.candidate_limit) {
        return response.status(403).json({ error: `Limite de ${plan.candidate_limit} candidaturas para esta vaga foi atingido.` });
      }
    }
    // --- FIM DA LÃ“GICA DE LIMITE ---

    const { name, email } = fields;
    const resumeFile = files.resume;
    if (!name || !email || !resumeFile) { return response.status(400).json({ error: 'Nome, e-mail e currÃ­culo sÃ£o obrigatÃ³rios.' }); }
    const fileContent = fs.readFileSync(resumeFile[0].filepath);
    const fileExtension = path.extname(resumeFile[0].originalFilename);
    const fileName = `${email[0].replace(/[^a-zA-Z0-9]/g, '_')}_${Date.now()}${fileExtension}`;
    const { data: uploadData, error: uploadError } = await supabaseAdmin.storage.from('resumes').upload(fileName, fileContent, { contentType: resumeFile[0].mimetype, upsert: false });
    if (uploadError) throw new Error(`Erro no upload: ${uploadError.message}`);
    let { data: candidate } = await supabaseAdmin.from('candidates').select('id').eq('email', email[0]).single();
    if (!candidate) {
      const { data: newCandidate, error: newCandidateError } = await supabaseAdmin.from('candidates').insert({ name: name[0], email: email[0] }).select('id').single();
      if (newCandidateError) throw newCandidateError;
      candidate = newCandidate;
    }
    const applicationFields = {};
    for (const key in fields) { applicationFields[key] = fields[key][0]; }
    const { error: applicationError } = await supabaseAdmin.from('applications').insert({ jobId: jobId, candidateId: candidate.id, resumeUrl: uploadData.path, formData: applicationFields });
    if (applicationError) throw applicationError;
    
    return response.status(201).json({ message: 'Candidatura enviada com sucesso!' });

  } catch (error) {
    console.error("Erro na candidatura:", error.message);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\api\createJob.js
==================================================
// api/createJob.js (VersÃ£o Final "Plan-Aware")
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  if (request.method !== 'POST') {
    response.setHeader('Allow', ['POST']);
    return response.status(405).json({ error: `MÃ©todo ${request.method} nÃ£o permitido.` });
  }
  try {
    const supabaseAdmin = createClient(process.env.SUPABASE_URL, process.env.SUPABASE_SERVICE_KEY);

    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });
    
    const { data: userData } = await supabaseAdmin.from('users').select('tenantId').eq('id', user.id).single();
    if (!userData) return response.status(404).json({ error: 'Perfil de usuÃ¡rio nÃ£o encontrado.' });
    const tenantId = userData.tenantId;

    const { data: tenant, error: tenantError } = await supabaseAdmin
      .from('tenants')
      .select('plan:plans(job_limit)')
      .eq('id', tenantId)
      .single();
    if (tenantError) throw tenantError;

    const job_limit = tenant.plan.job_limit;

    // LÃ³gica de limite dinÃ¢mica (job_limit === -1 Ã© ilimitado)
    if (job_limit !== -1) {
      const { count, error: countError } = await supabaseAdmin
        .from('jobs')
        .select('*', { count: 'exact', head: true })
        .eq('tenantId', tenantId);
      if (countError) throw countError;
      if (count >= job_limit) {
        return response.status(403).json({ error: `Limite de ${job_limit} vagas atingido para o seu plano.` });
      }
    }

    const { title } = request.body;
    if (!title) { return response.status(400).json({ error: 'O tÃ­tulo da vaga Ã© obrigatÃ³rio.' }); }
    
    const { data: newJob, error: insertError } = await supabaseAdmin
      .from('jobs')
      .insert({ title: title, tenantId: tenantId, status: 'active' })
      .select()
      .single();
    if (insertError) throw insertError;
    
    return response.status(201).json({ newJob });
  } catch (error) {
    console.error("Erro na funÃ§Ã£o createJob:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\api\getApplicantsForJob.js
==================================================
// api/getApplicantsForJob.js (VERSÃƒO FINAL E CORRIGIDA)
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    // ValidaÃ§Ã£o do usuÃ¡rio (sem alteraÃ§Ãµes)
    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });
    const { data: userData } = await supabaseAdmin.from('users').select('tenantId').eq('id', user.id).single();
    if (!userData) return response.status(404).json({ error: 'Perfil de usuÃ¡rio nÃ£o encontrado.' });
    const tenantId = userData.tenantId;
    const { jobId } = request.query;
    if (!jobId) return response.status(400).json({ error: 'O ID da vaga Ã© obrigatÃ³rio.' });

    // Busca a vaga e suas candidaturas de uma sÃ³ vez
    const { data: job, error: jobError } = await supabaseAdmin
      .from('jobs')
      .select(`
        id,
        tenantId,
        parameters,
        applications (
          id,
          created_at,
          evaluation,
          isHired,
          candidate:candidates ( id, name, email )
        )
      `)
      .eq('id', Number(jobId))
      .eq('tenantId', tenantId)
      .single();

    if (jobError || !job) {
      return response.status(404).json({ error: 'Vaga nÃ£o encontrada ou nÃ£o pertence Ã  sua empresa.' });
    }

    // Prepara os mapas para cÃ¡lculo (sem alteraÃ§Ãµes)
    const parameters = job.parameters || {};
    const notesMap = new Map((parameters.notas || []).map(note => [note.id, note.valor]));
    const weightsMap = {
      triagem: new Map((parameters.triagem || []).map(c => [c.name, c.weight])),
      cultura: new Map((parameters.cultura || []).map(c => [c.name, c.weight])),
      tÃ©cnico: new Map((parameters.tÃ©cnico || []).map(c => [c.name, c.weight])),
    };

    // Calcula as notas para cada candidatura
    const classifiedApplicants = job.applications.map(app => {
      const scores = { notaTriagem: 0, notaCultura: 0, notaTecnico: 0, notaGeral: 0 };
      if (app.evaluation) {
        ['triagem', 'cultura', 'tÃ©cnico'].forEach(section => {
          let sectionScore = 0;
          const sectionEvaluation = app.evaluation[section];
          if (sectionEvaluation) {
            for (const criterionName in sectionEvaluation) {
              if (criterionName !== 'anotacoes') {
                const noteId = sectionEvaluation[criterionName];
                const noteValue = notesMap.get(noteId) ?? 0;
                const weight = weightsMap[section]?.get(criterionName) ?? 0;
                sectionScore += (noteValue * weight) / 100;
              }
            }
          }
          if (section === 'triagem') scores.notaTriagem = sectionScore;
          if (section === 'cultura') scores.notaCultura = sectionScore;
          if (section === 'tÃ©cnico') scores.notaTecnico = sectionScore;
        });
        scores.notaGeral = scores.notaTriagem + scores.notaCultura + scores.notaTecnico;
      }

      // A CORREÃ‡ÃƒO ESTÃ AQUI: O campo 'isHired' foi restaurado
      return {
        applicationId: app.id,
        submissionDate: app.created_at,
        isHired: app.isHired,
        candidateName: app.candidate.name,
        candidateEmail: app.candidate.email,
        ...scores
      };
    });
    
    return response.status(200).json({ applicants: classifiedApplicants });

  } catch (error) {
    console.error("Erro na funÃ§Ã£o getApplicantsForJob:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\api\getApplicationDetails.js
==================================================
// api/getApplicationDetails.js (VersÃ£o Definitivamente Corrigida)
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });

    const { data: userData } = await supabaseAdmin.from('users').select('tenantId').eq('id', user.id).single();
    if (!userData) return response.status(404).json({ error: 'Perfil de usuÃ¡rio nÃ£o encontrado.' });
    const tenantId = userData.tenantId;

    const { applicationId } = request.query;
    if (!applicationId) {
      return response.status(400).json({ error: 'O ID da candidatura Ã© obrigatÃ³rio.' });
    }

    const { data: application, error: applicationError } = await supabaseAdmin
      .from('applications')
      .select(`
        id,
        created_at,
        formData,
        resumeUrl,
        evaluation, 
        candidate:candidates ( * ),
        job:jobs ( title, parameters, tenantId )
      `)
      .eq('id', Number(applicationId))
      .single();

    if (applicationError) {
      if (applicationError.code === 'PGRST116') {
         return response.status(404).json({ error: 'Candidatura nÃ£o encontrada.' });
      }
      throw applicationError;
    }

    if (application.job.tenantId !== tenantId) {
      return response.status(403).json({ error: 'VocÃª nÃ£o tem permissÃ£o para ver esta candidatura.' });
    }

    return response.status(200).json({ application });

  } catch (error) {
    console.error("Erro na funÃ§Ã£o getApplicationDetails:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\api\getHiredApplicants.js
==================================================
// api/getHiredApplicants.js
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    // ValidaÃ§Ã£o do usuÃ¡rio de RH
    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });
    
    const { data: userData } = await supabaseAdmin.from('users').select('tenantId').eq('id', user.id).single();
    if (!userData) return response.status(404).json({ error: 'Perfil de usuÃ¡rio nÃ£o encontrado.' });
    const tenantId = userData.tenantId;

    // Busca todas as candidaturas marcadas como 'isHired = true'
    const { data: hiredApplications, error: fetchError } = await supabaseAdmin
      .from('applications')
      .select(`
        id,
        hiredAt,
        formData,
        candidate:candidates ( name, email ),
        job:jobs ( id, title, tenantId )
      `)
      .eq('isHired', true);

    if (fetchError) throw fetchError;

    // Filtra no servidor para garantir que o usuÃ¡rio sÃ³ veja os aprovados do seu prÃ³prio tenant
    const tenantHired = hiredApplications.filter(app => app.job.tenantId === tenantId);

    return response.status(200).json({ hired: tenantHired });

  } catch (error) {
    console.error("Erro ao buscar candidatos contratados:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\api\getPublicJobData.js
==================================================
// api/getPublicJobData.js (VERSÃƒO FINAL E CORRIGIDA)
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    const { id: jobId } = request.query;
    if (!jobId) {
      return response.status(400).json({ error: 'O ID da vaga Ã© obrigatÃ³rio.' });
    }

    // A CORREÃ‡ÃƒO ESTÃ AQUI: Convertemos o jobId para Number()
    const { data: job, error: jobError } = await supabaseAdmin
      .from('jobs')
      .select(`
        title,
        tenantId,
        applications ( count )
      `)
      .eq('id', Number(jobId)) // Comparando nÃºmero com nÃºmero
      .single();

    if (jobError) throw jobError;

    const { data: tenant, error: tenantError } = await supabaseAdmin
      .from('tenants')
      .select('planId')
      .eq('id', job.tenantId)
      .single();
    
    if (tenantError) throw tenantError;
    
    const formattedJob = {
      title: job.title,
      candidateCount: job.applications[0] ? job.applications[0].count : 0,
      planId: tenant.planId
    };

    return response.status(200).json({ job: formattedJob });
  } catch (error) {
    console.error("Erro ao buscar dados pÃºblicos da vaga:", error);
    return response.status(500).json({ error: 'NÃ£o foi possÃ­vel buscar os dados da vaga.' });
  }
}

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\api\getResumeSignedUrl.js
==================================================
// api/getResumeSignedUrl.js
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    // ValidaÃ§Ã£o de seguranÃ§a (sÃ³ usuÃ¡rios logados podem pedir links)
    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });

    // Pega o caminho do arquivo que o frontend quer acessar
    const { filePath } = request.query;
    if (!filePath) {
      return response.status(400).json({ error: 'O caminho do arquivo Ã© obrigatÃ³rio.' });
    }

    // Gera uma URL assinada e segura, com validade de 60 segundos
    const { data, error: urlError } = await supabaseAdmin
      .storage
      .from('resumes')
      .createSignedUrl(filePath, 60); // 60 segundos de validade

    if (urlError) throw urlError;

    return response.status(200).json({ signedUrl: data.signedUrl });

  } catch (error) {
    console.error("Erro ao gerar URL assinada:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.' });
  }
}

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\api\jobs.js
==================================================
// api/jobs.js (VERSÃƒO FINAL com CRUD completo)
import { createClient } from '@supabase/supabase-js';

// FunÃ§Ã£o de middleware de seguranÃ§a (reutilizada)
async function validateUser(request) {
  const supabaseAdmin = createClient(
    process.env.SUPABASE_URL,
    process.env.SUPABASE_SERVICE_KEY
  );

  const authHeader = request.headers['authorization'];
  if (!authHeader) throw new Error('NÃ£o autorizado.');
  
  const token = authHeader.replace('Bearer ', '');
  const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
  if (userError) throw new Error('Token invÃ¡lido.');

  const { data: userData } = await supabaseAdmin.from('users').select('tenantId, isAdmin').eq('id', user.id).single();
  if (!userData) throw new Error('Perfil de usuÃ¡rio nÃ£o encontrado.');
  
  return { supabaseAdmin, user, userData };
}

// Handler principal
export default async function handler(request, response) {
  try {
    const { supabaseAdmin, userData } = await validateUser(request);
    const tenantId = userData.tenantId;

    // --- LÃ“GICA DE REQUISIÃ‡ÃƒO GET (LEITURA) ---
    if (request.method === 'GET') {
      const { id } = request.query;

      if (id) {
        // Busca UMA vaga
        const { data: job, error: jobError } = await supabaseAdmin.from('jobs').select('*').eq('id', Number(id)).eq('tenantId', tenantId).single();
        if (jobError || !job) return response.status(404).json({ error: 'Vaga nÃ£o encontrada.' });
        return response.status(200).json({ job });
      } 
      else {
        // Busca TODAS as vagas
        const { data: tenant, error: tenantError } = await supabaseAdmin.from('tenants').select('planId').eq('id', tenantId).single();
        if (tenantError) throw tenantError;

        const { data: jobs, error: jobsError } = await supabaseAdmin.from('jobs').select(`id, title, status, tenantId, applications ( count )`).eq('tenantId', tenantId);
        if (jobsError) throw jobsError;
        const formattedJobs = jobs.map(job => ({ ...job, candidateCount: job.applications[0] ? job.applications[0].count : 0 }));
        
        return response.status(200).json({ 
          jobs: formattedJobs,
          planId: tenant.planId,
          isAdmin: userData.isAdmin
        });
      }
    }

    // --- LÃ“GICA DE REQUISIÃ‡ÃƒO POST (ATUALIZAR/DELETAR) ---
    if (request.method === 'POST') {
      const { action, jobId, newStatus } = request.body;

      switch (action) {
        case 'updateJobStatus':
          if (!jobId || !newStatus) { return response.status(400).json({ error: 'jobId e newStatus sÃ£o obrigatÃ³rios.' }); }
          
          const { data: updatedJob, error: updateError } = await supabaseAdmin
            .from('jobs')
            .update({ status: newStatus })
            .eq('id', jobId)
            .eq('tenantId', tenantId) // SeguranÃ§a: sÃ³ pode atualizar as prÃ³prias vagas
            .select()
            .single();
          
          if (updateError) throw updateError;
          return response.status(200).json({ message: 'Status atualizado!', updatedJob });

        case 'deleteJob':
          if (!jobId) { return response.status(400).json({ error: 'jobId Ã© obrigatÃ³rio.' }); }

          // 1. (SeguranÃ§a) Deleta as candidaturas primeiro para evitar erro de FK
          await supabaseAdmin.from('applications').delete().eq('jobId', jobId);

          // 2. Deleta a vaga
          const { error: deleteError } = await supabaseAdmin
            .from('jobs')
            .delete()
            .eq('id', jobId)
            .eq('tenantId', tenantId); // SeguranÃ§a
            
          if (deleteError) throw deleteError;
          return response.status(200).json({ message: 'Vaga excluÃ­da com sucesso!' });

        default:
          return response.status(400).json({ error: 'AÃ§Ã£o POST desconhecida.' });
      }
    }

    // Se nÃ£o for GET nem POST
    response.setHeader('Allow', ['GET', 'POST']);
    return response.status(405).json({ error: `MÃ©todo ${request.method} nÃ£o permitido.` });

  } catch (error) {
    console.error("Erro na API de Vagas:", error.message);
    if (error.message.includes('NÃ£o autorizado') || error.message.includes('Token invÃ¡lido')) {
      return response.status(401).json({ error: error.message });
    }
    if (error.message.includes('Acesso negado')) {
      return response.status(403).json({ error: error.message });
    }
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\api\saveEvaluation.js
==================================================
// api/saveEvaluation.js
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  if (request.method !== 'POST') {
    return response.status(405).json({ error: 'MÃ©todo nÃ£o permitido.' });
  }

  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    // 1. Valida o token do usuÃ¡rio de RH
    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });

    // 2. Pega o ID da candidatura e os dados da avaliaÃ§Ã£o do corpo da requisiÃ§Ã£o
    const { applicationId, evaluation } = request.body;
    if (!applicationId || !evaluation) {
      return response.status(400).json({ error: 'applicationId e evaluation sÃ£o obrigatÃ³rios.' });
    }

    // 3. ATUALIZA a candidatura no banco, preenchendo a coluna 'evaluation'
    // Por seguranÃ§a, poderÃ­amos re-validar se o usuÃ¡rio tem acesso a esta vaga,
    // mas vamos manter simples por agora, pois o risco Ã© baixo.
    const { data, error: updateError } = await supabaseAdmin
      .from('applications')
      .update({ evaluation: evaluation }) // Atualiza apenas a coluna 'evaluation'
      .eq('id', applicationId)
      .select()
      .single();

    if (updateError) throw updateError;

    return response.status(200).json({ message: 'AvaliaÃ§Ã£o salva com sucesso!', updatedApplication: data });

  } catch (error) {
    console.error("Erro na funÃ§Ã£o saveEvaluation:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\api\updateHiredStatus.js
==================================================
// api/updateHiredStatus.js (VersÃ£o com data de contrataÃ§Ã£o)
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  if (request.method !== 'POST') {
    return response.status(405).json({ error: 'MÃ©todo nÃ£o permitido.' });
  }

  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    // ValidaÃ§Ã£o do usuÃ¡rio (sem alteraÃ§Ãµes)
    const authHeader = request.headers['authorization'];
    if (!authHeader) return response.status(401).json({ error: 'NÃ£o autorizado.' });
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) return response.status(401).json({ error: 'Token invÃ¡lido.' });
    
    const { applicationId, isHired } = request.body;
    if (!applicationId || typeof isHired !== 'boolean') {
      return response.status(400).json({ error: 'applicationId e isHired (booleano) sÃ£o obrigatÃ³rios.' });
    }

    // AQUI ESTÃ A LÃ“GICA ADITIVA:
    // Se estÃ¡ contratando, define a data atual. Se estÃ¡ "descontratando", define como nulo.
    const updateData = {
      isHired: isHired,
      hiredAt: isHired ? new Date().toISOString() : null
    };

    const { data, error: updateError } = await supabaseAdmin
      .from('applications')
      .update(updateData) // Usa o novo objeto de dados
      .eq('id', applicationId)
      .select()
      .single();

    if (updateError) throw updateError;

    return response.status(200).json({ message: 'Status do candidato atualizado com sucesso!', updatedApplication: data });

  } catch (error) {
    console.error("Erro ao atualizar status de contrataÃ§Ã£o:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\api\updateJobParameters.js
==================================================
// api/updateJobParameters.js
import { createClient } from '@supabase/supabase-js';

export default async function handler(request, response) {
  if (request.method !== 'POST') {
    response.setHeader('Allow', ['POST']);
    return response.status(405).json({ error: `MÃ©todo ${request.method} nÃ£o permitido.` });
  }

  try {
    const supabaseAdmin = createClient(
      process.env.SUPABASE_URL,
      process.env.SUPABASE_SERVICE_KEY
    );

    // 1. Valida o token do usuÃ¡rio para garantir que ele estÃ¡ logado
    const authHeader = request.headers['authorization'];
    if (!authHeader) {
      return response.status(401).json({ error: 'NÃ£o autorizado.' });
    }
    const token = authHeader.replace('Bearer ', '');
    const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(token);
    if (userError) {
      return response.status(401).json({ error: 'Token invÃ¡lido.' });
    }

    // 2. Busca o tenantId do usuÃ¡rio para garantir que ele sÃ³ edite suas prÃ³prias vagas
    const { data: userData } = await supabaseAdmin.from('users').select('tenantId').eq('id', user.id).single();
    if (!userData) {
      return response.status(404).json({ error: 'Perfil de usuÃ¡rio nÃ£o encontrado.' });
    }
    const tenantId = userData.tenantId;

    // 3. Pega o ID da vaga e os novos parÃ¢metros do corpo da requisiÃ§Ã£o
    const { jobId, parameters } = request.body;
    if (!jobId || !parameters) {
      return response.status(400).json({ error: 'jobId e parameters sÃ£o obrigatÃ³rios.' });
    }

    // 4. Atualiza a vaga no banco de dados
    const { data, error: updateError } = await supabaseAdmin
      .from('jobs')
      .update({ parameters: parameters }) // Atualiza apenas a coluna 'parameters'
      .eq('id', jobId)                   // Onde o ID da vaga bate
      .eq('tenantId', tenantId)          // E ONDE a vaga pertence ao tenant do usuÃ¡rio (SEGURANÃ‡A)
      .select()
      .single();

    if (updateError) {
      // Se o erro for 'PGRST116', significa que a vaga nÃ£o foi encontrada (ou nÃ£o pertence ao tenant)
      if (updateError.code === 'PGRST116') {
        return response.status(404).json({ error: 'Vaga nÃ£o encontrada ou vocÃª nÃ£o tem permissÃ£o para editÃ¡-la.' });
      }
      throw updateError;
    }

    // 5. Retorna sucesso
    return response.status(200).json({ message: 'ParÃ¢metros salvos com sucesso!', updatedJob: data });

  } catch (error) {
    console.error("Erro na funÃ§Ã£o updateJobParameters:", error);
    return response.status(500).json({ error: 'Erro interno do servidor.', details: error.message });
  }
}

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\functions\.eslintrc.js
==================================================
module.exports = {
  root: true,
  env: {
    es6: true,
    node: true,
  },
  extends: [
    "eslint:recommended",
    "google",
  ],
  rules: {
    quotes: ["error", "double"],
  },
};

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\functions\index.js
==================================================
const functions = require("firebase-functions");
const admin = require("firebase-admin");

admin.initializeApp();

exports.getJobsByTenant = functions.https.onCall(async (data, context) => {
  if (!context.auth) {
    throw new functions.https.HttpsError(
      "unauthenticated",
      "VocÃª precisa estar autenticado."
    );
  }

  const uid = context.auth.uid;
  const db = admin.firestore();

  try {
    const userDoc = await db.collection("users").doc(uid).get();
    if (!userDoc.exists) {
      throw new functions.https.HttpsError(
        "not-found",
        "UsuÃ¡rio nÃ£o encontrado."
      );
    }
    const tenantId = userDoc.data().tenantId;
    if (!tenantId) {
      throw new functions.https.HttpsError(
        "permission-denied",
        "UsuÃ¡rio sem tenantId."
      );
    }

    const jobsSnapshot = await db.collection("jobs").where("tenantId", "==", tenantId).get();
    const jobs = [];
    jobsSnapshot.forEach((doc) => {
      jobs.push({ id: doc.id, ...doc.data() });
    });

    return { jobs };

  } catch (error) {
    console.error("Erro ao buscar vagas:", error);
    throw new functions.https.HttpsError(
      "internal",
      "Ocorreu um erro ao buscar as vagas."
    );
  }
});

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\functions\package.json
==================================================
{
  "name": "functions",
  "description": "Cloud Functions for Firebase",
  "scripts": {
    "lint": "eslint .",
    "serve": "firebase emulators:start --only functions",
    "shell": "firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "20"
  },
  "main": "index.js",
  "dependencies": {
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^3.24.1"
  },
  "devDependencies": {
    "eslint": "^8.15.0",
    "eslint-plugin-promise": "^6.0.0",
    "firebase-functions-test": "^0.2.0"
  },
  "private": true
}

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\functions\functions\package.json
==================================================
{
  "dependencies": {
    "functions": "file:.."
  }
}


==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\src\App.jsx
==================================================
// src/App.jsx (VersÃ£o com Rota /admin/tenant/:tenantId)
import React from 'react';
import { Routes, Route } from 'react-router-dom';
import { useAuth } from './context/AuthContext';

import LoginPage from './pages/Login.jsx';
import Dashboard from './pages/Dashboard.jsx';
import JobDetails from './pages/JobDetails.jsx';
import ApplicationDetails from './pages/ApplicationDetails.jsx';
import ApplyPage from './pages/ApplyPage.jsx';
import HiredPage from './pages/HiredPage.jsx';
import AdminPage from './pages/AdminPage.jsx';
import AdminTenantPage from './pages/AdminTenantPage.jsx'; // ADICIONADO
import LoadingSpinner from './components/common/LoadingSpinner.jsx';

// Agrupa as rotas do usuÃ¡rio padrÃ£o
const ProtectedRoutes = () => (
  <Routes>
    <Route path="/" element={<Dashboard />} />
    <Route path="/vaga/:jobId" element={<JobDetails />} />
    <Route path="/vaga/:jobId/candidato/:applicationId" element={<ApplicationDetails />} />
    <Route path="/aprovados" element={<HiredPage />} />
    <Route path="/admin" element={<AdminPage />} />
    <Route path="/admin/tenant/:tenantId" element={<AdminTenantPage />} /> {/* ADICIONADO */}
  </Routes>
);

function App() {
    const { currentUser, loading } = useAuth();

    if (loading) {
        return <LoadingSpinner />;
    }

    return (
        <Routes>
            {/* ROTA PÃšBLICA */}
            <Route path="/vaga/:jobId/apply" element={<ApplyPage />} />

            {/* ROTAS PRIVADAS */}
            <Route path="/*" element={currentUser ? <ProtectedRoutes /> : <LoginPage />} />
        </Routes>
    );
}

export default App;

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\src\main.jsx
==================================================
// src/main.jsx (Corrigido)
import React from 'react';
import ReactDOM from 'react-dom/client';
import { BrowserRouter } from 'react-router-dom';
import App from './App.jsx';
import { AuthProvider } from './context/AuthContext.jsx';
import { CssBaseline, ThemeProvider, createTheme } from '@mui/material';

// Imports para o Date Picker
import { LocalizationProvider } from '@mui/x-date-pickers';
import { AdapterDateFns } from '@mui/x-date-pickers/AdapterDateFns'; // <-- LINHA CORRIGIDA
import { ptBR } from 'date-fns/locale';

const theme = createTheme();

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <LocalizationProvider dateAdapter={AdapterDateFns} adapterLocale={ptBR}>
      <ThemeProvider theme={theme}>
        <CssBaseline />
        <AuthProvider>
          <BrowserRouter>
            <App />
          </BrowserRouter>
        </AuthProvider>
      </ThemeProvider>
    </LocalizationProvider>
  </React.StrictMode>,
);

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\src\components\charts\ClassificationChart.jsx
==================================================
// src/components/charts/ClassificationChart.jsx
import React from 'react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, LabelList } from 'recharts';
import { Box } from '@mui/material';

const ClassificationChart = ({ data }) => {
  // O Recharts espera os dados com os candidatos no eixo Y, entÃ£o nÃ£o precisamos de transformaÃ§Ãµes
  return (
    <Box sx={{ width: '100%', height: 300, mt: 4 }}>
      <ResponsiveContainer>
        <BarChart
          layout="vertical"
          data={data}
          margin={{
            top: 5,
            right: 30,
            left: 100, // Aumenta o espaÃ§o para nomes longos
            bottom: 5,
          }}
        >
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis type="number" />
          <YAxis dataKey="candidateName" type="category" width={150} />
          <Tooltip />
          <Legend />
          <Bar dataKey="notaTriagem" stackId="a" fill="#3f51b5" name="Nota Triagem">
            <LabelList dataKey="notaTriagem" position="center" fill="#fff" formatter={(value) => value.toFixed(1)} />
          </Bar>
          <Bar dataKey="notaCultura" stackId="a" fill="#8884d8" name="Nota Cultura">
             <LabelList dataKey="notaCultura" position="center" fill="#fff" formatter={(value) => value.toFixed(1)} />
          </Bar>
          <Bar dataKey="notaTecnico" stackId="a" fill="#82ca9d" name="Nota TÃ©cnico">
             <LabelList dataKey="notaTecnico" position="center" fill="#fff" formatter={(value) => value.toFixed(1)} />
          </Bar>
        </BarChart>
      </ResponsiveContainer>
    </Box>
  );
};

export default ClassificationChart;

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\src\components\common\LoadingSpinner.jsx
==================================================
import React from 'react';
import { Box, CircularProgress } from '@mui/material';

const LoadingSpinner = () => {
    return (
        <Box
            sx={{
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'center',
                height: '100vh',
                width: '100vw',
            }}
        >
            <CircularProgress />
        </Box>
    );
};

export default LoadingSpinner;

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\src\components\evaluation_v2\EvaluationDashboardV2.jsx
==================================================
import React, { useEffect, useState } from 'react';
import { prepareEvaluationV2, getEvaluationSummaryV2 } from '../../services/evaluationService';
import { supabase } from '../../supabase/client';

export default function EvaluationDashboardV2({ applicationId, jobId, currentUser }) {
  const [loading, setLoading] = useState(true);
  const [summary, setSummary] = useState(null);
  const [viewMode, setViewMode] = useState('summary'); // 'summary' ou 'evaluate'

  useEffect(() => {
    const init = async () => {
      try {
        setLoading(true);
        // Garante que o banco estÃ¡ pronto
        await prepareEvaluationV2(jobId);
        // Carrega dados
        const data = await getEvaluationSummaryV2(applicationId);
        setSummary(data);
      } catch (error) {
        console.error("Erro ao carregar V2:", error);
      } finally {
        setLoading(false);
      }
    };
    if (jobId && applicationId) init();
  }, [applicationId, jobId]);

  if (loading) return <div className="p-4 text-center">Carregando AvaliaÃ§Ã£o 360Âº...</div>;

  return (
    <div className="bg-white rounded-lg shadow p-6 mt-6">
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-2xl font-bold text-gray-800">AvaliaÃ§Ã£o 360Âº</h2>
        <button 
          onClick={() => setViewMode(viewMode === 'summary' ? 'evaluate' : 'summary')}
          className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition"
        >
          {viewMode === 'summary' ? 'Minha AvaliaÃ§Ã£o' : 'Voltar ao Resumo'}
        </button>
      </div>

      {viewMode === 'summary' ? (
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          {/* Card da Nota Final */}
          <div className="bg-gray-50 p-6 rounded-xl border border-gray-200 text-center">
            <span className="block text-gray-500 text-sm uppercase tracking-wide">MÃ©dia Geral</span>
            <span className="block text-5xl font-extrabold text-blue-600 mt-2">
              {summary?.final_score || '-'}
            </span>
          </div>
          
          {/* Lista de Avaliadores */}
          <div className="col-span-2">
            <h3 className="font-semibold text-gray-700 mb-3">Avaliadores Participantes</h3>
            <div className="flex gap-2">
              {summary?.evaluators?.map(ev => (
                <span key={ev.id} className="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">
                  {ev.name}
                </span>
              ))}
              {(!summary?.evaluators || summary.evaluators.length === 0) && (
                <span className="text-gray-400 italic">Nenhuma avaliaÃ§Ã£o concluÃ­da ainda.</span>
              )}
            </div>
          </div>
        </div>
      ) : (
        <div className="p-4 bg-yellow-50 border border-yellow-200 rounded text-yellow-800">
          {/* AQUI ENTRARÃ O FORMULÃRIO DE NOTAS NO PRÃ“XIMO PASSO */}
          <p>O formulÃ¡rio de avaliaÃ§Ã£o individual serÃ¡ carregado aqui.</p>
        </div>
      )}
    </div>
  );
}

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\src\components\jobs\CreateJobModal.jsx
==================================================
// src/components/jobs/CreateJobModal.jsx (VersÃ£o Final)
import React, { useState } from 'react';
import { supabase } from '../../supabase/client';
import { Modal, Box, Typography, TextField, Button, CircularProgress, Alert } from '@mui/material';

// Estilo para a caixa do modal
const style = {
  position: 'absolute',
  top: '50%',
  left: '50%',
  transform: 'translate(-50%, -50%)',
  width: 400,
  bgcolor: 'background.paper',
  boxShadow: 24,
  p: 4,
  borderRadius: 2,
};

// Adicionamos a prop 'onJobCreated' para avisar o Dashboard que uma nova vaga foi criada
const CreateJobModal = ({ open, handleClose, onJobCreated }) => {
  const [jobTitle, setJobTitle] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');

  const handleSubmit = async (event) => {
    event.preventDefault();
    setLoading(true);
    setError('');

    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) throw new Error("VocÃª nÃ£o estÃ¡ autenticado.");

      // ESTA Ã‰ A LÃ“GICA CORRETA: Chamar a nossa API de backend
      const response = await fetch('/api/createJob', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${session.access_token}`,
        },
        body: JSON.stringify({ title: jobTitle }),
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || "NÃ£o foi possÃ­vel criar a vaga.");
      }

      // Limpa o formulÃ¡rio, avisa o componente pai e fecha o modal
      setJobTitle('');
      onJobCreated(); 
      handleClose();

    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <Modal
      open={open}
      onClose={handleClose}
      aria-labelledby="create-job-modal-title"
    >
      <Box sx={style} component="form" onSubmit={handleSubmit}>
        <Typography id="create-job-modal-title" variant="h6" component="h2">
          Criar Nova Vaga
        </Typography>
        <TextField
          margin="normal"
          required
          fullWidth
          id="jobTitle"
          label="Nome da Vaga"
          name="jobTitle"
          autoFocus
          value={jobTitle}
          onChange={(e) => setJobTitle(e.target.value)}
        />
        {error && <Alert severity="error" sx={{mt: 2}}>{error}</Alert>}
        <Box sx={{ mt: 2, display: 'flex', justifyContent: 'flex-end', gap: 1 }}>
          <Button onClick={handleClose}>Cancelar</Button>
          <Button type="submit" variant="contained" disabled={loading || !jobTitle}>
            {loading ? <CircularProgress size={24} /> : 'Criar Vaga'}
          </Button>
        </Box>
      </Box>
    </Modal>
  );
};

export default CreateJobModal;

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\src\context\AuthContext.jsx
==================================================
import React, { createContext, useState, useEffect, useContext } from 'react';
import { supabase } from '../supabase/client.js';

const AuthContext = createContext();

export const useAuth = () => {
    return useContext(AuthContext);
};

export const AuthProvider = ({ children }) => {
    const [currentUser, setCurrentUser] = useState(null);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        const getSession = async () => {
            const { data: { session } } = await supabase.auth.getSession();
            setCurrentUser(session?.user ?? null);
            setLoading(false);
        };

        getSession();

        const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
            setCurrentUser(session?.user ?? null);
        });

        return () => {
            subscription?.unsubscribe();
        };
    }, []);

    const value = {
        currentUser,
        loading // Adicionamos o 'loading' ao contexto
    };

    return (
        <AuthContext.Provider value={value}>
            {children}
        </AuthContext.Provider>
    );
};

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\src\data\brazil-locations.js
==================================================
// src/data/brazil-locations.js
export const estados = [
  { sigla: 'AC', nome: 'Acre' },
  { sigla: 'AL', nome: 'Alagoas' },
  { sigla: 'AP', nome: 'AmapÃ¡' },
  { sigla: 'AM', nome: 'Amazonas' },
  { sigla: 'BA', nome: 'Bahia' },
  { sigla: 'CE', nome: 'CearÃ¡' },
  { sigla: 'DF', nome: 'Distrito Federal' },
  { sigla: 'ES', nome: 'EspÃ­rito Santo' },
  { sigla: 'GO', nome: 'GoiÃ¡s' },
  { sigla: 'MA', nome: 'MaranhÃ£o' },
  { sigla: 'MT', nome: 'Mato Grosso' },
  { sigla: 'MS', nome: 'Mato Grosso do Sul' },
  { sigla: 'MG', nome: 'Minas Gerais' },
  { sigla: 'PA', nome: 'ParÃ¡' },
  { sigla: 'PB', nome: 'ParaÃ­ba' },
  { sigla: 'PR', nome: 'ParanÃ¡' },
  { sigla: 'PE', nome: 'Pernambuco' },
  { sigla: 'PI', nome: 'PiauÃ­' },
  { sigla: 'RJ', nome: 'Rio de Janeiro' },
  { sigla: 'RN', nome: 'Rio Grande do Norte' },
  { sigla: 'RS', nome: 'Rio Grande do Sul' },
  { sigla: 'RO', nome: 'RondÃ´nia' },
  { sigla: 'RR', nome: 'Roraima' },
  { sigla: 'SC', nome: 'Santa Catarina' },
  { sigla: 'SP', nome: 'SÃ£o Paulo' },
  { sigla: 'SE', nome: 'Sergipe' },
  { sigla: 'TO', nome: 'Tocantins' }
];

// No futuro, podemos substituir o campo de cidade por uma busca via API de CEP
// Por enquanto, usaremos um campo de texto simples para a cidade.

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\src\pages\AdminPage.jsx
==================================================
// src/pages/AdminPage.jsx (VersÃ£o com Link para /admin/tenant/:tenantId)
import React, { useState, useEffect, forwardRef } from 'react';
import { Link as RouterLink } from 'react-router-dom';
import { supabase } from '../supabase/client';
import { 
    Container, Typography, Box, AppBar, Toolbar, Button, CircularProgress, 
    Alert, Paper, Table, TableHead, TableRow, TableCell, TableBody, Tabs, Tab,
    Modal, FormControl, InputLabel, Select, MenuItem, Snackbar, TextField,
    Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, IconButton, Grid
} from '@mui/material';
import { IMaskInput } from 'react-imask';
import AddIcon from '@mui/icons-material/Add';
import EditIcon from '@mui/icons-material/Edit';
import DeleteIcon from '@mui/icons-material/Delete';

// MÃ¡scara CNPJ (sem alteraÃ§Ãµes)
const CnpjMask = forwardRef(function CnpjMask(props, ref) {
  const { onChange, ...other } = props;
  return (
    <IMaskInput
      {...other}
      mask="00.000.000/0000-00"
      definitions={{
        '#': /[1-9]/,
      }}
      inputRef={ref}
      onAccept={(value) => onChange({ target: { name: props.name, value } })}
      overwrite
    />
  );
});

// Estilo Modal (sem alteraÃ§Ãµes)
const modalStyle = {
  position: 'absolute',
  top: '50%',
  left: '50%',
  transform: 'translate(-50%, -50%)',
  width: 500,
  bgcolor: 'background.paper',
  boxShadow: 24,
  p: 4,
};

// Componente do FormulÃ¡rio de Plano (sem alteraÃ§Ãµes)
const PlanFormModal = ({ open, onClose, plan, onSave }) => {
  const [formData, setFormData] = useState({ id: '', name: '', user_limit: 1, job_limit: 1, candidate_limit: 1, price: 0 });
  const [isSaving, setIsSaving] = useState(false);
  const [error, setError] = useState('');
  const isEditMode = Boolean(plan);
  useEffect(() => { if (plan) { setFormData(plan); } else { setFormData({ id: '', name: '', user_limit: 1, job_limit: 1, candidate_limit: 1, price: 0 }); } }, [plan, open]);
  const handleChange = (e) => { const { name, value } = e.target; setFormData(prev => ({ ...prev, [name]: value })); };
  const handleNumericChange = (e) => { const { name, value } = e.target; const numValue = value === '-1' ? -1 : parseInt(value, 10) || 0; setFormData(prev => ({ ...prev, [name]: numValue })); };
  const handleSubmit = async () => {
    setIsSaving(true);
    setError('');
    try {
      const action = isEditMode ? 'updatePlan' : 'createPlan';
      const body = isEditMode ? { planId: plan.id, planData: formData } : { planData: formData };
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
      const response = await fetch('/api/admin', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
          body: JSON.stringify({ action, ...body })
      });
      if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error || "Ocorreu um erro."); }
      const data = await response.json();
      onSave(isEditMode ? data.updatedPlan : data.newPlan);
      onClose();
    } catch (err) { setError(err.message); } 
    finally { setIsSaving(false); }
  };
  return (
    <Modal open={open} onClose={onClose}>
      <Box sx={modalStyle}>
        <Typography variant="h6" gutterBottom>{isEditMode ? 'Editar Plano' : 'Criar Novo Plano'}</Typography>
        <Grid container spacing={2}>
          <Grid item xs={12}><TextField name="id" label="ID do Plano (ex: 'basico')" value={formData.id} onChange={handleChange} fullWidth margin="normal" required disabled={isEditMode} /></Grid>
          <Grid item xs={12}><TextField name="name" label="Nome do Plano (ex: 'Plano BÃ¡sico')" value={formData.name} onChange={handleChange} fullWidth margin="normal" required /></Grid>
          <Grid item xs={12}><TextField name="price" label="PreÃ§o (ex: 99.00)" type="number" value={formData.price} onChange={handleChange} fullWidth margin="normal" required /></Grid>
          <Grid item xs={12} sm={4}><TextField name="user_limit" label="Limite de UsuÃ¡rios" type="number" value={formData.user_limit} onChange={handleNumericChange} fullWidth margin="normal" helperText="-1 para ilimitado" /></Grid>
          <Grid item xs={12} sm={4}><TextField name="job_limit" label="Limite de Vagas" type="number" value={formData.job_limit} onChange={handleNumericChange} fullWidth margin="normal" helperText="-1 para ilimitado" /></Grid>
          <Grid item xs={12} sm={4}><TextField name="candidate_limit" label="Limite de Candidatos/Vaga" type="number" value={formData.candidate_limit} onChange={handleNumericChange} fullWidth margin="normal" helperText="-1 para ilimitado" /></Grid>
        </Grid>
        {error && <Alert severity="error" sx={{ mt: 2 }}>{error}</Alert>}
        <Box sx={{ mt: 3, display: 'flex', justifyContent: 'flex-end', gap: 1 }}>
          <Button onClick={onClose} disabled={isSaving}>Cancelar</Button>
          <Button variant="contained" onClick={handleSubmit} disabled={isSaving}>
            {isSaving ? <CircularProgress size={24} /> : 'Salvar'}
          </Button>
        </Box>
      </Box>
    </Modal>
  );
};

// Tabela de Planos (sem alteraÃ§Ãµes)
const PlansTable = ({ plans, onAdd, onEdit, onDelete }) => (
  <>
    <Box sx={{ display: 'flex', justifyContent: 'flex-end', my: 2 }}>
        <Button variant="contained" startIcon={<AddIcon />} onClick={onAdd}>
            Criar Novo Plano
        </Button>
    </Box>
    <Paper>
      <Table>
        <TableHead>
          <TableRow>
            <TableCell sx={{ fontWeight: 'bold' }}>ID do Plano</TableCell>
            <TableCell sx={{ fontWeight: 'bold' }}>Nome</TableCell>
            <TableCell align="center" sx={{ fontWeight: 'bold' }}>UsuÃ¡rios</TableCell>
            <TableCell align="center" sx={{ fontWeight: 'bold' }}>Vagas</TableCell>
            <TableCell align="center" sx={{ fontWeight: 'bold' }}>Candidatos/Vaga</TableCell>
            <TableCell align="right" sx={{ fontWeight: 'bold' }}>PreÃ§o</TableCell>
            <TableCell align="center" sx={{ fontWeight: 'bold' }}>AÃ§Ãµes</TableCell>
          </TableRow>
        </TableHead>
        <TableBody>
          {plans.map((plan) => (
            <TableRow hover key={plan.id}>
              <TableCell>{plan.id}</TableCell>
              <TableCell>{plan.name}</TableCell>
              <TableCell align="center">{plan.user_limit === -1 ? 'Ilimitado' : plan.user_limit}</TableCell>
              <TableCell align="center">{plan.job_limit === -1 ? 'Ilimitado' : plan.job_limit}</TableCell>
              <TableCell align="center">{plan.candidate_limit === -1 ? 'Ilimitado' : plan.candidate_limit}</TableCell>
              <TableCell align="right">R$ {plan.price.toFixed(2)}</TableCell>
              <TableCell align="center">
                <IconButton size="small" onClick={() => onEdit(plan)}><EditIcon /></IconButton>
                <IconButton size="small" onClick={() => onDelete(plan)}><DeleteIcon color="error" /></IconButton>
              </TableCell>
            </TableRow>
          ))}
        </TableBody>
      </Table>
    </Paper>
  </>
);

// Tabela de Tenants (AQUI ESTÃ A MUDANÃ‡A)
const TenantsTable = ({ tenants, plans, onTenantUpdated, onTenantCreated, onTenantDeleted }) => {
  const [modalOpen, setModalOpen] = useState(false);
  const [dialogOpen, setDialogOpen] = useState(false);
  const [isSaving, setIsSaving] = useState(false);
  const [selectedTenant, setSelectedTenant] = useState(null);
  const [formData, setFormData] = useState({ companyName: '', planId: '', cnpj: '' });
  
  const handleOpenModal = (tenant = null) => {
    setSelectedTenant(tenant);
    if (tenant) { setFormData({ companyName: tenant.companyName, planId: tenant.planId, cnpj: tenant.cnpj || '' }); }
    else { setFormData({ companyName: '', planId: '', cnpj: '' }); }
    setModalOpen(true);
  };
  const handleOpenDialog = (tenant) => { setSelectedTenant(tenant); setDialogOpen(true); };
  const handleClose = () => { setModalOpen(false); setDialogOpen(false); setSelectedTenant(null); };
  const handleChange = (e) => { const { name, value } = e.target; setFormData(prev => ({ ...prev, [name]: value })); };
  const callApi = async (action, body) => {
    const { data: { session } } = await supabase.auth.getSession();
    if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
    const response = await fetch('/api/admin', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
        body: JSON.stringify({ action, ...body })
    });
    if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error || "Ocorreu um erro."); }
    return await response.json();
  };
  const handleSubmit = async () => {
    setIsSaving(true);
    try {
      if (selectedTenant) { const data = await callApi('updateTenant', { id: selectedTenant.id, ...formData }); onTenantUpdated(data.updatedTenant); }
      else { const data = await callApi('createTenant', formData); onTenantCreated(data.newTenant); }
      handleClose();
    } catch (err) { console.error("Erro ao salvar empresa:", err); } 
    finally { setIsSaving(false); }
  };
  const handleDelete = async () => {
    setIsSaving(true);
    try {
      await callApi('deleteTenant', { tenantId: selectedTenant.id });
      onTenantDeleted(selectedTenant.id);
      handleClose();
    } catch (err) { console.error("Erro ao excluir empresa:", err); } 
    finally { setIsSaving(false); }
  };

  return (
    <>
      <Box sx={{ display: 'flex', justifyContent: 'flex-end', my: 2 }}>
        <Button variant="contained" startIcon={<AddIcon />} onClick={() => handleOpenModal()}>
            Criar Nova Empresa
        </Button>
      </Box>
      <Paper>
        <Table>
          <TableHead>
            <TableRow>
              <TableCell sx={{ fontWeight: 'bold' }}>Nome da Empresa</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>CNPJ</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Plano Atual</TableCell>
              <TableCell align="right" sx={{ fontWeight: 'bold' }}>AÃ§Ãµes</TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {tenants.map((tenant) => (
              <TableRow hover key={tenant.id}>
                <TableCell>{tenant.companyName}</TableCell>
                <TableCell>{tenant.cnpj}</TableCell>
                <TableCell>{tenant.plans ? tenant.plans.name : tenant.planId}</TableCell>
                <TableCell align="right">
                    {/* AQUI ESTÃ A MUDANÃ‡A: O botÃ£o agora Ã© um Link */}
                    <Button size="small" component={RouterLink} to={`/admin/tenant/${tenant.id}`}>
                      Gerenciar UsuÃ¡rios
                    </Button>
                    <IconButton size="small" onClick={() => handleOpenModal(tenant)}><EditIcon /></IconButton>
                    <IconButton size="small" onClick={() => handleOpenDialog(tenant)}><DeleteIcon color="error" /></IconButton>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </Paper>
      <Modal open={modalOpen} onClose={handleClose}>
        <Box sx={modalStyle}>
          <Typography variant="h6" gutterBottom>{selectedTenant ? 'Editar Empresa' : 'Criar Nova Empresa'}</Typography>
          <TextField name="companyName" label="Nome da Empresa" value={formData.companyName} onChange={handleChange} fullWidth margin="normal" required />
          <TextField name="cnpj" label="CNPJ" value={formData.cnpj} onChange={handleChange} fullWidth margin="normal" InputProps={{ inputComponent: CnpjMask }} />
          <FormControl fullWidth margin="normal" required>
            <InputLabel id="plan-select-label">Plano</InputLabel>
            <Select name="planId" labelId="plan-select-label" value={formData.planId} label="Plano" onChange={handleChange}>
              {plans.map(plan => (
                <MenuItem key={plan.id} value={plan.id}>{plan.name}</MenuItem>
              ))}
            </Select>
          </FormControl>
          <Box sx={{ mt: 3, display: 'flex', justifyContent: 'flex-end', gap: 1 }}>
            <Button onClick={handleClose} disabled={isSaving}>Cancelar</Button>
            <Button variant="contained" onClick={handleSubmit} disabled={isSaving}>
              {isSaving ? <CircularProgress size={24} /> : 'Salvar'}
            </Button>
          </Box>
        </Box>
      </Modal>
      <Dialog open={dialogOpen} onClose={handleClose}>
        <DialogTitle>Confirmar ExclusÃ£o</DialogTitle>
        <DialogContent><DialogContentText>VocÃª tem certeza que deseja excluir a empresa <strong>{selectedTenant?.companyName}</strong>? Esta aÃ§Ã£o Ã© irreversÃ­vel.</DialogContentText></DialogContent>
        <DialogActions>
          <Button onClick={handleClose} disabled={isSaving}>Cancelar</Button>
          <Button onClick={handleDelete} color="error" disabled={isSaving}>
            {isSaving ? <CircularProgress size={24} /> : 'Excluir'}
          </Button>
        </DialogActions>
      </Dialog>
    </>
  );
};

// Componente Principal da PÃ¡gina
const AdminPage = () => {
    const [tenants, setTenants] = useState([]);
    const [plans, setPlans] = useState([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState('');
    const [tabValue, setTabValue] = useState(0);
    const [feedback, setFeedback] = useState({ open: false, message: '', severity: 'success' });
    const [planModalOpen, setPlanModalOpen] = useState(false);
    const [selectedPlan, setSelectedPlan] = useState(null);
    const [planDialogOpen, setPlanDialogOpen] = useState(false);

    const fetchData = async () => {
        setLoading(true);
        try {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
            const response = await fetch('/api/admin?action=getTenantsAndPlans', {
                headers: { 'Authorization': `Bearer ${session.access_token}` },
            });
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || "NÃ£o foi possÃ­vel buscar os dados.");
            }
            const data = await response.json();
            setTenants(data.tenants || []);
            setPlans(data.plans || []);
        } catch (err) {
            console.error("Erro ao buscar dados de admin:", err);
            setError(err.message);
        } finally {
            setLoading(false);
        }
    };

    useEffect(() => {
        fetchData();
    }, []);

    const handleTabChange = (event, newValue) => { setTabValue(newValue); };

    const handleTenantUpdated = (updatedTenant) => {
      setTenants(prevTenants => prevTenants.map(t => 
        t.id === updatedTenant.id ? { ...t, ...updatedTenant, plans: plans.find(p => p.id === updatedTenant.planId) } : t
      ));
      setFeedback({ open: true, message: 'Empresa atualizada!', severity: 'success' });
    };
    const handleTenantCreated = (newTenant) => {
      setTenants(prevTenants => [
        ...prevTenants, 
        { ...newTenant, plans: plans.find(p => p.id === newTenant.planId) }
      ]);
      setFeedback({ open: true, message: 'Empresa criada!', severity: 'success' });
    };
    const handleTenantDeleted = (deletedTenantId) => {
      setTenants(prevTenants => prevTenants.filter(t => t.id !== deletedTenantId));
      setFeedback({ open: true, message: 'Empresa excluÃ­da!', severity: 'success' });
    };
    const handleOpenPlanModal = (plan = null) => {
      setSelectedPlan(plan);
      setPlanModalOpen(true);
    };
    const handleClosePlanModal = () => {
      setSelectedPlan(null);
      setPlanModalOpen(false);
    };
    const handleSavePlan = (savedPlan) => {
      if (selectedPlan) {
        setPlans(prev => prev.map(p => p.id === savedPlan.id ? savedPlan : p));
      } else {
        setPlans(prev => [...prev, savedPlan]);
      }
      setFeedback({ open: true, message: 'Plano salvo!', severity: 'success' });
    };
    const handleOpenPlanDialog = (plan) => {
      setSelectedPlan(plan);
      setPlanDialogOpen(true);
    };
    const handleClosePlanDialog = () => {
      setSelectedPlan(null);
      setPlanDialogOpen(false);
    };
    const handleDeletePlan = async () => {
      if (!selectedPlan) return;
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
        const response = await fetch('/api/admin', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
            body: JSON.stringify({ action: 'deletePlan', planId: selectedPlan.id })
        });
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || "Erro ao excluir.");
        }
        setPlans(prev => prev.filter(p => p.id !== selectedPlan.id));
        setFeedback({ open: true, message: 'Plano excluÃ­do!', severity: 'success' });
        handleClosePlanDialog();
      } catch (err) {
        console.error("Erro ao excluir plano:", err);
        setFeedback({ open: true, message: err.message, severity: 'error' });
      }
    };
    
    const renderContent = () => {
        if (loading) {
            return <Box sx={{ display: 'flex', justifyContent: 'center', my: 5 }}><CircularProgress /></Box>;
        }
        if (error) {
            return <Alert severity="error">{error}</Alert>;
        }
        return (
            <Box>
                <Box sx={{ borderBottom: 1, borderColor: 'divider' }}>
                    <Tabs value={tabValue} onChange={handleTabChange}>
                        <Tab label="Empresas (Tenants)" />
                        <Tab label="Planos" />
                    </Tabs>
                </Box>
                <Box hidden={tabValue !== 0}>
                    <TenantsTable 
                      tenants={tenants} 
                      plans={plans} 
                      onTenantUpdated={handleTenantUpdated}
                      onTenantCreated={handleTenantCreated}
                      onTenantDeleted={handleTenantDeleted}
                    />
                </Box>
                <Box hidden={tabValue !== 1}>
                    <PlansTable 
                      plans={plans} 
                      onAdd={() => handleOpenPlanModal()}
                      onEdit={(plan) => handleOpenPlanModal(plan)}
                      onDelete={(plan) => handleOpenPlanDialog(plan)}
                    />
                </Box>
            </Box>
        );
    };

    return (
        <Box>
            <AppBar position="static">
                <Toolbar>
                    <Typography variant="h6" component="div" sx={{ flexGrow: 1 }}>
                        Painel de AdministraÃ§Ã£o
                    </Typography>
                    <Button color="inherit" component={RouterLink} to="/">
                        Voltar para o App
                    </Button>
                </Toolbar>
            </AppBar>
            <Container sx={{ mt: 4 }}>
                <Typography variant="h4" component="h1" gutterBottom>
                    Gerenciamento do Sistema
                </Typography>
                {renderContent()}
            </Container>
            <PlanFormModal
              open={planModalOpen}
              onClose={handleClosePlanModal}
              plan={selectedPlan}
              onSave={handleSavePlan}
            />
            <Dialog open={planDialogOpen} onClose={handleClosePlanDialog}>
              <DialogTitle>Confirmar ExclusÃ£o</DialogTitle>
              <DialogContent>
                <DialogContentText>
                  VocÃª tem certeza que deseja excluir o plano <strong>{selectedPlan?.name}</strong>? Esta aÃ§Ã£o nÃ£o pode ser desfeita.
                </DialogContentText>
              </DialogContent>
              <DialogActions>
                <Button onClick={handleClosePlanDialog}>Cancelar</Button>
                <Button onClick={handleDeletePlan} color="error">Excluir</Button>
              </DialogActions>
            </Dialog>
            <Snackbar open={feedback.open} autoHideDuration={4000} onClose={() => setFeedback({open: false, message: ''})}>
                <Alert onClose={() => setFeedback({open: false, message: ''})} severity={feedback.severity || 'success'} sx={{ width: '100%' }}>
                  {feedback.message}
                </Alert>
            </Snackbar>
        </Box>
    );
};

export default AdminPage;

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\src\pages\AdminTenantPage.jsx
==================================================
// src/pages/AdminTenantPage.jsx (VERSÃƒO FINAL E CORRIGIDA)
import React, { useState, useEffect } from 'react';
import { useParams, Link as RouterLink } from 'react-router-dom';
import { supabase } from '../supabase/client';
import { 
    Container, Typography, Box, AppBar, Toolbar, Button, CircularProgress, 
    Alert, Paper, Table, TableHead, TableRow, TableCell, TableBody,
    Modal, TextField, Checkbox, FormControlLabel, Snackbar,
    Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, IconButton
} from '@mui/material';
import AddIcon from '@mui/icons-material/Add';
import EditIcon from '@mui/icons-material/Edit';
import DeleteIcon from '@mui/icons-material/Delete';

// Estilo para o Modal
const modalStyle = {
  position: 'absolute',
  top: '50%',
  left: '50%',
  transform: 'translate(-50%, -50%)',
  width: 500,
  bgcolor: 'background.paper',
  boxShadow: 24,
  p: 4,
};

// Componente do FormulÃ¡rio de UsuÃ¡rio
const UserFormModal = ({ open, onClose, user, tenantId, onSave }) => {
  const [formData, setFormData] = useState({ email: '', password: '', name: '', role: 'rh', isAdmin: false });
  const [isSaving, setIsSaving] = useState(false);
  const [error, setError] = useState('');
  const isEditMode = Boolean(user);

  useEffect(() => {
    if (user) {
      setFormData({ 
        name: user.name, 
        role: user.role, 
        isAdmin: user.isAdmin,
        email: user.email || '', // O email nÃ£o pode ser editado
      });
    } else {
      setFormData({ email: '', password: '', name: '', role: 'rh', isAdmin: false });
    }
  }, [user, open]);

  const handleChange = (e) => {
    const { name, value, type, checked } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: type === 'checkbox' ? checked : value
    }));
  };

  const handleSubmit = async () => {
    setIsSaving(true);
    setError('');
    try {
      const action = isEditMode ? 'updateUser' : 'createUser';
      // No modo de ediÃ§Ã£o, nÃ£o enviamos email/senha/tenantId
      const body = isEditMode 
        ? { action, userId: user.id, name: formData.name, role: formData.role, isAdmin: formData.isAdmin }
        : { action, ...formData, tenantId: tenantId };
      
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
      
      const response = await fetch('/api/admin', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
          body: JSON.stringify(body)
      });
      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || "Ocorreu um erro.");
      }
      const data = await response.json();
      onSave(isEditMode ? data.updatedUser : data.newUser);
      onClose();
    } catch (err) {
      setError(err.message);
    } finally {
      setIsSaving(false);
    }
  };

  return (
    <Modal open={open} onClose={onClose}>
      <Box sx={modalStyle}>
        <Typography variant="h6" gutterBottom>{isEditMode ? 'Editar UsuÃ¡rio' : 'Criar Novo UsuÃ¡rio'}</Typography>
        <TextField name="email" label="Email do UsuÃ¡rio" value={formData.email} onChange={handleChange} fullWidth margin="normal" required disabled={isEditMode} />
        {!isEditMode && (
          <TextField name="password" label="Senha ProvisÃ³ria" type="password" value={formData.password} onChange={handleChange} fullWidth margin="normal" required />
        )}
        <TextField name="name" label="Nome Completo" value={formData.name} onChange={handleChange} fullWidth margin="normal" required />
        <TextField name="role" label="FunÃ§Ã£o (ex: rh, gestor)" value={formData.role} onChange={handleChange} fullWidth margin="normal" required />
        <FormControlLabel
          control={<Checkbox name="isAdmin" checked={formData.isAdmin} onChange={handleChange} />}
          label="Este usuÃ¡rio Ã© Administrador?"
        />
        {error && <Alert severity="error" sx={{ mt: 2 }}>{error}</Alert>}
        <Box sx={{ mt: 3, display: 'flex', justifyContent: 'flex-end', gap: 1 }}>
          <Button onClick={onClose} disabled={isSaving}>Cancelar</Button>
          <Button variant="contained" onClick={handleSubmit} disabled={isSaving}>
            {isSaving ? <CircularProgress size={24} /> : 'Salvar'}
          </Button>
        </Box>
      </Box>
    </Modal>
  );
};


const AdminTenantPage = () => {
    const { tenantId } = useParams();
    const [tenant, setTenant] = useState(null);
    const [users, setUsers] = useState([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState('');
    const [modalOpen, setModalOpen] = useState(false);
    const [dialogOpen, setDialogOpen] = useState(false);
    const [selectedUser, setSelectedUser] = useState(null);
    const [feedback, setFeedback] = useState({ open: false, message: '', severity: 'success' });

    const fetchTenantDetails = async () => {
        setLoading(true);
        try {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
            const response = await fetch(`/api/admin?action=getTenantDetails&tenantId=${tenantId}`, {
                headers: { 'Authorization': `Bearer ${session.access_token}` },
            });
            if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error || "NÃ£o foi possÃ­vel buscar os dados."); }
            const data = await response.json();
            setTenant(data.tenant || null);
            setUsers(data.users || []);
        } catch (err) {
            console.error("Erro ao buscar detalhes do tenant:", err);
            setError(err.message);
        } finally {
            setLoading(false);
        }
    };

    useEffect(() => {
        fetchTenantDetails();
    }, [tenantId]);

    const handleOpenModal = (user = null) => {
      setSelectedUser(user);
      setModalOpen(true);
    };
    const handleCloseModal = () => {
      setSelectedUser(null);
      setModalOpen(false);
    };
    const handleOpenDialog = (user) => {
      setSelectedUser(user);
      setDialogOpen(true);
    };
    const handleCloseDialog = () => {
      setSelectedUser(null);
      setDialogOpen(false);
    };

    const handleSaveUser = (savedUser) => {
      if (selectedUser) {
        setUsers(prev => prev.map(u => u.id === savedUser.id ? savedUser : u));
      } else {
        setUsers(prev => [...prev, savedUser]);
      }
      setFeedback({ open: true, message: 'UsuÃ¡rio salvo!', severity: 'success' });
    };

    const handleDeleteUser = async () => {
      if (!selectedUser) return;
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
        
        const response = await fetch('/api/admin', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
            body: JSON.stringify({ action: 'deleteUser', userId: selectedUser.id })
        });
        if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error || "Erro ao excluir."); }
        
        setUsers(prev => prev.filter(u => u.id !== selectedUser.id));
        setFeedback({ open: true, message: 'UsuÃ¡rio excluÃ­do!', severity: 'success' });
        handleCloseDialog();
      } catch (err) {
        console.error("Erro ao excluir usuÃ¡rio:", err);
        setFeedback({ open: true, message: err.message, severity: 'error' });
      }
    };

    const renderContent = () => {
        if (loading) {
            return <Box sx={{ display: 'flex', justifyContent: 'center', my: 5 }}><CircularProgress /></Box>;
        }
        if (error) {
            return <Alert severity="error">{error}</Alert>;
        }
        if (!tenant) {
             return <Alert severity="warning">Empresa nÃ£o encontrada.</Alert>;
        }
        return (
            <Paper sx={{ mt: 3 }}>
                <Table>
                    <TableHead>
                        <TableRow>
                            <TableCell sx={{ fontWeight: 'bold' }}>Nome do UsuÃ¡rio</TableCell>
                            <TableCell sx={{ fontWeight: 'bold' }}>FunÃ§Ã£o</TableCell>
                            <TableCell align="center" sx={{ fontWeight: 'bold' }}>Ã‰ Admin?</TableCell>
                            <TableCell align="right" sx={{ fontWeight: 'bold' }}>AÃ§Ãµes</TableCell>
                        </TableRow>
                    </TableHead>
                    <TableBody>
                        {users.map((user) => (
                            <TableRow hover key={user.id}>
                                <TableCell>{user.name}</TableCell>
                                <TableCell>{user.role}</TableCell>
                                <TableCell align="center">{user.isAdmin ? 'Sim' : 'NÃ£o'}</TableCell>
                                <TableCell align="right">
                                    <IconButton size="small" onClick={() => handleOpenModal(user)}><EditIcon /></IconButton>
                                    <IconButton size="small" onClick={() => handleOpenDialog(user)}><DeleteIcon color="error" /></IconButton>
                                </TableCell>
                            </TableRow>
                        ))}
                    </TableBody>
                </Table>
            </Paper>
        );
    };

    return (
        <Box>
            <AppBar position="static">
                <Toolbar>
                    <Typography variant="h6" component="div" sx={{ flexGrow: 1 }}>
                        {tenant ? `Gerenciar: ${tenant.companyName}` : 'Carregando Empresa...'}
                    </Typography>
                    <Button color="inherit" component={RouterLink} to="/admin">
                        Voltar para Admin
                    </Button>
                </Toolbar>
            </AppBar>
            <Container sx={{ mt: 4 }}>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>
                    <Typography variant="h4" component="h1" gutterBottom>
                        Gerenciamento de UsuÃ¡rios
                    </Typography>
                    <Button variant="contained" startIcon={<AddIcon />} onClick={() => handleOpenModal()}>
                        Criar UsuÃ¡rio
                    </Button>
                </Box>
                {renderContent()}
            </Container>
            <UserFormModal
                open={modalOpen}
                onClose={handleCloseModal}
                user={selectedUser}
                tenantId={tenantId}
                onSave={handleSaveUser}
            />
            <Dialog open={dialogOpen} onClose={handleCloseDialog}>
                <DialogTitle>Confirmar ExclusÃ£o</DialogTitle>
                <DialogContent>
                    <DialogContentText>
                        VocÃª tem certeza que deseja excluir o usuÃ¡rio <strong>{selectedUser?.name}</strong>? Esta aÃ§Ã£o Ã© irreversÃ­vel.
                    </DialogContentText>
                </DialogContent>
                <DialogActions>
                    <Button onClick={handleCloseDialog}>Cancelar</Button>
                    <Button onClick={handleDeleteUser} color="error">Excluir</Button>
                </DialogActions>
            </Dialog>
            <Snackbar open={feedback.open} autoHideDuration={4000} onClose={() => setFeedback({open: false, message: ''})}>
                <Alert onClose={() => setFeedback({open: false, message: ''})} severity={feedback.severity || 'success'} sx={{ width: '100%' }}>
                  {feedback.message}
                </Alert>
            </Snackbar>
        </Box>
    );
};

export default AdminTenantPage;

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\src\pages\ApplicationDetails.jsx
==================================================
// src/pages/ApplicationDetails.jsx (VERSÃƒO FINAL, COMPLETA E CORRIGIDA)
import EvaluationDashboardV2 from '../components/evaluation_v2/EvaluationDashboardV2';
import { useAuth } from '../context/AuthContext'; // Para pegar o usuÃ¡rio logado
import React, { useState, useEffect } from 'react';
import { useParams, Link as RouterLink } from 'react-router-dom';
import { supabase } from '../supabase/client';
// Importa as funÃ§Ãµes centralizadas
import { formatUrl, formatPhone, formatDate } from '../utils/formatters';
import { 
    Container, Typography, Box, AppBar, Toolbar, Button, CircularProgress, 
    Alert, Paper, Grid, Link, Divider, List, ListItem, ListItemText,
    FormControl, InputLabel, Select, MenuItem, TextField, Snackbar
} from '@mui/material';
import AddCircleOutlineIcon from '@mui/icons-material/AddCircleOutline';
import DeleteIcon from '@mui/icons-material/Delete';
import ContentCopyIcon from '@mui/icons-material/ContentCopy';

// O componente de seÃ§Ã£o de parÃ¢metros, que jÃ¡ estÃ¡ estÃ¡vel.
// NOTE: Este componente nÃ£o existe neste arquivo, ele estÃ¡ no JobDetails.jsx
// Removendo-o daqui para evitar confusÃ£o, jÃ¡ que ele nÃ£o Ã© usado aqui.

// O componente de seÃ§Ã£o de avaliaÃ§Ã£o, com a lÃ³gica de ID Ãºnico que vocÃª sugeriu.
const EvaluationSection = ({ title, criteria = [], notes = [], evaluationData = {}, onEvaluationChange, onNotesChange }) => {
  return (
    <Paper variant="outlined" sx={{ p: 2, mt: 2 }}>
      <Typography variant="h6" sx={{textTransform: 'capitalize'}}>{title}</Typography>
      {criteria.map((criterion) => (
        <Box key={`${title}-${criterion.name}`} sx={{ mt: 2 }}>
          <FormControl fullWidth>
            <InputLabel>{criterion.name} (Peso: {criterion.weight}%)</InputLabel>
            <Select
              value={evaluationData[criterion.name] || ''}
              label={`${criterion.name} (Peso: ${criterion.weight}%)`}
              onChange={(e) => onEvaluationChange(title.toLowerCase(), criterion.name, e.target.value)}
              variant="standard"
            >
              {notes.map((note) => (
                <MenuItem key={note.id} value={note.id}>{note.nome} ({note.valor})</MenuItem>
              ))}
            </Select>
          </FormControl>
        </Box>
      ))}
      <TextField
        label="AnotaÃ§Ãµes"
        multiline
        rows={3}
        fullWidth
        variant="standard"
        sx={{ mt: 2 }}
        value={evaluationData.anotacoes || ''}
        onChange={(e) => onNotesChange(title.toLowerCase(), e.target.value)}
      />
    </Paper>
  );
};

// O componente principal, com a lÃ³gica de estado e carregamento CORRIGIDA.
const ApplicationDetails = () => {
  const { jobId, applicationId } = useParams();
  const [application, setApplication] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState('');
  const [resumeUrl, setResumeUrl] = useState('');
  const [evaluation, setEvaluation] = useState(null); // Corrigido: Inicia como nulo
  const [isSaving, setIsSaving] = useState(false);
  const [feedback, setFeedback] = useState({ open: false, message: '', severity: 'success' });
  
  useEffect(() => {
    const fetchDetails = async () => {
      if (!applicationId) { setError("ID da candidatura nÃ£o encontrado."); setLoading(false); return; }
      setLoading(true);
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
        const appResponse = await fetch(`/api/getApplicationDetails?applicationId=${applicationId}`, { headers: { 'Authorization': `Bearer ${session.access_token}` } });
        if (!appResponse.ok) { const errorData = await appResponse.json(); throw new Error(errorData.error || "NÃ£o foi possÃ­vel buscar os detalhes."); }
        const appData = await appResponse.json();
        
        if (appData.application) {
          setApplication(appData.application);

          // CORREÃ‡ÃƒO: LÃ³gica robusta para carregar a avaliaÃ§Ã£o salva ou criar uma estrutura vazia.
          const savedEvaluation = appData.application.evaluation;
          setEvaluation({
            triagem: savedEvaluation?.triagem || {},
            cultura: savedEvaluation?.cultura || {},
            tÃ©cnico: savedEvaluation?.tÃ©cnico || {},
          });

          const filePath = appData.application.resumeUrl;
          if (filePath) {
            const urlResponse = await fetch(`/api/getResumeSignedUrl?filePath=${filePath}`, { headers: { 'Authorization': `Bearer ${session.access_token}` } });
            if (!urlResponse.ok) { throw new Error("NÃ£o foi possÃ­vel gerar o link do currÃ­culo."); }
            const urlData = await urlResponse.json();
            setResumeUrl(urlData.signedUrl);
          }
        } else { throw new Error("Dados da candidatura recebidos sÃ£o invÃ¡lidos."); }
      } catch (err) { console.error("Erro ao carregar detalhes:", err); setError(err.message); } 
      finally { setLoading(false); }
    };
    fetchDetails();
  }, [applicationId]);
  
  const handleEvaluationChange = (section, criterionName, noteId) => {
    setEvaluation(prevEval => ({ ...prevEval, [section]: { ...prevEval[section], [criterionName]: noteId } }));
  };
  const handleNotesChange = (section, text) => {
    setEvaluation(prevEval => ({ ...prevEval, [section]: { ...prevEval[section], anotacoes: text } }));
  };
  const handleCloseFeedback = (event, reason) => {
    if (reason === 'clickaway') {
      return;
    }
    setFeedback({ open: false, message: '' });
  };

  const handleSaveEvaluation = async () => {
    setIsSaving(true);
    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) throw new Error("VocÃª nÃ£o estÃ¡ autenticado.");
      const response = await fetch('/api/saveEvaluation', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
        body: JSON.stringify({ applicationId: applicationId, evaluation: evaluation }),
      });
      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || "NÃ£o foi possÃ­vel salvar a avaliaÃ§Ã£o.");
      }
      setFeedback({ open: true, message: 'AvaliaÃ§Ã£o salva com sucesso!', severity: 'success' });
    } catch (err) {
      console.error("Erro ao salvar avaliaÃ§Ã£o:", err);
      setFeedback({ open: true, message: err.message, severity: 'error' });
    } finally {
      setIsSaving(false);
    }
  };
  
  const renderContent = () => {
    if (loading) { return <Box sx={{ display: 'flex', justifyContent: 'center', my: 5 }}><CircularProgress /></Box>; }
    if (error) { return <Alert severity="error">{error}</Alert>; }
    if (application && evaluation) {
      const { candidate, job, formData } = application;
      const displayFields = [
        { key: 'preferredName', label: 'Como prefere ser chamado(a)?' }, { key: 'birthDate', label: 'Data de Nascimento', format: formatDate },
        { key: 'state', label: 'Estado' }, { key: 'city', label: 'Cidade' },
        { key: 'hasGraduated', label: 'Concluiu curso superior?', format: (val) => val === 'sim' ? 'Sim, jÃ¡ concluÃ­' : 'NÃ£o, estou cursando' },
        { key: 'studyPeriod', label: 'PerÃ­odo que estuda' }, { key: 'course', label: 'Curso' },
        { key: 'institution', label: 'InstituiÃ§Ã£o' }, { key: 'completionYear', label: 'Ano de ConclusÃ£o' },
        { key: 'englishLevel', label: 'NÃ­vel de InglÃªs' }, { key: 'spanishLevel', label: 'NÃ­vel de Espanhol' },
        { key: 'source', label: 'Como soube da vaga?' }, { key: 'motivation', label: 'MotivaÃ§Ã£o' },
      ];

      return (
        <Grid container spacing={3}>
          <Grid item xs={12} md={4}>
            <Paper sx={{ p: 2, height: '100%' }}>
              <Typography variant="h5" gutterBottom>{candidate.name}</Typography>
              <Typography variant="body1" sx={{ wordBreak: 'break-all' }}><strong>E-mail:</strong> {candidate.email}</Typography>
              <Typography variant="body1"><strong>Telefone:</strong> {formatPhone(formData.phone)}</Typography>
              <Divider sx={{ my: 2 }} />
              {formData.linkedinProfile && <Link href={formatUrl(formData.linkedinProfile)} target="_blank" rel="noopener" display="block">Perfil no LinkedIn</Link>}
              {formData.githubProfile && <Link href={formatUrl(formData.githubProfile)} target="_blank" rel="noopener" display="block">Perfil no GitHub</Link>}
              <Box mt={2}><Button variant="contained" href={resumeUrl} target="_blank" disabled={!resumeUrl}> Ver CurrÃ­culo </Button></Box>
            </Paper>
          </Grid>
          <Grid item xs={12} md={8}>
            <Paper sx={{ p: 2, height: '100%' }}>
              <Typography variant="h6" gutterBottom>Respostas do FormulÃ¡rio</Typography>
              <Grid container spacing={2}>
                {displayFields.map((field) => {
                  const value = formData[field.key];
                  if (value) {
                    return (
                      <Grid item xs={12} sm={6} key={field.key}>
                        <Typography variant="caption" color="text.secondary" sx={{ display: 'block' }}>{field.label}</Typography>
                        <Typography variant="body1">{field.format ? field.format(value) : (value || 'NÃ£o informado')}</Typography>
                      </Grid>
                    );
                  }
                  return null;
                })}
              </Grid>
            </Paper>
          </Grid>
          <Grid item xs={12}>
             <Paper sx={{ p: 2, mt: 2 }}>
                <Typography variant="h5" gutterBottom>AvaliaÃ§Ã£o</Typography>
                <EvaluationSection title="Triagem" criteria={job.parameters.triagem} notes={job.parameters.notas} evaluationData={evaluation.triagem} onEvaluationChange={handleEvaluationChange} onNotesChange={handleNotesChange} />
                <EvaluationSection title="Cultura" criteria={job.parameters.cultura} notes={job.parameters.notas} evaluationData={evaluation.cultura} onEvaluationChange={handleEvaluationChange} onNotesChange={handleNotesChange} />
                <EvaluationSection title="TÃ©cnico" criteria={job.parameters.tÃ©cnico} notes={job.parameters.notas} evaluationData={evaluation.tÃ©cnico} onEvaluationChange={handleEvaluationChange} onNotesChange={handleNotesChange} />
                <Box sx={{ mt: 3, display: 'flex', justifyContent: 'flex-end' }}>
                  <Button variant="contained" size="large" onClick={handleSaveEvaluation} disabled={isSaving}>
                    {isSaving ? <CircularProgress size={24} color="inherit"/> : 'Salvar AvaliaÃ§Ã£o'}
                  </Button>
                </Box>
              </Paper>
           </Grid>
        </Grid>
      );
    }
    return null;
  };
  
  return (
    <Box>
      <AppBar position="static">
        <Toolbar>
          <Typography variant="h6" component="div" sx={{ flexGrow: 1 }}>
            {application ? `Candidato: ${application.candidate.name}` : 'Carregando Candidatura...'}
          </Typography>
          <Button color="inherit" component={RouterLink} to={`/vaga/${jobId}`}> Voltar para a Vaga </Button>
        </Toolbar>
      </AppBar>
      <Container sx={{ mt: 4 }}>
        {renderContent()}
      </Container>
      <Snackbar open={feedback.open} autoHideDuration={4000} onClose={handleCloseFeedback}>
        <Alert onClose={handleCloseFeedback} severity={feedback.severity} sx={{ width: '100%' }}>
          {feedback.message}
        </Alert>
      </Snackbar>
    </Box>
  );
};

export default ApplicationDetails;

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\src\pages\ApplyPage.jsx
==================================================
// src/pages/ApplyPage.jsx (VERSÃƒO FINAL E CORRIGIDA, COM LÃ“GICA FREEMIUM)
import React, { useState, useEffect } from 'react';
import { useParams } from 'react-router-dom';
import { 
    Container, Box, Typography, TextField, Button, CircularProgress, Alert,
    Select, MenuItem, InputLabel, FormControl, RadioGroup, FormControlLabel, Radio, FormLabel
} from '@mui/material';
import { DatePicker } from '@mui/x-date-pickers/DatePicker';
import { estados } from '../data/brazil-locations';

const ApplyPage = () => {
  const { jobId } = useParams();
  const [jobTitle, setJobTitle] = useState('');
  // ESTADOS RESTAURADOS
  const [isVagaClosed, setIsVagaClosed] = useState(false);
  const [loadingPage, setLoadingPage] = useState(true);
  const [errorPage, setErrorPage] = useState('');

  const [formState, setFormState] = useState({
    name: '', preferredName: '', email: '', phone: '', birthDate: null,
    state: '', city: '', hasGraduated: '', studyPeriod: '', course: '',
    institution: '', completionYear: '', englishLevel: '', spanishLevel: '',
    source: '', motivation: '', linkedinProfile: '', githubProfile: ''
  });
  const [resumeFile, setResumeFile] = useState(null);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [feedback, setFeedback] = useState({ type: '', message: '' });

  // LÃ“GICA DO USEEFFECT RESTAURADA E CORRIGIDA
  useEffect(() => {
    const fetchJobData = async () => {
      if (!jobId) {
        setErrorPage('ID da vaga nÃ£o especificado na URL.');
        setLoadingPage(false);
        return;
      }
      try {
        const response = await fetch(`/api/getPublicJobData?id=${jobId}`);
        if (!response.ok) throw new Error('Vaga nÃ£o encontrada ou ocorreu um erro no servidor.');
        const data = await response.json();
        
        if (data.job) {
          if (data.job.planId === 'freemium' && data.job.candidateCount >= 3) {
            setIsVagaClosed(true);
          }
          setJobTitle(data.job.title);
        } else {
            throw new Error('Dados da vaga nÃ£o encontrados.');
        }
      } catch (error) {
        setErrorPage(error.message);
        console.error(error);
      } finally {
        setLoadingPage(false);
      }
    };
    fetchJobData();
  }, [jobId]);

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormState(prevState => ({ ...prevState, [name]: value }));
  };
  const handleDateChange = (newDate) => { setFormState(prevState => ({ ...prevState, birthDate: newDate })); };
  const handleFileChange = (e) => {
    if (e.target.files && e.target.files.length > 0) {
      setResumeFile(e.target.files[0]);
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setIsSubmitting(true);
    setFeedback({ type: '', message: '' });

    if (!resumeFile) {
      setFeedback({ type: 'error', message: 'Por favor, anexe seu currÃ­culo.' });
      setIsSubmitting(false);
      return;
    }

    const formData = new FormData();
    formData.append('jobId', jobId);
    for (const key in formState) {
      if (formState[key]) {
        if (key === 'birthDate') { formData.append(key, formState[key].toISOString()); } 
        else { formData.append(key, formState[key]); }
      }
    }
    formData.append('resume', resumeFile);

    try {
      const response = await fetch('/api/apply', { method: 'POST', body: formData });
      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || 'Ocorreu um erro ao enviar sua candidatura.');
      }
      setFeedback({ type: 'success', message: 'Candidatura enviada com sucesso! Agradecemos o seu interesse.' });
    } catch (error) {
      console.error("Erro na submissÃ£o:", error);
      setFeedback({ type: 'error', message: error.message });
    } finally {
      setIsSubmitting(false);
    }
  };

  // RENDERIZAÃ‡ÃƒO CONDICIONAL RESTAURADA
  if (loadingPage) {
    return <Box sx={{ display: 'flex', justifyContent: 'center', my: 8 }}><CircularProgress /></Box>;
  }
  if (errorPage) {
    return <Container maxWidth="sm" sx={{mt: 8}}><Alert severity="error">{errorPage}</Alert></Container>;
  }
  if (feedback.type === 'success') {
    return (
        <Container maxWidth="sm" sx={{ textAlign: 'center', mt: 8 }}>
            <Typography variant="h4" gutterBottom>Obrigado!</Typography>
            <Alert severity="success">{feedback.message}</Alert>
        </Container>
    );
  }
  if (isVagaClosed) {
    return (
        <Container maxWidth="sm" sx={{ textAlign: 'center', mt: 8 }}>
            <Typography variant="h4" gutterBottom>Vaga Encerrada</Typography>
            <Alert severity="warning">
              Agradecemos o seu interesse, mas esta vaga jÃ¡ atingiu o nÃºmero mÃ¡ximo de candidaturas.
            </Alert>
        </Container>
    );
  }

  return (
    <Container maxWidth="md">
      <Box sx={{ my: 4 }}>
        <Typography variant="h4" component="h1" gutterBottom>Candidatura Ã  Vaga</Typography>
        <Typography variant="h6" color="text.secondary">{jobTitle}</Typography>
        <Box component="form" onSubmit={handleSubmit} noValidate sx={{ mt: 3, borderTop: '1px solid #ddd', pt: 3 }}>
          <TextField name="name" label="Nome Completo" required fullWidth margin="normal" onChange={handleInputChange} />
          <TextField name="preferredName" label="Como prefere ser chamado(a)?" fullWidth margin="normal" onChange={handleInputChange} />
          <TextField name="email" label="Seu melhor e-mail" type="email" required fullWidth margin="normal" onChange={handleInputChange} />
          <TextField name="phone" label="NÃºmero de telefone (celular)" type="tel" required fullWidth margin="normal" onChange={handleInputChange} />
          <DatePicker label="Data de Nascimento" sx={{ width: '100%', mt: 2, mb: 1 }} value={formState.birthDate} onChange={handleDateChange} />
          <FormControl fullWidth margin="normal" required><InputLabel id="state-label">Em que estado vocÃª mora?</InputLabel><Select labelId="state-label" name="state" value={formState.state} label="Em que estado vocÃª mora?" onChange={handleInputChange}>{estados.map(estado => <MenuItem key={estado.sigla} value={estado.sigla}>{estado.nome}</MenuItem>)}</Select></FormControl>
          <TextField name="city" label="Em que cidade vocÃª mora?" required fullWidth margin="normal" onChange={handleInputChange} />
          <FormControl component="fieldset" margin="normal" required><FormLabel component="legend">VocÃª jÃ¡ concluiu algum curso de nÃ­vel superior?</FormLabel><RadioGroup row name="hasGraduated" value={formState.hasGraduated} onChange={handleInputChange}><FormControlLabel value="sim" control={<Radio />} label="Sim, jÃ¡ concluÃ­" /><FormControlLabel value="nao" control={<Radio />} label="NÃ£o, estou cursando" /></RadioGroup></FormControl>
          {formState.hasGraduated === 'nao' && (<TextField name="studyPeriod" label="Em que perÃ­odo/ano vocÃª estÃ¡?" fullWidth margin="normal" onChange={handleInputChange} />)}
          {formState.hasGraduated && (<><TextField name="course" label="Qual o curso?" required={!!formState.hasGraduated} fullWidth margin="normal" onChange={handleInputChange} /><TextField name="institution" label="Em qual faculdade/instituiÃ§Ã£o?" required={!!formState.hasGraduated} fullWidth margin="normal" onChange={handleInputChange} />{formState.hasGraduated === 'sim' && ( <TextField name="completionYear" label="Ano de ConclusÃ£o" type="number" fullWidth margin="normal" onChange={handleInputChange} />)}</>)}
          {['englishLevel', 'spanishLevel'].map(lang => (<FormControl fullWidth margin="normal" key={lang}><InputLabel>{lang === 'englishLevel' ? 'NÃ­vel de InglÃªs' : 'NÃ­vel de Espanhol'}</InputLabel><Select name={lang} value={formState[lang] || ''} label={lang === 'englishLevel' ? 'NÃ­vel de InglÃªs' : 'NÃ­vel de Espanhol'} onChange={handleInputChange}><MenuItem value="basico">BÃ¡sico</MenuItem><MenuItem value="intermediario">IntermediÃ¡rio</MenuItem><MenuItem value="avancado">AvanÃ§ado</MenuItem><MenuItem value="fluente">Fluente/Nativo</MenuItem></Select></FormControl>))}
          <TextField name="source" label="Como ficou sabendo da vaga?" fullWidth margin="normal" onChange={handleInputChange} />
          <TextField name="motivation" label="Por que vocÃª deseja fazer parte do nosso time?" required multiline rows={4} fullWidth margin="normal" onChange={handleInputChange} />
          <TextField name="linkedinProfile" label="Link do seu perfil no LinkedIn" fullWidth margin="normal" onChange={handleInputChange} />
          <TextField name="githubProfile" label="Link do seu perfil no GitHub" fullWidth margin="normal" onChange={handleInputChange} />
          <Button variant="outlined" component="label" sx={{ mt: 2, mb: 1, width: '100%' }}>Anexe o seu currÃ­culo (PDF, DOC, DOCX)<input type="file" hidden required accept=".pdf,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" onChange={handleFileChange} /></Button>
          {resumeFile && <Typography variant="body2" textAlign="center" color="text.secondary">{resumeFile.name}</Typography>}
          
          {feedback.type && <Alert severity={feedback.type} sx={{ mt: 2 }}>{feedback.message}</Alert>}
          
          <Button type="submit" fullWidth variant="contained" size="large" sx={{ mt: 3, mb: 2 }} disabled={isSubmitting}>{isSubmitting ? <CircularProgress size={24} /> : 'Enviar Candidatura'}</Button>
        </Box>
      </Box>
    </Container>
  );
};

export default ApplyPage;

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\src\pages\Dashboard.jsx
==================================================
// src/pages/Dashboard.jsx (VERSÃƒO FINAL com Filtro e OrdenaÃ§Ã£o Aprimorada)
import React, { useState, useEffect, useMemo } from 'react';
import { useNavigate, Link as RouterLink } from 'react-router-dom';
import { supabase } from '../supabase/client';
import { useAuth } from '../context/AuthContext';
import CreateJobModal from '../components/jobs/CreateJobModal';
import { 
    Box, Button, Typography, Container, AppBar, Toolbar, CircularProgress, 
    Table, TableBody, TableCell, TableHead, TableRow, Paper, Alert,
    FormControl, InputLabel, Select, MenuItem // Adicionado para o Filtro
} from '@mui/material';
import { formatStatus } from '../utils/formatters';

const Dashboard = () => {
    const navigate = useNavigate();
    const { currentUser } = useAuth();
    const [jobs, setJobs] = useState([]);
    const [planId, setPlanId] = useState(null);
    const [isAdmin, setIsAdmin] = useState(false);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState('');
    const [openCreateModal, setOpenCreateModal] = useState(false);
    
    // NOVO ESTADO para o filtro de status
    const [statusFilter, setStatusFilter] = useState('active'); // Inicia mostrando apenas vagas ativas

    const fetchJobs = async () => {
        if (!currentUser) return;
        setLoading(true);
        try {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) throw new Error("SessÃ£o do usuÃ¡rio nÃ£o encontrada.");
            const response = await fetch('/api/jobs', { headers: { 'Authorization': `Bearer ${session.access_token}` } });
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'Falha ao buscar vagas do servidor.');
            }
            const data = await response.json();
            
            // Removemos a lÃ³gica de ordenaÃ§Ã£o daqui
            setJobs(data.jobs || []);
            setPlanId(data.planId);
            setIsAdmin(data.isAdmin);
        } catch (err) {
            console.error("Erro ao buscar vagas:", err);
            setError(err.message);
        } finally {
            setLoading(false);
        }
    };

    useEffect(() => {
        fetchJobs();
    }, [currentUser]);

    // NOVA LÃ“GICA DE ORDENAÃ‡ÃƒO E FILTRO
    const processedJobs = useMemo(() => {
      // Define a prioridade de ordenaÃ§Ã£o
      const statusPriority = {
        'active': 1,
        'filled': 2,
        'inactive': 3
      };

      return jobs
        .sort((a, b) => {
          const priorityA = statusPriority[a.status] || 4;
          const priorityB = statusPriority[b.status] || 4;
          
          // 1. Ordena pela prioridade do status
          if (priorityA !== priorityB) {
            return priorityA - priorityB;
          }
          
          // 2. Se a prioridade for a mesma, ordena alfabeticamente pelo tÃ­tulo
          return a.title.localeCompare(b.title);
        })
        .filter(job => {
          // 3. Aplica o filtro de status
          if (statusFilter === 'all') return true;
          return job.status === statusFilter;
        });
    }, [jobs, statusFilter]); // Recalcula apenas se as vagas ou o filtro mudarem

    const handleLogout = async () => { await supabase.auth.signOut(); };
    const handleRowClick = (jobId) => { navigate(`/vaga/${jobId}`); };
    
    const isFreemium = planId === 'freemium';
    const isJobLimitReached = isFreemium && jobs.length >= 2;

    return (
        <>
            <Box sx={{ flexGrow: 1 }}>
                <AppBar position="static">
                    <Toolbar>
                        <Typography variant="h6" component="div" sx={{ flexGrow: 1 }}>
                            Novva R&S Dashboard
                        </Typography>
                        {isAdmin && (
                            <Button color="inherit" component={RouterLink} to="/admin">
                                Admin
                            </Button>
                        )}
                        <Button color="inherit" onClick={handleLogout}>Sair</Button>
                    </Toolbar>
                </AppBar>

                <Container sx={{ mt: 4 }}>
                    <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3, flexWrap: 'wrap', gap: 2 }}>
                        <Typography variant="h4" component="h1">
                            Painel de Vagas
                        </Typography>
                        <Box>
                            <Button variant="outlined" color="primary" size="large" component={RouterLink} to="/aprovados" sx={{ mr: 2 }}>
                                Ver Aprovados
                            </Button>
                            <Button 
                                variant="contained" 
                                color="primary" 
                                size="large"
                                onClick={() => setOpenCreateModal(true)}
                                disabled={isJobLimitReached}
                            >
                                Criar Nova Vaga
                            </Button>
                        </Box>
                    </Box>

                    {isJobLimitReached && (
                        <Alert severity="info" sx={{ mb: 2 }}>
                            VocÃª atingiu o limite de 2 vagas para o plano freemium.
                        </Alert>
                    )}

                    {/* NOVO CAMPO DE FILTRO */}
                    <Box sx={{ mb: 2 }}>
                      <FormControl size="small" sx={{ minWidth: 240 }}>
                        <InputLabel id="status-filter-label">Filtrar por Status</InputLabel>
                        <Select
                          labelId="status-filter-label"
                          value={statusFilter}
                          label="Filtrar por Status"
                          onChange={(e) => setStatusFilter(e.target.value)}
                        >
                          <MenuItem value="all">Todos os Status</MenuItem>
                          <MenuItem value="active">Ativas</MenuItem>
                          <MenuItem value="filled">Preenchidas</MenuItem>
                          <MenuItem value="inactive">Inativas</MenuItem>
                        </Select>
                      </FormControl>
                    </Box>

                    {loading && <Box sx={{ display: 'flex', justifyContent: 'center', my: 5 }}><CircularProgress /></Box>}
                    {error && <Typography color="error" align="center">Erro: {error}</Typography>}
                    
                    {!loading && !error && (
                        <Paper sx={{ width: '100%', overflow: 'hidden' }}>
                            <Table>
                                <TableHead>
                                    <TableRow>
                                        <TableCell sx={{ fontWeight: 'bold' }}>Nome da Vaga</TableCell>
                                        <TableCell sx={{ fontWeight: 'bold' }}>Status</TableCell>
                                        <TableCell align="center" sx={{ fontWeight: 'bold' }}>Candidatos</TableCell>
                                    </TableRow>
                                </TableHead>
                                <TableBody>
                                    {/* USA A NOVA LISTA PROCESSADA */}
                                    {processedJobs.length > 0 ? processedJobs.map((job) => (
                                        <TableRow 
                                            hover 
                                            key={job.id} 
                                            onClick={() => handleRowClick(job.id)}
                                            sx={{ 
                                                cursor: 'pointer',
                                                backgroundColor: job.status !== 'active' ? '#f5f5f5' : 'transparent',
                                                color: job.status !== 'active' ? '#9e9e9e' : 'inherit'
                                            }}
                                        >
                                            <TableCell>{job.title}</TableCell>
                                            <TableCell sx={{ textTransform: 'capitalize' }}>{formatStatus(job.status)}</TableCell>
                                            <TableCell align="center">{job.candidateCount || 0}</TableCell>
                                        </TableRow>
                                    )) : (
                                        <TableRow>
                                            <TableCell colSpan={3} align="center">
                                                Nenhuma vaga encontrada para este filtro.
                                            </TableCell>
                                        </TableRow>
                                    )}
                                </TableBody>
                            </Table>
                        </Paper>
                    )}
                </Container>
            </Box>
            <CreateJobModal 
                open={openCreateModal}
                handleClose={() => setOpenCreateModal(false)}
                onJobCreated={fetchJobs}
            />
        </>
    );
};

export default Dashboard;

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\src\pages\HiredPage.jsx
==================================================
// src/pages/HiredPage.jsx (VersÃ£o Corrigida)
import React, { useState, useEffect } from 'react';
import { Link as RouterLink } from 'react-router-dom';
import { supabase } from '../supabase/client';
import { format, parseISO } from 'date-fns';
import {
    Container,
    Typography,
    Box,
    AppBar,
    Toolbar,
    Button,
    CircularProgress,
    Alert,
    Paper,
    List,
    ListItem,
    ListItemText,
    Divider,
} from '@mui/material';

const HiredPage = () => {
    const [hiredData, setHiredData] = useState({});
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState('');

    useEffect(() => {
        const fetchHired = async () => {
            setLoading(true);
            try {
                const { data: { session } } = await supabase.auth.getSession();
                if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
                const response = await fetch('/api/getHiredApplicants', {
                    headers: { 'Authorization': `Bearer ${session.access_token}` },
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || "NÃ£o foi possÃ­vel buscar os candidatos aprovados.");
                }
                const data = await response.json();
                const groupedByJob = (data.hired || []).reduce((acc, application) => {
                    const jobTitle = application.job.title;
                    if (!acc[jobTitle]) {
                        acc[jobTitle] = [];
                    }
                    acc[jobTitle].push(application);
                    return acc;
                }, {});
                setHiredData(groupedByJob);
            } catch (err) {
                console.error("Erro ao buscar aprovados:", err);
                setError(err.message);
            } finally {
                setLoading(false);
            }
        };
        fetchHired();
    }, []);

    const formatPhone = (phone) => {
        if (!phone) return 'NÃ£o informado';
        const cleaned = phone.replace(/\D/g, '');
        if (cleaned.length === 11) { return `(${cleaned.substring(0, 2)}) ${cleaned.substring(2, 7)}-${cleaned.substring(7)}`; }
        if (cleaned.length === 10) { return `(${cleaned.substring(0, 2)}) ${cleaned.substring(2, 6)}-${cleaned.substring(6)}`; }
        return phone;
    };

    const renderContent = () => {
        if (loading) {
            return <Box sx={{ display: 'flex', justifyContent: 'center', my: 5 }}><CircularProgress /></Box>;
        }
        if (error) {
            return <Alert severity="error">{error}</Alert>;
        }
        if (Object.keys(hiredData).length === 0) {
            return <Typography sx={{ mt: 3, textAlign: 'center' }}>Nenhum candidato foi marcado como contratado ainda.</Typography>;
        }
        return (
            <Box>
                {Object.entries(hiredData).map(([jobTitle, applications]) => (
                    <Paper key={jobTitle} sx={{ my: 3, p: 2 }}>
                        <Typography variant="h5" gutterBottom>{jobTitle}</Typography>
                        <List>
                            {applications.map((app, index) => (
                                <React.Fragment key={app.id}>
                                    <ListItem>
                                        <ListItemText
                                            primary={app.candidate.name}
                                            secondary={
                                                <>
                                                    <Typography component="span" variant="body2" color="text.primary">
                                                        Email: {app.candidate.email}
                                                    </Typography>
                                                    <br />
                                                    <Typography component="span" variant="body2" color="text.primary">
                                                        Telefone: {formatPhone(app.formData.phone)}
                                                    </Typography>
                                                    <br />
                                                    <Typography component="span" variant="body2" color="text.secondary">
                                                        {/* AQUI ESTÃ A CORREÃ‡ÃƒO DA REGRESSÃƒO */}
                                                        Aprovado em: {app.hiredAt ? format(parseISO(app.hiredAt), 'dd/MM/yyyy') : 'Data nÃ£o registrada'}
                                                    </Typography>
                                                </>
                                            }
                                        />
                                    </ListItem>
                                    {index < applications.length - 1 && <Divider />}
                                </React.Fragment>
                            ))}
                        </List>
                    </Paper>
                ))}
            </Box>
        );
    };

    return (
        <Box>
            <AppBar position="static">
                <Toolbar>
                    <Typography variant="h6" component="div" sx={{ flexGrow: 1 }}>
                        Candidatos Aprovados
                    </Typography>
                    <Button color="inherit" component={RouterLink} to="/">
                        Voltar para o Painel
                    </Button>
                </Toolbar>
            </AppBar>
            <Container sx={{ mt: 4 }}>
                {renderContent()}
            </Container>
        </Box>
    );
};

export default HiredPage;

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\src\pages\JobDetails.jsx
==================================================
// src/pages/JobDetails.jsx (VERSÃƒO FINAL com Status Traduzido)
import React, { useState, useEffect, useMemo } from 'react';
import { useParams, Link as RouterLink, useNavigate } from 'react-router-dom';
import { supabase } from '../supabase/client';
import { format, parseISO } from 'date-fns';
import { 
    Container, Typography, Box, AppBar, Toolbar, Button, CircularProgress, 
    Alert, Paper, Tabs, Tab, TextField, IconButton, Snackbar, InputAdornment,
    List, ListItem, ListItemText, Divider, Grid,
    Table, TableHead, TableRow, TableCell, TableBody, Checkbox,
    FormControl, InputLabel, Select, MenuItem, Modal,
    Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle
} from '@mui/material';
import AddCircleOutlineIcon from '@mui/icons-material/AddCircleOutline';
import DeleteIcon from '@mui/icons-material/Delete';
import ContentCopyIcon from '@mui/icons-material/ContentCopy';
import FileCopyIcon from '@mui/icons-material/FileCopy';
import ClassificationChart from '../components/charts/ClassificationChart';
import { formatStatus } from '../utils/formatters'; // IMPORTA NOSSO TRADUTOR

const modalStyle = {
  position: 'absolute',
  top: '50%',
  left: '50%',
  transform: 'translate(-50%, -50%)',
  width: 500,
  bgcolor: 'background.paper',
  boxShadow: 24,
  p: 4,
};

const CopyParametersModal = ({ open, onClose, currentJobId, onCopy }) => {
  const [jobs, setJobs] = useState([]);
  const [selectedJobId, setSelectedJobId] = useState('');
  const [loading, setLoading] = useState(true);
  const [isCopying, setIsCopying] = useState(false);

  useEffect(() => {
    if (open) {
      const fetchJobsList = async () => {
        setLoading(true);
        try {
          const { data: { session } } = await supabase.auth.getSession();
          if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
          const response = await fetch('/api/jobs', { headers: { 'Authorization': `Bearer ${session.access_token}` } });
          const data = await response.json();
          const copyableJobs = (data.jobs || []).filter(
            (job) => job.id.toString() !== currentJobId && job.status === 'active'
          );
          setJobs(copyableJobs);
        } catch (err) {
          console.error("Erro ao buscar lista de vagas:", err);
        } finally {
          setLoading(false);
        }
      };
      fetchJobsList();
    }
  }, [open, currentJobId]);

  const handleConfirmCopy = async () => {
    if (!selectedJobId) return;
    setIsCopying(true);
    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
      const response = await fetch(`/api/jobs?id=${selectedJobId}`, { headers: { 'Authorization': `Bearer ${session.access_token}` } });
      const data = await response.json();
      if (data.job && data.job.parameters) {
        onCopy(data.job.parameters);
      }
      onClose();
    } catch (err) {
      console.error("Erro ao copiar parÃ¢metros:", err);
    } finally {
      setIsCopying(false);
    }
  };

  return (
    <Modal open={open} onClose={onClose}>
      <Box sx={modalStyle}>
        <Typography variant="h6" gutterBottom>Copiar ParÃ¢metros de outra Vaga</Typography>
        <Typography variant="body2" gutterBottom>
          Selecione uma vaga ativa para copiar todos os seus parÃ¢metros (Triagem, Cultura, TÃ©cnico e Notas) para esta vaga.
        </Typography>
        {loading ? (
          <CircularProgress />
        ) : (
          <FormControl fullWidth margin="normal" required>
            <InputLabel id="copy-job-label">Selecionar Vaga</InputLabel>
            <Select
              labelId="copy-job-label"
              value={selectedJobId}
              label="Selecionar Vaga"
              onChange={(e) => setSelectedJobId(e.target.value)}
            >
              {jobs.length > 0 ? (
                jobs.map(job => (
                  <MenuItem key={job.id} value={job.id}>{job.title}</MenuItem>
                ))
              ) : (
                <MenuItem disabled>Nenhuma outra vaga ativa encontrada.</MenuItem>
              )}
            </Select>
          </FormControl>
        )}
        <Box sx={{ mt: 3, display: 'flex', justifyContent: 'flex-end', gap: 1 }}>
          <Button onClick={onClose} disabled={isCopying}>Cancelar</Button>
          <Button variant="contained" onClick={handleConfirmCopy} disabled={loading || isCopying || !selectedJobId}>
            {isCopying ? <CircularProgress size={24} /> : 'Copiar'}
          </Button>
        </Box>
      </Box>
    </Modal>
  );
};

const ParametersSection = ({ criteria = [], onCriteriaChange }) => {
  const handleItemChange = (index, field, value) => { const newCriteria = [...criteria]; const numericValue = field === 'weight' ? Number(value) || 0 : value; newCriteria[index] = { ...newCriteria[index], [field]: numericValue }; onCriteriaChange(newCriteria); };
  const addCriterion = () => { if (criteria.length < 10) { onCriteriaChange([...criteria, { name: '', weight: 0 }]); } };
  const removeCriterion = (index) => { const newCriteria = criteria.filter((_, i) => i !== index); onCriteriaChange(newCriteria); };
  const totalWeight = criteria.reduce((sum, item) => sum + (item.weight || 0), 0);
  return (
    <Box sx={{ mt: 2 }}>
      {criteria.map((item, index) => (
        <Box key={index} sx={{ display: 'flex', alignItems: 'center', gap: 2, mb: 2 }}>
          <TextField label={`CritÃ©rio ${index + 1}`} value={item.name} onChange={(e) => handleItemChange(index, 'name', e.target.value)} fullWidth variant="standard" />
          <TextField label="Peso (%)" type="number" value={item.weight} onChange={(e) => handleItemChange(index, 'weight', e.target.value)} sx={{ width: '120px' }} variant="standard" />
          <IconButton onClick={() => removeCriterion(index)} color="error"><DeleteIcon /></IconButton>
        </Box>
      ))}
      <Button startIcon={<AddCircleOutlineIcon />} onClick={addCriterion} disabled={criteria.length >= 10} sx={{ mt: 2 }}>Adicionar CritÃ©rio</Button>
      <Typography variant="h6" sx={{ mt: 3, p: 1, borderRadius: 1, bgcolor: totalWeight === 100 ? '#e8f5e9' : '#ffebee', color: totalWeight === 100 ? 'green' : 'red' }}> Soma dos Pesos: {totalWeight}% </Typography>
    </Box>
  );
};

const JobDetails = () => {
  const { jobId } = useParams();
  const navigate = useNavigate();
  const [job, setJob] = useState(null);
  const [parameters, setParameters] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState('');
  const [tabValue, setTabValue] = useState(0);
  const [isSaving, setIsSaving] = useState(false);
  const [feedback, setFeedback] = useState({ open: false, message: '', severity: 'success' });
  const [applicantData, setApplicantData] = useState({ loading: true, data: [], error: null });
  const [isCopyModalOpen, setIsCopyModalOpen] = useState(false);
  const [openDeleteDialog, setOpenDeleteDialog] = useState(false);
  const [isDeleting, setIsDeleting] = useState(false);

  useEffect(() => {
    const fetchJobDetails = async () => {
      if (!jobId) { setLoading(false); setError("ID da vaga nÃ£o encontrado."); return; }
      setLoading(true);
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
        const response = await fetch(`/api/jobs?id=${jobId}`, { headers: { 'Authorization': `Bearer ${session.access_token}` } });
        if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error || "NÃ£o foi possÃ­vel buscar os detalhes da vaga."); }
        const data = await response.json();
        if (data.job && data.job.parameters) { setJob(data.job); setParameters(data.job.parameters); } 
        else { throw new Error("Os dados da vaga recebidos sÃ£o invÃ¡lidos."); }
      } catch (err) { console.error("Erro ao buscar detalhes da vaga:", err); setError(err.message); } 
      finally { setLoading(false); }
    };
    fetchJobDetails();
  }, [jobId]);

  useEffect(() => {
    const fetchApplicants = async () => {
      if (!jobId) return;
      setApplicantData({ loading: true, data: [], error: null });
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
        const response = await fetch(`/api/getApplicantsForJob?jobId=${jobId}`, { headers: { 'Authorization': `Bearer ${session.access_token}` } });
        if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error || "NÃ£o foi possÃ­vel buscar os candidatos."); }
        const data = await response.json();
        setApplicantData({ loading: false, data: data.applicants || [], error: null });
      } catch (err) { console.error("Erro ao buscar candidatos:", err); setApplicantData({ loading: false, data: [], error: err.message }); }
    };
    fetchApplicants();
  }, [jobId]);

  const classifiedApplicants = useMemo(() => {
    if (!applicantData.data) return [];
    return [...applicantData.data].sort((a, b) => b.notaGeral - a.notaGeral);
  }, [applicantData.data]);
  
  const handleHiredToggle = async (applicationId, currentStatus) => {
    const newStatus = !currentStatus;
    setApplicantData(prev => ({
      ...prev,
      data: prev.data.map(app => 
        app.applicationId === applicationId ? { ...app, isHired: newStatus } : app
      ),
    }));
    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
      await fetch('/api/updateHiredStatus', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
        body: JSON.stringify({ applicationId, isHired: newStatus }),
      });
    } catch (err) {
      setFeedback({ open: true, message: 'Erro ao atualizar status.', severity: 'error' });
      setApplicantData(prev => ({
        ...prev,
        data: prev.data.map(app => 
          app.applicationId === applicationId ? { ...app, isHired: currentStatus } : app
        ),
      }));
    }
  };

  const handleTabChange = (event, newValue) => { setTabValue(newValue); };
  const handleParametersChange = (section, newCriteria) => { setParameters(prevParams => ({ ...prevParams, [section]: newCriteria })); };
  const handleNoteChange = (index, field, value) => {
    const newNotes = [...parameters.notas];
    const numericValue = field === 'valor' ? Number(value) || 0 : value;
    newNotes[index] = { ...newNotes[index], [field]: numericValue };
    setParameters(prevParams => ({ ...prevParams, notas: newNotes }));
  };
  const handleSaveParameters = async () => {
    setIsSaving(true);
    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) throw new Error("VocÃª nÃ£o estÃ¡ autenticado.");
      const response = await fetch('/api/updateJobParameters', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
        body: JSON.stringify({ jobId: jobId, parameters: parameters }),
      });
      if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error || "NÃ£o foi possÃ­vel salvar os parÃ¢metros."); }
      setFeedback({ open: true, message: 'ParÃ¢metros salvos com sucesso!', severity: 'success' });
    } catch (err) {
      setFeedback({ open: true, message: err.message, severity: 'error' });
    } finally {
      setIsSaving(false);
    }
  };
  const handleCloseFeedback = () => { setFeedback({ open: false, message: '' }); };
  const applicationUrl = `${window.location.origin}/vaga/${jobId}/apply`;
  const handleCopyLink = () => { navigator.clipboard.writeText(applicationUrl); setFeedback({ open: true, message: 'Link copiado!', severity: 'info' }); };
  const handleParametersCopied = (newParameters) => {
    setParameters(newParameters);
    setFeedback({ open: true, message: 'ParÃ¢metros copiados! Clique em "Salvar ParÃ¢metros" para confirmar.', severity: 'info' });
  };
  
  const handleStatusChange = async (event) => {
    const newStatus = event.target.value;
    const oldStatus = job.status;
    setJob(prev => ({ ...prev, status: newStatus }));
    setIsSaving(true);
    try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
        const response = await fetch('/api/jobs', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
            body: JSON.stringify({ action: 'updateJobStatus', jobId: jobId, newStatus: newStatus })
        });
        if (!response.ok) throw new Error("NÃ£o foi possÃ­vel atualizar o status.");
        setFeedback({ open: true, message: 'Status atualizado!', severity: 'success' });
    } catch (err) {
        console.error(err);
        setFeedback({ open: true, message: 'Erro ao atualizar status.', severity: 'error' });
        setJob(prev => ({ ...prev, status: oldStatus })); 
    } finally {
        setIsSaving(false);
    }
  };

  const handleDeleteJob = async () => {
    setIsDeleting(true);
    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) throw new Error("SessÃ£o nÃ£o encontrada.");
      const response = await fetch('/api/jobs', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` },
          body: JSON.stringify({ action: 'deleteJob', jobId: jobId })
      });
      if (!response.ok) throw new Error("NÃ£o foi possÃ­vel excluir a vaga.");
      setOpenDeleteDialog(false);
      navigate('/');
    } catch (err) {
      console.error(err);
      setFeedback({ open: true, message: 'Erro ao excluir vaga.', severity: 'error' });
    } finally {
      setIsDeleting(false);
    }
  };
  
  const renderContent = () => {
    if (loading) { return <Box sx={{ display: 'flex', justifyContent: 'center', my: 5 }}><CircularProgress /></Box>; }
    if (error) { return <Alert severity="error">{error}</Alert>; }
    if (job && parameters) {
      return (
        <>
          <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', mb: 2 }}>
            <Box>
                <Typography variant="h4">{job.title}</Typography>
                {/* CORREÃ‡ÃƒO APLICADA AQUI */}
                <Typography variant="subtitle1" color="text.secondary" gutterBottom sx={{ textTransform: 'capitalize' }}>
                  Status: {formatStatus(job.status)}
                </Typography>
            </Box>
            <Box sx={{ display: 'flex', gap: 2, alignItems: 'center' }}>
                <FormControl sx={{ minWidth: 150 }} size="small">
                  <InputLabel id="status-select-label">Alterar Status</InputLabel>
                  <Select
                    labelId="status-select-label"
                    value={job.status}
                    label="Alterar Status"
                    onChange={handleStatusChange}
                    disabled={isSaving}
                  >
                    {/* CORREÃ‡ÃƒO APLICADA AQUI */}
                    <MenuItem value="active">Ativa</MenuItem>
                    <MenuItem value="inactive">Inativa</MenuItem>
                    <MenuItem value="filled">Preenchida</MenuItem>
                  </Select>
                </FormControl>
                <Button 
                  variant="outlined" 
                  color="error"
                  startIcon={<DeleteIcon />}
                  onClick={() => setOpenDeleteDialog(true)}
                  disabled={isDeleting}
                >
                  Excluir Vaga
                </Button>
            </Box>
          </Box>
          
          <Box sx={{ mt: 4, mb: 4 }}>
            <Typography variant="h6" gutterBottom>Link PÃºblico de Candidatura</Typography>
            <TextField fullWidth variant="outlined" value={applicationUrl} InputProps={{ readOnly: true, endAdornment: ( <InputAdornment position="end"><IconButton onClick={handleCopyLink}><ContentCopyIcon /></IconButton></InputAdornment> )}}/>
          </Box>
          
          <Paper sx={{ width: '100%' }}>
            <Box sx={{ borderBottom: 1, borderColor: 'divider' }}>
              <Tabs value={tabValue} onChange={handleTabChange}>
                <Tab label="Candidatos" />
                <Tab label="ParÃ¢metros" />
                <Tab label="ClassificaÃ§Ã£o" />
              </Tabs>
            </Box>
            <Box p={3} hidden={tabValue !== 0}>
              <Typography variant="h5" gutterBottom>Candidatos Inscritos</Typography>
              {applicantData.loading ? <CircularProgress /> : applicantData.error ? <Alert severity="error">{applicantData.error}</Alert> : (
                <List>
                  {applicantData.data.length > 0 ? applicantData.data.map((app, index) => (
                    <React.Fragment key={app.applicationId}>
                      <ListItem button component={RouterLink} to={`/vaga/${jobId}/candidato/${app.applicationId}`}>
                        <ListItemText primary={app.candidateName} secondary={app.candidateEmail} />
                      </ListItem>
                      {index < applicantData.data.length - 1 && <Divider />}
                    </React.Fragment>
                  )) : ( <Typography>Nenhum candidato inscrito para esta vaga ainda.</Typography> )}
                </List>
              )}
            </Box>
            <Box p={3} hidden={tabValue !== 1}>
               <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                 <Typography variant="h5" gutterBottom>ParÃ¢metros de AvaliaÃ§Ã£o</Typography>
                 <Button
                    variant="outlined"
                    startIcon={<FileCopyIcon />}
                    onClick={() => setIsCopyModalOpen(true)}
                 >
                    Copiar ParÃ¢metros
                 </Button>
               </Box>
               <Paper variant="outlined" sx={{ p: 2, mt: 2 }}><Typography>CritÃ©rios de Triagem</Typography><ParametersSection criteria={parameters.triagem} onCriteriaChange={(newCriteria) => handleParametersChange('triagem', newCriteria)} /></Paper>
               <Paper variant="outlined" sx={{ p: 2, mt: 2 }}><Typography>Cultura</Typography><ParametersSection criteria={parameters.cultura} onCriteriaChange={(newCriteria) => handleParametersChange('cultura', newCriteria)} /></Paper>
               <Paper variant="outlined" sx={{ p: 2, mt: 2 }}><Typography>TÃ©cnico</Typography><ParametersSection criteria={parameters.tÃ©cnico} onCriteriaChange={(newCriteria) => handleParametersChange('tÃ©cnico', newCriteria)} /></Paper>
               <Paper variant="outlined" sx={{ p: 2, mt: 3 }}><Typography variant="h6" gutterBottom sx={{p: 1}}>DefiniÃ§Ã£o de Notas</Typography><Grid container spacing={2} sx={{p: 2}}>{parameters.notas && parameters.notas.map((nota, index) => ( <React.Fragment key={index}><Grid item xs={6}><TextField label={`Nome da Nota ${index + 1}`} value={nota.nome} onChange={(e) => handleNoteChange(index, 'nome', e.target.value)} fullWidth variant="standard" disabled={nota.fixed} /></Grid><Grid item xs={6}><TextField label={`Valor da Nota ${index + 1}`} type="number" value={nota.valor} onChange={(e) => handleNoteChange(index, 'valor', e.target.value)} fullWidth variant="standard" disabled={nota.fixed} /></Grid></React.Fragment> ))}</Grid></Paper>
               <Box sx={{ mt: 3, display: 'flex', justifyContent: 'flex-end' }}><Button variant="contained" size="large" onClick={handleSaveParameters} disabled={isSaving}>{isSaving ? <CircularProgress size={24} /> : 'Salvar ParÃ¢metros'}</Button></Box>
            </Box>
            <Box p={3} hidden={tabValue !== 2}>
              <Typography variant="h5" gutterBottom>ClassificaÃ§Ã£o dos Candidatos</Typography>
              {tabValue === 2 && !applicantData.loading && applicantData.data.length > 0 && (
                <ClassificationChart data={classifiedApplicants} />
              )}
              {applicantData.loading ? <CircularProgress sx={{mt: 4}} /> : applicantData.error ? <Alert severity="error">{applicantData.error}</Alert> : (
                <Table sx={{ mt: 4 }}>
                  <TableHead><TableRow><TableCell sx={{ fontWeight: 'bold' }}>Nome</TableCell><TableCell sx={{ fontWeight: 'bold' }}>Data da InscriÃ§Ã£o</TableCell><TableCell align="right" sx={{ fontWeight: 'bold' }}>Nota Triagem</TableCell><TableCell align="right" sx={{ fontWeight: 'bold' }}>Nota Cultura</TableCell><TableCell align="right" sx={{ fontWeight: 'bold' }}>Nota TÃ©cnico</TableCell><TableCell align="right" sx={{ fontWeight: 'bold' }}>Nota Geral</TableCell><TableCell align="center" sx={{ fontWeight: 'bold' }}>Contratado?</TableCell></TableRow></TableHead>
                  <TableBody>
                    {classifiedApplicants.map(applicant => (
                      <TableRow hover key={applicant.applicationId} sx={{ backgroundColor: applicant.isHired ? '#e8f5e9' : 'transparent' }}>
                        <TableCell>{applicant.candidateName}</TableCell>
                        <TableCell>{format(parseISO(applicant.submissionDate), 'dd/MM/yyyy')}</TableCell>
                        <TableCell align="right">{applicant.notaTriagem.toFixed(1)}</TableCell>
                        <TableCell align="right">{applicant.notaCultura.toFixed(1)}</TableCell>
                        <TableCell align="right">{applicant.notaTecnico.toFixed(1)}</TableCell>
                        <TableCell align="right" sx={{ fontWeight: 'bold' }}>{applicant.notaGeral.toFixed(1)}</TableCell>
                        <TableCell align="center">
                          <Checkbox
                            checked={applicant.isHired || false}
                            onChange={() => handleHiredToggle(applicant.applicationId, applicant.isHired)}
                          />
                        </TableCell>
                      </TableRow>
                    ))}
                  </TableBody>
                </Table>
              )}
            </Box>
          </Paper>
        </>
      );
    }
    return null;
  };

  return (
    <Box>
      <AppBar position="static"><Toolbar><Typography variant="h6" component="div" sx={{ flexGrow: 1 }}>{job ? `Vaga: ${job.title}` : 'Carregando Vaga...'}</Typography><Button color="inherit" component={RouterLink} to="/">Voltar para o Painel</Button></Toolbar></AppBar>
      <Container sx={{ mt: 4 }}>
        {renderContent()}
      </Container>
      
      <CopyParametersModal 
        open={isCopyModalOpen}
        onClose={() => setIsCopyModalOpen(false)}
        currentJobId={jobId}
        onCopy={handleParametersCopied}
      />
      
      <Dialog open={openDeleteDialog} onClose={() => setOpenDeleteDialog(false)}>
        <DialogTitle>Confirmar ExclusÃ£o</DialogTitle>
        <DialogContent>
          <DialogContentText>
            VocÃª tem certeza que deseja excluir a vaga <strong>"{job?.title}"</strong>? Esta aÃ§Ã£o Ã© irreversÃ­vel e excluirÃ¡ todas as candidaturas e avaliaÃ§Ãµes associadas.
          </DialogContentText>
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setOpenDeleteDialog(false)} disabled={isDeleting}>Cancelar</Button>
          <Button onClick={handleDeleteJob} color="error" disabled={isDeleting}>
            {isDeleting ? <CircularProgress size={24} /> : 'Excluir'}
          </Button>
        </DialogActions>
      </Dialog>
      
      <Snackbar open={feedback.open} autoHideDuration={4000} onClose={handleCloseFeedback}><Alert onClose={handleCloseFeedback} severity={feedback.severity} sx={{ width: '100%' }}>{feedback.message}</Alert></Snackbar>
    </Box>
  );
};

export default JobDetails;

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\src\pages\Login.jsx
==================================================
// src/pages/Login.jsx
import React, { useState } from 'react';
import { supabase } from '../supabase/client'; // Importa nosso novo cliente Supabase
import { Container, Box, TextField, Button, Typography, CircularProgress, Alert } from '@mui/material';

const LoginPage = () => {
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const [loading, setLoading] = useState(false);
    const [error, setError] = useState('');

    const handleLogin = async (e) => {
        e.preventDefault();
        setLoading(true);
        setError('');

        try {
            // A nova funÃ§Ã£o de login do Supabase
            const { error } = await supabase.auth.signInWithPassword({
                email: email,
                password: password,
            });

            if (error) throw error;
            // O redirecionamento para o Dashboard Ã© tratado automaticamente pelo AuthContext
        } catch (err) {
            setError('E-mail ou senha invÃ¡lidos. Por favor, tente novamente.');
            console.error("Erro de autenticaÃ§Ã£o:", err.message);
        } finally {
            setLoading(false);
        }
    };

    // O restante do JSX (a parte visual) continua exatamente o mesmo
    return (
        <Container component="main" maxWidth="xs">
            <Box sx={{ marginTop: 8, display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                <Typography component="h1" variant="h4" sx={{ mb: 3, fontWeight: 'bold' }}>Novva R&S</Typography>
                <Typography component="p" variant="subtitle1" color="text.secondary">Bem-vindo(a)!</Typography>
                <Box component="form" onSubmit={handleLogin} noValidate sx={{ mt: 1 }}>
                    <TextField margin="normal" required fullWidth id="email" label="EndereÃ§o de E-mail" name="email" autoComplete="email" autoFocus value={email} onChange={(e) => setEmail(e.target.value)} />
                    <TextField margin="normal" required fullWidth name="password" label="Senha" type="password" id="password" autoComplete="current-password" value={password} onChange={(e) => setPassword(e.target.value)} />
                    {error && <Alert severity="error" sx={{ mt: 2, width: '100%' }}>{error}</Alert>}
                    <Button type="submit" fullWidth variant="contained" sx={{ mt: 3, mb: 2, py: 1.5 }} disabled={loading}>
                        {loading ? <CircularProgress size={24} color="inherit" /> : 'Entrar'}
                    </Button>
                </Box>
            </Box>
        </Container>
    );
};

export default LoginPage;

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\src\services\evaluationService.js
==================================================
// src/services/evaluationService.js
import { supabase } from '../supabase/client';

// 1. Prepara o banco (Cria critÃ©rios se nÃ£o existirem)
export const prepareEvaluationV2 = async (jobId) => {
  const { data, error } = await supabase
    .rpc('initialize_job_criteria_v2', { target_job_id: jobId });
  if (error) throw error;
  return data;
};

// 2. Busca o resumo consolidado (MÃ©dias)
export const getEvaluationSummaryV2 = async (applicationId) => {
  const { data, error } = await supabase
    .rpc('get_candidate_summary_v2', { target_app_id: applicationId });
  if (error) throw error;
  return data;
};

// 3. Busca/Cria a sessÃ£o do usuÃ¡rio atual
export const getMyEvaluationSession = async (applicationId, userId) => {
  // Tenta buscar existente
  let { data: session, error } = await supabase
    .from('evaluation_assignments_v2')
    .select('id, status')
    .eq('application_id', applicationId)
    .eq('evaluator_id', userId)
    .maybeSingle();

  // Se nÃ£o existir, cria
  if (!session) {
    const { data: newSession, error: createError } = await supabase
      .from('evaluation_assignments_v2')
      .insert({ application_id: applicationId, evaluator_id: userId })
      .select()
      .single();
    
    if (createError) throw createError;
    session = newSession;
  }
  
  return session;
};

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\src\supabase\client.js
==================================================
// src/supabase/client.js (VersÃ£o de DepuraÃ§Ã£o)
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY

// --- NOSSO TESTE DE DEPURAÃ‡ÃƒO ---
// Estas linhas irÃ£o imprimir no console do seu navegador as chaves que o app estÃ¡ realmente usando.
console.log("--- INICIANDO VERIFICAÃ‡ÃƒO DE CHAVES SUPABASE ---");
console.log("URL EM USO:", supabaseUrl);
console.log("CHAVE ANON EM USO:", supabaseAnonKey);
console.log("-------------------------------------------");
// --- FIM DO TESTE ---

// Se a URL ou a Chave estiverem vazias, o comando abaixo irÃ¡ falhar.
export const supabase = createClient(supabaseUrl, supabaseAnonKey)

==================================================
ARQUIVO: C:\Users\Eider\NOVVA\novva-rs-saas\src\utils\formatters.js
==================================================
// src/utils/formatters.js
import { format, parseISO } from 'date-fns';

// Nossa nova funÃ§Ã£o de traduÃ§Ã£o
export const formatStatus = (status) => {
  const statusMap = {
    active: 'Ativa',
    inactive: 'Inativa',
    filled: 'Preenchida',
  };
  return statusMap[status] || status;
};

// Movi as outras funÃ§Ãµes de formataÃ§Ã£o para cÃ¡ para centralizar
export const formatPhone = (phone) => {
  if (!phone) return 'NÃ£o informado';
  const cleaned = phone.replace(/\D/g, '');
  if (cleaned.length === 11) {
    return `(${cleaned.substring(0, 2)}) ${cleaned.substring(2, 7)}-${cleaned.substring(7)}`;
  }
  if (cleaned.length === 10) {
    return `(${cleaned.substring(0, 2)}) ${cleaned.substring(2, 6)}-${cleaned.substring(6)}`;
  }
  return phone;
};

export const formatUrl = (url) => {
  if (!url) return '#';
  if (url.startsWith('http://') || url.startsWith('https://')) { return url; }
  return `//${url}`;
};

export const formatDate = (dateStr) => {
    if (!dateStr) return 'NÃ£o informado';
    try {
        return format(parseISO(dateStr), 'dd/MM/yyyy');
    } catch (error) {
        console.error("Erro ao formatar data:", dateStr, error);
        return 'Data invÃ¡lida';
    }
};

